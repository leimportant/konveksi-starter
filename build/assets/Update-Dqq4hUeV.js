import{b as J,G as Q,ar as x,r as K,o as W,a as $,g as u,j as r,q as i,x as e,y as X,z as n,l as a,B as Y,m as T,A as d,F as v,D as g,k as m,P as U,H as Z,M}from"./app-C0ZtNFPV.js";import{_ as tt}from"./AppLayout.vue_vue_type_script_setup_true_lang-CxyMViV1.js";import{_ as V}from"./Button.vue_vue_type_script_setup_true_lang-B6TXREVN.js";import{_ as w}from"./Input.vue_vue_type_script_setup_true_lang-BWB1n0oK.js";import{_ as f}from"./Label.vue_vue_type_script_setup_true_lang-DUa9-7wS.js";import{_ as ot,a as et,b as h,c as y,d as it,e as b}from"./TableRow.vue_vue_type_script_setup_true_lang-CVJoN5Nr.js";import{u as st}from"./useToast-DV2nGitA.js";import{u as lt}from"./useTransferStockStore-B-GCbk1t.js";import{u as nt}from"./useInventoryStore-MPufUS0_.js";import{T as at}from"./trash-C6WxX6NS.js";import"./index-C2dazRLE.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BIT3zfbJ.js";const dt={class:"p-6 space-y-6"},rt={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ut=["value"],_t=["value"],ft=["value"],ct={class:"border rounded p-4"},mt={class:"flex justify-between items-center mb-4"},pt={class:"grid grid-cols-1 sm:grid-cols-5 gap-4 mb-4 items-end"},vt={class:"pt-6 text-center"},gt={class:"flex justify-end gap-2"},yt={key:0,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"},bt={class:"bg-white rounded-lg shadow-lg w-11/12 max-w-4xl p-6"},kt={class:"flex justify-between items-center mb-4"},xt={key:0,class:"text-center py-10"},Vt={key:1},wt=["onClick"],Mt=J({__name:"Update",props:{id:{}},setup(L){const N=[{title:"Transfer Stock",href:"/transfer-stock"}],c=st(),z=lt(),S=nt(),l=Q({location_id:void 0,location_destination_id:void 0,sloc_id:void 0,transfer_detail:[]}),q=x({}),C=x([]),B=x([]),j=x([]),k=K(!1),P=L;W(async()=>{try{await z.fetchTransferByID(P.id),H();const[s,t,o]=await Promise.all([$.get("/api/locations"),$.get("/api/slocs"),$.get("/api/products")]);C.push(...s.data.data),B.push(...t.data.data),j.push(...o.data.data)}catch(s){console.error(s),c.error("Gagal memuat data")}});const O=async()=>{if(!l.location_id||!l.sloc_id){c.error("Pilih lokasi dan sloc terlebih dahulu");return}try{await S.fetchInventory(),k.value=!0}catch(s){console.error(s),c.error("Gagal memuat inventory")}},A=s=>{var o;if(l.transfer_detail.find(_=>_.product_id===s.product.id&&_.size_id===s.size_id&&_.uom_id===s.uom.id)){c.error("Produk ini sudah ada di daftar detail");return}l.transfer_detail.push({product_id:(o=s.product)==null?void 0:o.id,size_id:s.size_id,uom_id:s.uom_id,qty:1}),k.value=!1},F=s=>{const t=j.find(o=>o.id===s);return t?t.name:""},I=s=>{delete q[s]},G=()=>{M.visit("/transfer-stock")},R=s=>{l.transfer_detail.splice(s,1)},E=async()=>{var s;try{if(!l.location_id||!l.location_destination_id||!l.sloc_id){c.error("Semua lokasi dan sloc wajib diisi");return}await z.updateTransfer(String(P.id),{id:P.id,location_id:l.location_id,location_destination_id:l.location_destination_id,sloc_id:l.sloc_id,transfer_detail:l.transfer_detail.map(t=>({product_id:t.product_id,size_id:t.size_id,uom_id:t.uom_id,qty:t.qty}))}),c.success("Transfer berhasil disimpan"),M.visit("/transfer-stock")}catch(t){((s=t.response)==null?void 0:s.status)===422?Object.assign(q,t.response.data.errors):c.error("Gagal menyimpan transfer")}},H=()=>{const s=z.transfer;if(s){l.location_id=s.location_id??void 0,l.location_destination_id=s.location_destination_id??void 0,l.sloc_id=s.sloc_id??void 0;const t=s.transfer_detail?s.transfer_detail.map(o=>({product_id:o.product_id??0,size_id:o.size_id??"",uom_id:o.uom_id??"",qty:o.qty})):[];l.transfer_detail.splice(0,l.transfer_detail.length,...t)}},D=()=>{I("location_id"),I("sloc_id"),l.transfer_detail.splice(0,l.transfer_detail.length)};return(s,t)=>(r(),u(v,null,[i(e(X),{title:"Transfer Stock Management"}),i(tt,{breadcrumbs:N},{default:n(()=>[a("div",dt,[a("div",rt,[a("div",null,[i(e(f),{for:"location_id"},{default:n(()=>t[4]||(t[4]=[d("Lokasi Asal")])),_:1,__:[4]}),T(a("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>e(l).location_id=o),id:"location_id",class:"w-full border rounded p-2",onChange:D},[t[5]||(t[5]=a("option",{disabled:"",value:""},"Pilih lokasi",-1)),(r(!0),u(v,null,g(C,o=>(r(),u("option",{key:o.id,value:o.id},m(o.name),9,ut))),128))],544),[[U,e(l).location_id]])]),a("div",null,[i(e(f),{for:"location_destination_id"},{default:n(()=>t[6]||(t[6]=[d("Lokasi Tujuan")])),_:1,__:[6]}),T(a("select",{"onUpdate:modelValue":t[1]||(t[1]=o=>e(l).location_destination_id=o),id:"location_destination_id",class:"w-full border rounded p-2"},[t[7]||(t[7]=a("option",{disabled:"",value:""},"Pilih lokasi",-1)),(r(!0),u(v,null,g(C,o=>(r(),u("option",{key:o.id,value:o.id},m(o.name),9,_t))),128))],512),[[U,e(l).location_destination_id]])]),a("div",null,[i(e(f),{for:"sloc_id"},{default:n(()=>t[8]||(t[8]=[d("Sloc")])),_:1,__:[8]}),T(a("select",{"onUpdate:modelValue":t[2]||(t[2]=o=>e(l).sloc_id=o),id:"sloc_id",class:"w-full border rounded p-2",onChange:D},[t[9]||(t[9]=a("option",{disabled:"",value:""},"Pilih sloc",-1)),(r(!0),u(v,null,g(B,o=>(r(),u("option",{key:o.id,value:o.id},m(o.name),9,ft))),128))],544),[[U,e(l).sloc_id]])])]),a("div",ct,[a("div",mt,[t[11]||(t[11]=a("h2",{class:"text-lg font-semibold"},"Detail Barang",-1)),i(e(V),{variant:"outline",onClick:O,disabled:!e(l).location_id||!e(l).sloc_id},{default:n(()=>t[10]||(t[10]=[d(" Tambah Baris ")])),_:1,__:[10]},8,["disabled"])]),a("div",pt,[i(e(f),null,{default:n(()=>t[12]||(t[12]=[d("Produk")])),_:1,__:[12]}),i(e(f),null,{default:n(()=>t[13]||(t[13]=[d("Size")])),_:1,__:[13]}),i(e(f),null,{default:n(()=>t[14]||(t[14]=[d("UOM")])),_:1,__:[14]}),i(e(f),null,{default:n(()=>t[15]||(t[15]=[d("Qty")])),_:1,__:[15]}),i(e(f),null,{default:n(()=>t[16]||(t[16]=[d("Action")])),_:1,__:[16]})]),(r(!0),u(v,null,g(e(l).transfer_detail,(o,_)=>(r(),u("div",{key:_,class:"grid grid-cols-1 sm:grid-cols-5 gap-4 mb-4 items-end"},[a("div",null,[i(e(w),{type:"text",value:F(o.product_id),readonly:""},null,8,["value"])]),a("div",null,[i(e(w),{type:"text",modelValue:o.size_id,"onUpdate:modelValue":p=>o.size_id=p,readonly:""},null,8,["modelValue","onUpdate:modelValue"])]),a("div",null,[i(e(w),{type:"text",modelValue:o.uom_id,"onUpdate:modelValue":p=>o.uom_id=p,readonly:""},null,8,["modelValue","onUpdate:modelValue"])]),a("div",null,[i(e(w),{type:"number",min:"1",modelValue:o.qty,"onUpdate:modelValue":p=>o.qty=p},null,8,["modelValue","onUpdate:modelValue"])]),a("div",vt,[i(e(V),{variant:"destructive",size:"sm",onClick:p=>R(_)},{default:n(()=>[i(e(at),{class:"h-4 w-4"})]),_:2},1032,["onClick"])])]))),128))]),a("div",gt,[i(e(V),{onClick:E,class:"bg-indigo-600 text-white py-2 rounded-md hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:n(()=>t[17]||(t[17]=[d("Simpan")])),_:1,__:[17]}),i(e(V),{variant:"outline",onClick:G},{default:n(()=>t[18]||(t[18]=[d("Batal")])),_:1,__:[18]})])]),k.value?(r(),u("div",yt,[a("div",bt,[a("div",kt,[t[19]||(t[19]=a("h3",{class:"text-lg font-semibold"},"Pilih Produk dari Inventory",-1)),a("button",{onClick:t[3]||(t[3]=o=>k.value=!1),class:"text-2xl font-bold text-gray-600 hover:text-gray-900"},"Ã—")]),e(S).loading?(r(),u("div",xt,"Loading inventory...")):(r(),u("div",Vt,[i(e(ot),null,{default:n(()=>[i(e(et),null,{default:n(()=>[i(e(h),{class:"bg-gray-100"},{default:n(()=>[i(e(y),null,{default:n(()=>t[20]||(t[20]=[d("Product")])),_:1,__:[20]}),i(e(y),null,{default:n(()=>t[21]||(t[21]=[d("Size")])),_:1,__:[21]}),i(e(y),null,{default:n(()=>t[22]||(t[22]=[d("UOM")])),_:1,__:[22]}),i(e(y),null,{default:n(()=>t[23]||(t[23]=[d("Stock")])),_:1,__:[23]}),i(e(y),null,{default:n(()=>t[24]||(t[24]=[d("Action")])),_:1,__:[24]})]),_:1})]),_:1}),i(e(it),null,{default:n(()=>[(r(!0),u(v,null,g(e(S).inventory,o=>(r(),Z(e(h),{key:o.id},{default:n(()=>[i(e(b),null,{default:n(()=>{var _;return[d(m((_=o.product)==null?void 0:_.name),1)]}),_:2},1024),i(e(b),null,{default:n(()=>[d(m(o.size_id),1)]),_:2},1024),i(e(b),null,{default:n(()=>[d(m(o.uom_id),1)]),_:2},1024),i(e(b),null,{default:n(()=>[d(m(o.qty),1)]),_:2},1024),i(e(b),null,{default:n(()=>[a("button",{onClick:_=>A(o),class:"text-blue-600 hover:underline"}," Pilih ",8,wt)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]))])])):Y("",!0)]),_:1})],64))}});export{Mt as default};
