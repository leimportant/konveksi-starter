import{b as Q,r as _,e as z,G,o as H,w as J,g as i,j as o,q as d,x as a,y as K,z as V,l as s,k as v,F as D,D as U,N as L,I as q,B as u,M as N,A as S}from"./app-C0ZtNFPV.js";import{_ as O}from"./AppLayout.vue_vue_type_script_setup_true_lang-CxyMViV1.js";import{_ as h}from"./Input.vue_vue_type_script_setup_true_lang-BWB1n0oK.js";import{_ as T}from"./DateInput.vue_vue_type_script_setup_true_lang-2xKITj_b.js";import{_ as w}from"./Button.vue_vue_type_script_setup_true_lang-B6TXREVN.js";import{_ as W}from"./DocumentList.vue_vue_type_script_setup_true_lang-DhWvrvZy.js";import{_ as X,a as Y,b as Z,c as R}from"./ModelMaterialTab.vue_vue_type_script_setup_true_lang-S9BdycTJ.js";import{u as ee}from"./useModelStore-e7qA7dMk.js";import{u as te}from"./useToast-DV2nGitA.js";import"./index-C2dazRLE.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BIT3zfbJ.js";import"./trash-C6WxX6NS.js";import"./useSizeStore-D54fUmtw.js";import"./useProductStore-BuBbG374.js";import"./useMasterActivityRoleStore-DBv0ZGNU.js";import"./useUomStore-CL0R-Ai3.js";const ae={class:"rounded-xl bg-white p-6 shadow-sm dark:bg-gray-800"},se={class:"border-b pb-4"},le={class:"text-2xl font-semibold text-gray-900 dark:text-white"},ie={class:"text-sm text-gray-500 dark:text-gray-400"},oe={class:"my-6 flex space-x-4 border-b dark:border-gray-700"},de=["onClick"],re={key:0,class:"space-y-6"},ne={key:0,class:"text-destructive"},ue={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},me={key:0,class:"text-destructive"},ce={key:0,class:"text-destructive"},ve={key:0,class:"text-destructive"},pe={key:0,class:"text-destructive"},_e={key:0,class:"mt-4 grid grid-cols-2 md:grid-cols-4 gap-4"},fe=["src"],ye={class:"absolute inset-x-0 bottom-0 bg-black/50 p-2 text-white text-xs truncate"},ke={key:1},ge={key:2},be={key:3,class:"space-y-6"},xe={key:4},Ve={key:5},Me={class:"flex justify-end border-t pt-6 dark:border-gray-300 space-x-2"},De="Model",Qe=Q({__name:"CreateModel",props:{modelData:{}},setup(B){const r=B,E=["model","size","activity","document","bahan_dan_biaya","hpp"],m=_("model"),p=z(()=>!!r.modelData),C=_(Math.random().toString(36).substring(2,15)),k=_([]),I=z(()=>p.value?r.modelData.id:C.value),A=c=>k.value.splice(c,1),j=[{title:"Konveksi",href:"/konveksi"},{title:p.value?"Edit Model":"Create Model",href:p.value?`/konveksi/model/${r.modelData.id}/edit`:"/konveksi/model/create"}],$=ee(),b=te(),l=G({description:"",remark:"",start_date:null,end_date:null,estimation_price_pcs:0,estimation_qty:1}),n=_({}),f=_([]),M=_(0),y=_([]),g=_([]);H(()=>{p.value&&(l.description=r.modelData.description,l.remark=r.modelData.remark,l.start_date=r.modelData.start_date,l.end_date=r.modelData.end_date,l.estimation_price_pcs=r.modelData.estimation_price_pcs,l.estimation_qty=r.modelData.estimation_qty,f.value=r.modelData.sizes||[],y.value=r.modelData.activity||[],g.value=r.modelData.modelMaterials||[],k.value=r.modelData.documents||[])}),J(m,c=>{if(c==="size"){const e=f.value.reduce((t,x)=>t+(Number(x.qty)||0),0);M.value=e}});const F=async()=>{var c,e;if(!l.start_date){n.value.start_date=["Tanggal mulai harus diisi"],b.error("Tanggal mulai harus diisi");return}try{p.value?(await $.updateModel(r.modelData.id,{...l,sizes:f.value,activity:y.value,documents:k.value,modelMaterials:g.value}),b.success("Model berhasil diperbarui")):(await $.createModel({...l,sizes:f.value,activity:y.value,uniqId:C.value,documents:k.value,modelMaterials:g.value}),b.success("Model berhasil dibuat")),N.visit("/konveksi/model/list")}catch(t){(e=(c=t.response)==null?void 0:c.data)!=null&&e.errors?(n.value=t.response.data.errors,b.error("Validasi gagal, silakan periksa form")):b.error("Terjadi kesalahan saat menyimpan model")}},P=c=>y.value.find(t=>t.activity_role_id===c)?`Activity ${c}`:"Unknown Activity";return(c,e)=>(o(),i(D,null,[d(a(K),{title:p.value?"Edit Model":"Create Model"},null,8,["title"]),d(O,{breadcrumbs:j},{default:V(()=>[s("div",ae,[s("div",se,[s("h1",le,v(p.value?"Edit Model":"Buat Model Baru"),1),s("p",ie,v(p.value?"Ubah data model, ukuran, dan aktivitas":"Isi data model, ukuran, dan aktivitas"),1)]),s("div",oe,[(o(),i(D,null,U(E,t=>s("button",{key:t,class:L(["pb-2 text-sm font-medium",{"border-b-2 border-primary text-primary":m.value===t,"text-gray-500 hover:text-gray-700":m.value!==t}]),onClick:x=>m.value=t},v(t.charAt(0).toUpperCase()+t.slice(1)),11,de)),64))]),s("form",{onSubmit:q(F,["prevent"]),class:"space-y-6"},[m.value==="model"?(o(),i("div",re,[s("div",null,[e[10]||(e[10]=s("label",{for:"description",class:"text-sm font-medium"},"Nama Model",-1)),d(a(h),{id:"description",modelValue:a(l).description,"onUpdate:modelValue":e[0]||(e[0]=t=>a(l).description=t)},null,8,["modelValue"]),n.value.description?(o(),i("small",ne,v(n.value.description[0]),1)):u("",!0)]),s("div",ue,[s("div",null,[e[11]||(e[11]=s("label",{for:"start_date",class:"text-sm font-medium"},"Tanggal Mulai",-1)),d(a(T),{id:"start_date",modelValue:a(l).start_date,"onUpdate:modelValue":e[1]||(e[1]=t=>a(l).start_date=t)},null,8,["modelValue"]),n.value.start_date?(o(),i("small",me,v(n.value.start_date[0]),1)):u("",!0)]),s("div",null,[e[12]||(e[12]=s("label",{for:"end_date",class:"text-sm font-medium"},"Estimasi Selesai",-1)),d(a(T),{id:"end_date",modelValue:a(l).end_date,"onUpdate:modelValue":e[2]||(e[2]=t=>a(l).end_date=t)},null,8,["modelValue"]),n.value.end_date?(o(),i("small",ce,v(n.value.end_date[0]),1)):u("",!0)]),s("div",null,[e[13]||(e[13]=s("label",{for:"estimation_price_pcs",class:"text-sm font-medium"},"Estimasi Harga",-1)),d(a(h),{id:"estimation_price_pcs",type:"number",modelValue:a(l).estimation_price_pcs,"onUpdate:modelValue":e[3]||(e[3]=t=>a(l).estimation_price_pcs=t)},null,8,["modelValue"]),n.value.estimation_price_pcs?(o(),i("small",ve,v(n.value.estimation_price_pcs[0]),1)):u("",!0)])]),s("div",null,[e[14]||(e[14]=s("label",{for:"remark",class:"text-sm font-medium"},"Catatan",-1)),d(a(h),{id:"remark",modelValue:a(l).remark,"onUpdate:modelValue":e[4]||(e[4]=t=>a(l).remark=t)},null,8,["modelValue"]),n.value.remark?(o(),i("small",pe,v(n.value.remark[0]),1)):u("",!0)]),k.value.length?(o(),i("div",_e,[(o(!0),i(D,null,U(k.value,(t,x)=>(o(),i("div",{key:t.id,class:"relative group border rounded-xl overflow-hidden"},[s("img",{src:t.url,class:"object-cover w-full aspect-square transition-transform group-hover:scale-105"},null,8,fe),s("div",ye,v(t.filename),1),d(a(w),{variant:"destructive",size:"icon",class:"absolute top-2 right-2",onClick:q(he=>A(x),["prevent"])},{default:V(()=>e[15]||(e[15]=[s("i",{class:"pi pi-times"},null,-1)])),_:2,__:[15]},1032,["onClick"])]))),128))])):u("",!0)])):u("",!0),m.value==="size"?(o(),i("div",ke,[d(X,{modelValue:f.value,"onUpdate:modelValue":e[5]||(e[5]=t=>f.value=t),"onUpdate:totalQuantity":e[6]||(e[6]=t=>M.value=t)},null,8,["modelValue"])])):u("",!0),m.value==="activity"?(o(),i("div",ge,[d(Y,{modelValue:y.value,"onUpdate:modelValue":e[7]||(e[7]=t=>y.value=t)},null,8,["modelValue"])])):u("",!0),m.value==="document"?(o(),i("div",be,[d(W,{"reference-id":I.value,"reference-type":De},null,8,["reference-id"])])):u("",!0),m.value==="bahan_dan_biaya"?(o(),i("div",xe,[d(Z,{modelValue:g.value,"onUpdate:modelValue":e[8]||(e[8]=t=>g.value=t)},null,8,["modelValue"])])):u("",!0),m.value==="hpp"?(o(),i("div",Ve,[d(R,{"model-materials":g.value,"activity-items":y.value.map(t=>({...t,activity_name:P(t.activity_role_id)})),"start-date":a(l).start_date,"end-date":a(l).end_date,"total-production":M.value,"size-items":f.value.map(t=>({...t}))},null,8,["model-materials","activity-items","start-date","end-date","total-production","size-items"])])):u("",!0),s("div",Me,[d(a(w),{type:"button",variant:"secondary",onClick:e[9]||(e[9]=t=>a(N).visit("/konveksi"))},{default:V(()=>e[16]||(e[16]=[S("Batal")])),_:1,__:[16]}),d(a(w),{type:"submit",loading:a(l).processing,class:"bg-indigo-600 text-white py-2 rounded-md hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:V(()=>[e[17]||(e[17]=s("i",{class:"pi pi-check"},null,-1)),S(" "+v(p.value?"Perbarui":"Simpan"),1)]),_:1,__:[17]},8,["loading"])])],32)])]),_:1})],64))}});export{Qe as default};
