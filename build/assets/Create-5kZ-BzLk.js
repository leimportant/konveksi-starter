import{b as G,u as h,r as I,L as A,G as N,w as $,o as T,g as i,j as l,q as m,x as d,y as Y,z as f,l as e,I as E,B as F,m as w,F as _,D as b,k as a,P as q,A as k,_ as O}from"./app-C0ZtNFPV.js";import{_ as j}from"./AppLayout.vue_vue_type_script_setup_true_lang-CxyMViV1.js";import{_ as S}from"./Button.vue_vue_type_script_setup_true_lang-B6TXREVN.js";import{_ as x}from"./Input.vue_vue_type_script_setup_true_lang-BWB1n0oK.js";import{u as K}from"./useToast-DV2nGitA.js";import{u as L}from"./useGoodReceiveStore-Bgi3vwLl.js";import{u as Q}from"./useModelStore-e7qA7dMk.js";import{u as z}from"./useUomStore-CL0R-Ai3.js";import{u as H}from"./useProductStore-BuBbG374.js";import"./index-C2dazRLE.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BIT3zfbJ.js";const J={class:"px-2 py-4 sm:px-4 sm:py-6"},W={class:"mx-auto"},X={class:"bg-white rounded-lg shadow p-4 sm:p-6"},Z={class:"grid grid-cols-1 gap-4 sm:grid-cols-2 sm:gap-6"},ee=["value"],te={key:0,class:"mt-4 sm:mt-6"},oe={class:"overflow-x-auto"},se={class:"min-w-full inline-block align-middle"},re={class:"border rounded-lg overflow-hidden sm:border-0 sm:rounded-none"},de={class:"min-w-full divide-y divide-gray-200"},ae={class:"bg-white divide-y divide-gray-200"},ie={class:"px-2 py-1 sm:px-3 sm:py-2 whitespace-nowrap block sm:table-cell"},le={class:"sm:hidden"},ne={class:"font-semibold"},me={class:"text-sm mt-1"},ce={class:"hidden sm:block"},ue={class:"px-3 py-2 whitespace-nowrap hidden sm:table-cell"},pe={class:"px-3 py-2 whitespace-nowrap hidden sm:table-cell"},_e={class:"px-3 py-2 whitespace-nowrap hidden sm:table-cell"},ye={class:"px-3 py-2 whitespace-nowrap sm:table-cell"},fe={class:"px-3 py-2 whitespace-nowrap sm:table-cell"},be=["onUpdate:modelValue"],xe=["value"],ve={class:"flex flex-col sm:flex-row justify-end gap-2 sm:gap-4"},ge=G({__name:"Create",setup(he){var g;const c=K(),V=L(),y=Q(),v=z(),M=H(),{models:R}=h(y),{items:U}=h(v),C=I([]),D=A().props.auth,r=N({date:new Date().toISOString().split("T")[0],model_id:0,description:"",recipent:((g=D.user)==null?void 0:g.name)||"",items:[]});$(()=>r.model_id,async n=>{var o;if(n)try{const p=((o=(await y.fetchModelById(n)).data)==null?void 0:o.model_material)||[];C.value=p,r.items=await Promise.all(p.map(async s=>{try{const u=await M.fetchProductById(s.product_id);return{model_material_id:s.product_id,model_material_desc:(u==null?void 0:u.name)||s.item.toString(),model_material_item:s.item,qty:s.qty,qty_convert:s.qty,uom_base:s.uom_id,uom_convert:"YARD"}}catch(u){return console.error("Error fetching product:",u),{model_material_id:s.product_id,model_material_desc:s.item.toString(),model_material_item:s.item,qty:s.qty,qty_convert:s.qty,uom_base:s.uom_id,uom_convert:"YARD"}}}))}catch(t){console.error("Error fetching model materials:",t)}});const P=[{title:"Good Receive",href:"/good-receive"},{title:"Create",href:"/good-receive/create"}];T(async()=>{await Promise.all([y.fetchModels(),v.fetchUoms()])});const B=async()=>{var n,o;if(!r.model_id)return c.error("Model is required");if(!r.recipent)return c.error("Penerima is required");if(r.items.length===0)return c.error("Minimal 1 material item");try{await V.createGoodReceive({date:r.date,model_id:Number(r.model_id),description:r.description,recipent:r.recipent,items:r.items.map(t=>({model_material_id:t.model_material_id,model_material_desc:t.model_material_desc,model_material_item:t.model_material_item,qty:t.qty,qty_convert:t.qty_convert,qty_base:t.qty,uom_base:t.uom_base,uom_convert:t.uom_convert}))}),c.success("Good Receive created successfully"),window.location.href="/good-receive"}catch(t){c.error(((o=(n=t==null?void 0:t.response)==null?void 0:n.data)==null?void 0:o.message)??"Failed to create Good Receive")}};return(n,o)=>(l(),i(_,null,[m(d(Y),{title:"Buat Penerimaan Barang / Kain"}),m(j,{breadcrumbs:P},{default:f(()=>[e("div",J,[e("div",W,[e("div",X,[o[13]||(o[13]=e("h2",{class:"text-base sm:text-lg font-semibold mb-4 sm:mb-6"},"Penerimaan Kain",-1)),e("form",{onSubmit:E(B,["prevent"]),class:"space-y-4 sm:space-y-6"},[e("div",Z,[e("div",null,[o[4]||(o[4]=e("label",{class:"block text-sm font-medium mb-1"},"Date",-1)),m(d(x),{type:"date",modelValue:d(r).date,"onUpdate:modelValue":o[0]||(o[0]=t=>d(r).date=t),required:""},null,8,["modelValue"])]),e("div",null,[o[6]||(o[6]=e("label",{class:"block text-sm font-medium mb-1"},"Model",-1)),w(e("select",{"onUpdate:modelValue":o[1]||(o[1]=t=>d(r).model_id=t),class:"w-full rounded-md border border-input px-3 py-2",required:""},[o[5]||(o[5]=e("option",{value:"0"},"Select Model",-1)),(l(!0),i(_,null,b(d(R),t=>(l(),i("option",{key:t.id,value:t.id},a(t.description),9,ee))),128))],512),[[q,d(r).model_id]])])]),e("div",null,[o[7]||(o[7]=e("label",{class:"block text-sm font-medium mb-1"},"Penerima",-1)),m(d(x),{modelValue:d(r).recipent,"onUpdate:modelValue":o[2]||(o[2]=t=>d(r).recipent=t),required:""},null,8,["modelValue"])]),d(r).items.length>0?(l(),i("div",te,[o[10]||(o[10]=e("h3",{class:"text-sm sm:text-md font-medium mb-2"},"Material Items",-1)),e("div",oe,[e("div",se,[e("div",re,[e("table",de,[o[9]||(o[9]=e("thead",{class:"bg-gray-50 hidden sm:table-header-group"},[e("tr",null,[e("th",{class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Material"),e("th",{class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Item"),e("th",{class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Qty"),e("th",{class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"UOM"),e("th",{class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Qty Conv"),e("th",{class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"UOM Conv")])],-1)),e("tbody",ae,[(l(!0),i(_,null,b(d(r).items,(t,p)=>(l(),i("tr",{key:p,class:"block sm:table-row mb-2 sm:mb-0 border-b sm:border-b-0"},[e("td",ie,[e("div",le,[e("div",ne,a(t.model_material_id)+" - "+a(t.model_material_desc),1),e("div",me,a(t.qty)+" "+a(t.uom_base),1)]),e("div",ce,a(t.model_material_id)+" - "+a(t.model_material_desc),1)]),e("td",ue,a(t.model_material_item),1),e("td",pe,a(t.qty),1),e("td",_e,a(t.uom_base),1),e("td",ye,[m(d(x),{type:"number",modelValue:t.qty_convert,"onUpdate:modelValue":s=>t.qty_convert=s,step:"0.01",min:"0",class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),e("td",fe,[w(e("select",{"onUpdate:modelValue":s=>t.uom_convert=s,class:"w-full rounded-md border border-input px-2 py-1 text-sm"},[o[8]||(o[8]=e("option",{value:"YARD"},"YARD",-1)),(l(!0),i(_,null,b(d(U),s=>(l(),i("option",{key:s.id,value:s.name},a(s.name),9,xe))),128))],8,be),[[q,t.uom_convert]])])]))),128))])])])])])])):F("",!0),e("div",ve,[m(d(S),{type:"button",variant:"outline",onClick:o[3]||(o[3]=t=>n.$inertia.visit("/good-receive"))},{default:f(()=>o[11]||(o[11]=[k(" Cancel ")])),_:1,__:[11]}),m(d(S),{type:"submit",class:"bg-indigo-600 text-white py-2 rounded-md hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:f(()=>o[12]||(o[12]=[k("Simpan")])),_:1,__:[12]})])],32)])])])]),_:1})],64))}}),Ge=O(ge,[["__scopeId","data-v-1fe7376b"]]);export{Ge as default};
