import{d as J,a as w,b as K,r as x,G as O,u as Q,o as W,e as X,g as _,j as m,q as n,x as o,y as Y,z as d,l as i,B as A,A as p,F as $,D as S,H as Z,k as M,I as ee}from"./app-C0ZtNFPV.js";import{u as se,_ as te}from"./AppLayout.vue_vue_type_script_setup_true_lang-CxyMViV1.js";import{_ as g}from"./Button.vue_vue_type_script_setup_true_lang-B6TXREVN.js";import{_ as ae}from"./Input.vue_vue_type_script_setup_true_lang-BWB1n0oK.js";import{_ as le,a as oe,b as T,c as N,d as ne,e as V}from"./TableRow.vue_vue_type_script_setup_true_lang-CVJoN5Nr.js";import{u as ie}from"./useToast-DV2nGitA.js";import{P as j}from"./plus-jsIhsatj.js";import{T as re}from"./trash-2-Bt8Dqp-q.js";import"./index-C2dazRLE.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BIT3zfbJ.js";const de=J("role",{state:()=>({items:[],loaded:!1}),actions:{async fetchRoles(){if(!this.loaded)try{const f=await w.get("/api/roles");this.items=f.data.data,this.loaded=!0}catch(f){console.error("Failed to fetch Roles",f)}},async createRole(f){try{await w.post("/api/roles",{name:f}),await this.fetchRoles()}catch(c){throw c}},async updateRole(f,c){try{await w.put(`/api/roles/${f}`,{name:c}),await this.fetchRoles()}catch(v){throw v}},async deleteRole(f){try{await w.delete(`/api/roles/${f}`),await this.fetchRoles()}catch(c){throw c}},async assignMenusToRole(f,c){try{await w.post(`/api/roles/${f}/assign-menus`,{menus:c})}catch(v){throw v}}}}),ce={class:"px-4 py-4"},ue={class:"flex justify-between items-center mb-6"},fe={class:"rounded-md border"},me={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},he={class:"bg-white p-6 rounded-lg w-96"},_e={class:"text-lg font-semibold mb-4"},ve={class:"flex items-center mb-2 border-b pb-2"},pe=["checked"],ge={class:"mb-4 max-h-60 overflow-y-auto"},ye={class:"flex items-center"},be=["id","checked","onChange"],ke=["for"],we={key:0,class:"ml-6"},xe=["id","checked","onChange"],Ce=["for"],Re={class:"flex justify-end gap-2"},$e={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Me={class:"bg-white p-6 rounded-lg w-96"},Ae={class:"mb-4"},Se={class:"flex justify-end gap-2"},Pe=K({__name:"Index",setup(f){const c=ie(),v=x(!1),C=x(!1),y=x(null),b=x([]),r=x([]),k=O({name:""}),B=[{title:"Role",href:"/roles"}],h=de(),{items:F}=Q(h),z=se();W(()=>{h.fetchRoles()});const I=async()=>{var a,e;if(!y.value)return c.error("No role selected");try{await h.assignMenusToRole(y.value.id,r.value),c.success("Menus assigned successfully"),C.value=!1}catch(l){c.error(((e=(a=l==null?void 0:l.response)==null?void 0:a.data)==null?void 0:e.message)??"Failed to assign menus")}},q=async a=>{var e;y.value=a,r.value=((e=y.value.menus)==null?void 0:e.map(l=>l.id))||[],b.value=await z.fetchAllMenus(),C.value=!0},D=async()=>{var a,e,l,s;if(!k.name)return c.error("Name is required");try{await h.createRole(k.name),c.success("Role created successfully"),k.reset(),h.loaded=!1,await h.fetchRoles(),v.value=!1}catch(t){const u=(s=(l=(e=(a=t==null?void 0:t.response)==null?void 0:a.data)==null?void 0:e.errors)==null?void 0:l.name)==null?void 0:s[0];c.error(u||"Failed to create role")}},P=async a=>{var e,l;if(confirm("Are you sure you want to delete this role?"))try{await h.deleteRole(a),c.success("Role deleted successfully"),h.loaded=!1,await h.fetchRoles()}catch(s){c.error(((l=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:l.message)??"Failed to delete role")}},R=a=>r.value.includes(a),E=a=>{var s;const e=a.id,l=((s=a.children)==null?void 0:s.map(t=>t.id))||[];if(R(e))r.value=r.value.filter(t=>t!==e&&!l.includes(t));else{r.value.push(e);for(const t of l)r.value.includes(t)||r.value.push(t)}},U=(a,e)=>{var l;if(R(e)){r.value=r.value.filter(u=>u!==e);const s=b.value.find(u=>u.id===a);((l=s==null?void 0:s.children)==null?void 0:l.some(u=>r.value.includes(u.id)))||(r.value=r.value.filter(u=>u!==a))}else r.value.push(e),r.value.includes(a)||r.value.push(a)},G=a=>{if(a.target.checked){const l=b.value.flatMap(s=>{var u;const t=((u=s.children)==null?void 0:u.map(L=>L.id))||[];return[s.id,...t]}).filter(s=>typeof s=="number");r.value=[...new Set(l)]}else r.value=[]},H=X(()=>{const a=b.value.flatMap(e=>{var s;const l=((s=e.children)==null?void 0:s.map(t=>t.id))||[];return[e.id,...l]}).filter(e=>typeof e=="number");return a.length>0&&a.every(e=>r.value.includes(e))});return(a,e)=>(m(),_($,null,[n(o(Y),{title:"Role Management"}),n(te,{breadcrumbs:B},{default:d(()=>{var l;return[i("div",ce,[i("div",ue,[n(o(g),{onClick:e[0]||(e[0]=s=>v.value=!0),class:"bg-indigo-600 text-white py-2 rounded-md hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:d(()=>[n(o(j),{class:"h-4 w-4"}),e[4]||(e[4]=p(" Tambah Role "))]),_:1,__:[4]})]),i("div",fe,[n(o(le),null,{default:d(()=>[n(o(oe),null,{default:d(()=>[n(o(T),{class:"bg-gray-100"},{default:d(()=>[n(o(N),null,{default:d(()=>e[5]||(e[5]=[p("Name")])),_:1,__:[5]}),n(o(N),{class:"w-24"},{default:d(()=>e[6]||(e[6]=[p("Actions")])),_:1,__:[6]})]),_:1})]),_:1}),n(o(ne),null,{default:d(()=>[(m(!0),_($,null,S(o(F),s=>(m(),Z(o(T),{key:s.id},{default:d(()=>[n(o(V),null,{default:d(()=>[p(M(s.name),1)]),_:2},1024),n(o(V),{class:"flex gap-2"},{default:d(()=>[n(o(g),{variant:"ghost",size:"icon",onClick:t=>q(s)},{default:d(()=>[n(o(j),{class:"h-4 w-4"})]),_:2},1032,["onClick"]),n(o(g),{variant:"ghost",size:"icon",onClick:t=>P(s.id)},{default:d(()=>[n(o(re),{class:"h-4 w-4"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),C.value?(m(),_("div",me,[i("div",he,[i("h2",_e,"Assign Menu to "+M((l=y.value)==null?void 0:l.name),1),i("div",ve,[i("input",{type:"checkbox",id:"check-all",checked:H.value,onChange:G,class:"mr-2"},null,40,pe),e[7]||(e[7]=i("label",{for:"check-all",class:"font-medium"},"Check / Uncheck All",-1))]),i("div",ge,[(m(!0),_($,null,S(b.value,s=>(m(),_("div",{key:s.id,class:"mb-2"},[i("div",ye,[i("input",{type:"checkbox",id:`menu-${s.id}`,checked:R(s.id),onChange:t=>E(s),class:"mr-2"},null,40,be),i("label",{for:`menu-${s.id}`},M(s.title),9,ke)]),s.children&&s.children.length?(m(),_("div",we,[(m(!0),_($,null,S(s.children,t=>(m(),_("div",{key:t.id,class:"flex items-center mb-1"},[i("input",{type:"checkbox",id:`menu-${t.id}`,checked:R(t.id),onChange:u=>U(s.id,t.id),class:"mr-2"},null,40,xe),i("label",{for:`menu-${t.id}`},M(t.title),9,Ce)]))),128))])):A("",!0)]))),128))]),i("div",Re,[n(o(g),{type:"button",variant:"outline",onClick:e[1]||(e[1]=s=>C.value=!1)},{default:d(()=>e[8]||(e[8]=[p("Cancel")])),_:1,__:[8]}),n(o(g),{type:"submit",onClick:I},{default:d(()=>e[9]||(e[9]=[p("Assign")])),_:1,__:[9]})])])])):A("",!0),v.value?(m(),_("div",$e,[i("div",Me,[e[12]||(e[12]=i("h2",{class:"text-lg font-semibold mb-4"},"Tambah Role Baru",-1)),i("form",{onSubmit:ee(D,["prevent"])},[i("div",Ae,[n(o(ae),{modelValue:o(k).name,"onUpdate:modelValue":e[2]||(e[2]=s=>o(k).name=s),placeholder:"Role Name",required:""},null,8,["modelValue"])]),i("div",Se,[n(o(g),{type:"button",variant:"outline",onClick:e[3]||(e[3]=s=>v.value=!1)},{default:d(()=>e[10]||(e[10]=[p("Cancel")])),_:1,__:[10]}),n(o(g),{type:"submit"},{default:d(()=>e[11]||(e[11]=[p("Create")])),_:1,__:[11]})])],32)])])):A("",!0)])]}),_:1})],64))}});export{Pe as default};
