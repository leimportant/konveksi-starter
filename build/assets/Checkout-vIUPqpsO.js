import{b as O,r as c,e as D,o as Q,M as k,a as M,g as n,j as l,q as p,x as m,y as J,z as g,l as t,B as b,A as y,k as d,V as W,F as j,D as L,m as $,W as K}from"./app-C0ZtNFPV.js";import{_ as x}from"./Button.vue_vue_type_script_setup_true_lang-B6TXREVN.js";import{u as Y}from"./useToast-DV2nGitA.js";import{_ as X}from"./AppLayout.vue_vue_type_script_setup_true_lang-CxyMViV1.js";import{u as Z}from"./useCartStore-pAcp0Plh.js";import"./index-C2dazRLE.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BIT3zfbJ.js";const ee={class:"container mx-auto px-4 py-8"},te={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-gray-600 bg-opacity-75"},se={class:"w-full max-w-md rounded-lg bg-white p-8 text-center shadow-xl"},re={key:0},oe={class:"mb-4 text-lg"},ae={class:"font-semibold"},ne={class:"mb-6 flex justify-center"},le={key:1,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex justify-center items-center"},ie={class:"bg-white p-8 rounded-lg shadow-xl max-w-md w-full"},de={key:0,class:"bg-gray-100 p-4 rounded-md mb-6"},ue=["innerHTML"],ce={class:"text-center mb-4"},pe={class:"flex justify-end gap-2"},me={key:2,class:"grid grid-cols-1 gap-8 lg:grid-cols-3"},fe={class:"mb-8 rounded-2xl bg-white p-8 shadow-xl lg:col-span-2"},ge={key:0,class:"mt-2 text-sm text-green-600 font-medium mb-4"},be={class:"flex items-center space-x-4"},ye=["src"],_e={class:"flex-1"},ve={class:"text-sm text-gray-900"},ke={class:"text-sm text-gray-600"},xe={class:"text-sm text-gray-600"},he={class:"text-sm font-bold text-gray-900"},we={key:0,class:"text-sm text-gray-500 line-through"},Pe={class:"mt-4 space-y-4 border-gray-300 pt-6"},Ce={class:"flex items-center justify-between text-sm font-semibold text-gray-800"},Ie={class:"flex items-center justify-between text-sm font-semibold text-gray-800"},De={class:"flex items-center justify-between border-t border-gray-200 pt-4 text-sm font-bold text-gray-900"},Me={class:"rounded-2xl bg-white p-8 shadow-xl lg:col-span-1"},je={class:"space-y-4"},Te={class:"flex cursor-pointer items-center rounded-sm border border-gray-200 p-4 shadow-sm transition-all duration-200 has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 has-[:checked]:ring-2 has-[:checked]:ring-blue-500"},Be=["innerHTML"],qe={class:"flex cursor-pointer items-center rounded-sm border border-gray-200 p-4 shadow-sm transition-all duration-200 has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 has-[:checked]:ring-2 has-[:checked]:ring-blue-500"},Se=["innerHTML"],Ae={class:"mt-8 flex justify-end space-x-4"},Fe={key:3,class:"text-center text-gray-600"},Ne=O({__name:"Checkout",props:{user:Object},setup(N){const R=N,_=Z(),f=Y(),T=c(!1),P=c(null),C=c(null),B=c(!1),q=c(null),u=c(null),S=c(null),A=c(null),h=c(null),V=D(()=>_.cartItems.reduce((r,e)=>e.price_sell_grosir&&e.quantity>1?r+(e.quantity||0)*(e.price_sell_grosir||0):r+(e.quantity||0)*(e.price_sell||0),0)),U=D(()=>_.cartItems.reduce((r,e)=>{if(e.price_sell_grosir&&e.quantity>1){const i=e.price_grosir||0,v=e.price_sell_grosir||0,I=i-v;return r+I*(e.quantity||0)}const s=e.price||0,a=e.price_sell||0,o=s-a;return r+o*(e.quantity||0)},0)),H=D(()=>V.value-U.value);function w(r){const e=typeof r=="string"?parseFloat(r):r;return!e||e<=0?"-":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:2}).format(e)}const F=D(()=>_.cartItems);Q(async()=>{_.cartItems.length===0&&(f.warning("Your cart is empty. Please add items before checking out."),k.visit("/home"));try{const r=await M.get("/api/setting/cod_store");S.value=r.data.message}catch(r){console.error("Error fetching COD store setting:",r),S.value="Could not load COD store information."}try{const r=await M.get("/api/setting/bank_transfer");A.value=r.data.message}catch(r){console.error("Error fetching bank transfer setting:",r),A.value="Could not load bank transfer information."}});const E=async()=>{var r;if(!u.value){f.error("Silahkan pilih metode pembayaran.");return}if(confirm("Apakah anda yakin ingin proses?"))try{const e={customer_id:(r=R.user)==null?void 0:r.customer_id,items:_.cartItems.filter(o=>{var i;return(i=o.product)==null?void 0:i.id}).map(o=>{var i,v;return{product_id:o.product.id,quantity:o.quantity,price:o.price||0,price_sell:o.price_sell||0,size_id:o.size_id??((i=o.product)==null?void 0:i.size_id)??"",uom_id:o.uom_id??((v=o.product)==null?void 0:v.uom_id)??"PCS",discount:(o.price||0)-(o.price_sell||0)}}),payment_method:u.value,total_amount:H.value};u.value!=="bank_transfer"&&h.value&&(e.payment_proof=h.value);const s=new FormData;for(const o in e)e[o]!==null&&(o==="items"?e.items.forEach((i,v)=>{for(const I in i)s.append(`items[${v}][${I}]`,i[I])}):s.append(o,e[o]));const a=await M.post("/api/orders",s,{headers:{"Content-Type":"multipart/form-data"}});f.success("Berhasil!"),_.clearCart(),u.value==="cod_store"?(P.value=a.data.order.id,T.value=!0):u.value==="bank_transfer"?(C.value=a.data.order.id,B.value=!0,q.value=a.data.bank_account_info):k.visit("/")}catch(e){f.error("Gagal memproses checkout."),console.error("Checkout error:",e)}},G=async()=>{if(!h.value||!C.value){f.error("Silahkan pilih bukti transfer dan pastikan order ID tersedia.");return}const r=new FormData;r.append("payment_proof",h.value);try{await M.post(`/api/order/${C.value}/upload-payment-proof`,r,{headers:{"Content-Type":"multipart/form-data"}}),f.success("Bukti transfer berhasil diunggah!"),B.value=!1,k.visit("/")}catch(e){f.error("Gagal mengunggah bukti transfer."),console.error("Upload payment proof error:",e)}},z=()=>{k.visit("/home")};return(r,e)=>(l(),n(j,null,[p(m(J),{title:"Checkout Produk"}),p(X,null,{default:g(()=>[t("div",ee,[T.value?(l(),n("div",te,[t("div",se,[e[8]||(e[8]=t("h2",{class:"mb-4 text-xl font-bold"},"Pesanan Dikonfirmasi!",-1)),P.value?(l(),n("div",re,[t("p",oe,[e[5]||(e[5]=y(" ID Pesanan Anda: ")),t("span",ae,d(P.value),1)]),e[7]||(e[7]=t("p",{class:"text-md mb-6 text-gray-600"},"Silakan tunjukkan QR code ini di toko untuk melakukan pembayaran.",-1)),t("div",ne,[p(W,{value:P.value,size:200,level:"H"},null,8,["value"])]),p(m(x),{onClick:e[0]||(e[0]=s=>m(k).visit("/"))},{default:g(()=>e[6]||(e[6]=[y("Kembali ke Beranda")])),_:1,__:[6]})])):b("",!0)])])):b("",!0),B.value?(l(),n("div",le,[t("div",ie,[e[12]||(e[12]=t("h2",{class:"text-2xl font-bold mb-4 text-center"},"Pesanan Berhasil!",-1)),e[13]||(e[13]=t("p",{class:"text-center mb-4"},"Pesanan Anda berhasil dibuat. Silakan transfer total pembayaran ke rekening berikut:",-1)),q.value?(l(),n("div",de,[e[9]||(e[9]=t("p",{class:"font-semibold"},"Informasi Rekening Bank:",-1)),t("div",{innerHTML:q.value},null,8,ue)])):b("",!0),t("p",ce,"ID Pesanan: "+d(C.value),1),e[14]||(e[14]=t("label",{for:"paymentProofUpload",class:"block text-sm font-medium text-gray-700 mb-2"},"Unggah Bukti Transfer",-1)),t("input",{type:"file",id:"paymentProofUpload",onChange:e[1]||(e[1]=s=>{var a;return h.value=((a=s.target.files)==null?void 0:a[0])||null}),class:"mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 mb-4"},null,32),t("div",pe,[p(m(x),{onClick:G,class:"bg-indigo-600 text-white py-2 rounded-md hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:g(()=>e[10]||(e[10]=[y("Kirim Bukti Pembayaran")])),_:1,__:[10]}),p(m(x),{onClick:e[2]||(e[2]=s=>m(k).visit("/")),type:"button",variant:"outline"},{default:g(()=>e[11]||(e[11]=[y("Nanti Saja")])),_:1,__:[11]})])])])):b("",!0),F.value.length>0&&!T.value?(l(),n("div",me,[t("div",fe,[e[18]||(e[18]=t("h2",{class:"mb-6 text-l text-gray-800"},"Rincian Pesanan",-1)),(l(!0),n(j,null,L(F.value,s=>{var a;return l(),n(j,{key:(a=s.product)==null?void 0:a.id},[s.price_sell_grosir&&s.discount_grosir&&s.quantity>1?(l(),n("div",ge," ðŸŽ‰ Hore, selamat Anda mendapatkan promo harga grosir dengan pembelian lebih dari 1! ")):b("",!0)],64)}),128)),(l(!0),n(j,null,L(F.value,s=>{var a,o,i;return l(),n("div",{key:(a=s.product)==null?void 0:a.id,class:"mb-6 flex items-center justify-between border-b border-gray-200 pb-4 last:mb-0 last:border-b-0"},[t("div",be,[(o=s.product)!=null&&o.image?(l(),n("img",{key:0,src:s.product.image,alt:"Gambar Produk",class:"h-14 w-14 rounded-lg object-cover shadow-md"},null,8,ye)):b("",!0),t("div",_e,[t("p",ve,d(((i=s.product)==null?void 0:i.name)??"Produk Tidak Dikenal"),1),t("p",ke,"Jumlah: "+d(s.quantity),1),t("p",xe,"Ukuran: "+d(s.size_id)+" - "+d(s.uom_id),1)])]),t("div",null,[t("p",he,d(w(s.quantity>1&&s.price_sell_grosir?s.price_sell_grosir:s.price_sell??0)),1),s.quantity>1&&s.price_sell_grosir&&s.price||s.price_sell&&s.price_sell<s.price?(l(),n("p",we,d(w(s.price)),1)):b("",!0)])])}),128)),t("div",Pe,[t("div",Ce,[e[15]||(e[15]=t("span",null,"Subtotal:",-1)),t("span",null,d(w(V.value)),1)]),t("div",Ie,[e[16]||(e[16]=t("span",null,"Diskon:",-1)),t("span",null,"- "+d(w(U.value)),1)]),t("div",De,[e[17]||(e[17]=t("span",null,"Total:",-1)),t("span",null,d(w(H.value)),1)])])]),t("div",Me,[e[23]||(e[23]=t("h2",{class:"mb-6 text-sm font-bold text-gray-800"},"Metode Pembayaran",-1)),t("div",je,[t("label",Te,[$(t("input",{type:"radio",name:"paymentMethod",value:"cod_store","onUpdate:modelValue":e[3]||(e[3]=s=>u.value=s),class:"form-radio h-5 w-5 text-blue-600"},null,512),[[K,u.value]]),e[19]||(e[19]=t("span",{class:"ml-4 text-sm font-medium text-gray-800"},"Bayar di Toko",-1))]),t("div",{class:"rounded border border-green-600 p-1 text-xs text-black",innerHTML:S.value},null,8,Be),t("label",qe,[$(t("input",{type:"radio",name:"paymentMethod",value:"bank_transfer","onUpdate:modelValue":e[4]||(e[4]=s=>u.value=s),class:"form-radio h-5 w-5 text-blue-600"},null,512),[[K,u.value]]),e[20]||(e[20]=t("span",{class:"ml-4 text-sm font-medium text-gray-800"},"Transfer Bank",-1))]),t("div",{class:"rounded border border-green-600 p-1 text-xs text-black",innerHTML:A.value},null,8,Se),t("div",Ae,[p(m(x),{onClick:z,class:"w-full bg-orange-600 text-white py-2 rounded-md hover:bg-orange-700 focus:ring-2 focus:ring-indigo-500"},{default:g(()=>e[21]||(e[21]=[y("Batal")])),_:1,__:[21]}),p(m(x),{onClick:E,class:"w-full bg-indigo-600 text-white py-2 rounded-md hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:g(()=>e[22]||(e[22]=[y("Proses")])),_:1,__:[22]})])])])])):(l(),n("div",Fe,[e[25]||(e[25]=t("p",null,"Keranjang Anda kosong. Silakan tambahkan produk terlebih dahulu sebelum checkout.",-1)),p(m(x),{class:"mt-4",onClick:z},{default:g(()=>e[24]||(e[24]=[y("Kembali ke Keranjang")])),_:1,__:[24]})]))])]),_:1})],64))}});export{Ne as default};
