import{b as A,r as c,G as D,o as j,g as i,j as r,q as d,x as a,y as F,z as g,l,F as z,D as P,N as y,k as v,I as G,B as n,M as C,A as w}from"./app-C0ZtNFPV.js";import{_ as H}from"./AppLayout.vue_vue_type_script_setup_true_lang-CxyMViV1.js";import{_ as x}from"./Input.vue_vue_type_script_setup_true_lang-BWB1n0oK.js";import{_ as N}from"./DateInput.vue_vue_type_script_setup_true_lang-2xKITj_b.js";import{_ as T}from"./Button.vue_vue_type_script_setup_true_lang-B6TXREVN.js";import{_ as J}from"./DocumentList.vue_vue_type_script_setup_true_lang-DhWvrvZy.js";import{_ as K,a as L,b as Q,c as O}from"./ModelMaterialTab.vue_vue_type_script_setup_true_lang-S9BdycTJ.js";import{u as W}from"./useModelStore-e7qA7dMk.js";import{u as X}from"./useToast-DV2nGitA.js";import"./index-C2dazRLE.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BIT3zfbJ.js";import"./trash-C6WxX6NS.js";import"./useSizeStore-D54fUmtw.js";import"./useProductStore-BuBbG374.js";import"./useMasterActivityRoleStore-DBv0ZGNU.js";import"./useUomStore-CL0R-Ai3.js";const Y={class:"rounded-xl bg-white p-6 shadow-sm dark:bg-gray-800"},Z={class:"my-6 flex space-x-4 border-b dark:border-gray-700"},R=["onClick"],ee={key:0,class:"space-y-6"},te={key:0,class:"text-destructive"},ae={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},se={key:0,class:"text-destructive"},le={key:0,class:"text-destructive"},oe={key:0,class:"text-destructive"},de={key:0,class:"text-destructive"},ie={key:1},re={key:2},ne={key:3,class:"space-y-6"},me={key:4},ue={key:5},ce={class:"flex justify-end gap-2"},pe="Model",Te=A({__name:"UpdateModel",props:{modelId:{}},setup(E){const k=E,S=c(Number(k.modelId)).value??"",V=["model","size","activity","document","bahan dan biaya","hpp"],m=c(V[0]),o=c({}),h=[{title:"Konveksi",href:"/konveksi"},{title:"Edit Model",href:`/konveksi/model/${k.modelId}/edit`}],M=W(),b=X(),s=D({description:"",remark:"",start_date:null,end_date:null,estimation_price_pcs:0,estimation_qty:1}),$=c([]),_=c([]),U=c(0),p=c([]),f=c([]),B=async()=>{var u,t;try{await M.updateModel(k.modelId,{...s,sizes:_.value,activity:p.value,documents:$.value,modelMaterials:f.value}),b.success("Model berhasil diperbarui"),C.visit("/konveksi/model/list")}catch(e){const I=((t=(u=e==null?void 0:e.response)==null?void 0:u.data)==null?void 0:t.message)||"Gagal memperbarui model";b.error(I)}};j(async()=>{var u,t;try{const e=await M.fetchModelById(k.modelId);console.log("Model Data:",e),e&&(s.description=e.data.description,s.remark=e.data.remark,s.start_date=e.data.start_date?e.data.start_date.split("T")[0]:"",s.end_date=e.data.end_date?e.data.end_date.split("T")[0]:"",s.estimation_price_pcs=e.data.estimation_price_pcs,s.estimation_qty=e.data.estimation_qty,_.value=e.data.sizes||[],p.value=e.data.activities||[],$.value=e.data.documents||[],f.value=e.data.modelMaterials||[])}catch(e){(t=(u=e.response)==null?void 0:u.data)!=null&&t.errors?(o.value=e.response.data.errors,b.error("Validasi gagal, silakan periksa form")):b.error("Terjadi kesalahan saat membuat model")}});const q=u=>{const t=p.value.find(e=>e.activity_role_id===u);return(t==null?void 0:t.activity_name)||`Activity ${u}`};return(u,t)=>(r(),i(z,null,[d(a(F),{title:"Edit Model"}),d(H,{breadcrumbs:h},{default:g(()=>[l("div",Y,[t[17]||(t[17]=l("div",{class:"border-b pb-4"},[l("h1",{class:"text-2xl font-semibold text-gray-900 dark:text-white"},"Edit Model"),l("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Edit data model, ukuran, dan aktivitas")],-1)),l("div",Z,[(r(),i(z,null,P(V,e=>l("button",{key:e,class:y(["pb-2 text-sm font-medium",{"border-b-2 border-primary text-primary":m.value===e,"text-gray-500 hover:text-gray-700":m.value!==e}]),onClick:I=>m.value=e},v(e.charAt(0).toUpperCase()+e.slice(1)),11,R)),64))]),l("form",{onSubmit:G(B,["prevent"]),class:"space-y-6"},[m.value==="model"?(r(),i("div",ee,[l("div",null,[t[10]||(t[10]=l("label",{for:"description",class:"text-sm font-medium"},"Nama Model",-1)),d(a(x),{id:"description",modelValue:a(s).description,"onUpdate:modelValue":t[0]||(t[0]=e=>a(s).description=e),placeholder:""},null,8,["modelValue"]),o.value.description?(r(),i("small",te,v(o.value.description[0]),1)):n("",!0)]),l("div",ae,[l("div",null,[t[11]||(t[11]=l("label",{for:"start_date",class:"text-sm font-medium"},"Tanggal Mulai",-1)),d(a(N),{modelValue:a(s).start_date,"onUpdate:modelValue":t[1]||(t[1]=e=>a(s).start_date=e),id:"start_date",class:y({"border-destructive":o.value.start_date})},null,8,["modelValue","class"]),o.value.start_date?(r(),i("small",se,v(o.value.start_date[0]),1)):n("",!0)]),l("div",null,[t[12]||(t[12]=l("label",{for:"end_date",class:"text-sm font-medium"},"Estimasi Selesai",-1)),d(a(N),{modelValue:a(s).end_date,"onUpdate:modelValue":t[2]||(t[2]=e=>a(s).end_date=e),id:"end_date",class:y({"border-destructive":o.value.end_date})},null,8,["modelValue","class"]),o.value.end_date?(r(),i("small",le,v(o.value.end_date[0]),1)):n("",!0)]),l("div",null,[t[13]||(t[13]=l("label",{for:"estimation_price_pcs",class:"text-sm font-medium"},"Estimasi Harga",-1)),d(a(x),{type:"number",modelValue:a(s).estimation_price_pcs,"onUpdate:modelValue":t[3]||(t[3]=e=>a(s).estimation_price_pcs=e),id:"estimation_price_pcs",class:y({"border-destructive":o.value.estimation_price_pcs})},null,8,["modelValue","class"]),o.value.estimation_price_pcs?(r(),i("small",oe,v(o.value.estimation_price_pcs[0]),1)):n("",!0)])]),l("div",null,[t[14]||(t[14]=l("label",{for:"remark",class:"text-sm font-medium"},"Catatan",-1)),d(a(x),{modelValue:a(s).remark,"onUpdate:modelValue":t[4]||(t[4]=e=>a(s).remark=e),id:"remark",placeholder:"",class:y({"border-destructive":o.value.remark})},null,8,["modelValue","class"]),o.value.remark?(r(),i("small",de,v(o.value.remark[0]),1)):n("",!0)])])):n("",!0),m.value==="size"?(r(),i("div",ie,[d(K,{modelValue:_.value,"onUpdate:modelValue":t[5]||(t[5]=e=>_.value=e),"onUpdate:totalQuantity":t[6]||(t[6]=e=>U.value=e)},null,8,["modelValue"])])):n("",!0),m.value==="activity"?(r(),i("div",re,[d(L,{modelValue:p.value,"onUpdate:modelValue":t[7]||(t[7]=e=>p.value=e)},null,8,["modelValue"])])):n("",!0),m.value==="document"?(r(),i("div",ne,[d(J,{"reference-id":a(S),"reference-type":pe},null,8,["reference-id"])])):n("",!0),m.value==="bahan dan biaya"?(r(),i("div",me,[d(Q,{modelValue:f.value,"onUpdate:modelValue":t[8]||(t[8]=e=>f.value=e)},null,8,["modelValue"])])):n("",!0),m.value==="hpp"?(r(),i("div",ue,[d(O,{"model-materials":f.value,"activity-items":p.value.map(e=>({...e,activity_name:q(e.activity_role_id)})),"start-date":a(s).start_date,"end-date":a(s).end_date,"total-production":U.value,"size-items":_.value.map(e=>({...e}))},null,8,["model-materials","activity-items","start-date","end-date","total-production","size-items"])])):n("",!0),l("div",ce,[d(a(T),{type:"button",variant:"outline",onClick:t[9]||(t[9]=e=>a(C).visit("/konveksi/model/list"))},{default:g(()=>t[15]||(t[15]=[w(" Batal ")])),_:1,__:[15]}),d(a(T),{type:"submit",class:"bg-indigo-600 text-white py-2 rounded-md hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:g(()=>t[16]||(t[16]=[w("Simpan Perubahan")])),_:1,__:[16]})])],32)])]),_:1})],64))}});export{Te as default};
