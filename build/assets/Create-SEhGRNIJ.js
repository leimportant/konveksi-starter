import{b as M,G as N,ar as x,r as O,o as R,a as z,w as G,H as A,j as d,z as l,l as e,g as a,B as b,q as n,m as C,x as r,A as u,F as g,D as v,k as _,P,M as q}from"./app-C0ZtNFPV.js";import{_ as F}from"./AppLayout.vue_vue_type_script_setup_true_lang-CxyMViV1.js";import{_ as S}from"./Button.vue_vue_type_script_setup_true_lang-B6TXREVN.js";import{_ as E}from"./Input.vue_vue_type_script_setup_true_lang-BWB1n0oK.js";import{_ as m}from"./Label.vue_vue_type_script_setup_true_lang-DUa9-7wS.js";import{u as Q}from"./useToast-DV2nGitA.js";import{u as H}from"./useTransferStockStore-B-GCbk1t.js";import{u as J}from"./useInventoryStore-MPufUS0_.js";import"./index-C2dazRLE.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BIT3zfbJ.js";const K={class:"p-6 space-y-6"},W={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},X=["value"],Y={key:0,class:"text-red-600 text-sm mt-1"},Z=["value"],oo={key:0,class:"text-red-600 text-sm mt-1"},to=["value"],eo={key:0,class:"text-red-600 text-sm mt-1"},so={class:"border rounded p-4"},ro={class:"font-semibold text-lg mb-4 flex justify-between items-center"},io=["value"],ao=["value"],lo=["value"],no=["value"],uo={class:"flex justify-end"},_o={key:0,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"},co={class:"bg-white rounded-lg shadow-lg w-11/12 max-w-4xl p-6"},po={class:"flex justify-between items-center mb-4"},fo={key:0,class:"text-center py-10"},mo={key:1},yo={class:"w-full border-collapse border border-gray-300"},bo={class:"border border-gray-300 p-2"},go={class:"border border-gray-300 p-2"},vo={class:"border border-gray-300 p-2"},ko={class:"border border-gray-300 p-2"},ho={class:"border border-gray-300 p-2 text-center"},xo=["onClick"],wo={key:0},Do=M({__name:"Create",setup($o){const p=Q(),T=H(),y=J(),s=N({location_id:void 0,location_destination_id:void 0,sloc_id:void 0,transfer_detail:[]}),c=x({}),w=x([]),V=x([]),j=x([]),k=O(!1);R(async()=>{try{const[i,o,t]=await Promise.all([z.get("/api/locations"),z.get("/api/slocs"),z.get("/api/products")]);w.push(...i.data.data),V.push(...o.data.data),j.push(...t.data.data)}catch(i){console.error(i),p.error("Gagal memuat data")}}),G(()=>s.location_id,()=>{h("location_id"),$()});const B=async()=>{if(!s.location_id||!s.sloc_id){p.error("Pilih lokasi dan sloc terlebih dahulu");return}y.filters.productName="";try{await y.fetchInventory(),k.value=!0}catch(i){console.error(i),p.error("Gagal memuat inventory")}},U=i=>{if(s.transfer_detail.find(t=>t.product_id===i.product_id&&t.size_id===i.size_id&&t.uom_id===i.uom.id)){p.error("Produk ini sudah ada di daftar detail");return}s.transfer_detail.push({product_id:i.product_id,product_name:i.product_name,size_id:i.size_id,size_name:i.size_id,uom_id:i.uom_id,uom_name:i.uom_id,qty:i.qty_available??1}),k.value=!1},h=i=>{delete c[i]},D=()=>{q.visit("/transfer-stock")},I=async()=>{var i;try{if(!s.location_id||!s.location_destination_id||!s.sloc_id){p.error("Semua lokasi dan sloc wajib diisi");return}await T.createTransfer({location_id:s.location_id,location_destination_id:s.location_destination_id,sloc_id:s.sloc_id,transfer_detail:s.transfer_detail.map(o=>({product_id:o.product_id,size_id:o.size_id,uom_id:o.uom_id,qty:o.qty}))}),p.success("Transfer berhasil disimpan"),q.visit("/transfer-stock")}catch(o){((i=o.response)==null?void 0:i.status)===422?Object.assign(c,o.response.data.errors):p.error("Gagal menyimpan transfer")}},$=()=>{h("location_id"),h("sloc_id"),s.transfer_detail.splice(0,s.transfer_detail.length)};return(i,o)=>(d(),A(F,{title:"Tambah Transfer Stock"},{default:l(()=>[e("div",K,[e("div",W,[e("div",null,[n(r(m),{for:"location_id"},{default:l(()=>o[5]||(o[5]=[u("Lokasi Asal")])),_:1,__:[5]}),C(e("select",{"onUpdate:modelValue":o[0]||(o[0]=t=>r(s).location_id=t),id:"location_id",class:"w-full border rounded p-2",onChange:$},[o[6]||(o[6]=e("option",{disabled:"",value:""},"Pilih lokasi",-1)),(d(!0),a(g,null,v(w,t=>(d(),a("option",{key:t.id,value:t.id},_(t.name),9,X))),128))],544),[[P,r(s).location_id]]),c.location_id?(d(),a("p",Y,_(c.location_id),1)):b("",!0)]),e("div",null,[n(r(m),{for:"location_destination_id"},{default:l(()=>o[7]||(o[7]=[u("Lokasi Tujuan")])),_:1,__:[7]}),C(e("select",{"onUpdate:modelValue":o[1]||(o[1]=t=>r(s).location_destination_id=t),id:"location_destination_id",class:"w-full border rounded p-2",onChange:o[2]||(o[2]=t=>h("location_destination_id"))},[o[8]||(o[8]=e("option",{disabled:"",value:""},"Pilih lokasi",-1)),(d(!0),a(g,null,v(w,t=>(d(),a("option",{key:t.id,value:t.id},_(t.name),9,Z))),128))],544),[[P,r(s).location_destination_id]]),c.location_destination_id?(d(),a("p",oo,_(c.location_destination_id),1)):b("",!0)]),e("div",null,[n(r(m),{for:"sloc_id"},{default:l(()=>o[9]||(o[9]=[u("Sloc")])),_:1,__:[9]}),C(e("select",{"onUpdate:modelValue":o[3]||(o[3]=t=>r(s).sloc_id=t),id:"sloc_id",class:"w-full border rounded p-2",onChange:$},[o[10]||(o[10]=e("option",{disabled:"",value:""},"Pilih sloc",-1)),(d(!0),a(g,null,v(V,t=>(d(),a("option",{key:t.id,value:t.id},_(t.name),9,to))),128))],544),[[P,r(s).sloc_id]]),c.sloc_id?(d(),a("p",eo,_(c.sloc_id),1)):b("",!0)])]),e("div",so,[e("div",ro,[o[12]||(o[12]=u(" Detail Barang ")),n(r(S),{variant:"outline",class:"ml-2",onClick:B,disabled:!r(s).location_id||!r(s).sloc_id},{default:l(()=>o[11]||(o[11]=[u(" Tambah Baris ")])),_:1,__:[11]},8,["disabled"])]),(d(!0),a(g,null,v(r(s).transfer_detail,(t,f)=>(d(),a("div",{key:f,class:"grid grid-cols-1 sm:grid-cols-4 gap-4 mb-4 items-end"},[e("div",null,[n(r(m),{for:`product_id_${f}`},{default:l(()=>o[13]||(o[13]=[u("Produk")])),_:2,__:[13]},1032,["for"]),e("input",{type:"hidden",value:t.product_id,readonly:"",class:"w-full border rounded p-2 bg-gray-100 cursor-not-allowed"},null,8,io),e("input",{type:"text",value:t.product_name,readonly:"",class:"w-full border rounded p-2 bg-gray-100 cursor-not-allowed"},null,8,ao)]),e("div",null,[n(r(m),{for:`size_id_${f}`},{default:l(()=>o[14]||(o[14]=[u("Ukuran")])),_:2,__:[14]},1032,["for"]),e("input",{type:"text",value:t.size_id,readonly:"",class:"w-full border rounded p-2 bg-gray-100 cursor-not-allowed"},null,8,lo)]),e("div",null,[n(r(m),{for:`uom_id_${f}`},{default:l(()=>o[15]||(o[15]=[u("UOM")])),_:2,__:[15]},1032,["for"]),e("input",{type:"text",value:t.uom_id,readonly:"",class:"w-full border rounded p-2 bg-gray-100 cursor-not-allowed"},null,8,no)]),e("div",null,[n(r(m),{for:`qty_${f}`},{default:l(()=>o[16]||(o[16]=[u("Qty")])),_:2,__:[16]},1032,["for"]),n(r(E),{type:"number",min:"1",step:"1",modelValue:t.qty,"onUpdate:modelValue":L=>t.qty=L,id:`qty_${f}`},null,8,["modelValue","onUpdate:modelValue","id"])])]))),128))]),e("div",uo,[n(r(S),{onClick:I,disabled:r(s).processing,class:"bg-indigo-600 text-white py-2 rounded-md hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:l(()=>o[17]||(o[17]=[u("Simpan")])),_:1,__:[17]},8,["disabled"]),n(r(S),{onClick:D,variant:"outline",class:"ml-2"},{default:l(()=>o[18]||(o[18]=[u("Batal")])),_:1,__:[18]})])]),k.value?(d(),a("div",_o,[e("div",co,[e("div",po,[o[19]||(o[19]=e("h3",{class:"text-lg font-semibold"},"Pilih Produk dari Inventory",-1)),e("button",{onClick:o[4]||(o[4]=t=>k.value=!1),class:"text-gray-600 hover:text-gray-900"}," Ã— ")]),r(y).loading?(d(),a("div",fo," Loading inventory... ")):(d(),a("div",mo,[e("table",yo,[o[21]||(o[21]=e("thead",null,[e("tr",null,[e("th",{class:"border border-gray-300 p-2"},"Produk"),e("th",{class:"border border-gray-300 p-2"},"Size"),e("th",{class:"border border-gray-300 p-2"},"UOM"),e("th",{class:"border border-gray-300 p-2"},"Qty"),e("th",{class:"border border-gray-300 p-2"},"Action")])],-1)),e("tbody",null,[(d(!0),a(g,null,v(r(y).inventoryRpt,t=>(d(),a("tr",{key:`${t.product_id}-${t.location_id}-${t.sloc_id}-${t.size_id}`,class:"hover:bg-gray-100"},[e("td",bo,_(t.product_name),1),e("td",go,_(t.size_id),1),e("td",vo,_(t.uom_id),1),e("td",ko,_(t.qty_available),1),e("td",ho,[e("button",{onClick:f=>U(t),class:"text-blue-600 hover:underline"}," Pilih ",8,xo)])]))),128)),r(y).inventoryRpt.length===0?(d(),a("tr",wo,o[20]||(o[20]=[e("td",{class:"border border-gray-300 p-2 text-center",colspan:"5"}," Tidak ada inventory ditemukan. ",-1)]))):b("",!0)])])]))])])):b("",!0)]),_:1}))}});export{Do as default};
