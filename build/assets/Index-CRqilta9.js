import{d as Q,a as k,b as W,r as T,G as X,u as Y,e as Z,o as ee,f as te,g as p,j as f,q as r,x as t,y as se,z as o,l,B as h,A as c,O as ae,F as C,D as P,H as le,k as b,N as M,m as w,p as E,P as j,J as re}from"./app-C0ZtNFPV.js";import{_ as oe}from"./AppLayout.vue_vue_type_script_setup_true_lang-CxyMViV1.js";import{_ as N}from"./Button.vue_vue_type_script_setup_true_lang-B6TXREVN.js";import{_ as ne,a as ie,b as A,c as v,d as de,e as g}from"./TableRow.vue_vue_type_script_setup_true_lang-CVJoN5Nr.js";import{u as ue}from"./useToast-DV2nGitA.js";import{P as me}from"./plus-jsIhsatj.js";import{T as ce}from"./trash-2-Bt8Dqp-q.js";import"./index-C2dazRLE.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BIT3zfbJ.js";const fe=Q("user",{state:()=>({users:[],total:0,loaded:!1,loading:!1,currentPage:1,lastPage:1,error:null,filterName:""}),getters:{activeUsers(u){return u.users.filter(n=>n.active)},inactiveUsers(u){return u.users.filter(n=>!n.active)}},actions:{async fetchUsers(u=1,n=10){var m,d;this.loading=!0;try{const a=await k.get("/api/users",{params:{page:u,perPage:n,name:this.filterName}});this.users=a.data.data,this.total=a.data.total,this.currentPage=u,this.lastPage=a.data.last_page||1,this.loaded=!0}catch(a){throw this.error=((d=(m=a.response)==null?void 0:m.data)==null?void 0:d.message)||"Failed to load users",a}finally{this.loading=!1}},setFilter(u,n){u==="name"&&(this.filterName=n,this.currentPage=1,this.fetchUsers(1))},async createUser(u){var n,m;this.loading=!0;try{const d=await k.post("/api/users",u);return await this.fetchUsers(),d.data}catch(d){throw this.error=((m=(n=d.response)==null?void 0:n.data)==null?void 0:m.message)||"Failed to create user",d}finally{this.loading=!1}},async updateUser(u,n){var m,d;this.loading=!0;try{const a=await k.put(`/api/users/${u}`,n);return await this.fetchUsers(),a.data}catch(a){throw this.error=((d=(m=a.response)==null?void 0:m.data)==null?void 0:d.message)||"Failed to update user",a}finally{this.loading=!1}},async deleteUser(u){var n,m;this.loading=!0;try{return await k.delete(`/api/users/${u}`),this.users=this.users.filter(d=>d.id!==u),!0}catch(d){throw this.error=((m=(n=d.response)==null?void 0:n.data)==null?void 0:m.message)||"Failed to delete user",d}finally{this.loading=!1}}}}),pe={class:"px-4 py-4"},be={class:"flex justify-between items-center mb-6"},_e={class:"rounded-md border"},xe={class:"flex justify-end mt-4 space-x-2"},ye=["disabled"],ve=["onClick","disabled"],ge=["disabled"],he={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},we={class:"bg-white p-6 rounded-lg w-full max-w-md"},ke={class:"mb-3"},Ue={key:0,class:"text-red-500 text-xs mt-1"},Ce={class:"mb-3"},Pe={key:0,class:"text-red-500 text-xs mt-1"},Ne={class:"mb-3"},$e={key:0,class:"text-red-500 text-xs mt-1"},Fe={class:"mb-3"},Ve=["value"],Se={key:0,class:"text-red-500 text-xs mt-1"},Te={class:"mb-3"},Ee=["value"],Be={key:0,class:"text-red-500 text-xs mt-1"},Me={class:"mb-4"},je={class:"inline-flex items-center text-sm"},Ae={class:"flex justify-end gap-2"},Oe=W({__name:"Index",setup(u){const n=ue(),m=T(!1),d=T([]),a=X({name:"",email:"",phone_number:"",location_id:"",role:"",active:!0}),I=[{title:"Users",href:"/users"}],x=fe(),{users:R,currentPage:U,lastPage:z,loading:$,filterName:F}=Y(x),V=Z(()=>z.value||1),S=async i=>{i<1||i>V.value||await x.fetchUsers(i)},D=()=>S(U.value+1),L=()=>S(U.value-1),q=async(i,e)=>{const y=e.target;x.setFilter(i,y.value),await x.fetchUsers()},B=T([]),G=async()=>{try{const i=await k.get("/api/locations");d.value=i.data.data||[]}catch(i){console.error(i),n.error("Failed to fetch locations")}};ee(()=>{x.fetchUsers(),H(),G()});const H=async()=>{try{const i=await k.get("/api/roles");B.value=i.data.data||[]}catch(i){console.error(i),n.error("Failed to fetch roles")}},J=async()=>{var i,e,y,s;try{await x.createUser({name:a.name,email:a.email,phone_number:a.phone_number,location_id:a.location_id,role:a.role,active:a.active}),n.success("User created successfully"),a.reset(),await x.fetchUsers(),m.value=!1}catch(_){const K=((e=(i=_==null?void 0:_.response)==null?void 0:i.data)==null?void 0:e.message)||"Failed to create user";n.error(K),(s=(y=_==null?void 0:_.response)==null?void 0:y.data)!=null&&s.errors&&a.setError(_.response.data.errors)}},O=async i=>{var e,y;if(confirm("Are you sure you want to delete this user?"))try{await x.deleteUser(i),n.success("User deleted successfully"),await x.fetchUsers()}catch(s){n.error(((y=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:y.message)||"Failed to delete user")}};return(i,e)=>{const y=te("Input");return f(),p(C,null,[r(t(se),{title:"User Management"}),r(oe,{breadcrumbs:I},{default:o(()=>[l("div",pe,[l("div",be,[r(t(N),{onClick:e[0]||(e[0]=s=>m.value=!0),class:"bg-indigo-600 text-white py-2 rounded-md hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:o(()=>[r(t(me),{class:"h-4 w-4 mr-2"}),e[10]||(e[10]=c(" Tambah User "))]),_:1,__:[10]}),r(y,{modelValue:t(F),"onUpdate:modelValue":e[1]||(e[1]=s=>ae(F)?F.value=s:null),placeholder:"Search",onInput:e[2]||(e[2]=s=>q("name",s)),class:"w-64","aria-label":"Search"},null,8,["modelValue"])]),l("div",_e,[r(t(ne),null,{default:o(()=>[r(t(ie),null,{default:o(()=>[r(t(A),{class:"bg-gray-100"},{default:o(()=>[r(t(v),null,{default:o(()=>e[11]||(e[11]=[c("Name")])),_:1,__:[11]}),r(t(v),null,{default:o(()=>e[12]||(e[12]=[c("Phone Number")])),_:1,__:[12]}),r(t(v),null,{default:o(()=>e[13]||(e[13]=[c("Location")])),_:1,__:[13]}),r(t(v),null,{default:o(()=>e[14]||(e[14]=[c("Email")])),_:1,__:[14]}),r(t(v),null,{default:o(()=>e[15]||(e[15]=[c("Role")])),_:1,__:[15]}),r(t(v),null,{default:o(()=>e[16]||(e[16]=[c("Status")])),_:1,__:[16]}),r(t(v),{class:"w-24"},{default:o(()=>e[17]||(e[17]=[c("Actions")])),_:1,__:[17]})]),_:1})]),_:1}),r(t(de),null,{default:o(()=>[(f(!0),p(C,null,P(t(R),s=>(f(),le(t(A),{key:s.id},{default:o(()=>[r(t(g),null,{default:o(()=>[c(b(s.name),1)]),_:2},1024),r(t(g),null,{default:o(()=>[c(b(s.phone_number),1)]),_:2},1024),r(t(g),null,{default:o(()=>{var _;return[c(b(((_=s.location)==null?void 0:_.name)||"-"),1)]}),_:2},1024),r(t(g),null,{default:o(()=>[c(b(s.email),1)]),_:2},1024),r(t(g),null,{default:o(()=>[c(b(s.role||"User"),1)]),_:2},1024),r(t(g),null,{default:o(()=>[l("span",{class:M(s.active?"text-green-600":"text-red-600")},b(s.active?"Active":"Inactive"),3)]),_:2},1024),r(t(g),{class:"flex gap-2"},{default:o(()=>[r(t(N),{variant:"ghost",size:"icon",onClick:_=>O(s.id)},{default:o(()=>[r(t(ce),{class:"h-4 w-4"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),l("div",xe,[l("button",{onClick:L,disabled:t(U)===1||t($),class:"px-3 py-1 rounded border border-gray-300 text-gray-700 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed"}," Previous ",8,ye),(f(!0),p(C,null,P(V.value,s=>(f(),p("button",{key:s,onClick:_=>S(s),class:M(["px-3 py-1 rounded border text-sm",s===t(U)?"bg-blue-600 border-blue-600 text-white":"border-gray-300 text-gray-700 hover:bg-gray-100"]),disabled:t($)},b(s),11,ve))),128)),l("button",{onClick:D,disabled:t(U)===V.value||t($),class:"px-3 py-1 rounded border border-gray-300 text-gray-700 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed"}," Next ",8,ge)]),m.value?(f(),p("div",he,[l("div",we,[e[28]||(e[28]=l("h2",{class:"text-base font-semibold mb-4"},"Tambah User Baru",-1)),l("div",ke,[e[18]||(e[18]=l("label",{class:"block text-sm mb-1"},"Name",-1)),w(l("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>t(a).name=s),type:"text",class:"w-full border rounded px-3 py-2 text-sm",placeholder:"Enter name"},null,512),[[E,t(a).name]]),t(a).errors.name?(f(),p("p",Ue,b(t(a).errors.name),1)):h("",!0)]),l("div",Ce,[e[19]||(e[19]=l("label",{class:"block text-sm mb-1"},"Email",-1)),w(l("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>t(a).email=s),autocomplete:"false",type:"email",class:"w-full border rounded px-3 py-2 text-sm",placeholder:"Enter email"},null,512),[[E,t(a).email]]),t(a).errors.email?(f(),p("p",Pe,b(t(a).errors.email),1)):h("",!0)]),l("div",Ne,[e[20]||(e[20]=l("label",{class:"block text-sm mb-1"},"Phone Number",-1)),w(l("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>t(a).phone_number=s),autocomplete:"false",type:"text",class:"w-full border rounded px-3 py-2 text-sm",placeholder:"Enter phone number"},null,512),[[E,t(a).phone_number]]),t(a).errors.phone_number?(f(),p("p",$e,b(t(a).errors.phone_number),1)):h("",!0)]),l("div",Fe,[e[22]||(e[22]=l("label",{class:"block text-sm mb-1"},"Location",-1)),w(l("select",{"onUpdate:modelValue":e[6]||(e[6]=s=>t(a).location_id=s),class:"w-full border rounded px-3 py-2 text-sm"},[e[21]||(e[21]=l("option",{value:""},"Select location",-1)),(f(!0),p(C,null,P(d.value,s=>(f(),p("option",{key:s.id,value:s.id},b(s.name),9,Ve))),128))],512),[[j,t(a).location_id]]),t(a).errors.location_id?(f(),p("p",Se,b(t(a).errors.location_id),1)):h("",!0)]),l("div",Te,[e[24]||(e[24]=l("label",{class:"block text-sm mb-1"},"Role",-1)),w(l("select",{"onUpdate:modelValue":e[7]||(e[7]=s=>t(a).role=s),class:"w-full border rounded px-3 py-2 text-sm"},[e[23]||(e[23]=l("option",{value:""},"Select role",-1)),(f(!0),p(C,null,P(B.value,s=>(f(),p("option",{key:s.id,value:s.id},b(s.name),9,Ee))),128))],512),[[j,t(a).role]]),t(a).errors.role?(f(),p("p",Be,b(t(a).errors.role),1)):h("",!0)]),l("div",Me,[l("label",je,[w(l("input",{type:"checkbox","onUpdate:modelValue":e[8]||(e[8]=s=>t(a).active=s),class:"form-checkbox mr-2"},null,512),[[re,t(a).active]]),e[25]||(e[25]=c(" Active "))])]),l("div",Ae,[r(t(N),{variant:"outline",onClick:e[9]||(e[9]=s=>m.value=!1)},{default:o(()=>e[26]||(e[26]=[c("Cancel")])),_:1,__:[26]}),r(t(N),{onClick:J},{default:o(()=>e[27]||(e[27]=[c("Submit")])),_:1,__:[27]})])])])):h("",!0)])]),_:1})],64)}}});export{Oe as default};
