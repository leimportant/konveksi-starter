import{b as I,r as U,e as w,w as S,o as q,g as n,j as a,l as e,q as P,F as V,D as $,m as D,B as z,P as A,x as y,k as c,z as T,A as F,d as E,ar as O,I as N,p as C}from"./app-C0ZtNFPV.js";import{_ as B}from"./Input.vue_vue_type_script_setup_true_lang-BWB1n0oK.js";import{_ as j}from"./Button.vue_vue_type_script_setup_true_lang-B6TXREVN.js";import{u as G}from"./useSizeStore-D54fUmtw.js";import{T as R}from"./trash-C6WxX6NS.js";import{u as H}from"./useProductStore-BuBbG374.js";import{u as J}from"./useMasterActivityRoleStore-DBv0ZGNU.js";import{u as K}from"./useUomStore-CL0R-Ai3.js";const W={class:"space-y-6"},X={class:"min-w-full divide-y divide-gray-200"},Y={class:"bg-white divide-y divide-gray-200"},Z={class:"px-6 py-4 whitespace-nowrap bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"},ee=["onUpdate:modelValue","disabled"],te=["value"],se={key:0,class:"text-destructive"},oe={class:"px-6 py-4 whitespace-nowrap bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"},ie={class:"px-6 py-4 whitespace-nowrap bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"},gt=I({__name:"SizeTab",props:{modelValue:{}},emits:["update:modelValue","update:totalQuantity"],setup(k,{emit:h}){const v=k,_=h,x=G(),f=U(v.modelValue.slice()),b=w(()=>f.value.reduce((r,l)=>r+(Number(l.qty)||0),0));S(b,r=>{_("update:totalQuantity",r)}),S(f,r=>_("update:modelValue",r),{deep:!0}),q(()=>{x.fetchSizes(),_("update:totalQuantity",b.value)});const g=()=>{f.value.push({size_id:"",qty:0})},m=r=>{f.value.splice(r,1)};return(r,l)=>(a(),n("div",W,[e("table",X,[l[1]||(l[1]=e("thead",null,[e("tr",null,[e("th",{class:"px-6 py-5 text-left text-xs bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring uppercase"},"Size"),e("th",{class:"px-6 py-5 text-left text-xs bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring uppercase"},"Quantity"),e("th",{class:"px-6 py-5 text-left text-xs bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring uppercase w-16"},"Action")])],-1)),e("tbody",Y,[(a(!0),n(V,null,$(f.value,(d,s)=>(a(),n("tr",{key:s},[e("td",Z,[D(e("select",{"onUpdate:modelValue":i=>d.size_id=i,class:"block w-full rounded-md border bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring py-2 px-3 shadow-sm sm:text-sm",disabled:y(x).isLoading},[l[0]||(l[0]=e("option",{disabled:"",value:"0"},"Pilih Ukuran",-1)),(a(!0),n(V,null,$(y(x).sizes,i=>(a(),n("option",{key:i.id,value:i.id},c(i.name),9,te))),128))],8,ee),[[A,d.size_id]]),y(x).error?(a(),n("small",se,c(y(x).error),1)):z("",!0)]),e("td",oe,[P(y(B),{type:"number",modelValue:d.qty,"onUpdate:modelValue":i=>d.qty=i,class:"w-full",min:"0"},null,8,["modelValue","onUpdate:modelValue"])]),e("td",ie,[P(y(j),{variant:"destructive",size:"icon",onClick:i=>m(s)},{default:T(()=>[P(y(R))]),_:2},1032,["onClick"])])]))),128))])]),P(y(j),{type:"button",onClick:g},{default:T(()=>l[2]||(l[2]=[e("i",{class:"pi pi-plus"},null,-1),F(" Tambah Ukuran ")])),_:1,__:[2]})]))}}),ne=E("activity",()=>{const k=U([]),h=O({}),v=U([]);return{roles:k,rolesMap:h,items:v,fetchRoles:async()=>{try{const g=(await(await fetch("/api/activity-roles")).json()).data;k.value=g,g.forEach(m=>{h[m.id]=m.name}),v.value=g.map(m=>{const r=v.value.find(l=>l.role_id===m.id);return{role_id:m.id,price:(r==null?void 0:r.price)??0}})}catch(f){console.error("Failed to fetch menus",f)}},updatePrice:(f,b)=>{const g=parseFloat(b);v.value[f].price=isNaN(g)?0:g}}}),ae={class:"min-w-full divide-y divide-gray-200"},le={class:"px-6 py-4 whitespace-nowrap bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"},re={class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"},vt=I({__name:"ActivityTab",props:{modelValue:{}},emits:["update:modelValue"],setup(k,{emit:h}){const v=k,_=h,x=ne(),{rolesMap:f}=x,b=U(v.modelValue);q(async()=>{await x.fetchRoles(),b.value.length===0&&(b.value=Object.keys(f).map(m=>({activity_role_id:parseInt(m),price:0})),_("update:modelValue",b.value))}),S(b,m=>{_("update:modelValue",m)},{deep:!0});const g=(m,r)=>{const l=parseFloat(r);b.value[m].price=isNaN(l)?0:l};return(m,r)=>(a(),n("div",null,[e("table",ae,[r[0]||(r[0]=e("thead",null,[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Aktivitas"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Upah Per Hari")])],-1)),e("tbody",null,[(a(!0),n(V,null,$(b.value,(l,d)=>(a(),n("tr",{key:l.activity_role_id,class:"bg-white even:bg-gray-50"},[e("td",le,c(y(f)[l.activity_role_id]||"Unknown"),1),e("td",re,[P(y(B),{type:"number",min:"0",modelValue:l.price,"onUpdate:modelValue":s=>l.price=s,onInput:s=>g(d,s.target.value)},null,8,["modelValue","onUpdate:modelValue","onInput"])])]))),128))])])]))}}),de={class:"space-y-4 sm:space-y-6"},ue={class:"rounded-lg border p-3 sm:p-4 space-y-3 sm:space-y-4"},ce={class:"space-y-2"},pe={class:"grid gap-1 sm:gap-2 text-sm"},me={class:"flex justify-between"},fe={class:"text-[12px]"},be={class:"flex justify-between"},ge={class:"text-[12px]"},ve={class:"flex justify-between font-medium"},xe={class:"text-[12px]"},_e={class:"space-y-2"},ye={class:"grid gap-1 sm:gap-2 text-sm"},he={class:"text-[12px]"},ke={class:"text-[12px]"},we={class:"flex justify-between font-medium pt-2 border-t text-sm sm:text-base"},Ve={class:"text-[12px]"},$e={class:"flex justify-between font-medium pt-2 border-t text-sm sm:text-base"},Pe={class:"text-[12px]"},De={class:"space-y-2"},Me={class:"grid gap-1 sm:gap-2 text-sm"},Ue={class:"text-[12px]"},Se={class:"text-[12px]"},Te={class:"space-y-2"},je={class:"grid gap-1 sm:gap-2"},Ie={class:"flex flex-col"},qe={class:"text-sm"},Ce={class:"text-xs sm:text-sm text-gray-500"},ze={class:"flex flex-col items-end"},Ae={class:"text-xs sm:text-sm"},Ne={class:"text-sm font-medium"},Fe={class:"flex justify-between font-medium pt-2 border-t text-sm sm:text-base"},Be={class:"text-[12px]"},Re={class:"flex justify-between font-bold pt-4 border-t text-base sm:text-lg"},He={class:"text-[12px]"},Qe={class:"flex justify-between font-medium text-sm sm:text-base"},Le={class:"text-[12px]"},xt=I({__name:"HPPTab",props:{modelMaterials:{},activityItems:{},sizeItems:{},startDate:{},endDate:{}},setup(k){const h=k,v=H(),_=J(),x=w(()=>v.items),f=o=>{const t=x.value.find(p=>p.id===o);return(t==null?void 0:t.name)||`Material ${o}`},b=w(()=>h.modelMaterials.map(o=>({material_id:o.product_id,qty:o.qty,price:o.price||0}))),g=w(()=>b.value.reduce((o,t)=>o+t.qty*t.price,0)),m=(o,t)=>{if(!o||!t)return 1;const p=new Date(o),Q=new Date(t),L=Math.abs(Q.getTime()-p.getTime());return Math.ceil(L/(1e3*60*60*24))||1},r=w(()=>h.activityItems.reduce((o,t)=>o+(t.price||0)*s.value,0)),l=w(()=>g.value+r.value),d=w(()=>s.value===0?0:l.value/s.value),s=w(()=>{var o;return((o=h.sizeItems)==null?void 0:o.reduce((t,p)=>t+p.qty,0))||0}),i=o=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(o),M=o=>{const t=_.items.find(p=>p.id===o.activity_role_id);return t!=null&&t.name?t.name:o.activity_name||`Aktivitas ${o.activity_role_id}`};q(async()=>{try{await Promise.all([v.fetchProducts(),_.fetchActivityRoles()])}catch(o){console.error("Failed to fetch data:",o)}});const u=o=>o?new Date(o).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric"}):"-";return(o,t)=>(a(),n("div",de,[e("div",ue,[t[12]||(t[12]=e("h3",{class:"text-base sm:text-lg font-semibold border-b pb-2"},"Ringkasan HPP",-1)),e("div",ce,[t[3]||(t[3]=e("span",{class:"text-[14px]"},"Durasi Proyek",-1)),e("div",pe,[e("div",me,[t[0]||(t[0]=e("span",{class:"text-[12px]"},"Tanggal Mulai",-1)),e("span",fe,c(u(o.startDate)),1)]),e("div",be,[t[1]||(t[1]=e("span",{class:"text-[12px]"},"Tanggal Selesai",-1)),e("span",ge,c(u(o.endDate)),1)]),e("div",ve,[t[2]||(t[2]=e("span",{class:"text-[12px]"},"Total Durasi",-1)),e("span",xe,c(m(o.startDate,o.endDate))+" hari",1)])])]),e("div",_e,[t[6]||(t[6]=e("span",{class:"text-[14px]"},"Biaya Material",-1)),e("div",ye,[(a(!0),n(V,null,$(o.modelMaterials,p=>(a(),n("div",{key:p.product_id,class:"flex justify-between"},[e("span",he,c(f(p.product_id)),1),e("span",ke,c(i(p.qty*(p.price||0))),1)]))),128))]),e("div",we,[t[4]||(t[4]=e("span",{class:"text-[12px]"},"Total Biaya Material",-1)),e("span",Ve,c(i(g.value)),1)]),e("div",$e,[t[5]||(t[5]=e("span",{class:"text-[12px]"},"Total Produksi",-1)),e("span",Pe,c(s.value),1)])]),e("div",De,[t[7]||(t[7]=e("span",{class:"text-[14px]"},"Ukuran",-1)),e("div",Me,[(a(!0),n(V,null,$(o.sizeItems,p=>(a(),n("div",{key:p.size_id,class:"flex justify-between"},[e("span",Ue,c(p.size_id),1),e("span",Se,c(p.qty),1)]))),128))])]),e("div",Te,[t[9]||(t[9]=e("span",{class:"text-[14px]"},"Biaya Aktivitas",-1)),e("div",je,[(a(!0),n(V,null,$(o.activityItems,p=>(a(),n("div",{key:p.activity_role_id,class:"flex justify-between"},[e("div",Ie,[e("span",qe,c(M(p)),1),e("span",Ce,c(m(o.startDate,o.endDate))+" hari ",1)]),e("div",ze,[e("span",Ae,c(i(p.price||0))+" / PCS",1),e("span",Ne,c(i((p.price||0)*s.value)),1)])]))),128))]),e("div",Fe,[t[8]||(t[8]=e("span",{class:"text-[12px]"},"Total Biaya Aktivitas",-1)),e("span",Be,c(i(r.value)),1)])]),e("div",Re,[t[10]||(t[10]=e("span",{class:"text-[12px]"},"Total HPP",-1)),e("span",He,c(i(l.value)),1)]),e("div",Qe,[t[11]||(t[11]=e("span",{class:"text-[12px]"},"HPP per PCS",-1)),e("span",Le,c(i(d.value)),1)])])]))}}),Ee={class:"space-y-4"},Oe={class:"flex justify-between items-center border-b pb-2"},Ge={class:"font-medium"},Je={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ke=["onUpdate:modelValue"],We={key:0,disabled:""},Xe=["value"],Ye={class:"flex gap-2"},Ze=["onUpdate:modelValue"],et=["onUpdate:modelValue"],tt={key:0,disabled:""},st=["value","selected"],ot=["onUpdate:modelValue"],it={class:"md:col-span-2"},nt=["onUpdate:modelValue"],at={class:"flex justify-end"},_t=I({__name:"ModelMaterialTab",props:{modelValue:{}},emits:["update:modelValue"],setup(k,{emit:h}){const v=k,_=h,x=H(),f=K(),b=w(()=>x.items),g=w(()=>f.items),m=()=>{const d=[...v.modelValue];d.push({product_id:null,qty:1,uom_id:null,remark:"",price:null}),_("update:modelValue",d)},r=d=>{const s=[...v.modelValue];s.splice(d,1),_("update:modelValue",s)};q(async()=>{try{await Promise.all([x.fetchProducts(),f.fetchUoms()])}catch(d){console.error("Failed to fetch data:",d)}});const l=d=>{if(!d)return null;const s=b.value.find(i=>i.id===d);return(s==null?void 0:s.uom_id)||null};return S(()=>v.modelValue,d=>{d.forEach(s=>{s.product_id&&!s.uom_id&&(s.uom_id=l(s.product_id))})},{deep:!0}),(d,s)=>(a(),n("div",Ee,[(a(!0),n(V,null,$(d.modelValue,(i,M)=>(a(),n("div",{key:M,class:"p-4 border rounded-lg space-y-4"},[e("div",Oe,[e("h3",Ge,"Material #"+c(M+1),1),P(y(j),{type:"button",variant:"destructive",size:"icon",onClick:N(u=>r(M),["prevent"])},{default:T(()=>[P(y(R))]),_:2},1032,["onClick"])]),e("div",Je,[e("div",null,[s[1]||(s[1]=e("label",{class:"text-sm font-medium block mb-1"},"Material",-1)),D(e("select",{"onUpdate:modelValue":u=>i.product_id=u,class:"block w-full rounded-md border bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring py-2 px-3 shadow-sm sm:text-sm"},[s[0]||(s[0]=e("option",{value:""},"Pilih Material",-1)),b.value.length===0?(a(),n("option",We,"Loading materials...")):z("",!0),(a(!0),n(V,null,$(b.value,u=>(a(),n("option",{key:u.id,value:u.id},c(u.name),9,Xe))),128))],8,Ke),[[A,i.product_id]])]),e("div",null,[s[3]||(s[3]=e("label",{class:"text-sm font-medium block mb-1"},"Quantity, Unit & Price",-1)),e("div",Ye,[D(e("input",{type:"number","onUpdate:modelValue":u=>i.qty=u,min:"1",class:"block w-1/3 rounded-md border bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring py-2 px-3 shadow-sm sm:text-sm"},null,8,Ze),[[C,i.qty]]),D(e("select",{"onUpdate:modelValue":u=>i.uom_id=u,class:"block w-1/3 rounded-md border bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring py-2 px-3 shadow-sm sm:text-sm"},[s[2]||(s[2]=e("option",{value:""},"Pilih Unit",-1)),g.value.length===0?(a(),n("option",tt,"Loading units...")):z("",!0),(a(!0),n(V,null,$(g.value,u=>(a(),n("option",{key:u.id,value:u.id,selected:u.id===l(i.product_id)},c(u.name),9,st))),128))],8,et),[[A,i.uom_id]]),D(e("input",{type:"number","onUpdate:modelValue":u=>i.price=u,min:"0",placeholder:"Harga",class:"block w-1/3 rounded-md border bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring py-2 px-3 shadow-sm sm:text-sm"},null,8,ot),[[C,i.price]])])]),e("div",it,[s[4]||(s[4]=e("label",{class:"text-sm font-medium block mb-1"},"Remark",-1)),D(e("input",{type:"text","onUpdate:modelValue":u=>i.remark=u,class:"block w-full rounded-md border bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring py-2 px-3 shadow-sm sm:text-sm",placeholder:"Optional remark"},null,8,nt),[[C,i.remark]])])])]))),128)),e("div",at,[P(y(j),{type:"button",variant:"secondary",onClick:N(m,["prevent"])},{default:T(()=>s[5]||(s[5]=[e("i",{class:"pi pi-plus mr-2"},null,-1),F(" Tambah Material ")])),_:1,__:[5]})])]))}});export{gt as _,vt as a,_t as b,xt as c};
