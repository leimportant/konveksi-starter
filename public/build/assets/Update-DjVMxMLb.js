import{d as E,r as U,T as R,o as z,f as m,g as n,p as r,u as t,Z as L,x as a,k as i,O as G,C as _,y as p,j as c,D as h,F as $,B as O,E as K,l as Q,U as Z,b as P,V as H}from"./app-C-oCxDbN.js";import{_ as J}from"./AppLayout.vue_vue_type_script_setup_true_lang-DkzW-LgS.js";import{u as W}from"./useToast-B4n-YQXl.js";import{u as X}from"./usePurchaseOrder-4V2fqQD6.js";import{A as Y}from"./vue3-select-DW9Mudm0.js";import{_ as b}from"./Input.vue_vue_type_script_setup_true_lang-Cc0tbtxW.js";import{_ as v}from"./Label.vue_vue_type_script_setup_true_lang-vVSNedvi.js";import{_ as ee}from"./Textarea.vue_vue_type_script_setup_true_lang-q_cU1YGM.js";import{_ as te,a as se,b as S,c as y,d as re,e as x}from"./TableRow.vue_vue_type_script_setup_true_lang-Cu8B0glB.js";import{P as oe}from"./plus-B2tm8Opl.js";import{T as ae}from"./trash-2-BrBeAq-c.js";import"./index-BpuFes6Z.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-DgzA-mfZ.js";const le={class:"py-6 px-4 sm:px-6 lg:px-8"},de={class:"grid grid-cols-1 sm:grid-cols-2 gap-6"},ue={key:0,class:"text-red-500 text-xs mt-1"},ie={key:0,class:"text-red-500 text-xs mt-1"},ne={class:"sm:col-span-2"},pe={key:0,class:"text-red-500 text-xs mt-1"},me={class:"sm:col-span-2"},ce={key:0,class:"text-red-500 text-xs mt-1"},_e={class:"flex justify-between items-center mb-2"},fe={key:0,class:"text-red-500 text-xs mt-1"},ye={key:0,class:"text-red-500 text-xs mt-1"},xe=["onUpdate:modelValue"],be=["value"],ge={key:0,class:"text-red-500 text-xs mt-1"},he={key:0,class:"text-red-500 text-xs mt-1"},ve={class:"flex justify-end gap-2 mt-4"},Te=E({__name:"Update",props:{purchaseOrderId:{type:String,required:!0}},setup(q){const f=W(),{products:C,createPurchaseOrder:D,fetchPurchaseOrder:N,updatePurchaseOrder:T}=X(),I=U([]),g=q,s=R({nota_number:"",purchase_date:new Date().toISOString().slice(0,10),supplier:"",notes:"",items:[]}),V=U([]),M=()=>{s.items.push({product_id:0,qty:1,uom_id:"",price:0,total:0})},B=o=>{s.items.splice(o,1)},F=o=>{const e=C.find(l=>l.id===s.items[o].product_id);e&&(s.items[o].price=e.price,w(o))},w=o=>{const e=s.items[o];e.total=e.qty*e.price},A=async()=>{try{const[o]=await Promise.all([P.get("/api/uoms")]);I.value=o.data.data}catch(o){f.error("Gagal mengambil data dropdown"),console.error(o)}},j=async o=>{if(o.length<2){V.value=[];return}try{const e=await P.get("/api/products",{params:{search:o}});V.value=e.data.data}catch(e){console.error("Search error:",e),f.error("Failed to search products")}};z(async()=>{if(await A(),g.purchaseOrderId)try{const o=await N(g.purchaseOrderId);o&&(s.nota_number=o.nota_number,s.purchase_date=o.purchase_date,s.supplier=o.supplier,s.notes=o.notes,s.items=o.items.map(e=>({product_id:e.product_id,qty:e.qty,uom_id:e.uom_id,price:e.price,total:e.total})))}catch(o){f.error("Failed to fetch purchase order details."),console.error(o)}});const k=async()=>{if(!s.processing){s.processing=!0;try{const o={nota_number:s.nota_number,purchase_date:s.purchase_date,supplier:s.supplier,notes:s.notes,items:s.items.map(e=>{var l;return{product_id:((l=e.product_id)==null?void 0:l.id)??e.product_id,qty:e.qty,uom_id:e.uom_id||"",price:e.price,total:e.total}})};g.purchaseOrderId?(await T(g.purchaseOrderId,o),f.success("Purchase Order has been updated successfully.")):(await D(o),f.success("Purchase Order has been created successfully.")),s.reset(),s.items=[],H.visit("/purchase-order")}catch(o){console.error("Error processing purchase order:",o),f.error("Failed to process purchase order.")}finally{s.processing=!1}}};return(o,e)=>(n(),m($,null,[r(t(L),{title:"Update Purchase Order"}),r(J,null,{header:a(()=>e[4]||(e[4]=[i("h2",{class:"font-semibold text-lg sm:text-xl text-gray-800 leading-tight"}," Update Purchase Order ",-1)])),default:a(()=>[i("div",le,[i("form",{onSubmit:G(k,["prevent"]),class:"space-y-6"},[i("div",de,[i("div",null,[r(t(v),{for:"nota_number"},{default:a(()=>e[5]||(e[5]=[p("Nota/Kwitansi No.")])),_:1,__:[5]}),r(t(b),{id:"nota_number",type:"text",modelValue:t(s).nota_number,"onUpdate:modelValue":e[0]||(e[0]=l=>t(s).nota_number=l)},null,8,["modelValue"]),t(s).errors.nota_number?(n(),m("div",ue,c(t(s).errors.nota_number),1)):_("",!0)]),i("div",null,[r(t(v),{for:"purchase_date"},{default:a(()=>e[6]||(e[6]=[p("Tanggal")])),_:1,__:[6]}),r(t(b),{id:"purchase_date",type:"date",modelValue:t(s).purchase_date,"onUpdate:modelValue":e[1]||(e[1]=l=>t(s).purchase_date=l)},null,8,["modelValue"]),t(s).errors.purchase_date?(n(),m("div",ie,c(t(s).errors.purchase_date),1)):_("",!0)]),i("div",ne,[r(t(v),{for:"supplier"},{default:a(()=>e[7]||(e[7]=[p("Supplier")])),_:1,__:[7]}),r(t(b),{id:"supplier",type:"text",modelValue:t(s).supplier,"onUpdate:modelValue":e[2]||(e[2]=l=>t(s).supplier=l)},null,8,["modelValue"]),t(s).errors.supplier?(n(),m("div",pe,c(t(s).errors.supplier),1)):_("",!0)]),i("div",me,[r(t(v),{for:"notes"},{default:a(()=>e[8]||(e[8]=[p("Notes")])),_:1,__:[8]}),r(t(ee),{id:"notes",rows:"2",modelValue:t(s).notes,"onUpdate:modelValue":e[3]||(e[3]=l=>t(s).notes=l)},null,8,["modelValue"]),t(s).errors.notes?(n(),m("div",ce,c(t(s).errors.notes),1)):_("",!0)])]),i("div",null,[i("div",_e,[e[10]||(e[10]=i("h3",{class:"text-base sm:text-lg font-semibold text-gray-900"},"Items",-1)),r(t(h),{type:"button",onClick:M,size:"sm",class:"bg-blue-500 hover:bg-blue-600 text-white"},{default:a(()=>[r(t(oe),{class:"w-4 h-4 mr-1"}),e[9]||(e[9]=p(" Add Item "))]),_:1,__:[9]})]),r(t(te),{class:"min-w-full text-sm sm:text-base table-auto"},{default:a(()=>[r(t(se),{class:"bg-gray-50 text-gray-700"},{default:a(()=>[r(t(S),null,{default:a(()=>[r(t(y),{class:"px-3 py-2 text-left font-semibold"},{default:a(()=>e[11]||(e[11]=[p("Product")])),_:1,__:[11]}),r(t(y),{class:"px-3 py-2 text-left font-semibold"},{default:a(()=>e[12]||(e[12]=[p("Qty")])),_:1,__:[12]}),r(t(y),{class:"px-3 py-2 text-left font-semibold"},{default:a(()=>e[13]||(e[13]=[p("UOM")])),_:1,__:[13]}),r(t(y),{class:"px-3 py-2 text-left font-semibold"},{default:a(()=>e[14]||(e[14]=[p("Price")])),_:1,__:[14]}),r(t(y),{class:"px-3 py-2 text-left font-semibold"},{default:a(()=>e[15]||(e[15]=[p("Total")])),_:1,__:[15]}),r(t(y),{class:"px-3 py-2 text-right font-semibold"},{default:a(()=>e[16]||(e[16]=[i("span",{class:"sr-only"},"Actions",-1)])),_:1,__:[16]})]),_:1})]),_:1}),r(t(re),{class:"bg-white divide-y divide-gray-100"},{default:a(()=>[(n(!0),m($,null,O(t(s).items,(l,d)=>(n(),K(t(S),{key:d,class:"hover:bg-gray-50"},{default:a(()=>[r(t(x),{class:"px-3 py-2 min-w-[180px] align-top"},{default:a(()=>[r(t(Y),{modelValue:l.product_id,"onUpdate:modelValue":u=>l.product_id=u,options:V.value,label:"name",value:"id",onSearch:j,placeholder:"Select product",onInput:u=>F(d)},null,8,["modelValue","onUpdate:modelValue","options","onInput"]),t(s).errors[`items.${d}.product_id`]?(n(),m("div",fe,c(t(s).errors[`items.${d}.product_id`]),1)):_("",!0)]),_:2},1024),r(t(x),{class:"px-3 py-2 w-24 align-top"},{default:a(()=>[r(t(b),{type:"number",modelValue:l.qty,"onUpdate:modelValue":u=>l.qty=u,modelModifiers:{number:!0},onInput:u=>w(d)},null,8,["modelValue","onUpdate:modelValue","onInput"]),t(s).errors[`items.${d}.qty`]?(n(),m("div",ye,c(t(s).errors[`items.${d}.qty`]),1)):_("",!0)]),_:2},1024),r(t(x),{class:"px-3 py-2 w-28 align-top"},{default:a(()=>[Q(i("select",{"onUpdate:modelValue":u=>t(s).items[d].uom_id=u,class:"w-full rounded-md border text-xs border-input px-3 py-2",required:""},[e[17]||(e[17]=i("option",{value:""},"Select UOM",-1)),(n(!0),m($,null,O(I.value,u=>(n(),m("option",{key:u.id,value:u.id},c(u.name),9,be))),128))],8,xe),[[Z,t(s).items[d].uom_id]]),t(s).errors[`items.${d}.uom_id`]?(n(),m("div",ge,c(t(s).errors[`items.${d}.uom_id`]),1)):_("",!0)]),_:2},1024),r(t(x),{class:"px-3 py-2 w-32 align-top"},{default:a(()=>[r(t(b),{type:"number",modelValue:l.price,"onUpdate:modelValue":u=>l.price=u,modelModifiers:{number:!0},onInput:u=>w(d)},null,8,["modelValue","onUpdate:modelValue","onInput"]),t(s).errors[`items.${d}.price`]?(n(),m("div",he,c(t(s).errors[`items.${d}.price`]),1)):_("",!0)]),_:2},1024),r(t(x),{class:"px-3 py-2 w-32 align-middle font-medium text-gray-800"},{default:a(()=>[p(c(l.total.toLocaleString("id-ID",{style:"currency",currency:"IDR"})),1)]),_:2},1024),r(t(x),{class:"px-3 py-2 w-12 text-right align-middle"},{default:a(()=>[r(t(h),{type:"button",variant:"destructive",size:"icon",onClick:u=>B(d),class:"hover:bg-red-600"},{default:a(()=>[r(t(ae),{class:"w-4 h-4"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),i("div",ve,[r(t(h),{onClick:k,class:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600",disabled:t(s).processing},{default:a(()=>e[18]||(e[18]=[p("Save")])),_:1,__:[18]},8,["disabled"]),r(t(h),{href:o.route("purchase-order.index"),type:"button",class:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600"},{default:a(()=>e[19]||(e[19]=[p(" Cancel ")])),_:1,__:[19]},8,["href"])])],32)])]),_:1})],64))}});export{Te as default};
