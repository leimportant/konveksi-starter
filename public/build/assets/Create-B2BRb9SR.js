import{d as F,aS as O,r as k,T as G,o as J,b as V,w as L,f as n,g as p,p as r,u as t,Z as W,x as a,k as c,C as v,y as _,j as m,F as w,B as U,E as Z,l as D,U as I,D as P,V as T}from"./app-BUIdBR0K.js";import{_ as q}from"./AppLayout.vue_vue_type_script_setup_true_lang-3u43giJ3.js";import{_ as $}from"./Input.vue_vue_type_script_setup_true_lang-Cv8i5Vsw.js";import{_ as h}from"./Label.vue_vue_type_script_setup_true_lang-BdAPdzXk.js";import{u as K}from"./useToast-NpPWbmhv.js";import{_ as Q,a as X,b as R,c as y,d as Y,e as b}from"./TableRow.vue_vue_type_script_setup_true_lang-FLGmIzyf.js";import{A as ee}from"./vue3-select-H6UUNqe_.js";import{u as te}from"./useProductPriceStore-CiUdq5WY.js";import{T as re}from"./trash-2-Dfe6-qlG.js";import"./index-CjYf141v.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-C-o5URw4.js";const oe={class:"p-6 space-y-6"},se={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ae={key:0,class:"text-red-600 text-sm mt-1"},de={key:0,class:"text-red-600 text-sm mt-1"},ie={key:0,class:"text-red-600 text-sm mt-1"},le={class:"border rounded p-4"},ue=["onUpdate:modelValue","id","onChange"],pe=["value"],ne={key:0,class:"text-red-600 text-xs mt-1"},ce=["onUpdate:modelValue","id","onChange"],_e=["value"],me={key:0,class:"text-red-600 text-xs mt-1"},fe={key:0,class:"text-red-600 text-xs mt-1"},ve={key:0,class:"text-red-600 text-xs mt-1"},ge={key:0,class:"text-red-600 text-xs mt-1"},ye={class:"flex justify-end gap-2 mt-4"},De=F({__name:"Create",setup(be){const f=K(),j=te(),A=[{title:"Add Product Prices",href:"/product-prices/create"}],l=O({}),C=k([]),x=k([]),B=k([]),S=k([]),i=G({product_id:void 0,effective_date:new Date().toISOString().split("T")[0],cost_price:0,product_price:[]});J(()=>{M(),z()});const M=async()=>{try{const[u,e,o]=await Promise.all([V.get("/api/price-types"),V.get("/api/uoms"),V.get("/api/sizes")]);x.value=u.data.data,B.value=e.data.data,S.value=o.data.data}catch(u){f.error("Gagal mengambil data dropdown"),console.error(u)}},E=async u=>{if(u.length<2){C.value=[];return}try{const e=await V.get("/api/products",{params:{search:u}});C.value=e.data.data}catch(e){console.error("Search error:",e),f.error("Failed to search products")}},H=u=>{i.product_price.length>1?i.product_price.splice(u,1):f.error("Setidaknya harus ada satu baris harga")},z=()=>{const u={price_type_id:0,size_id:"",price:0,discount:0,price_sell:0};i.product_price.push(u)},g=u=>{Object.keys(l).forEach(e=>{(e===u||e.startsWith(u+"."))&&delete l[e]})};L(()=>i.product_price,u=>{u.forEach(e=>{e.price_sell=e.price-e.discount})},{deep:!0,immediate:!0});const N=async()=>{var e;if(i.product_id===void 0){f.error("Product must be selected");return}for(const[o,s]of i.product_price.entries())if(!s.price_type_id||!s.size_id){f.error(`Lengkapi semua field pada baris harga ke-${o+1}`);return}const u=typeof i.product_id=="object"?i.product_id.id:i.product_id;try{await j.createProductPrice({product_id:u,effective_date:i.effective_date,cost_price:i.cost_price,price_types:i.product_price}),f.success("Data created successfully"),T.visit("/product-prices")}catch(o){((e=o.response)==null?void 0:e.status)===422?(Object.assign(l,o.response.data.errors),f.error("Periksa kesalahan input dan coba lagi")):(console.error("Submit error:",o),f.error("Gagal menyimpan data"))}};return(u,e)=>(p(),n(w,null,[r(t(W),{title:"Add Product Prices"}),r(q,{breadcrumbs:A},{default:a(()=>[c("div",oe,[c("div",se,[c("div",null,[r(t(h),{for:"product_id"},{default:a(()=>e[6]||(e[6]=[_("Produk")])),_:1,__:[6]}),r(t(ee),{modelValue:t(i).product_id,"onUpdate:modelValue":e[0]||(e[0]=o=>t(i).product_id=o),options:C.value,label:"name",value:"id",onSearch:E,placeholder:"Search a product"},null,8,["modelValue","options"]),l.product_id?(p(),n("p",ae,m(l.product_id),1)):v("",!0)]),c("div",null,[r(t(h),{for:"effective_date"},{default:a(()=>e[7]||(e[7]=[_("Tanggal Berlaku")])),_:1,__:[7]}),r(t($),{type:"date",modelValue:t(i).effective_date,"onUpdate:modelValue":e[1]||(e[1]=o=>t(i).effective_date=o),id:"effective_date",onInput:e[2]||(e[2]=o=>g("effective_date"))},null,8,["modelValue"]),l.effective_date?(p(),n("p",de,m(l.effective_date),1)):v("",!0)]),c("div",null,[r(t(h),{for:"cost_price"},{default:a(()=>e[8]||(e[8]=[_("Harga Pokok")])),_:1,__:[8]}),r(t($),{type:"number",modelValue:t(i).cost_price,"onUpdate:modelValue":e[3]||(e[3]=o=>t(i).cost_price=o),modelModifiers:{number:!0},id:"cost_price",onInput:e[4]||(e[4]=o=>g("cost_price"))},null,8,["modelValue"]),l.cost_price?(p(),n("p",ie,m(l.cost_price),1)):v("",!0)])]),c("div",le,[e[18]||(e[18]=c("div",{class:"font-semibold text-lg mb-4"},"Detail Harga",-1)),r(t(Q),null,{default:a(()=>[r(t(X),null,{default:a(()=>[r(t(R),null,{default:a(()=>[r(t(y),null,{default:a(()=>e[9]||(e[9]=[_("Jenis Harga")])),_:1,__:[9]}),r(t(y),null,{default:a(()=>e[10]||(e[10]=[_("Ukuran")])),_:1,__:[10]}),r(t(y),null,{default:a(()=>e[11]||(e[11]=[_("Harga")])),_:1,__:[11]}),r(t(y),null,{default:a(()=>e[12]||(e[12]=[_("Discount")])),_:1,__:[12]}),r(t(y),null,{default:a(()=>e[13]||(e[13]=[_("Harga Jual")])),_:1,__:[13]}),r(t(y),null,{default:a(()=>e[14]||(e[14]=[_("Actions")])),_:1,__:[14]})]),_:1})]),_:1}),r(t(Y),null,{default:a(()=>[(p(!0),n(w,null,U(t(i).product_price,(o,s)=>(p(),Z(t(R),{key:s,class:"hover:bg-gray-50"},{default:a(()=>[r(t(b),null,{default:a(()=>[D(c("select",{"onUpdate:modelValue":d=>o.price_type_id=d,id:`price_type_id_${s}`,class:"w-full border rounded p-1",onChange:d=>g(`product_price.${s}.price_type_id`)},[e[15]||(e[15]=c("option",{value:"",disabled:""},"Pilih jenis harga",-1)),(p(!0),n(w,null,U(x.value,d=>(p(),n("option",{key:d.id,value:d.id},m(d.name),9,pe))),128))],40,ue),[[I,o.price_type_id,void 0,{number:!0}]]),l[`product_price.${s}.price_type_id`]?(p(),n("p",ne,m(l[`product_price.${s}.price_type_id`]),1)):v("",!0)]),_:2},1024),r(t(b),null,{default:a(()=>[D(c("select",{"onUpdate:modelValue":d=>o.size_id=d,id:`size_id_${s}`,class:"w-full border rounded p-1",onChange:d=>g(`product_price.${s}.size_id`)},[e[16]||(e[16]=c("option",{value:"",disabled:""},"Pilih ukuran",-1)),(p(!0),n(w,null,U(S.value,d=>(p(),n("option",{key:d.id,value:d.id},m(d.name),9,_e))),128))],40,ce),[[I,o.size_id,void 0,{number:!0}]]),l[`product_price.${s}.size_id`]?(p(),n("p",me,m(l[`product_price.${s}.size_id`]),1)):v("",!0)]),_:2},1024),r(t(b),null,{default:a(()=>[r(t($),{type:"number",modelValue:o.price,"onUpdate:modelValue":d=>o.price=d,modelModifiers:{number:!0},id:`price_${s}`,onInput:d=>g(`product_price.${s}.price`),class:"w-full"},null,8,["modelValue","onUpdate:modelValue","id","onInput"]),l[`product_price.${s}.price`]?(p(),n("p",fe,m(l[`product_price.${s}.price`]),1)):v("",!0)]),_:2},1024),r(t(b),null,{default:a(()=>[r(t($),{type:"number",modelValue:o.discount,"onUpdate:modelValue":d=>o.discount=d,modelModifiers:{number:!0},id:`discount_${s}`,onInput:d=>g(`product_price.${s}.discount`),class:"w-full"},null,8,["modelValue","onUpdate:modelValue","id","onInput"]),l[`product_price.${s}.discount`]?(p(),n("p",ve,m(l[`product_price.${s}.discount`]),1)):v("",!0)]),_:2},1024),r(t(b),null,{default:a(()=>[r(t($),{type:"number",readonly:"",modelValue:o.price_sell,"onUpdate:modelValue":d=>o.price_sell=d,modelModifiers:{number:!0},id:`price_sell_${s}`,onInput:d=>g(`product_price.${s}.price_sell`),class:"w-full"},null,8,["modelValue","onUpdate:modelValue","id","onInput"]),l[`product_price.${s}.price_sell`]?(p(),n("p",ge,m(l[`product_price.${s}.price_sell`]),1)):v("",!0)]),_:2},1024),r(t(b),{class:"text-center"},{default:a(()=>[r(t(P),{variant:"ghost",size:"icon",onClick:d=>H(s)},{default:a(()=>[r(t(re),{class:"h-4 w-4"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),r(t(P),{onClick:z,variant:"outline",class:"mt-2"},{default:a(()=>e[17]||(e[17]=[_("Add")])),_:1,__:[17]})]),c("div",ye,[r(t(P),{onClick:N,class:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600",disabled:t(i).processing},{default:a(()=>e[19]||(e[19]=[_("Save")])),_:1,__:[19]},8,["disabled"]),r(t(P),{onClick:e[5]||(e[5]=o=>t(T).visit("/product-prices")),type:"button",class:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600"},{default:a(()=>e[20]||(e[20]=[_(" Cancel ")])),_:1,__:[20]})])])]),_:1})],64))}});export{De as default};
