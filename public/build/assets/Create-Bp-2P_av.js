import{d as K,aR as g,w as M,T as W,r as X,o as Y,b as j,E as O,g as d,x as r,k as s,f as n,C as b,p as l,l as T,u as o,y as _,F as k,B as h,j as c,O as U,D as P,m as Z,P as R}from"./app-BxkTEHtz.js";import{_ as tt}from"./AppLayout.vue_vue_type_script_setup_true_lang-BJOCQrJ0.js";import{_ as et}from"./Input.vue_vue_type_script_setup_true_lang-h78xJ4GD.js";import{_ as B}from"./Label.vue_vue_type_script_setup_true_lang-C-OFNqr8.js";import{_ as st,a as ot,b as A,c as w,d as at,e as C}from"./TableRow.vue_vue_type_script_setup_true_lang-2BKo8fJ5.js";import{u as it}from"./useToast-F1k_a3VB.js";import{u as rt}from"./useTransferStockStore-qKEkkPu_.js";import{u as lt}from"./useInventoryStore-C3RBb68u.js";import{d as dt}from"./debounce-BcZQbp_F.js";import{T as nt}from"./trash-Cmkp-GrJ.js";import"./index-BU4A83se.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-Bg291vNH.js";const ut={class:"p-4 space-y-4 text-sm"},_t={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3"},ct=["value"],pt={key:0,class:"text-red-600 text-xs mt-1"},mt=["value"],ft={key:0,class:"text-red-600 text-xs mt-1"},xt=["value"],yt={key:0,class:"text-red-600 text-xs mt-1"},vt={class:"border rounded-lg p-4 bg-white shadow-sm"},gt={class:"flex justify-between items-center mb-4"},bt=["value"],kt=["value"],ht=["value"],wt={class:"flex justify-end gap-2"},Ct={key:0,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"},$t={class:"bg-white rounded-lg shadow-lg w-11/12 max-w-4xl p-4 space-y-4 text-sm"},zt={class:"flex justify-between items-center"},Tt={key:0,class:"text-center py-6"},Pt={key:1,class:"space-y-4"},St={class:"flex flex-col sm:flex-row items-start sm:items-center gap-2"},Vt=["disabled"],Nt={class:"overflow-x-auto rounded-md border border-gray-200 shadow-sm"},jt={class:"min-w-full text-sm text-left whitespace-nowrap"},Ut={class:"px-3 py-2 font-medium text-gray-800"},Bt={class:"px-3 py-2"},qt={class:"px-3 py-2"},It={class:"px-3 py-2 text-right"},Mt={class:"px-3 py-2 text-center"},Ot=["onClick"],Rt={key:0},Zt=K({__name:"Create",setup(At){const S=g({productName:""});M(()=>S.productName,dt(i=>{m.setFilter("productName",i),m.fetchInventory()},500));const p=it(),m=lt(),D=rt(),a=W({location_id:void 0,location_destination_id:void 0,sloc_id:void 0,transfer_detail:[]}),u=g({}),V=g([]),q=g([]),L=g([]),$=X(!1);Y(async()=>{var i,t,e,x,y;try{const[f,v,I]=await Promise.all([j.get("/api/locations"),j.get("/api/slocs"),j.get("/api/products")]);V.push(...f.data.data),q.push(...v.data.data),L.push(...I.data.data)}catch(f){if(((i=f.response)==null?void 0:i.status)===422&&((e=(t=f.response)==null?void 0:t.data)!=null&&e.errors)){u.value=f.response.data.errors;for(const v in u)(Array.isArray(u[v])?u[v]:[u[v]]).forEach(J=>{p.error(J)})}else(y=(x=f.response)==null?void 0:x.data)!=null&&y.message?p.error(f.response.data.message):p.error("Terjadi kesalahan saat menyimpan data")}}),M(()=>a.location_id,()=>{z("location_id"),N()});const E=async()=>{if(!a.location_id||!a.sloc_id){p.error("Pilih lokasi dan sloc terlebih dahulu");return}m.filters.productName="";try{await m.fetchInventory(),$.value=!0}catch(i){console.error(i),p.error("Gagal memuat inventory")}},F=i=>{if(a.transfer_detail.find(e=>e.product_id===i.product_id&&e.size_id===i.size_id&&e.uom_id===i.uom.id)){p.error("Produk ini sudah ada di daftar detail");return}a.transfer_detail.push({product_id:i.product_id,product_name:i.product_name,size_id:i.size_id,size_name:i.size_id,uom_id:i.uom_id,uom_name:i.uom_id,qty:i.qty_available??1}),$.value=!1},z=i=>{delete u[i]},G=()=>{R.visit("/transfer-stock")},Q=async()=>{var i;try{if(!a.location_id||!a.location_destination_id||!a.sloc_id){p.error("Semua lokasi dan sloc wajib diisi");return}await D.createTransfer({location_id:a.location_id,location_destination_id:a.location_destination_id,sloc_id:a.sloc_id,transfer_detail:a.transfer_detail.map(t=>({product_id:t.product_id,size_id:t.size_id,uom_id:t.uom_id,qty:t.qty}))}),p.success("Transfer berhasil disimpan"),R.visit("/transfer-stock")}catch(t){((i=t.response)==null?void 0:i.status)===422?Object.assign(u,t.response.data.errors):p.error("Gagal menyimpan transfer")}};function H(i){a.transfer_detail.splice(i,1)}const N=()=>{z("location_id"),z("sloc_id"),a.transfer_detail.splice(0,a.transfer_detail.length)};return(i,t)=>(d(),O(tt,{title:"Tambah Transfer Stock"},{default:r(()=>[s("div",ut,[s("div",_t,[s("div",null,[l(o(B),{for:"location_id"},{default:r(()=>t[6]||(t[6]=[_("Lokasi Asal")])),_:1,__:[6]}),T(s("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>o(a).location_id=e),id:"location_id",class:"w-full border rounded p-1",onChange:N},[t[7]||(t[7]=s("option",{disabled:"",value:""},"Pilih lokasi",-1)),(d(!0),n(k,null,h(V,e=>(d(),n("option",{key:e.id,value:e.id},c(e.name),9,ct))),128))],544),[[U,o(a).location_id]]),u.location_id?(d(),n("p",pt,c(u.location_id),1)):b("",!0)]),s("div",null,[l(o(B),{for:"location_destination_id"},{default:r(()=>t[8]||(t[8]=[_("Lokasi Tujuan")])),_:1,__:[8]}),T(s("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>o(a).location_destination_id=e),id:"location_destination_id",class:"w-full border rounded p-1",onChange:t[2]||(t[2]=e=>z("location_destination_id"))},[t[9]||(t[9]=s("option",{disabled:"",value:""},"Pilih lokasi",-1)),(d(!0),n(k,null,h(V,e=>(d(),n("option",{key:e.id,value:e.id},c(e.name),9,mt))),128))],544),[[U,o(a).location_destination_id]]),u.location_destination_id?(d(),n("p",ft,c(u.location_destination_id),1)):b("",!0)]),s("div",null,[l(o(B),{for:"sloc_id"},{default:r(()=>t[10]||(t[10]=[_("Sloc")])),_:1,__:[10]}),T(s("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>o(a).sloc_id=e),id:"sloc_id",class:"w-full border rounded p-1",onChange:N},[t[11]||(t[11]=s("option",{disabled:"",value:""},"Pilih sloc",-1)),(d(!0),n(k,null,h(q,e=>(d(),n("option",{key:e.id,value:e.id},c(e.name),9,xt))),128))],544),[[U,o(a).sloc_id]]),u.sloc_id?(d(),n("p",yt,c(u.sloc_id),1)):b("",!0)])]),s("div",vt,[s("div",gt,[t[13]||(t[13]=s("h2",{class:"font-semibold text-gray-800 text-base"},"Detail Barang",-1)),l(o(P),{variant:"outline",size:"sm",class:"text-xs",onClick:E,disabled:!o(a).location_id||!o(a).sloc_id},{default:r(()=>t[12]||(t[12]=[_(" Tambah Baris ")])),_:1,__:[12]},8,["disabled"])]),l(o(st),null,{default:r(()=>[l(o(ot),null,{default:r(()=>[l(o(A),null,{default:r(()=>[l(o(w),{class:"text-xs"},{default:r(()=>t[14]||(t[14]=[_("Produk")])),_:1,__:[14]}),l(o(w),{class:"text-xs"},{default:r(()=>t[15]||(t[15]=[_("Ukuran")])),_:1,__:[15]}),l(o(w),{class:"text-xs"},{default:r(()=>t[16]||(t[16]=[_("UOM")])),_:1,__:[16]}),l(o(w),{class:"text-xs text-center"},{default:r(()=>t[17]||(t[17]=[_("Qty")])),_:1,__:[17]}),l(o(w),{class:"text-xs text-center"},{default:r(()=>t[18]||(t[18]=[_("Aksi")])),_:1,__:[18]})]),_:1})]),_:1}),l(o(at),null,{default:r(()=>[(d(!0),n(k,null,h(o(a).transfer_detail,(e,x)=>(d(),O(o(A),{key:x},{default:r(()=>[l(o(C),null,{default:r(()=>[s("input",{type:"text",value:e.product_name,readonly:"",class:"w-full bg-gray-100 text-sm border rounded px-2 py-1"},null,8,bt)]),_:2},1024),l(o(C),null,{default:r(()=>[s("input",{type:"text",value:e.size_id,readonly:"",class:"w-full bg-gray-100 text-sm border rounded px-2 py-1"},null,8,kt)]),_:2},1024),l(o(C),null,{default:r(()=>[s("input",{type:"text",value:e.uom_id,readonly:"",class:"w-full bg-gray-100 text-sm border rounded px-2 py-1"},null,8,ht)]),_:2},1024),l(o(C),{class:"text-center"},{default:r(()=>[l(o(et),{type:"number",min:"1",step:"1",modelValue:e.qty,"onUpdate:modelValue":y=>e.qty=y,class:"w-full text-sm px-2 py-1 border rounded"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(o(C),{class:"text-center"},{default:r(()=>[l(o(P),{variant:"destructive",size:"sm",class:"text-xs",onClick:y=>H(x)},{default:r(()=>[l(o(nt),{class:"h-4 w-4"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),s("div",wt,[l(o(P),{onClick:Q,disabled:o(a).processing,class:"bg-indigo-600 text-white text-sm px-4 py-2 rounded hover:bg-indigo-700"},{default:r(()=>t[19]||(t[19]=[_("Simpan")])),_:1,__:[19]},8,["disabled"]),l(o(P),{onClick:G,variant:"outline",class:"text-sm px-4 py-2"},{default:r(()=>t[20]||(t[20]=[_("Batal")])),_:1,__:[20]})])]),$.value?(d(),n("div",Ct,[s("div",$t,[s("div",zt,[t[21]||(t[21]=s("h3",{class:"text-base font-semibold"},"Pilih Produk dari Inventory",-1)),s("button",{onClick:t[4]||(t[4]=e=>$.value=!1),class:"text-gray-600 hover:text-gray-900 text-lg"},"Ã—")]),o(m).loading?(d(),n("div",Tt,"Loading inventory...")):(d(),n("div",Pt,[s("div",St,[T(s("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>S.productName=e),placeholder:"Cari Produk",disabled:o(m).loading,class:"w-full sm:w-64 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 text-sm","aria-label":"Search"},null,8,Vt),[[Z,S.productName]])]),s("div",Nt,[s("table",jt,[t[23]||(t[23]=s("thead",{class:"bg-gray-100 text-gray-700 uppercase text-xs"},[s("tr",null,[s("th",{class:"px-3 py-2"},"Produk"),s("th",{class:"px-3 py-2"},"Size"),s("th",{class:"px-3 py-2"},"UOM"),s("th",{class:"px-3 py-2 text-right"},"Qty"),s("th",{class:"px-3 py-2 text-center"},"Aksi")])],-1)),s("tbody",null,[(d(!0),n(k,null,h(o(m).inventoryRpt,e=>(d(),n("tr",{key:`${e.product_id}-${e.location_id}-${e.sloc_id}-${e.size_id}`,class:"hover:bg-gray-50 border-t"},[s("td",Ut,c(e.product_name),1),s("td",Bt,c(e.size_id),1),s("td",qt,c(e.uom_id),1),s("td",It,c(e.qty),1),s("td",Mt,[s("button",{onClick:x=>F(e),class:"text-blue-600 hover:text-blue-800 hover:underline transition"}," Pilih ",8,Ot)])]))),128)),o(m).inventoryRpt.length===0?(d(),n("tr",Rt,t[22]||(t[22]=[s("td",{colspan:"5",class:"px-3 py-4 text-center text-gray-500"},"Tidak ada inventory ditemukan.",-1)]))):b("",!0)])])])]))])])):b("",!0)]),_:1}))}});export{Zt as default};
