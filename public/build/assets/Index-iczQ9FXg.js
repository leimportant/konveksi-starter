import{M as G,b as k,d as H,r as w,T as J,q as O,o as Q,c as W,f as _,g as m,p as i,u as o,Z as X,x as d,k as r,C as A,D as g,y as p,F as $,B as S,E as Y,j as M,K as ee}from"./app-CxjlAAmy.js";import{d as se,_ as te}from"./AppLayout.vue_vue_type_script_setup_true_lang-CUqc4D3a.js";import{_ as ae}from"./Input.vue_vue_type_script_setup_true_lang-DmbB-vQJ.js";import{_ as le,a as oe,b as T,c as N,d as ne,e as V}from"./TableRow.vue_vue_type_script_setup_true_lang-CX4CaGyC.js";import{u as ie}from"./useToast-C62M7Wea.js";import{P as j}from"./plus-Ce-KvbGD.js";import{T as re}from"./trash-2-Dkdqy3vN.js";import"./index-CnSYX7tt.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CwHWoZIt.js";const de=G("role",{state:()=>({items:[],loaded:!1}),actions:{async fetchRoles(){if(!this.loaded)try{const f=await k.get("/api/roles");this.items=f.data.data,this.loaded=!0}catch(f){console.error("Failed to fetch Roles",f)}},async createRole(f){try{await k.post("/api/roles",{name:f}),await this.fetchRoles()}catch(c){throw c}},async updateRole(f,c){try{await k.put(`/api/roles/${f}`,{name:c}),await this.fetchRoles()}catch(v){throw v}},async deleteRole(f){try{await k.delete(`/api/roles/${f}`),await this.fetchRoles()}catch(c){throw c}},async assignMenusToRole(f,c){try{await k.post("/api/roles/assign-menus",{role_id:f,menus:c})}catch(v){throw v}}}}),ce={class:"px-4 py-4"},ue={class:"flex justify-between items-center gap-2 mb-2"},fe={class:"rounded-md border"},he={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},me={class:"bg-white p-6 rounded-lg w-96"},_e={class:"text-lg font-semibold mb-4"},ve={class:"flex items-center mb-2 border-b pb-2"},pe=["checked"],ge={class:"mb-4 max-h-60 overflow-y-auto"},ye={class:"flex items-center"},be=["id","checked","onChange"],ke=["for"],we={key:0,class:"ml-6"},xe=["id","checked","onChange"],Ce=["for"],Re={class:"flex justify-end gap-2"},$e={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Me={class:"bg-white p-6 rounded-lg w-96"},Ae={class:"mb-4"},Se={class:"flex justify-end gap-2"},De=H({__name:"Index",setup(f){const c=ie(),v=w(!1),x=w(!1),C=w(null),y=w([]),n=w([]),b=J({name:""}),B=[{title:"Role",href:"/roles"}],h=de(),{items:F}=O(h),E=se();Q(()=>{h.fetchRoles()});const z=async()=>{var t,e;if(!C.value)return c.error("No role selected");try{await h.assignMenusToRole(C.value.id,n.value),c.success("Menus assigned successfully"),x.value=!1,h.loaded=!1,await h.fetchRoles()}catch(l){c.error(((e=(t=l==null?void 0:l.response)==null?void 0:t.data)==null?void 0:e.message)??"Failed to assign menus")}},q=async t=>{C.value=t,y.value=await E.fetchAllMenus(t.id),n.value=[],y.value.forEach(e=>{var l;e.checked&&n.value.push(e.id),(l=e.children)==null||l.forEach(s=>{s.checked&&n.value.push(s.id)})}),x.value=!0},D=async()=>{var t,e,l,s;if(!b.name)return c.error("Name is required");try{await h.createRole(b.name),c.success("Role created successfully"),b.reset(),h.loaded=!1,await h.fetchRoles(),v.value=!1}catch(a){const u=(s=(l=(e=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:e.errors)==null?void 0:l.name)==null?void 0:s[0];c.error(u||"Failed to create role")}},I=async t=>{var e,l;if(confirm("Are you sure you want to delete this role?"))try{await h.deleteRole(t),c.success("Role deleted successfully"),h.loaded=!1,await h.fetchRoles()}catch(s){c.error(((l=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:l.message)??"Failed to delete role")}},R=t=>n.value.includes(t),P=t=>{var s;const e=t.id,l=((s=t.children)==null?void 0:s.map(a=>a.id))||[];if(R(e))n.value=n.value.filter(a=>a!==e&&!l.includes(a));else{n.value.push(e);for(const a of l)n.value.includes(a)||n.value.push(a)}},U=(t,e)=>{var l;if(R(e)){n.value=n.value.filter(u=>u!==e);const s=y.value.find(u=>u.id===t);((l=s==null?void 0:s.children)==null?void 0:l.some(u=>n.value.includes(u.id)))||(n.value=n.value.filter(u=>u!==t))}else n.value.push(e),n.value.includes(t)||n.value.push(t)},K=t=>{if(t.target.checked){const l=y.value.flatMap(s=>{var u;const a=((u=s.children)==null?void 0:u.map(Z=>Z.id))||[];return[s.id,...a]}).filter(s=>typeof s=="number");n.value=[...new Set(l)]}else n.value=[]},L=W(()=>{const t=y.value.flatMap(e=>{var s;const l=((s=e.children)==null?void 0:s.map(a=>a.id))||[];return[e.id,...l]}).filter(e=>typeof e=="number");return t.length>0&&t.every(e=>n.value.includes(e))});return(t,e)=>(m(),_($,null,[i(o(X),{title:"Role Management"}),i(te,{breadcrumbs:B},{default:d(()=>{var l;return[r("div",ce,[r("div",ue,[i(o(g),{onClick:e[0]||(e[0]=s=>v.value=!0),class:"bg-indigo-600 text-white py-2 h-10 rounded-md hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:d(()=>[i(o(j),{class:"h-4 w-4"}),e[4]||(e[4]=p(" Tambah Role "))]),_:1,__:[4]})]),r("div",fe,[i(o(le),null,{default:d(()=>[i(o(oe),null,{default:d(()=>[i(o(T),{class:"bg-gray-100"},{default:d(()=>[i(o(N),null,{default:d(()=>e[5]||(e[5]=[p("Name")])),_:1,__:[5]}),i(o(N),{class:"w-24"},{default:d(()=>e[6]||(e[6]=[p("Actions")])),_:1,__:[6]})]),_:1})]),_:1}),i(o(ne),null,{default:d(()=>[(m(!0),_($,null,S(o(F),s=>(m(),Y(o(T),{key:s.id},{default:d(()=>[i(o(V),null,{default:d(()=>[p(M(s.name),1)]),_:2},1024),i(o(V),{class:"flex gap-2"},{default:d(()=>[i(o(g),{variant:"ghost",size:"icon",onClick:a=>q(s)},{default:d(()=>[i(o(j),{class:"h-4 w-4"})]),_:2},1032,["onClick"]),i(o(g),{variant:"ghost",size:"icon",onClick:a=>I(s.id)},{default:d(()=>[i(o(re),{class:"h-4 w-4"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),x.value?(m(),_("div",he,[r("div",me,[r("h2",_e,"Assign Menu to "+M((l=C.value)==null?void 0:l.name),1),r("div",ve,[r("input",{type:"checkbox",id:"check-all",checked:L.value,onChange:K,class:"mr-2"},null,40,pe),e[7]||(e[7]=r("label",{for:"check-all",class:"font-medium"},"Check / Uncheck All",-1))]),r("div",ge,[(m(!0),_($,null,S(y.value,s=>(m(),_("div",{key:s.id,class:"mb-2"},[r("div",ye,[r("input",{type:"checkbox",id:`menu-${s.id}`,checked:R(s.id),onChange:a=>P(s),class:"mr-2"},null,40,be),r("label",{for:`menu-${s.id}`},M(s.title),9,ke)]),s.children&&s.children.length?(m(),_("div",we,[(m(!0),_($,null,S(s.children,a=>(m(),_("div",{key:a.id,class:"flex items-center mb-1"},[r("input",{type:"checkbox",id:`menu-${a.id}`,checked:R(a.id),onChange:u=>U(s.id,a.id),class:"mr-2"},null,40,xe),r("label",{for:`menu-${a.id}`},M(a.title),9,Ce)]))),128))])):A("",!0)]))),128))]),r("div",Re,[i(o(g),{type:"button",variant:"outline",onClick:e[1]||(e[1]=s=>x.value=!1),class:"h-10"},{default:d(()=>e[8]||(e[8]=[p("Cancel")])),_:1,__:[8]}),i(o(g),{type:"submit",onClick:z},{default:d(()=>e[9]||(e[9]=[p("Assign")])),_:1,__:[9]})])])])):A("",!0),v.value?(m(),_("div",$e,[r("div",Me,[e[12]||(e[12]=r("h2",{class:"text-lg font-semibold mb-4"},"Tambah Role Baru",-1)),r("form",{onSubmit:ee(D,["prevent"])},[r("div",Ae,[i(o(ae),{modelValue:o(b).name,"onUpdate:modelValue":e[2]||(e[2]=s=>o(b).name=s),placeholder:"Role Name",required:""},null,8,["modelValue"])]),r("div",Se,[i(o(g),{type:"button",variant:"outline",onClick:e[3]||(e[3]=s=>v.value=!1),class:"h-10"},{default:d(()=>e[10]||(e[10]=[p("Cancel")])),_:1,__:[10]}),i(o(g),{type:"submit",class:"bg-indigo-600 text-white py-2 h-10 rounded-md hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:d(()=>e[11]||(e[11]=[p("Create")])),_:1,__:[11]})])],32)])])):A("",!0)])]}),_:1})],64))}});export{De as default};
