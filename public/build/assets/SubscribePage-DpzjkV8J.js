import{b as g,d as h,r as o,f as c,g as u,k as l,p as f,C as v,x as k,y as w,j as b,u as m,D as S}from"./app-CimJA_nk.js";async function _(r){if(!("serviceWorker"in navigator))throw new Error("Service workers are not supported.");const s=await navigator.serviceWorker.ready,t=await s.pushManager.getSubscription();if(t){const i=t.options.applicationServerKey,y=p(r);if(!x(i,y))console.log("Unsubscribing existing push subscription..."),await t.unsubscribe();else{console.log("Already subscribed with same key.");return}}const e=await s.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:p(r)}),n={endpoint:e.endpoint,keys:{p256dh:d(e.getKey("p256dh")),auth:d(e.getKey("auth"))}},a=await g.post("/api/push/subscribe",n);console.log("Subscription berhasil dikirim:",a.data)}function p(r){const s="=".repeat((4-r.length%4)%4),t=(r+s).replace(/-/g,"+").replace(/_/g,"/"),e=window.atob(t),n=new Uint8Array(e.length);for(let a=0;a<e.length;++a)n[a]=e.charCodeAt(a);return n}function d(r){if(!r)return"";const s=new Uint8Array(r);let t="";return s.forEach(e=>t+=String.fromCharCode(e)),window.btoa(t)}function x(r,s){return!r||r.byteLength!==s.byteLength?!1:new Uint8Array(r).every((e,n)=>e===s[n])}const A={class:"p-4 space-y-4"},C={key:0,class:"text-sm text-gray-600"},E=h({__name:"SubscribePage",setup(r){const s="BFhuAkBPxt7Entla9XXTPMX9lEE6fC53hv78zM_sO8utv65lzMz_WKI6Q6eid3sC8sPYBUmoG-a4vdpn0v23M7k",t=o(!1),e=o(""),n=async()=>{try{if(!("serviceWorker"in navigator)){e.value="Service Worker tidak didukung di browser ini.";return}await _(s),t.value=!0,e.value="Berhasil subscribe push notification."}catch(a){console.error("Subscription error:",a),e.value="Gagal subscribe. Cek console."}};return(a,i)=>(u(),c("div",A,[i[0]||(i[0]=l("h1",{class:"text-xl font-bold"},"Push Notifications",-1)),i[1]||(i[1]=l("p",null,"Tekan tombol untuk subscribe ke notifikasi.",-1)),f(m(S),{onClick:n,disabled:t.value},{default:k(()=>[w(b(t.value?"Sudah Subscribe":"Subscribe Push"),1)]),_:1},8,["disabled"]),e.value?(u(),c("p",C,b(e.value),1)):v("",!0)]))}});export{E as default};
