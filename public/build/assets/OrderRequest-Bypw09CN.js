import{d as ce,r,c as J,o as _e,a as be,w as Q,f,g as m,p as l,u as a,Z as ye,x as s,k as o,z as k,j as c,y as i,F as S,B as Y,C as V,D as v,E as D,$ as xe,a0 as U,a1 as ke,b as we}from"./app-Bj_kpMHq.js";import{_ as Ce,a as he,b as F,c as b,d as $e,e as _}from"./TableRow.vue_vue_type_script_setup_true_lang-2xZ4sEoC.js";import{_ as Ve}from"./Textarea.vue_vue_type_script_setup_true_lang--L6dZrkK.js";import{u as De}from"./useToast-BKXtDSru.js";import{_ as Pe}from"./AppLayout.vue_vue_type_script_setup_true_lang-C-B5aa47.js";import{_ as O}from"./Input.vue_vue_type_script_setup_true_lang-DJN7_ygH.js";import{_ as Se}from"./DateInput.vue_vue_type_script_setup_true_lang-BdtTXEwl.js";import{u as H}from"./useOrderCustomer-FEe50nPa.js";import{d as Oe}from"./debounce-BcZQbp_F.js";import"./index-DYrEdJEX.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CFabbRMa.js";const Te={class:"px-4 py-4"},Ne={class:"px-2 py-2 sm:px-4 sm:py-4 bg-white min-h-screen overflow-x-auto"},ze={class:"mb-4 flex flex-wrap gap-2 border-b"},Be={key:0,class:"text-center text-gray-500 text-sm py-6"},Ie={key:1,class:"text-center text-red-500 text-sm py-6"},Me={key:2,class:"text-center text-gray-500 text-sm py-6"},Ue={key:3,class:"overflow-x-auto border rounded"},Fe={class:"relative bg-white dark:bg-gray-800"},Re={key:0,class:"absolute left-0 top-full z-50 mt-2 w-44 rounded-md bg-white dark:bg-gray-800 text-black dark:text-white shadow-lg ring-1 ring-black ring-opacity-5"},Ee={class:"py-1 text-left text-sm"},je={class:"space-y-1"},Ke={class:"mt-1 text-right font-semibold"},Ge={class:"space-y-4 p-4 sm:p-6"},Le={class:"flex justify-end gap-2 pt-2"},qe={class:"flex justify-center p-4"},Ae={class:"space-y-3 p-4 text-sm"},Je={class:"flex justify-end gap-2"},ot=ce({__name:"OrderRequest",setup(Qe){const R=r(!1),y=r(!1),w=r(!1),P=r(""),W=r(""),C=r([]),E=r(null),T=r(""),{orders:j,isLoading:K,error:G,pagination:L,fetchOrderRequest:h,cancelOrder:Z,deleteOrder:X,checkShipping:ee,updateShipping:te,setFilterOrderRequest:ae}=H(),d=r("cart"),le=r(null),N=r(""),z=r(""),B=r(""),I=r(null),$=r(null),p=r(1),x=r(10),se=J(()=>{var n,e;return Math.ceil((((n=L.value)==null?void 0:n.total)||0)/(((e=L.value)==null?void 0:e.per_page)||1))}),q=()=>{document.documentElement.scrollTop+window.innerHeight>=document.documentElement.offsetHeight-100&&!K.value&&p.value<se.value&&(p.value++,h({status:d.value,page:p.value,per_page:x.value,append:!0}))},{fetchBankAccount:ne}=H(),g=De();_e(()=>{p.value=1,ne(),h({status:d.value,page:p.value,per_page:x.value}),window.addEventListener("scroll",q)}),be(()=>{window.removeEventListener("scroll",q)}),Q(d,n=>{p.value=1,h({status:n,page:p.value,per_page:x.value})}),Q(T,Oe(n=>{j.value=[],p.value=1,ae("name",n,{status:d.value,page:p.value,per_page:x.value,append:!1})},400));const A=J(()=>j.value),oe=(n,e)=>{E.value=e,C.value=n,w.value=!0},M=r();function ie(n){M.value=M.value===n?null:n}const ue=async n=>{try{const e=await ee(n);le.value=e,y.value=!0}catch(e){console.log(e),alert("Gagal mengambil data pengiriman.")}};async function re(n){try{await Z(n),g.success("Pesanan berhasil dibatalkan."),setTimeout(()=>{p.value=1,h({status:d.value,page:p.value,per_page:x.value})},500)}catch(e){console.log(e),g.error("Gagal membatalkan pesanan.")}}async function de(n){try{await X(n),g.success("Pesanan berhasil dibatalkan."),setTimeout(()=>{p.value=1,h({status:d.value,page:p.value,per_page:x.value})},500)}catch(e){console.log(e),g.error("Gagal membatalkan pesanan.")}}const me=async()=>{try{const n={message:P.value,content_data:C.value.length>0?C.value:null,sender_type:"admin",receiver_id:E.value,order_id:C.value.length>0?C.value[0]:null};console.log("Sending message payload:",n),await we.post("/api/chat/send",n),w.value=!1,P.value="",g.success("Pesan berhasil dikirim")}catch(n){console.error("Failed to send message:",n),g.error("Gagal mengirim pesan")}};function pe(n){var t;const e=n.target;(t=e.files)!=null&&t.length&&(I.value=e.files[0])}const ve=async n=>{y.value=!0,$.value=n};async function ge(){var e,t;const n=new FormData;if(!$.value){g.error("Order ID tidak tersedia");return}n.append("resi_number",N.value),n.append("delivery_provider",z.value),n.append("estimation_date",B.value),I.value&&n.append("delivery_proof",I.value);try{const u=await te($.value,n);g.success((u==null?void 0:u.message)||"Pengiriman berhasil diperbarui"),y.value=!1}catch(u){console.error("Gagal memperbarui pengiriman:",u);const fe=((t=(e=u==null?void 0:u.response)==null?void 0:e.data)==null?void 0:t.message)||"Terjadi kesalahan saat memperbarui pengiriman";g.error(fe)}}return(n,e)=>(m(),f(S,null,[l(a(ye),{title:"Riwayat Order"}),l(Pe,null,{default:s(()=>[o("div",Te,[o("section",Ne,[l(a(O),{modelValue:T.value,"onUpdate:modelValue":e[0]||(e[0]=t=>T.value=t),placeholder:"Search",class:"w-64","aria-label":"Search"},null,8,["modelValue"]),o("div",ze,[o("button",{onClick:e[1]||(e[1]=t=>d.value="cart"),class:k(["rounded-t px-4 py-2 text-sm md:",d.value==="cart"?"border-b-2 text-indigo-400 border-indigo-600 font-semibold":"text-gray-500"])}," Keranjang Konsumen ",2),o("button",{onClick:e[2]||(e[2]=t=>d.value="pending"),class:k(["rounded-t px-4 py-2 text-sm md:",d.value==="pending"?"border-b-2 text-indigo-400 border-indigo-600 font-semibold":"text-gray-500"])}," Pesanan Active ",2),o("button",{onClick:e[3]||(e[3]=t=>d.value="done"),class:k(["rounded-t px-4 py-2 text-sm md:",d.value==="done"?"border-b-2  text-indigo-400 border-indigo-600 font-semibold":"text-gray-500"])}," Selesai ",2),o("button",{onClick:e[4]||(e[4]=t=>d.value="cancel"),class:k(["rounded-t px-4 py-2 text-sm md:",d.value==="cancel"?"border-b-2  text-indigo-400 border-indigo-600 font-semibold":"text-gray-500"])}," Dibatalkan ",2)]),a(K)?(m(),f("div",Be,"Memuat pesanan...")):a(G)?(m(),f("div",Ie,c(a(G)),1)):A.value.length===0?(m(),f("div",Me,"Tidak ada pesanan ditemukan.")):(m(),f("div",Ue,[l(a(Ce),{class:"max-h-screen w-full"},{default:s(()=>[l(a(he),null,{default:s(()=>[l(a(F),{class:"bg-gray-100"},{default:s(()=>[l(a(b),{class:"w-[5%]"},{default:s(()=>e[15]||(e[15]=[i("#")])),_:1,__:[15]}),l(a(b),{class:"w-[10%]"},{default:s(()=>e[16]||(e[16]=[i("No. Order")])),_:1,__:[16]}),l(a(b),{class:"w-[10%]"},{default:s(()=>e[17]||(e[17]=[i("Customer")])),_:1,__:[17]}),l(a(b),{class:"w-[10%]"},{default:s(()=>e[18]||(e[18]=[i("Tanggal")])),_:1,__:[18]}),l(a(b),{class:"w-[10%]"},{default:s(()=>e[19]||(e[19]=[i("Total")])),_:1,__:[19]}),l(a(b),{class:"w-[10%]"},{default:s(()=>e[20]||(e[20]=[i("Status")])),_:1,__:[20]}),l(a(b),{class:"w-[10%] text-center"},{default:s(()=>e[21]||(e[21]=[i("Pembayaran")])),_:1,__:[21]})]),_:1})]),_:1}),l(a($e),null,{default:s(()=>[(m(!0),f(S,null,Y(A.value,t=>(m(),f(S,{key:t.id},[l(a(F),{class:"text-xs sm:text-sm"},{default:s(()=>[l(a(_),null,{default:s(()=>[o("div",Fe,[l(a(v),{onClick:u=>ie(t.id),size:"icon",variant:"ghost"},{default:s(()=>e[22]||(e[22]=[i("â‹®")])),_:2,__:[22]},1032,["onClick"]),M.value===t.id?(m(),f("div",Re,[o("div",Ee,[l(a(v),{variant:"ghost",size:"icon",onClick:u=>oe([t.id],t.customer_id),class:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700"},{default:s(()=>e[23]||(e[23]=[i(" Kirim Pesan ")])),_:2,__:[23]},1032,["onClick"]),t.is_paid!=="Y"?(m(),D(a(v),{key:0,variant:"ghost",size:"icon",onClick:u=>re(t.id),class:"w-full text-left px-4 py-2 text-red-500 hover:bg-gray-100 dark:hover:bg-gray-700"},{default:s(()=>e[24]||(e[24]=[i(" Batalkan Pesanan ")])),_:2,__:[24]},1032,["onClick"])):V("",!0),d.value==="cart"?(m(),D(a(v),{key:1,variant:"ghost",size:"icon",onClick:u=>de(t.id),class:"w-full text-left px-4 py-2 text-red-500 hover:bg-gray-100 dark:hover:bg-gray-700"},{default:s(()=>e[25]||(e[25]=[i(" Delete Pesanan ")])),_:2,__:[25]},1032,["onClick"])):V("",!0),t.resi_number==""&&t.is_paid=="Y"&&t.payment_method==="bank_transfer"?(m(),D(a(v),{key:2,variant:"ghost",size:"icon",onClick:u=>ve(t.id),class:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700"},{default:s(()=>e[26]||(e[26]=[i(" Update Resi ")])),_:2,__:[26]},1032,["onClick"])):V("",!0),t.resi_number==""&&t.is_paid=="Y"&&t.payment_method==="bank_transfer"?(m(),D(a(v),{key:3,variant:"ghost",size:"icon",onClick:u=>ue(t.id),class:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700"},{default:s(()=>e[27]||(e[27]=[i(" Status Pengiriman ")])),_:2,__:[27]},1032,["onClick"])):V("",!0)])])):V("",!0)])]),_:2},1024),l(a(_),null,{default:s(()=>[i(c(t.id),1)]),_:2},1024),l(a(_),null,{default:s(()=>{var u;return[i(c(((u=t.customer)==null?void 0:u.name)||t.customer_id+" - N/A"),1)]}),_:2},1024),l(a(_),null,{default:s(()=>[i(c(new Date(t.created_at).toLocaleDateString("id-ID")),1)]),_:2},1024),l(a(_),null,{default:s(()=>[i(c(new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(Number(t.total_amount))),1)]),_:2},1024),l(a(_),null,{default:s(()=>[o("span",{class:k({"text-yellow-600":t.status===1,"text-green-600":t.status===2,"text-red-600":t.status===3})},c(t.status===1?"Pending":t.status===2?"Selesai":t.status===3?"Menunggu Konfirmasi":t.status===4?"On Progress":t.status===5?"Sedang di kemas":"Dikirim"),3)]),_:2},1024),l(a(_),{class:"text-center"},{default:s(()=>[o("span",{class:k(["inline-block rounded-full border px-2 py-0.5 text-xs",t.payment_method==="bank_transfer"?"border-yellow-600 text-yellow-600":t.payment_method==="cod_store"?"border-green-600 text-green-600":"border-gray-300 text-gray-500"])},c(t.payment_method==="bank_transfer"?"Transfer":t.payment_method==="cod_store"?"Bayar Di Toko":"-"),3)]),_:2},1024)]),_:2},1024),l(a(F),null,{default:s(()=>[l(a(_),{colspan:"7",class:"bg-blue-50 p-3 text-xs sm:text-sm"},{default:s(()=>[e[28]||(e[28]=o("h4",{class:"mb-1 font-medium"},"Detail Pesanan:",-1)),o("div",je,[(m(!0),f(S,null,Y(t.order_items,u=>(m(),D(xe,{key:u.id,item:u},null,8,["item"]))),128))]),o("div",Ke," Subtotal: "+c(new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(Number(t.total_amount))),1)]),_:2,__:[28]},1024)]),_:2},1024)],64))),128))]),_:1})]),_:1})]))])]),l(U,{show:w.value,onClose:e[7]||(e[7]=t=>w.value=!1)},{default:s(()=>[o("div",Ge,[e[31]||(e[31]=o("h2",{class:"text-center font-semibold text-gray-800 sm:text-lg"},"Kirim Pesan",-1)),l(a(Ve),{modelValue:P.value,"onUpdate:modelValue":e[5]||(e[5]=t=>P.value=t),class:"h-32 w-full resize-none rounded-md border border-gray-300 p-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"Tulis pesan..."},null,8,["modelValue"]),o("div",Le,[l(a(v),{onClick:e[6]||(e[6]=t=>w.value=!1),variant:"outline"},{default:s(()=>e[29]||(e[29]=[i("Batal")])),_:1,__:[29]}),l(a(v),{onClick:me,class:"bg-indigo-600 text-white"},{default:s(()=>e[30]||(e[30]=[i("Kirim")])),_:1,__:[30]})])])]),_:1},8,["show"]),l(U,{show:R.value,onClose:e[8]||(e[8]=t=>R.value=!1)},{default:s(()=>[o("div",qe,[l(ke,{value:W.value,size:256},null,8,["value"])])]),_:1},8,["show"]),l(U,{show:y.value,onClose:e[14]||(e[14]=t=>y.value=!1)},{default:s(()=>[o("div",Ae,[e[39]||(e[39]=o("h3",{class:"font-semibold"},"Update Pengiriman",-1)),o("div",null,[e[32]||(e[32]=o("label",null,"No Order:",-1)),l(a(O),{modelValue:$.value,"onUpdate:modelValue":e[9]||(e[9]=t=>$.value=t),readonly:""},null,8,["modelValue"])]),o("div",null,[e[33]||(e[33]=o("label",null,"No Resi:",-1)),l(a(O),{modelValue:N.value,"onUpdate:modelValue":e[10]||(e[10]=t=>N.value=t),placeholder:"Masukkan nomor resi"},null,8,["modelValue"])]),o("div",null,[e[34]||(e[34]=o("label",null,"Jasa Pengirim:",-1)),l(a(O),{modelValue:z.value,"onUpdate:modelValue":e[11]||(e[11]=t=>z.value=t),placeholder:"JNE/J&T/Sicepat dll"},null,8,["modelValue"])]),o("div",null,[e[35]||(e[35]=o("label",null,"Estimasi Tiba:",-1)),l(a(Se),{id:"estimation_date",modelValue:B.value,"onUpdate:modelValue":e[12]||(e[12]=t=>B.value=t)},null,8,["modelValue"])]),o("div",null,[e[36]||(e[36]=o("label",null,"Bukti Pengiriman (opsional):",-1)),o("input",{type:"file",onChange:pe},null,32)]),o("div",Je,[l(a(v),{onClick:e[13]||(e[13]=t=>y.value=!1),variant:"outline"},{default:s(()=>e[37]||(e[37]=[i("Batal")])),_:1,__:[37]}),l(a(v),{onClick:ge,class:"bg-blue-600 text-white"},{default:s(()=>e[38]||(e[38]=[i("Simpan")])),_:1,__:[38]})])])]),_:1},8,["show"])]),_:1})],64))}});export{ot as default};
