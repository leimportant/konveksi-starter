import{R as de,b as S,d as re,r as g,T as ue,q as ce,o as fe,c as ve,f,g as c,p as d,u as i,Z as me,x as u,k as o,C as B,D as k,y as _,F as M,B as V,E as pe,j as C,l as Y,U as E,O as _e,N as ge,n as ye}from"./app-Cc0-XsVa.js";import{_ as he}from"./Input.vue_vue_type_script_setup_true_lang-3rw-jVjU.js";import{_ as be,a as ke,b as L,c as T,d as we,e as U}from"./TableRow.vue_vue_type_script_setup_true_lang-BrVXD2t_.js";import{u as xe}from"./useToast-CPWFUHv0.js";import{i as Ce,_ as Re}from"./AppLayout.vue_vue_type_script_setup_true_lang-CXI-OFE0.js";import{u as $e}from"./useActivityGroupStore-hg3hRD1S.js";import{P as O}from"./plus-BOy4GVc6.js";import{T as Ae}from"./trash-2-CYmKYlSH.js";import"./index-BGxQBHr3.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-Cgh6EfYZ.js";const Me=de("role",{state:()=>({items:[],loaded:!1}),actions:{async fetchRoles(y=!1){if(!(this.loaded&&!y))try{const r=await S.get("/api/roles");this.items=r.data.data,this.loaded=!0}catch(r){console.error("Failed to fetch Roles",r)}},async createRole(y,r,h){try{await S.post("/api/roles",{name:y,create_prod:r,all_employee:h}),await this.fetchRoles()}catch(w){throw w}},async updateRole(y,r,h,w){try{await S.put(`/api/roles/${y}`,{name:r,create_prod:h,all_employee:w}),await this.fetchRoles()}catch(b){throw b}},async deleteRole(y){try{await S.delete(`/api/roles/${y}`),await this.fetchRoles()}catch(r){throw r}},async assignMenusToRole(y,r){try{await S.post("/api/roles/assign-menus",{role_id:y,menus:r})}catch(h){throw h}}}}),Ne={class:"px-4 py-4"},Se={class:"mb-2 flex items-center justify-between gap-2"},Ve={class:"rounded-md border"},Ye=["onClick"],Te=["title"],Ue={key:1,class:"text-sm italic text-gray-400"},Fe=["onMouseleave"],Ge=["onChange"],je=["onClick"],Be={key:0,class:"text-green-600 font-semibold"},Ee={key:1,class:"text-red-600 font-semibold"},Pe=["onMouseleave"],ze=["onChange"],De=["onClick"],qe={key:0,class:"text-green-600 font-semibold"},Ie={key:1,class:"text-red-600 font-semibold"},Ke={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},Le={class:"w-96 rounded-lg bg-white p-6"},Oe={class:"mb-4 text-lg font-semibold"},Ze={class:"mb-4 max-h-60 overflow-y-auto"},He=["id","value"],Je=["for"],Qe={class:"flex justify-end gap-2"},We={key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},Xe={class:"w-96 rounded-lg bg-white p-6"},es={class:"mb-4 text-lg font-semibold"},ss={class:"mb-2 flex items-center border-b pb-2"},ts=["checked"],ls={class:"mb-4 max-h-60 overflow-y-auto"},os={class:"flex items-center"},as=["id","checked","onChange"],is=["for"],ns={key:0,class:"ml-6"},ds=["id","checked","onChange"],rs=["for"],us={class:"flex justify-end gap-2"},cs={key:2,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},fs={class:"w-96 rounded-lg bg-white p-6"},vs={class:"mb-4"},ms={class:"mb-4"},ps={class:"mb-4"},_s={class:"flex justify-end gap-2"},As=re({__name:"Index",setup(y){const r=xe(),h=g(!1),w=g(!1),b=g(null),R=g([]),v=g([]),x=g(null),N=g(""),$=g(""),p=ue({name:"",create_prod:"Y",all_employee:"N"}),Z=[{title:"Role",href:"/roles"}],m=Me(),{items:H}=ce(m),{updateRole:z}=m,P=$e(),J=Ce(),F=g(!1),D=g([]),G=g([]);fe(()=>{m.fetchRoles()});const Q=async()=>{var t,e;if(!b.value)return r.error("No role selected");try{await m.assignMenusToRole(b.value.id,v.value),r.success("Menus assigned successfully"),w.value=!1,m.loaded=!1,await m.fetchRoles(!0)}catch(a){r.error(((e=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:e.message)??"Failed to assign menus")}},W=async t=>{var e;b.value=t,await P.fetchActivity(),D.value=[...P.items],G.value=((e=t.activity_groups)==null?void 0:e.map(a=>String(a.activity_group_id||a.id)))||[],F.value=!0},X=async()=>{var t,e;if(!b.value)return r.error("No role selected");try{await P.assignToRole(b.value.id,G.value),r.success("Activity Groups assigned successfully"),F.value=!1,m.loaded=!1,await ye(),await m.fetchRoles(!0)}catch(a){r.error(((e=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:e.message)??"Failed to assign activity groups")}},ee=async t=>{b.value=t,R.value=await J.fetchAllMenus(t.id),v.value=[],R.value.forEach(e=>{var a;e.checked&&v.value.push(e.id),(a=e.children)==null||a.forEach(n=>{n.checked&&v.value.push(n.id)})}),w.value=!0},se=async()=>{var t,e,a,n;if(!p.name)return r.error("Name is required");p.create_prod||(p.create_prod="Y"),p.all_employee||(p.all_employee="N");try{await m.createRole(p.name,p.create_prod,p.all_employee),r.success("Role created successfully"),p.reset(),m.loaded=!1,await m.fetchRoles(!0),h.value=!1}catch(s){const l=(n=(a=(e=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:e.errors)==null?void 0:a.name)==null?void 0:n[0];r.error(l||"Failed to create role")}},te=async t=>{var e,a;if(confirm("Are you sure you want to delete this role?"))try{await m.deleteRole(t),r.success("Role deleted successfully"),m.loaded=!1,await m.fetchRoles()}catch(n){r.error(((a=(e=n==null?void 0:n.response)==null?void 0:e.data)==null?void 0:a.message)??"Failed to delete role")}},q=t=>{x.value=t.id,N.value=t.create_prod,$.value=t.all_employee},I=async(t,e,a)=>{var n,s;if(x.value===t)try{await z(t,a,e,$.value),r.success("Role updated successfully"),x.value=null,await m.fetchRoles(!0)}catch(l){r.error(((s=(n=l==null?void 0:l.response)==null?void 0:n.data)==null?void 0:s.message)??"Failed to update role")}},K=async(t,e,a,n)=>{var s,l;if(x.value===t)try{await z(t,a,n,e),r.success("Role updated successfully"),x.value=null,await m.fetchRoles(!0)}catch(A){r.error(((l=(s=A==null?void 0:A.response)==null?void 0:s.data)==null?void 0:l.message)??"Failed to update role")}},j=t=>v.value.includes(t),le=(t,e=8)=>t?t.length>e?t.slice(0,e)+"...":t:"",oe=t=>{var n;const e=t.id,a=((n=t.children)==null?void 0:n.map(s=>s.id))||[];if(j(e))v.value=v.value.filter(s=>s!==e&&!a.includes(s));else{v.value.push(e);for(const s of a)v.value.includes(s)||v.value.push(s)}},ae=(t,e)=>{var a;if(j(e)){v.value=v.value.filter(l=>l!==e);const n=R.value.find(l=>l.id===t);((a=n==null?void 0:n.children)==null?void 0:a.some(l=>v.value.includes(l.id)))||(v.value=v.value.filter(l=>l!==t))}else v.value.push(e),v.value.includes(t)||v.value.push(t)},ie=t=>{if(t.target.checked){const a=R.value.flatMap(n=>{var l;const s=((l=n.children)==null?void 0:l.map(A=>A.id))||[];return[n.id,...s]}).filter(n=>typeof n=="number");v.value=[...new Set(a)]}else v.value=[]},ne=ve(()=>{const t=R.value.flatMap(e=>{var n;const a=((n=e.children)==null?void 0:n.map(s=>s.id))||[];return[e.id,...a]}).filter(e=>typeof e=="number");return t.length>0&&t.every(e=>v.value.includes(e))});return(t,e)=>(c(),f(M,null,[d(i(me),{title:"Role Management"}),d(Re,{breadcrumbs:Z},{default:u(()=>{var a,n;return[o("div",Ne,[o("div",Se,[d(i(k),{onClick:e[0]||(e[0]=s=>h.value=!0),class:"h-10 rounded-md bg-indigo-600 py-2 text-white hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:u(()=>[d(i(O),{class:"h-4 w-4"}),e[10]||(e[10]=_(" Tambah Role "))]),_:1,__:[10]})]),o("div",Ve,[d(i(be),null,{default:u(()=>[d(i(ke),null,{default:u(()=>[d(i(L),{class:"bg-gray-100"},{default:u(()=>[d(i(T),null,{default:u(()=>e[11]||(e[11]=[_("Name")])),_:1,__:[11]}),d(i(T),null,{default:u(()=>e[12]||(e[12]=[_("Apparel (Menu)")])),_:1,__:[12]}),d(i(T),null,{default:u(()=>e[13]||(e[13]=[_("Buat Produksi")])),_:1,__:[13]}),d(i(T),null,{default:u(()=>e[14]||(e[14]=[_("Access Karyawan")])),_:1,__:[14]}),d(i(T),{class:"w-24"},{default:u(()=>e[15]||(e[15]=[_("Actions")])),_:1,__:[15]})]),_:1})]),_:1}),d(i(we),null,{default:u(()=>[(c(!0),f(M,null,V(i(H),s=>(c(),pe(i(L),{key:s.id},{default:u(()=>[d(i(U),null,{default:u(()=>[_(C(s.name),1)]),_:2},1024),d(i(U),null,{default:u(()=>[o("div",{class:"flex cursor-pointer flex-wrap gap-1 rounded-md p-2 transition hover:bg-gray-50",onClick:l=>W(s)},[s.activity_groups&&s.activity_groups.length>0?(c(!0),f(M,{key:0},V(s.activity_groups,l=>(c(),f("span",{key:l.activity_group_id,class:"rounded-full border border-indigo-200 bg-indigo-50 px-2 py-0.5 text-xs font-medium text-gray-700",title:l.activity_group_id},C(le(l.activity_group_id)),9,Te))),128)):(c(),f("span",Ue,"No activity groups"))],8,Ye)]),_:2},1024),d(i(U),null,{default:u(()=>[x.value===s.id?(c(),f("div",{key:0,onMouseleave:l=>I(s.id,N.value,s.name),class:"flex items-center gap-2"},[Y(o("select",{"onUpdate:modelValue":e[1]||(e[1]=l=>N.value=l),onChange:l=>I(s.id,N.value,s.name),class:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm"},e[16]||(e[16]=[o("option",{value:"Y"},"Yes",-1),o("option",{value:"N"},"No",-1)]),40,Ge),[[E,N.value]])],40,Fe)):(c(),f("div",{key:1,onClick:l=>q(s),class:"cursor-pointer"},[s.create_prod=="Y"?(c(),f("span",Be,"Yes")):(c(),f("span",Ee,"No"))],8,je))]),_:2},1024),d(i(U),null,{default:u(()=>[x.value===s.id?(c(),f("div",{key:0,onMouseleave:l=>K(s.id,$.value,s.name,s.create_prod),class:"flex items-center gap-2"},[Y(o("select",{"onUpdate:modelValue":e[2]||(e[2]=l=>$.value=l),onChange:l=>K(s.id,$.value,s.name,s.create_prod),class:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm"},e[17]||(e[17]=[o("option",{value:"Y"},"Yes",-1),o("option",{value:"N"},"No",-1)]),40,ze),[[E,$.value]])],40,Pe)):(c(),f("div",{key:1,onClick:l=>q(s),class:"cursor-pointer"},[s.all_employee=="Y"?(c(),f("span",qe,"Yes")):(c(),f("span",Ie,"No"))],8,De))]),_:2},1024),d(i(U),{class:"flex gap-2"},{default:u(()=>[d(i(k),{variant:"ghost",size:"icon",onClick:l=>ee(s)},{default:u(()=>[d(i(O),{class:"h-4 w-4"})]),_:2},1032,["onClick"]),d(i(k),{variant:"ghost",size:"icon",onClick:l=>te(s.id)},{default:u(()=>[d(i(Ae),{class:"h-4 w-4"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),F.value?(c(),f("div",Ke,[o("div",Le,[o("h2",Oe,"Assign Activity Group untuk "+C((a=b.value)==null?void 0:a.name),1),o("div",Ze,[(c(!0),f(M,null,V(D.value,s=>(c(),f("div",{key:s.id,class:"mb-2 flex items-center"},[Y(o("input",{type:"checkbox",id:s.id,value:s.id,"onUpdate:modelValue":e[3]||(e[3]=l=>G.value=l),class:"mr-2"},null,8,He),[[_e,G.value]]),o("label",{for:s.id},C(s.name),9,Je)]))),128))]),o("div",Qe,[d(i(k),{variant:"outline",onClick:e[4]||(e[4]=s=>F.value=!1)},{default:u(()=>e[18]||(e[18]=[_(" Cancel ")])),_:1,__:[18]}),d(i(k),{onClick:X},{default:u(()=>e[19]||(e[19]=[_("Save")])),_:1,__:[19]})])])])):B("",!0),w.value?(c(),f("div",We,[o("div",Xe,[o("h2",es,"Assign Menu to "+C((n=b.value)==null?void 0:n.name),1),o("div",ss,[o("input",{type:"checkbox",id:"check-all",checked:ne.value,onChange:ie,class:"mr-2"},null,40,ts),e[20]||(e[20]=o("label",{for:"check-all",class:"font-medium"},"Check / Uncheck All",-1))]),o("div",ls,[(c(!0),f(M,null,V(R.value,s=>(c(),f("div",{key:s.id,class:"mb-2"},[o("div",os,[o("input",{type:"checkbox",id:`menu-${s.id}`,checked:j(s.id),onChange:l=>oe(s),class:"mr-2"},null,40,as),o("label",{for:`menu-${s.id}`},C(s.title),9,is)]),s.children&&s.children.length?(c(),f("div",ns,[(c(!0),f(M,null,V(s.children,l=>(c(),f("div",{key:l.id,class:"mb-1 flex items-center"},[o("input",{type:"checkbox",id:`menu-${l.id}`,checked:j(l.id),onChange:A=>ae(s.id,l.id),class:"mr-2"},null,40,ds),o("label",{for:`menu-${l.id}`},C(l.title),9,rs)]))),128))])):B("",!0)]))),128))]),o("div",us,[d(i(k),{type:"button",variant:"outline",onClick:e[5]||(e[5]=s=>w.value=!1),class:"h-10"},{default:u(()=>e[21]||(e[21]=[_("Cancel")])),_:1,__:[21]}),d(i(k),{type:"submit",onClick:Q},{default:u(()=>e[22]||(e[22]=[_("Assign")])),_:1,__:[22]})])])])):B("",!0),h.value?(c(),f("div",cs,[o("div",fs,[e[29]||(e[29]=o("h2",{class:"mb-4 text-lg font-semibold"},"Tambah Role Baru",-1)),o("form",{onSubmit:ge(se,["prevent"])},[o("div",vs,[d(i(he),{modelValue:i(p).name,"onUpdate:modelValue":e[6]||(e[6]=s=>i(p).name=s),placeholder:"Role Name",required:""},null,8,["modelValue"])]),o("div",ms,[e[24]||(e[24]=o("label",{class:"block mb-1 font-medium"},"Buat Produksi",-1)),Y(o("select",{"onUpdate:modelValue":e[7]||(e[7]=s=>i(p).create_prod=s),class:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},e[23]||(e[23]=[o("option",{value:"Y"},"Yes",-1),o("option",{value:"N"},"No",-1)]),512),[[E,i(p).create_prod]])]),o("div",ps,[e[26]||(e[26]=o("label",{class:"block mb-1 font-medium"},"Access Karyawan",-1)),Y(o("select",{"onUpdate:modelValue":e[8]||(e[8]=s=>i(p).all_employee=s),class:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},e[25]||(e[25]=[o("option",{value:"Y"},"Yes",-1),o("option",{value:"N"},"No",-1)]),512),[[E,i(p).all_employee]])]),o("div",_s,[d(i(k),{type:"button",variant:"outline",onClick:e[9]||(e[9]=s=>h.value=!1),class:"h-10"},{default:u(()=>e[27]||(e[27]=[_("Cancel")])),_:1,__:[27]}),d(i(k),{type:"submit",class:"h-10 rounded-md bg-indigo-600 py-2 text-white hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:u(()=>e[28]||(e[28]=[_("Create")])),_:1,__:[28]})])],32)])])):B("",!0)])]}),_:1})],64))}});export{As as default};
