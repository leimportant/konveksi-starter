import{d as L,r as p,T as H,o as K,f as r,g as i,p as l,u as a,Z as Q,x as V,k as o,F as C,B as Z,z as b,j as _,R as G,C as m,D as E,N as T,y as z}from"./app-B2NgnLsj.js";import{_ as J}from"./AppLayout.vue_vue_type_script_setup_true_lang-CRmQOpAR.js";import{_ as M}from"./Input.vue_vue_type_script_setup_true_lang-DhZQbsO4.js";import{_ as N}from"./DateInput.vue_vue_type_script_setup_true_lang-CgS3nSb4.js";import{_ as O}from"./DocumentList.vue_vue_type_script_setup_true_lang-DvLySlZy.js";import{d as R,_ as W,a as X,b as Y,c as ee}from"./index-C1RFzmMd.js";import{u as te}from"./useModelStore-CICFApwW.js";import{u as ae}from"./useToast-C6x4wygu.js";import"./index-2uNuP1oD.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-B3OTglti.js";import"./trash-DNQP0gfH.js";import"./useSizeStore-CAGlx4B5.js";import"./useProductStore-DPTu8-Nd.js";import"./useMasterActivityRoleStore-ConKNjtS.js";import"./useUomStore-CpYUs16h.js";import"./vue3-select-Cv9cLezv.js";const se={class:"rounded-xl bg-white p-6 shadow-sm dark:bg-gray-800"},oe={class:"my-6 flex space-x-4 border-b dark:border-gray-700"},de=["onClick"],le={key:0,class:"space-y-6"},re={key:0,class:"text-destructive"},ie={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ne={key:0,class:"text-destructive"},me={key:0,class:"text-destructive"},ue={key:0,class:"text-destructive"},pe={key:0,class:"text-destructive"},ce={key:1},ve={key:2},_e={key:3,class:"space-y-6"},fe={key:4},ye={key:5},ke={class:"flex justify-end gap-2"},be="Model",De=L({__name:"UpdateModel",props:{modelId:{}},setup(S){const g=S,B=p(Number(g.modelId)).value??"",$=["model","size","activity","gambar","bahan dan biaya","hpp"],u=p($[0]),d=p({}),j=[{title:"Konveksi",href:"/konveksi"},{title:"Edit Model",href:`/konveksi/model/${g.modelId}/edit`}],w=te(),c=ae(),D=n=>n.map(t=>({...t,product_id:typeof t.product_id=="object"?t.product_id.id:t.product_id})),s=H({description:"",remark:"",start_date:null,end_date:null,estimation_price_pcs:0,estimation_qty:1}),U=p([]),f=p([]),I=p(0),v=p([]),y=p([]),q=async()=>{var n,t,e,x,h;try{await w.updateModel(g.modelId,{...s,sizes:f.value,activity:v.value,documents:U.value,modelMaterials:D(y.value)}),c.success("Model berhasil diperbarui"),T.visit("/konveksi/model/list")}catch(k){if(((n=k.response)==null?void 0:n.status)===422&&((e=(t=k.response)==null?void 0:t.data)!=null&&e.errors)){d.value=k.response.data.errors;for(const F in d.value)d.value[F].forEach(P=>{c.error(P)})}else(h=(x=k.response)==null?void 0:x.data)!=null&&h.message?c.error(k.response.data.message):c.error("Terjadi kesalahan saat menyimpan model")}};K(async()=>{var n,t;try{const e=await w.fetchModelById(g.modelId);console.log("Model Data:",e),e&&(s.description=e.data.description,s.remark=e.data.remark,s.start_date=e.data.start_date?e.data.start_date.split("T")[0]:"",s.end_date=e.data.end_date?e.data.end_date.split("T")[0]:"",s.estimation_price_pcs=e.data.estimation_price_pcs,s.estimation_qty=e.data.estimation_qty,f.value=e.data.sizes||[],v.value=e.data.activities||[],U.value=e.data.documents||[],y.value=e.data.model_material||[])}catch(e){(t=(n=e.response)==null?void 0:n.data)!=null&&t.errors?(d.value=e.response.data.errors,c.error("Validasi gagal, silakan periksa form")):c.error("Terjadi kesalahan saat membuat model")}window.addEventListener("popstate",()=>{R.Inertia.visit(window.location.href,{preserveState:!0})})});const A=n=>{const t=v.value.find(e=>e.activity_role_id===n);return(t==null?void 0:t.activity_name)||`Activity ${n}`};return(n,t)=>(i(),r(C,null,[l(a(Q),{title:"Edit Model"}),l(J,{breadcrumbs:j},{default:V(()=>[o("div",se,[t[17]||(t[17]=o("div",{class:"border-b pb-4"},[o("h1",{class:"text-2xl font-semibold text-gray-900 dark:text-white"},"Edit Model"),o("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Edit data model, ukuran, dan aktivitas")],-1)),o("div",oe,[(i(),r(C,null,Z($,e=>o("button",{key:e,class:b(["pb-2 text-sm font-medium",{"border-b-2 border-primary text-primary":u.value===e,"text-gray-500 hover:text-gray-700":u.value!==e}]),onClick:x=>u.value=e},_(e.charAt(0).toUpperCase()+e.slice(1)),11,de)),64))]),o("form",{onSubmit:G(q,["prevent"]),class:"space-y-6"},[u.value==="model"?(i(),r("div",le,[o("div",null,[t[10]||(t[10]=o("label",{for:"description",class:"text-sm font-medium"},"Nama Model",-1)),l(a(M),{id:"description",modelValue:a(s).description,"onUpdate:modelValue":t[0]||(t[0]=e=>a(s).description=e),placeholder:""},null,8,["modelValue"]),d.value.description?(i(),r("small",re,_(d.value.description[0]),1)):m("",!0)]),o("div",ie,[o("div",null,[t[11]||(t[11]=o("label",{for:"start_date",class:"text-sm font-medium"},"Tanggal Mulai",-1)),l(a(N),{modelValue:a(s).start_date,"onUpdate:modelValue":t[1]||(t[1]=e=>a(s).start_date=e),id:"start_date",class:b({"border-destructive":d.value.start_date})},null,8,["modelValue","class"]),d.value.start_date?(i(),r("small",ne,_(d.value.start_date[0]),1)):m("",!0)]),o("div",null,[t[12]||(t[12]=o("label",{for:"end_date",class:"text-sm font-medium"},"Estimasi Selesai",-1)),l(a(N),{modelValue:a(s).end_date,"onUpdate:modelValue":t[2]||(t[2]=e=>a(s).end_date=e),id:"end_date",class:b({"border-destructive":d.value.end_date})},null,8,["modelValue","class"]),d.value.end_date?(i(),r("small",me,_(d.value.end_date[0]),1)):m("",!0)]),o("div",null,[t[13]||(t[13]=o("label",{for:"estimation_price_pcs",class:"text-sm font-medium"},"Estimasi Harga",-1)),l(a(M),{type:"number",modelValue:a(s).estimation_price_pcs,"onUpdate:modelValue":t[3]||(t[3]=e=>a(s).estimation_price_pcs=e),id:"estimation_price_pcs",class:b({"border-destructive":d.value.estimation_price_pcs})},null,8,["modelValue","class"]),d.value.estimation_price_pcs?(i(),r("small",ue,_(d.value.estimation_price_pcs[0]),1)):m("",!0)])]),o("div",null,[t[14]||(t[14]=o("label",{for:"remark",class:"text-sm font-medium"},"Catatan",-1)),l(a(M),{modelValue:a(s).remark,"onUpdate:modelValue":t[4]||(t[4]=e=>a(s).remark=e),id:"remark",placeholder:"",class:b({"border-destructive":d.value.remark})},null,8,["modelValue","class"]),d.value.remark?(i(),r("small",pe,_(d.value.remark[0]),1)):m("",!0)])])):m("",!0),u.value==="size"?(i(),r("div",ce,[l(W,{modelValue:f.value,"onUpdate:modelValue":t[5]||(t[5]=e=>f.value=e),"onUpdate:totalQuantity":t[6]||(t[6]=e=>I.value=e)},null,8,["modelValue"])])):m("",!0),u.value==="activity"?(i(),r("div",ve,[l(X,{modelValue:v.value,"onUpdate:modelValue":t[7]||(t[7]=e=>v.value=e)},null,8,["modelValue"])])):m("",!0),u.value==="gambar"?(i(),r("div",_e,[l(O,{"reference-id":a(B),"reference-type":be},null,8,["reference-id"])])):m("",!0),u.value==="bahan dan biaya"?(i(),r("div",fe,[l(Y,{modelValue:y.value,"onUpdate:modelValue":t[8]||(t[8]=e=>y.value=e)},null,8,["modelValue"])])):m("",!0),u.value==="hpp"?(i(),r("div",ye,[l(ee,{"model-materials":y.value,"activity-items":v.value.map(e=>({...e,activity_name:A(e.activity_role_id)})),"start-date":a(s).start_date,"end-date":a(s).end_date,"total-production":I.value,"size-items":f.value.map(e=>({...e}))},null,8,["model-materials","activity-items","start-date","end-date","total-production","size-items"])])):m("",!0),o("div",ke,[l(a(E),{type:"button",variant:"outline",onClick:t[9]||(t[9]=e=>a(T).visit("/konveksi/model/list"))},{default:V(()=>t[15]||(t[15]=[z(" Batal ")])),_:1,__:[15]}),l(a(E),{type:"submit",class:"bg-indigo-600 text-white py-2 h-10 rounded-md hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:V(()=>t[16]||(t[16]=[z("Simpan Perubahan")])),_:1,__:[16]})])],32)])]),_:1})],64))}});export{De as default};
