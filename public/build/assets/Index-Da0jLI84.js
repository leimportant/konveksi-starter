import{d as se,q as oe,Q as re,r as g,c as D,o as ae,f as i,g as l,p as c,u as a,Z as ne,x as m,k as t,l as B,m as M,E as F,C as P,D as x,y as S,G as le,F as f,B as $,j as d,z as ie,V as Q}from"./app-BSDUiwR6.js";import{_ as de}from"./Input.vue_vue_type_script_setup_true_lang-lWUANtoz.js";import{u as ce}from"./useToast-Bsqp-1GY.js";import{_ as ue}from"./AppLayout.vue_vue_type_script_setup_true_lang-Di2aN84C.js";import{u as pe}from"./useProductionStore-DF6HDbo6.js";import{P as ge}from"./plus-BU_uU8x3.js";import{S as ye}from"./square-pen-ByjeUhGO.js";import{T as me}from"./trash-2-CDyt52wz.js";import{V as fe}from"./view-ChzIR26y.js";import"./index-DpJAop6U.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-nr-cC9hQ.js";const xe={class:"px-3 py-4"},ve={class:"flex flex-col gap-3"},_e={class:"flex min-w-0 flex-1 flex-col"},be={class:"flex gap-3"},he={class:"flex min-w-0 flex-1 flex-col"},we={class:"flex min-w-0 flex-1 flex-col"},ke={class:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between"},Ce={class:"flex flex-1 items-center gap-2"},De={key:0,class:"py-4 text-center text-sm text-gray-500"},Pe={key:1,class:"space-y-2"},Se={class:"mt-2 overflow-x-auto rounded-md border border-gray-200 dark:border-gray-700"},$e={class:"min-w-full table-auto text-left text-sm text-gray-800 dark:text-gray-100"},Te={class:"bg-gray-200 font-semibold dark:bg-gray-700"},Ve={colspan:"8",class:"px-3 py-2"},Ie={class:"whitespace-nowrap px-3 py-2 align-top"},Ne={class:"whitespace-nowrap px-3 py-2 align-top"},Ue={key:0,class:"flex flex-col gap-1 rounded-lg border border-gray-200 bg-gray-50 p-1 text-[11px] text-gray-700"},Fe={class:"font-semibold"},Oe={key:0,class:"order-t mt-0.5 flex items-center justify-between rounded-md border-gray-300 bg-white px-1.5 py-0.5 pt-0.5 text-[11px] font-semibold text-gray-800 shadow-sm"},Re={key:1,class:"text-xs italic text-gray-400"},je={class:"truncate px-3 py-2 align-top"},Ee={class:"max-w-[80px] truncate px-3 py-2 align-top"},qe={class:"px-3 py-2 align-top"},ze={class:"flex justify-end gap-1 sm:gap-2"},Be={class:"bg-gray-50 font-semibold dark:bg-gray-800"},Me={class:"px-3 py-2 text-right"},Qe={class:"px-3 py-2"},Ye={class:"mt-4 flex justify-end space-x-2"},Ae=["disabled"],Le=["onClick","disabled"],Ke=["disabled"],lt=se({__name:"Index",props:{activity_role:{},isCreate:{}},setup(Y){const T=ce(),v=pe(),{productions:V,currentPage:p,lastPage:A,loading:_}=oe(v),L=re().props.auth.user.employee_status.toUpperCase()=="OWNER"?"Y":"N",b=g(""),h=g(""),O=g(50),R=g("created_at"),j=g("desc"),y=Y,K=[{title:"Production",href:`/production/${y.activity_role}`}],I=D(()=>A.value||1),N=async o=>{var e,s;o<1||o>I.value||(await v.fetchProductions({page:o,per_page:O.value,sort_field:R.value,sort_order:j.value,activity_role_id:y.activity_role,search:w.value,date_from:(e=E.value.from)==null?void 0:e.toISOString(),date_to:(s=E.value.to)==null?void 0:s.toISOString()}),p.value=o)},G=()=>N(p.value+1),W=()=>N(p.value-1),w=g(""),E=g({from:null,to:null});function q(o){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(o)}const k=async(o=1)=>{var e,s;try{await v.fetchProductions({page:o||p.value,per_page:O.value,sort_field:R.value,sort_order:j.value,activity_role_id:y.activity_role,search:w.value,date_from:b.value,date_to:h.value})}catch(n){T.error(((s=(e=n==null?void 0:n.response)==null?void 0:e.data)==null?void 0:s.message)??"Failed to fetch productions")}},Z=D(()=>{const o={};return V.value.forEach(e=>{var n,r;const s=`${e.employee_name||"Unknown"} - ${((n=e.model)==null?void 0:n.description)||"No Model"}`;o[s]||(o[s]={employee_name:e.employee_name,model_description:(r=e.model)==null?void 0:r.description,items:[]}),o[s].items.push(e)}),o}),H=D(()=>V.value.reduce((o,e)=>{var n;const s=((n=e.items)==null?void 0:n.reduce((r,C)=>r+(parseFloat(String(C.qty))||0),0))||0;return o+s},0)),J=()=>{const o=window.location.pathname;Q.visit(`/production/${y.activity_role}/create?returnUrl=${encodeURIComponent(o)}`)},X=o=>{const e=window.location.pathname;Q.visit(`/production/${o.activity_role_id}/edit/${o.id}?returnUrl=${encodeURIComponent(e)}`)},ee=D(()=>V.value.reduce((o,e)=>{const s=String(e.total_price).replace(/[^\d]/g,""),n=parseFloat(s)||0;return o+n},0));ae(()=>{const o=new Date,e=new Date;e.setDate(o.getDate()-6),b.value=e.toISOString().split("T")[0],h.value=o.toISOString().split("T")[0],k()});const te=async o=>{var e,s;if(confirm("Are you sure you want to delete this production?"))try{await v.deleteProduction(o),T.success("Production deleted successfully"),await k(1)}catch(n){T.error(((s=(e=n==null?void 0:n.response)==null?void 0:e.data)==null?void 0:s.message)??"Failed to delete production")}};return(o,e)=>(l(),i(f,null,[c(a(ne),{title:"Production Management"}),c(ue,{breadcrumbs:K},{default:m(()=>[t("div",xe,[t("div",ve,[t("div",_e,[e[8]||(e[8]=t("div",{class:"flex items-center gap-3"},null,-1)),t("div",be,[t("div",he,[e[6]||(e[6]=t("label",{class:"mb-1 text-xs font-medium text-gray-600"},"Start Date",-1)),B(t("input",{type:"date","onUpdate:modelValue":e[0]||(e[0]=s=>b.value=s),class:"w-full max-w-full rounded-md border border-gray-300 px-3 py-1.5 text-sm shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"},null,512),[[M,b.value]])]),t("div",we,[e[7]||(e[7]=t("label",{class:"mb-1 text-xs font-medium text-gray-600"},"End Date",-1)),B(t("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=s=>h.value=s),class:"w-full max-w-full rounded-md border border-gray-300 px-3 py-1.5 text-sm shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"},null,512),[[M,h.value]])])])]),t("div",ke,[t("div",Ce,[y.isCreate==="Y"?(l(),F(a(x),{key:0,onClick:e[2]||(e[2]=s=>J()),class:"flex h-10 flex-shrink-0 items-center gap-2 rounded-md bg-indigo-600 px-3 py-1.5 text-sm font-medium text-white hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:m(()=>[c(a(ge),{class:"h-4 w-4"}),e[9]||(e[9]=S(" Tambah Data "))]),_:1,__:[9]})):P("",!0),c(a(de),{modelValue:w.value,"onUpdate:modelValue":e[3]||(e[3]=s=>w.value=s),placeholder:"Search...",class:"h-10 min-w-0 flex-1 rounded-md border border-gray-300 px-3 py-1 text-sm shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",onKeyup:e[4]||(e[4]=le(s=>k(1),["enter"]))},null,8,["modelValue"]),c(a(x),{onClick:e[5]||(e[5]=s=>k(1)),class:"h-10 flex-shrink-0 rounded-md bg-green-600 px-3 py-1.5 text-sm font-medium text-white hover:bg-green-700 focus:ring-2 focus:ring-green-500"},{default:m(()=>e[10]||(e[10]=[S(" Cari ")])),_:1,__:[10]})])])]),a(_)?(l(),i("div",De,"Loading...")):(l(),i("div",Pe,[t("div",Se,[t("table",$e,[e[16]||(e[16]=t("thead",{class:"bg-gray-100 text-xs font-semibold uppercase text-gray-600 dark:bg-gray-800 dark:text-gray-300"},[t("tr",null,[t("th",{class:"px-3 py-2"},"Tanggal"),t("th",{class:"px-3 py-2"},"Size/Qty"),t("th",{class:"px-3 py-2"},"Price/PCS"),t("th",{class:"px-3 py-2"},"Total"),t("th",{class:"px-3 py-2 text-right"},"Actions")])],-1)),t("tbody",null,[(l(!0),i(f,null,$(Z.value,(s,n)=>(l(),i(f,{key:n},[t("tr",Te,[t("td",Ve," ðŸ‘¤ "+d(s.employee_name||"-")+" â€” ðŸ§µ "+d(s.model_description||"-"),1)]),(l(!0),i(f,null,$(s.items,r=>{var C,z;return l(),i("tr",{key:r.id,class:"border-b border-gray-100 hover:bg-gray-50 dark:border-gray-700 dark:hover:bg-gray-800"},[t("td",Ie,[S(d(r.created_at?new Date(r.created_at).toLocaleDateString("id-ID"):"-")+" ",1),e[11]||(e[11]=t("br",null,null,-1)),S(" "+d(((C=r.activity_role)==null?void 0:C.name)||"-"),1)]),t("td",Ne,[(z=r.items)!=null&&z.length?(l(),i("div",Ue,[(l(!0),i(f,null,$(r.items,(u,U)=>(l(),i("div",{key:U,class:"flex items-center justify-between rounded-md bg-white px-1.5 py-0.5 shadow-sm"},[t("span",null,d(u.size_id)+" - "+d(u.variant),1),t("span",Fe,d(u.qty),1)]))),128)),r.items.length>1?(l(),i("div",Oe,[e[12]||(e[12]=t("span",null,"Total",-1)),t("span",null,d(r.items.reduce((u,U)=>u+Number(U.qty||0),0)),1)])):P("",!0)])):(l(),i("span",Re,"-"))]),t("td",je,d(q((r==null?void 0:r.price_per_pcs)||0)),1),t("td",Ee,d((r==null?void 0:r.total_price)||0),1),t("td",qe,[t("div",ze,[y.isCreate==="Y"&&a(L)=="Y"&&(r.status===1||r.status===3)?(l(),F(a(x),{key:0,variant:"ghost",size:"icon",class:"hover:bg-gray-100 dark:hover:bg-gray-700",onClick:u=>X(r)},{default:m(()=>[c(a(ye),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):P("",!0),r.status===1||r.status===3?(l(),F(a(x),{key:1,variant:"ghost",size:"icon",class:"hover:bg-gray-100 dark:hover:bg-gray-700",onClick:u=>te(r.id)},{default:m(()=>[c(a(me),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):P("",!0),c(a(x),{variant:"ghost",size:"icon",class:"hover:bg-gray-100 dark:hover:bg-gray-700",onClick:u=>o.$inertia.visit(`/production/${r.activity_role_id}/view/${r.id}`)},{default:m(()=>[c(a(fe),{class:"h-4 w-4"})]),_:2},1032,["onClick"])])])])}),128))],64))),128))]),t("tfoot",null,[t("tr",Be,[e[13]||(e[13]=t("td",{class:"px-3 py-2 text-right"},null,-1)),t("td",Me,"Total Â :Â  "+d(H.value),1),e[14]||(e[14]=t("td",{class:"px-3 py-2"},null,-1)),t("td",Qe,d(q(ee.value)),1),e[15]||(e[15]=t("td",null,null,-1))])])])]),t("div",Ye,[t("button",{onClick:W,disabled:a(p)===1||a(_),class:"rounded border border-gray-300 px-3 py-1 text-gray-700 hover:bg-gray-100 disabled:cursor-not-allowed disabled:opacity-50"}," Previous ",8,Ae),(l(!0),i(f,null,$(I.value,s=>(l(),i("button",{key:s,onClick:n=>N(s),class:ie(["rounded border px-3 py-1 text-sm",s===a(p)?"border-blue-600 bg-blue-600 text-white":"border-gray-300 text-gray-700 hover:bg-gray-100"]),disabled:a(_)},d(s),11,Le))),128)),t("button",{onClick:G,disabled:a(p)===I.value||a(_),class:"rounded border border-gray-300 px-3 py-1 text-gray-700 hover:bg-gray-100 disabled:cursor-not-allowed disabled:opacity-50"}," Next ",8,Ke)])]))])]),_:1})],64))}});export{lt as default};
