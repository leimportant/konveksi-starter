import{d as X,T as Y,aR as g,r as tt,o as et,b as U,w as st,f as n,g as l,p as d,u as s,Z as ot,x as r,k as o,C as R,l as z,y as u,F as v,B as b,j as m,O as N,D as V,E as at,m as it,P as A}from"./app-Bnll__8U.js";import{_ as dt}from"./AppLayout.vue_vue_type_script_setup_true_lang-B3eEpm2e.js";import{_ as q}from"./Input.vue_vue_type_script_setup_true_lang-DsQ_5daF.js";import{_ as B}from"./Label.vue_vue_type_script_setup_true_lang-D3DAE8nx.js";import{_ as rt,a as lt,b as F,c as k,d as nt,e as h}from"./TableRow.vue_vue_type_script_setup_true_lang-BYu6ELCM.js";import{u as ut}from"./useToast-Dd8A8Ub6.js";import{u as _t}from"./useTransferStockStore-yUoBUu4p.js";import{u as ct}from"./useInventoryStore-ChYOKZ0G.js";import{d as pt}from"./debounce-BcZQbp_F.js";import{T as ft}from"./trash-DcbqTmWa.js";import"./index-BTzGte9E.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CRNSQ64l.js";const mt={class:"p-6 space-y-6"},yt={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},xt=["value"],vt=["value"],gt=["value"],bt={class:"border rounded-lg p-4 shadow-sm bg-white"},kt={class:"flex justify-between items-center mb-4 flex-wrap gap-2"},ht={class:"overflow-x-auto"},wt=["value"],zt={class:"flex justify-end gap-2"},Vt={key:0,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"},$t={class:"bg-white rounded-lg shadow-lg w-11/12 max-w-4xl p-6"},Ct={class:"flex justify-between items-center mb-4"},St={key:0,class:"text-center py-10"},Tt={key:1,class:"space-y-4"},Pt={class:"flex flex-col sm:flex-row items-start sm:items-center gap-2"},Ut=["disabled"],Nt={class:"overflow-x-auto rounded-md border border-gray-200 shadow-sm"},qt={class:"min-w-full text-sm text-left whitespace-nowrap"},Bt={class:"px-3 py-2 font-medium text-gray-800"},jt={class:"px-3 py-2"},It={class:"px-3 py-2"},Mt={class:"px-3 py-2 text-right"},Dt={class:"px-3 py-2 text-center"},Rt=["onClick"],At={key:0},te=X({__name:"Update",props:{id:{}},setup(L){const O=[{title:"Transfer Stock",href:"/transfer-stock"}],c=ut(),$=_t(),y=ct(),i=Y({location_id:void 0,location_destination_id:void 0,sloc_id:void 0,transfer_detail:[]}),x=g({}),C=g([]),j=g([]),I=g([]),w=tt(!1),S=g({productName:""}),T=L;et(async()=>{try{await $.fetchTransferByID(T.id),K();const[a,e,t]=await Promise.all([U.get("/api/locations"),U.get("/api/slocs"),U.get("/api/products")]);C.push(...a.data.data),j.push(...e.data.data),I.push(...t.data.data)}catch(a){console.error(a),c.error("Gagal memuat data")}}),st(()=>S.productName,pt(a=>{y.setFilter("productName",a),y.fetchInventory()},500));const E=async()=>{if(!i.location_id||!i.sloc_id){c.error("Pilih lokasi dan sloc terlebih dahulu");return}try{await y.fetchInventory(),w.value=!0}catch(a){console.error(a),c.error("Gagal memuat inventory")}},G=a=>{if(i.transfer_detail.find(t=>t.product_id===a.product_id&&t.size_id===a.size_id&&t.uom_id===a.uom_id)){c.error("Produk ini sudah ada di daftar detail");return}i.transfer_detail.push({product_id:a.product_id,product_name:a.product_name,size_id:a.size_id,size_name:a.size_id,uom_id:a.uom_id,uom_name:a.uom_id,qty:a.qty_available??1}),w.value=!1},Q=(a,e)=>{const t=I.find(f=>f.id===a);return t?t.name:e},M=a=>{delete x[a]},Z=()=>{A.visit("/transfer-stock")},H=a=>{i.transfer_detail.splice(a,1)},J=async()=>{var a,e,t,f,p;try{if(!i.location_id||!i.location_destination_id||!i.sloc_id){c.error("Semua lokasi dan sloc wajib diisi");return}await $.updateTransfer(String(T.id),{id:T.id,location_id:i.location_id,location_destination_id:i.location_destination_id,sloc_id:i.sloc_id,transfer_detail:i.transfer_detail.map(_=>({product_id:_.product_id,size_id:_.size_id,uom_id:_.uom_id,qty:_.qty}))}),c.success("Transfer berhasil disimpan"),A.visit("/transfer-stock")}catch(_){if(((a=_.response)==null?void 0:a.status)===422&&((t=(e=_.response)==null?void 0:e.data)!=null&&t.errors)){x.value=_.response.data.errors;for(const P in x)(Array.isArray(x[P])?x[P]:[x[P]]).forEach(W=>{c.error(W)})}else(p=(f=_.response)==null?void 0:f.data)!=null&&p.message?c.error(_.response.data.message):c.error("Terjadi kesalahan saat menyimpan data")}},K=()=>{const a=$.transfer;if(a){i.location_id=a.location_id??void 0,i.location_destination_id=a.location_destination_id??void 0,i.sloc_id=a.sloc_id??void 0;const e=a.transfer_detail?a.transfer_detail.map(t=>({product_id:t.product_id??0,product_name:t.product_name??"",size_id:t.size_id??"",size_name:t.size_id??"",uom_id:t.uom_id??"",uom_name:t.uom_id??"",qty:t.qty})):[];i.transfer_detail.splice(0,i.transfer_detail.length,...e)}},D=()=>{M("location_id"),M("sloc_id"),i.transfer_detail.splice(0,i.transfer_detail.length)};return(a,e)=>(l(),n(v,null,[d(s(ot),{title:"Transfer Stock Management"}),d(dt,{breadcrumbs:O},{default:r(()=>[o("div",mt,[o("div",yt,[o("div",null,[d(s(B),{for:"location_id"},{default:r(()=>e[5]||(e[5]=[u("Lokasi Asal")])),_:1,__:[5]}),z(o("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>s(i).location_id=t),id:"location_id",class:"w-full border rounded p-2",onChange:D},[e[6]||(e[6]=o("option",{disabled:"",value:""},"Pilih lokasi",-1)),(l(!0),n(v,null,b(C,t=>(l(),n("option",{key:t.id,value:t.id},m(t.name),9,xt))),128))],544),[[N,s(i).location_id]])]),o("div",null,[d(s(B),{for:"location_destination_id"},{default:r(()=>e[7]||(e[7]=[u("Lokasi Tujuan")])),_:1,__:[7]}),z(o("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>s(i).location_destination_id=t),id:"location_destination_id",class:"w-full border rounded p-2"},[e[8]||(e[8]=o("option",{disabled:"",value:""},"Pilih lokasi",-1)),(l(!0),n(v,null,b(C,t=>(l(),n("option",{key:t.id,value:t.id},m(t.name),9,vt))),128))],512),[[N,s(i).location_destination_id]])]),o("div",null,[d(s(B),{for:"sloc_id"},{default:r(()=>e[9]||(e[9]=[u("Sloc")])),_:1,__:[9]}),z(o("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>s(i).sloc_id=t),id:"sloc_id",class:"w-full border rounded p-2",onChange:D},[e[10]||(e[10]=o("option",{disabled:"",value:""},"Pilih sloc",-1)),(l(!0),n(v,null,b(j,t=>(l(),n("option",{key:t.id,value:t.id},m(t.name),9,gt))),128))],544),[[N,s(i).sloc_id]])])]),o("div",bt,[o("div",kt,[e[12]||(e[12]=o("h2",{class:"text-lg font-semibold text-gray-800"},"Detail Barang",-1)),d(s(V),{variant:"outline",onClick:E,disabled:!s(i).location_id||!s(i).sloc_id,class:"text-sm"},{default:r(()=>e[11]||(e[11]=[u(" Tambah Baris ")])),_:1,__:[11]},8,["disabled"])]),o("div",ht,[d(s(rt),{class:"min-w-full text-sm"},{default:r(()=>[d(s(lt),null,{default:r(()=>[d(s(F),{class:"bg-gray-100"},{default:r(()=>[d(s(k),{class:"px-3 py-2"},{default:r(()=>e[13]||(e[13]=[u("Produk")])),_:1,__:[13]}),d(s(k),{class:"px-3 py-2"},{default:r(()=>e[14]||(e[14]=[u("Size")])),_:1,__:[14]}),d(s(k),{class:"px-3 py-2"},{default:r(()=>e[15]||(e[15]=[u("UOM")])),_:1,__:[15]}),d(s(k),{class:"px-3 py-2"},{default:r(()=>e[16]||(e[16]=[u("Qty")])),_:1,__:[16]}),d(s(k),{class:"px-3 py-2 text-center"},{default:r(()=>e[17]||(e[17]=[u("Action")])),_:1,__:[17]})]),_:1})]),_:1}),d(s(nt),null,{default:r(()=>[(l(!0),n(v,null,b(s(i).transfer_detail,(t,f)=>(l(),at(s(F),{key:f,class:"hover:bg-gray-50"},{default:r(()=>[d(s(h),{class:"px-3 py-2"},{default:r(()=>[o("input",{type:"text",value:Q(t.product_id,t.product_name),readonly:"",class:"w-full bg-gray-100 text-sm border rounded px-2 py-1"},null,8,wt)]),_:2},1024),d(s(h),{class:"px-3 py-2"},{default:r(()=>[d(s(q),{type:"text",modelValue:t.size_id,"onUpdate:modelValue":p=>t.size_id=p,readonly:"",class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),d(s(h),{class:"px-3 py-2"},{default:r(()=>[d(s(q),{type:"text",modelValue:t.uom_id,"onUpdate:modelValue":p=>t.uom_id=p,readonly:"",class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),d(s(h),{class:"px-3 py-2"},{default:r(()=>[d(s(q),{type:"number",min:"1",modelValue:t.qty,"onUpdate:modelValue":p=>t.qty=p,class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),d(s(h),{class:"px-3 py-2 text-center"},{default:r(()=>[d(s(V),{variant:"destructive",size:"sm",onClick:p=>H(f)},{default:r(()=>[d(s(ft),{class:"h-4 w-4"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])]),o("div",zt,[d(s(V),{onClick:J,class:"bg-indigo-600 text-white py-2 h-10 rounded-md hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:r(()=>e[18]||(e[18]=[u("Simpan")])),_:1,__:[18]}),d(s(V),{variant:"outline",onClick:Z},{default:r(()=>e[19]||(e[19]=[u("Batal")])),_:1,__:[19]})])]),w.value?(l(),n("div",Vt,[o("div",$t,[o("div",Ct,[e[20]||(e[20]=o("h3",{class:"text-lg font-semibold"},"Pilih Produk dari Inventory",-1)),o("button",{onClick:e[3]||(e[3]=t=>w.value=!1),class:"text-2xl font-bold text-gray-600 hover:text-gray-900"},"Ã—")]),s(y).loading?(l(),n("div",St,"Loading inventory...")):(l(),n("div",Tt,[o("div",Pt,[z(o("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>S.productName=t),placeholder:"Cari Produk",disabled:s(y).loading,class:"w-full sm:w-64 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 text-sm","aria-label":"Search"},null,8,Ut),[[it,S.productName]])]),o("div",Nt,[o("table",qt,[e[22]||(e[22]=o("thead",{class:"bg-gray-100 text-gray-700 uppercase text-xs"},[o("tr",null,[o("th",{class:"px-3 py-2"},"Produk"),o("th",{class:"px-3 py-2"},"Size"),o("th",{class:"px-3 py-2"},"UOM"),o("th",{class:"px-3 py-2 text-right"},"Qty"),o("th",{class:"px-3 py-2 text-center"},"Aksi")])],-1)),o("tbody",null,[(l(!0),n(v,null,b(s(y).inventoryRpt,t=>(l(),n("tr",{key:`${t.product_id}-${t.location_id}-${t.sloc_id}-${t.size_id}`,class:"hover:bg-gray-50 border-t"},[o("td",Bt,m(t.product_id)+" - "+m(t.product_name),1),o("td",jt,m(t.size_id),1),o("td",It,m(t.uom_id),1),o("td",Mt,m(t.qty),1),o("td",Dt,[o("button",{onClick:f=>G(t),class:"text-blue-600 hover:text-blue-800 hover:underline transition"}," Pilih ",8,Rt)])]))),128)),s(y).inventoryRpt.length===0?(l(),n("tr",At,e[21]||(e[21]=[o("td",{colspan:"5",class:"px-3 py-4 text-center text-gray-500"},"Tidak ada inventory ditemukan.",-1)]))):R("",!0)])])])]))])])):R("",!0)]),_:1})],64))}});export{te as default};
