import{R as ie,b as M,d as ne,r as y,T as de,q as re,o as ue,c as ce,f as v,g as f,p as d,u as i,Z as fe,x as u,k as o,C as G,D as b,y as p,F as R,B as A,E as ve,j as w,l as Y,U as z,O as me,N as pe,n as _e}from"./app-Df831RX2.js";import{_ as ge}from"./Input.vue_vue_type_script_setup_true_lang-HzNmLQ4u.js";import{_ as he,a as ye,b as D,c as j,d as be,e as B}from"./TableRow.vue_vue_type_script_setup_true_lang-D4tqAwZh.js";import{u as ke}from"./useToast-DqJwyF9x.js";import{i as we,_ as xe}from"./AppLayout.vue_vue_type_script_setup_true_lang-Btj8Y7OQ.js";import{u as Ce}from"./useActivityGroupStore-BRKCVuEy.js";import{P as q}from"./plus-B0wusX5z.js";import{T as Re}from"./trash-2-6HSdnYNV.js";import"./index-PbyRZfWL.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-vqGVAmD0.js";const $e=ie("role",{state:()=>({items:[],loaded:!1}),actions:{async fetchRoles(_=!1){if(!(this.loaded&&!_))try{const r=await M.get("/api/roles");this.items=r.data.data,this.loaded=!0}catch(r){console.error("Failed to fetch Roles",r)}},async createRole(_,r){try{await M.post("/api/roles",{name:_,create_prod:r}),await this.fetchRoles()}catch(g){throw g}},async updateRole(_,r,g){try{await M.put(`/api/roles/${_}`,{name:r,create_prod:g}),await this.fetchRoles()}catch(x){throw x}},async deleteRole(_){try{await M.delete(`/api/roles/${_}`),await this.fetchRoles()}catch(r){throw r}},async assignMenusToRole(_,r){try{await M.post("/api/roles/assign-menus",{role_id:_,menus:r})}catch(g){throw g}}}}),Me={class:"px-4 py-4"},Ae={class:"mb-2 flex items-center justify-between gap-2"},Ne={class:"rounded-md border"},Se=["onClick"],Te=["title"],Ve={key:1,class:"text-sm italic text-gray-400"},Ge=["onMouseleave"],je=["onChange"],Be=["onClick"],Fe={key:0,class:"text-green-600 font-semibold"},Ye={key:1,class:"text-red-600 font-semibold"},Pe={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},Ue={class:"w-96 rounded-lg bg-white p-6"},Ee={class:"mb-4 text-lg font-semibold"},ze={class:"mb-4 max-h-60 overflow-y-auto"},De=["id","value"],qe=["for"],Ie={class:"flex justify-end gap-2"},Le={key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},Oe={class:"w-96 rounded-lg bg-white p-6"},Ze={class:"mb-4 text-lg font-semibold"},He={class:"mb-2 flex items-center border-b pb-2"},Je=["checked"],Ke={class:"mb-4 max-h-60 overflow-y-auto"},Qe={class:"flex items-center"},We=["id","checked","onChange"],Xe=["for"],et={key:0,class:"ml-6"},tt=["id","checked","onChange"],st=["for"],at={class:"flex justify-end gap-2"},ot={key:2,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},lt={class:"w-96 rounded-lg bg-white p-6"},it={class:"mb-4"},nt={class:"mb-4"},dt={class:"flex justify-end gap-2"},yt=ne({__name:"Index",setup(_){const r=ke(),g=y(!1),x=y(!1),k=y(null),C=y([]),c=y([]),N=y(null),$=y(""),h=de({name:"",create_prod:"Y"}),I=[{title:"Role",href:"/roles"}],m=$e(),{items:L}=re(m),{updateRole:O}=m,F=Ce(),Z=we(),S=y(!1),P=y([]),T=y([]);ue(()=>{m.fetchRoles()});const H=async()=>{var s,e;if(!k.value)return r.error("No role selected");try{await m.assignMenusToRole(k.value.id,c.value),r.success("Menus assigned successfully"),x.value=!1,m.loaded=!1,await m.fetchRoles(!0)}catch(l){r.error(((e=(s=l==null?void 0:l.response)==null?void 0:s.data)==null?void 0:e.message)??"Failed to assign menus")}},J=async s=>{var e;k.value=s,await F.fetchActivity(),P.value=[...F.items],T.value=((e=s.activity_groups)==null?void 0:e.map(l=>String(l.activity_group_id||l.id)))||[],S.value=!0},K=async()=>{var s,e;if(!k.value)return r.error("No role selected");try{await F.assignToRole(k.value.id,T.value),r.success("Activity Groups assigned successfully"),S.value=!1,m.loaded=!1,await _e(),await m.fetchRoles(!0)}catch(l){r.error(((e=(s=l==null?void 0:l.response)==null?void 0:s.data)==null?void 0:e.message)??"Failed to assign activity groups")}},Q=async s=>{k.value=s,C.value=await Z.fetchAllMenus(s.id),c.value=[],C.value.forEach(e=>{var l;e.checked&&c.value.push(e.id),(l=e.children)==null||l.forEach(n=>{n.checked&&c.value.push(n.id)})}),x.value=!0},W=async()=>{var s,e,l,n;if(!h.name)return r.error("Name is required");h.create_prod||(h.create_prod="Y");try{await m.createRole(h.name,h.create_prod),r.success("Role created successfully"),h.reset(),m.loaded=!1,await m.fetchRoles(!0),g.value=!1}catch(t){const a=(n=(l=(e=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:e.errors)==null?void 0:l.name)==null?void 0:n[0];r.error(a||"Failed to create role")}},X=async s=>{var e,l;if(confirm("Are you sure you want to delete this role?"))try{await m.deleteRole(s),r.success("Role deleted successfully"),m.loaded=!1,await m.fetchRoles()}catch(n){r.error(((l=(e=n==null?void 0:n.response)==null?void 0:e.data)==null?void 0:l.message)??"Failed to delete role")}},ee=s=>{N.value=s.id,$.value=s.create_prod},U=async(s,e,l)=>{var n,t;if(N.value===s)try{await O(s,l,e),r.success("Role updated successfully"),N.value=null,await m.fetchRoles(!0)}catch(a){r.error(((t=(n=a==null?void 0:a.response)==null?void 0:n.data)==null?void 0:t.message)??"Failed to update role")}},V=s=>c.value.includes(s),te=(s,e=8)=>s?s.length>e?s.slice(0,e)+"...":s:"",se=s=>{var n;const e=s.id,l=((n=s.children)==null?void 0:n.map(t=>t.id))||[];if(V(e))c.value=c.value.filter(t=>t!==e&&!l.includes(t));else{c.value.push(e);for(const t of l)c.value.includes(t)||c.value.push(t)}},ae=(s,e)=>{var l;if(V(e)){c.value=c.value.filter(a=>a!==e);const n=C.value.find(a=>a.id===s);((l=n==null?void 0:n.children)==null?void 0:l.some(a=>c.value.includes(a.id)))||(c.value=c.value.filter(a=>a!==s))}else c.value.push(e),c.value.includes(s)||c.value.push(s)},oe=s=>{if(s.target.checked){const l=C.value.flatMap(n=>{var a;const t=((a=n.children)==null?void 0:a.map(E=>E.id))||[];return[n.id,...t]}).filter(n=>typeof n=="number");c.value=[...new Set(l)]}else c.value=[]},le=ce(()=>{const s=C.value.flatMap(e=>{var n;const l=((n=e.children)==null?void 0:n.map(t=>t.id))||[];return[e.id,...l]}).filter(e=>typeof e=="number");return s.length>0&&s.every(e=>c.value.includes(e))});return(s,e)=>(f(),v(R,null,[d(i(fe),{title:"Role Management"}),d(xe,{breadcrumbs:I},{default:u(()=>{var l,n;return[o("div",Me,[o("div",Ae,[d(i(b),{onClick:e[0]||(e[0]=t=>g.value=!0),class:"h-10 rounded-md bg-indigo-600 py-2 text-white hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:u(()=>[d(i(q),{class:"h-4 w-4"}),e[8]||(e[8]=p(" Tambah Role "))]),_:1,__:[8]})]),o("div",Ne,[d(i(he),null,{default:u(()=>[d(i(ye),null,{default:u(()=>[d(i(D),{class:"bg-gray-100"},{default:u(()=>[d(i(j),null,{default:u(()=>e[9]||(e[9]=[p("Name")])),_:1,__:[9]}),d(i(j),null,{default:u(()=>e[10]||(e[10]=[p("Apparel (Menu)")])),_:1,__:[10]}),d(i(j),null,{default:u(()=>e[11]||(e[11]=[p("Buat Produksi")])),_:1,__:[11]}),d(i(j),{class:"w-24"},{default:u(()=>e[12]||(e[12]=[p("Actions")])),_:1,__:[12]})]),_:1})]),_:1}),d(i(be),null,{default:u(()=>[(f(!0),v(R,null,A(i(L),t=>(f(),ve(i(D),{key:t.id},{default:u(()=>[d(i(B),null,{default:u(()=>[p(w(t.name),1)]),_:2},1024),d(i(B),null,{default:u(()=>[o("div",{class:"flex cursor-pointer flex-wrap gap-1 rounded-md p-2 transition hover:bg-gray-50",onClick:a=>J(t)},[t.activity_groups&&t.activity_groups.length>0?(f(!0),v(R,{key:0},A(t.activity_groups,a=>(f(),v("span",{key:a.activity_group_id,class:"rounded-full border border-indigo-200 bg-indigo-50 px-2 py-0.5 text-xs font-medium text-gray-700",title:a.activity_group_id},w(te(a.activity_group_id)),9,Te))),128)):(f(),v("span",Ve,"No activity groups"))],8,Se)]),_:2},1024),d(i(B),null,{default:u(()=>[N.value===t.id?(f(),v("div",{key:0,onMouseleave:a=>U(t.id,$.value,t.name),class:"flex items-center gap-2"},[Y(o("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>$.value=a),onChange:a=>U(t.id,$.value,t.name),class:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm"},e[13]||(e[13]=[o("option",{value:"Y"},"Yes",-1),o("option",{value:"N"},"No",-1)]),40,je),[[z,$.value]])],40,Ge)):(f(),v("div",{key:1,onClick:a=>ee(t),class:"cursor-pointer"},[t.create_prod=="Y"?(f(),v("span",Fe,"Yes")):(f(),v("span",Ye,"No"))],8,Be))]),_:2},1024),d(i(B),{class:"flex gap-2"},{default:u(()=>[d(i(b),{variant:"ghost",size:"icon",onClick:a=>Q(t)},{default:u(()=>[d(i(q),{class:"h-4 w-4"})]),_:2},1032,["onClick"]),d(i(b),{variant:"ghost",size:"icon",onClick:a=>X(t.id)},{default:u(()=>[d(i(Re),{class:"h-4 w-4"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),S.value?(f(),v("div",Pe,[o("div",Ue,[o("h2",Ee,"Assign Activity Group untuk "+w((l=k.value)==null?void 0:l.name),1),o("div",ze,[(f(!0),v(R,null,A(P.value,t=>(f(),v("div",{key:t.id,class:"mb-2 flex items-center"},[Y(o("input",{type:"checkbox",id:t.id,value:t.id,"onUpdate:modelValue":e[2]||(e[2]=a=>T.value=a),class:"mr-2"},null,8,De),[[me,T.value]]),o("label",{for:t.id},w(t.name),9,qe)]))),128))]),o("div",Ie,[d(i(b),{variant:"outline",onClick:e[3]||(e[3]=t=>S.value=!1)},{default:u(()=>e[14]||(e[14]=[p(" Cancel ")])),_:1,__:[14]}),d(i(b),{onClick:K},{default:u(()=>e[15]||(e[15]=[p("Save")])),_:1,__:[15]})])])])):G("",!0),x.value?(f(),v("div",Le,[o("div",Oe,[o("h2",Ze,"Assign Menu to "+w((n=k.value)==null?void 0:n.name),1),o("div",He,[o("input",{type:"checkbox",id:"check-all",checked:le.value,onChange:oe,class:"mr-2"},null,40,Je),e[16]||(e[16]=o("label",{for:"check-all",class:"font-medium"},"Check / Uncheck All",-1))]),o("div",Ke,[(f(!0),v(R,null,A(C.value,t=>(f(),v("div",{key:t.id,class:"mb-2"},[o("div",Qe,[o("input",{type:"checkbox",id:`menu-${t.id}`,checked:V(t.id),onChange:a=>se(t),class:"mr-2"},null,40,We),o("label",{for:`menu-${t.id}`},w(t.title),9,Xe)]),t.children&&t.children.length?(f(),v("div",et,[(f(!0),v(R,null,A(t.children,a=>(f(),v("div",{key:a.id,class:"mb-1 flex items-center"},[o("input",{type:"checkbox",id:`menu-${a.id}`,checked:V(a.id),onChange:E=>ae(t.id,a.id),class:"mr-2"},null,40,tt),o("label",{for:`menu-${a.id}`},w(a.title),9,st)]))),128))])):G("",!0)]))),128))]),o("div",at,[d(i(b),{type:"button",variant:"outline",onClick:e[4]||(e[4]=t=>x.value=!1),class:"h-10"},{default:u(()=>e[17]||(e[17]=[p("Cancel")])),_:1,__:[17]}),d(i(b),{type:"submit",onClick:H},{default:u(()=>e[18]||(e[18]=[p("Assign")])),_:1,__:[18]})])])])):G("",!0),g.value?(f(),v("div",ot,[o("div",lt,[e[23]||(e[23]=o("h2",{class:"mb-4 text-lg font-semibold"},"Tambah Role Baru",-1)),o("form",{onSubmit:pe(W,["prevent"])},[o("div",it,[d(i(ge),{modelValue:i(h).name,"onUpdate:modelValue":e[5]||(e[5]=t=>i(h).name=t),placeholder:"Role Name",required:""},null,8,["modelValue"])]),o("div",nt,[e[20]||(e[20]=o("label",{class:"block mb-1 font-medium"},"Buat Produksi",-1)),Y(o("select",{"onUpdate:modelValue":e[6]||(e[6]=t=>i(h).create_prod=t),class:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},e[19]||(e[19]=[o("option",{value:"Y"},"Yes",-1),o("option",{value:"N"},"No",-1)]),512),[[z,i(h).create_prod]])]),o("div",dt,[d(i(b),{type:"button",variant:"outline",onClick:e[7]||(e[7]=t=>g.value=!1),class:"h-10"},{default:u(()=>e[21]||(e[21]=[p("Cancel")])),_:1,__:[21]}),d(i(b),{type:"submit",class:"h-10 rounded-md bg-indigo-600 py-2 text-white hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:u(()=>e[22]||(e[22]=[p("Create")])),_:1,__:[22]})])],32)])])):G("",!0)])]}),_:1})],64))}});export{yt as default};
