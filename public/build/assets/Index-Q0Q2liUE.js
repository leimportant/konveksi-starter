import{d as Q,q as W,r as k,Q as X,T as Y,aS as Z,c as H,o as ee,f as b,g as m,p as s,u as t,Z as te,x as l,k as n,C as x,l as ae,G as se,m as le,D as p,y as r,F as h,B as oe,j as g,z as ne,E as P,N as E}from"./app-tcqbjKsK.js";import{_ as y}from"./Input.vue_vue_type_script_setup_true_lang-CkZfi-Vz.js";import{_ as ie,a as de,b as v,c as A,d as re,e as c}from"./TableRow.vue_vue_type_script_setup_true_lang-COlKs_Fh.js";import{u as ue}from"./useToast-CsntzXKD.js";import{_ as me}from"./AppLayout.vue_vue_type_script_setup_true_lang-DluZnwtD.js";import{u as pe}from"./useKasbonStore-Cqxf-URs.js";import{A as ce}from"./vue3-select-CnQCHJJp.js";import{S as fe}from"./search-CVi6N5Yx.js";import{C as be,a as _e}from"./circle-x-BZqadggx.js";import{T as M}from"./trash-2-C4NXCeyh.js";import{S as ge}from"./square-pen-C687e0C4.js";import"./index-B6V4jR1T.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BTsuvxy6.js";const ye={class:"px-4 py-4"},ve={class:"mb-4 flex flex-col sm:flex-row items-center justify-between gap-3"},xe={class:"flex items-center gap-3 w-full sm:w-auto"},he={class:"overflow-x-auto"},we={class:"flex items-center justify-between"},Ce={class:"font-semibold text-gray-800"},Ve={class:"mt-4 flex justify-end space-x-2"},ke=["disabled"],Ke=["disabled"],je={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},Se={class:"w-96 rounded-lg bg-white p-6"},$e={class:"mb-4"},Pe={class:"mb-4"},De={class:"mb-4"},Ue={class:"flex justify-end gap-2"},Te={key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},qe={class:"w-96 rounded-lg bg-white p-6"},ze={class:"mb-4"},Ee={class:"mb-4"},Ae={class:"mb-4"},Me={class:"flex justify-end gap-2"},et=Q({__name:"Index",setup(Ne){const u=ue(),f=pe(),{kasbonList:N,pagination:_,loading:D}=W(f),K=k(!1),C=k(!1),V=k(null),U=X().props.auth.user,w=k(""),i=Y({id:"",employee_id:0,employee_name:"",amount:0,description:"",status:"Pending"}),R=[{title:"Kasbon",href:"/kasbon"}],j=Z({search:""}),T=()=>{var e;const o=typeof w.value=="string"?w.value:((e=w.value)==null?void 0:e.value)??"";f.fetchKasbon(1,50,{search:j.search,status:o})},S=H(()=>Math.ceil(_.value.total/_.value.per_page)||1),q=async o=>{o<1||o>S.value||await f.fetchKasbon(o)},G=()=>q(_.value.current_page+1),B=()=>q(_.value.current_page-1);ee(()=>{f.fetchKasbon()});const I=async()=>{var o,e;if(!i.employee_id||!i.amount)return u.error("Karyawan dan nominal wajib diisi");try{await f.storeKasbon(i),u.success("Kasbon berhasil ditambahkan"),i.reset(),K.value=!1}catch(a){u.error(((e=(o=a==null?void 0:a.response)==null?void 0:o.data)==null?void 0:e.message)??"Gagal membuat kasbon")}},L=o=>{var e;V.value=o,i.id=o.id,i.employee_id=o.employee_id,i.amount=o.amount,i.description=o.description,i.status=o.status,i.employee_name=(e=o.employee)==null?void 0:e.name,C.value=!0},J=async()=>{var o,e;if(V.value)try{await f.updateKasbon(V.value.id,i),u.success("Kasbon berhasil diperbarui"),C.value=!1,V.value=null}catch(a){u.error(((e=(o=a==null?void 0:a.response)==null?void 0:o.data)==null?void 0:e.message)??"Gagal memperbarui kasbon")}},z=async o=>{var e,a;if(o&&confirm("Yakin ingin menghapus kasbon ini?"))try{await f.deleteKasbon(o),u.success("Kasbon berhasil dihapus")}catch(d){u.error(((a=(e=d==null?void 0:d.response)==null?void 0:e.data)==null?void 0:a.message)??"Gagal menghapus kasbon")}},F=async o=>{var e,a;if(o&&confirm("Setujui kasbon ini?"))try{await f.approveKasbon(o),u.success("Kasbon disetujui dan masuk ke mutasi")}catch(d){u.error(((a=(e=d==null?void 0:d.response)==null?void 0:e.data)==null?void 0:a.message)??"Gagal menyetujui kasbon")}},O=async o=>{var a,d;if(!o)return;const e=prompt("Masukkan alasan penolakan:");if(e)try{await f.rejectKasbon(o,e),u.success("Kasbon ditolak")}catch($){u.error(((d=(a=$==null?void 0:$.response)==null?void 0:a.data)==null?void 0:d.message)??"Gagal menolak kasbon")}};return(o,e)=>(m(),b(h,null,[s(t(te),{title:"Kasbon Management"}),s(me,{breadcrumbs:R},{default:l(()=>[n("div",ye,[n("div",ve,[n("div",xe,[s(t(ce),{modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=a=>w.value=a),options:[{label:"Semua",value:""},{label:"Pending",value:"Pending"},{label:"Approve",value:"Approved"},{label:"Reject",value:"Rejected"}],placeholder:"Pilih Status",class:"w-full sm:w-auto"},null,8,["modelValue"]),ae(n("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>j.search=a),type:"text",placeholder:"Cari data...",onKeyup:se(T,["enter"]),class:"border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 w-full sm:w-46"},null,544),[[le,j.search]]),s(t(p),{onClick:T,class:"bg-indigo-600 text-white hover:bg-indigo-700 flex items-center gap-1"},{default:l(()=>[s(t(fe),{class:"h-4 w-4"}),e[11]||(e[11]=r(" Cari "))]),_:1,__:[11]})])]),n("div",he,[s(t(ie),null,{default:l(()=>[s(t(de),null,{default:l(()=>[s(t(v),{class:"bg-gray-100"},{default:l(()=>[s(t(A),{class:"px-3 py-2"},{default:l(()=>e[12]||(e[12]=[r("Karyawan")])),_:1,__:[12]}),s(t(A),{class:"px-3 py-2"},{default:l(()=>e[13]||(e[13]=[r("Details")])),_:1,__:[13]})]),_:1})]),_:1}),s(t(re),null,{default:l(()=>[(m(!0),b(h,null,oe(t(N),a=>(m(),b(h,{key:a.id},[s(t(v),{class:"bg-gray-50"},{default:l(()=>[s(t(c),{colspan:"2",class:"px-3 py-2"},{default:l(()=>[n("div",we,[n("span",Ce,g(a.employee?a.employee.name:"-"),1),n("span",{class:ne(["inline-block rounded-full border px-2.5 py-0.5 text-xs font-semibold",{"border-yellow-400 bg-yellow-50 text-yellow-700":a.status==="Pending","border-green-400 bg-green-50 text-green-700":a.status==="Approved","border-red-400 bg-red-50 text-red-700":a.status==="Rejected"}])},g(a.status),3)])]),_:2},1024)]),_:2},1024),s(t(v),null,{default:l(()=>[s(t(c),{class:"w-1/4 px-3 py-1 font-medium"},{default:l(()=>e[14]||(e[14]=[r("Tanggal")])),_:1,__:[14]}),s(t(c),{class:"px-3 py-1"},{default:l(()=>[r(g(a.created_at?new Date(a.created_at).toLocaleDateString("id-ID"):"-"),1)]),_:2},1024)]),_:2},1024),s(t(v),null,{default:l(()=>[s(t(c),{class:"w-1/4 px-3 py-1 font-medium"},{default:l(()=>e[15]||(e[15]=[r("Jumlah Kasbon")])),_:1,__:[15]}),s(t(c),{class:"px-3 py-1"},{default:l(()=>[r(g(Number(a.amount).toLocaleString()),1)]),_:2},1024)]),_:2},1024),s(t(v),null,{default:l(()=>[s(t(c),{class:"px-3 py-1 font-medium"},{default:l(()=>e[16]||(e[16]=[r("Keterangan")])),_:1,__:[16]}),s(t(c),{class:"px-3 py-1"},{default:l(()=>[r(g(a.description||"-"),1)]),_:2},1024)]),_:2},1024),s(t(v),null,{default:l(()=>[s(t(c),{class:"px-3 py-1 font-medium"},{default:l(()=>e[17]||(e[17]=[r("Actions")])),_:1,__:[17]}),s(t(c),{class:"flex gap-2 px-3 py-1"},{default:l(()=>[t(U).employee_status&&t(U).employee_status.toUpperCase()==="OWNER"?(m(),b(h,{key:0},[a.status==="Pending"?(m(),b(h,{key:0},[s(t(p),{size:"icon",variant:"ghost",onClick:d=>F(a.id)},{default:l(()=>[s(t(be),{class:"h-4 w-4 text-green-600"})]),_:2},1032,["onClick"]),s(t(p),{size:"icon",variant:"ghost",onClick:d=>O(a.id)},{default:l(()=>[s(t(_e),{class:"h-4 w-4 text-red-600"})]),_:2},1032,["onClick"])],64)):x("",!0),a.status==="Rejected"?(m(),P(t(p),{key:1,size:"icon",variant:"ghost",onClick:d=>z(a.id)},{default:l(()=>[s(t(M),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):x("",!0)],64)):(m(),b(h,{key:1},[a.status==="Pending"||a.status==="Rejected"?(m(),P(t(p),{key:0,size:"icon",variant:"ghost",onClick:d=>L(a)},{default:l(()=>[s(t(ge),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):x("",!0),a.status!=="Approved"?(m(),P(t(p),{key:1,size:"icon",variant:"ghost",onClick:d=>z(a.id)},{default:l(()=>[s(t(M),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):x("",!0)],64))]),_:2},1024)]),_:2},1024),s(t(v),null,{default:l(()=>[s(t(c),{colspan:"2",class:"h-3"})]),_:1})],64))),128))]),_:1})]),_:1})]),n("div",Ve,[n("button",{onClick:B,disabled:t(_).current_page===1||t(D),class:"rounded border px-3 py-1 hover:bg-gray-100 disabled:opacity-50"}," Previous ",8,ke),n("span",null,"Page "+g(t(_).current_page)+" / "+g(S.value),1),n("button",{onClick:G,disabled:t(_).current_page>=S.value||t(D),class:"rounded border px-3 py-1 hover:bg-gray-100 disabled:opacity-50"}," Next ",8,Ke)]),K.value?(m(),b("div",je,[n("div",Se,[e[20]||(e[20]=n("h2",{class:"mb-4 text-lg font-semibold"},"Tambah Kasbon",-1)),n("form",{onSubmit:E(I,["prevent"])},[n("div",$e,[s(t(y),{modelValue:t(i).employee_id,"onUpdate:modelValue":e[2]||(e[2]=a=>t(i).employee_id=a),placeholder:"Employee ID",required:""},null,8,["modelValue"])]),n("div",Pe,[s(t(y),{type:"number",modelValue:t(i).amount,"onUpdate:modelValue":e[3]||(e[3]=a=>t(i).amount=a),placeholder:"Jumlah Kasbon",required:""},null,8,["modelValue"])]),n("div",De,[s(t(y),{modelValue:t(i).description,"onUpdate:modelValue":e[4]||(e[4]=a=>t(i).description=a),placeholder:"Deskripsi",required:""},null,8,["modelValue"])]),n("div",Ue,[s(t(p),{variant:"outline",type:"button",onClick:e[5]||(e[5]=a=>K.value=!1)},{default:l(()=>e[18]||(e[18]=[r("Cancel")])),_:1,__:[18]}),s(t(p),{type:"submit",class:"bg-indigo-600 text-white hover:bg-indigo-700"},{default:l(()=>e[19]||(e[19]=[r("Create")])),_:1,__:[19]})])],32)])])):x("",!0),C.value?(m(),b("div",Te,[n("div",qe,[e[23]||(e[23]=n("h2",{class:"mb-4 text-lg font-semibold"},"Edit Kasbon",-1)),n("form",{onSubmit:E(J,["prevent"])},[n("div",ze,[s(t(y),{type:"hidden",modelValue:t(i).employee_id,"onUpdate:modelValue":e[6]||(e[6]=a=>t(i).employee_id=a),readonly:"",placeholder:"Employee ID",required:""},null,8,["modelValue"]),s(t(y),{modelValue:t(i).employee_name,"onUpdate:modelValue":e[7]||(e[7]=a=>t(i).employee_name=a),readonly:"",placeholder:"Employee ID",required:""},null,8,["modelValue"])]),n("div",Ee,[s(t(y),{type:"number",modelValue:t(i).amount,"onUpdate:modelValue":e[8]||(e[8]=a=>t(i).amount=a),placeholder:"Jumlah Kasbon",required:""},null,8,["modelValue"])]),n("div",Ae,[s(t(y),{modelValue:t(i).description,"onUpdate:modelValue":e[9]||(e[9]=a=>t(i).description=a),placeholder:"Deskripsi",required:""},null,8,["modelValue"])]),n("div",Me,[s(t(p),{variant:"outline",type:"button",onClick:e[10]||(e[10]=a=>C.value=!1)},{default:l(()=>e[21]||(e[21]=[r("Cancel")])),_:1,__:[21]}),s(t(p),{type:"submit",class:"bg-indigo-600 text-white hover:bg-indigo-700"},{default:l(()=>e[22]||(e[22]=[r("Update")])),_:1,__:[22]})])],32)])])):x("",!0)])]),_:1})],64))}});export{et as default};
