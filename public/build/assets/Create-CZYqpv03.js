import{d as A,q as B,r as y,T as F,o as $,w as j,e as W,f as l,g as i,p as f,u as n,Z as q,x as H,k as a,C as N,j as v,l as S,F as k,B as w,W as K,y as D,S as L,m as Q,N as V,b as R}from"./app-36B4zYOK.js";import{u as Y}from"./useToast-21bEKSXO.js";import{_ as Z}from"./AppLayout.vue_vue_type_script_setup_true_lang-GP0QoSo9.js";import{u as J}from"./useModelStore-BeN1VjVP.js";import{u as O}from"./useProductionStore-CspIaND6.js";import{A as X}from"./vue3-select-CKZcsg76.js";import"./index-D_L_HNLE.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-C9dYfdTb.js";const ee={class:"space-y-6 p-6"},te={class:"text-2xl font-bold"},ae=["value"],oe={key:0,class:"mt-4 p-4 bg-yellow-50 border border-yellow-300 rounded text-sm text-yellow-700"},se={key:1,class:"mt-4 p-4 bg-blue-50 border border-blue-300 rounded text-sm text-blue-700"},le={class:"flex flex-col gap-2"},ie=["value"],re={key:2},ne={class:"w-full table-auto border"},de={class:"border px-3 py-2 text-sm"},ue={class:"border px-3 py-2 text-sm"},me={class:"border px-3 py-2 text-sm"},ce=["onUpdate:modelValue"],pe={class:"flex gap-2"},ye=["disabled"],he=A({__name:"Create",props:{activity_role:{}},setup(G){const x=Y(),b=J(),{models:T,employees:z}=B(b),o=G,g=y(null),c=y(0),I=y([]),_=y([]),h=y([]),r=F({model_id:null,activity_role_id:Number(o.activity_role),employee_id:null,items:[],remark:""}),C=async(d="SEWING")=>{var t,s;try{const e=await R.get("/api/activity-roles",{params:{group_menu:d}});_.value=e.data.data}catch(e){x.error(((s=(t=e.response)==null?void 0:t.data)==null?void 0:s.message)||"Gagal mengambil data tugas finishing")}};$(async()=>{await b.fetchModels({page:1,is_close:"N"}),o.activity_role==="FINISHING"&&await C("FINISHING"),o.activity_role==="SEWING"&&await C("SEWING"),await b.fetchActivityEmployee(String(o.activity_role))}),j(g,async d=>{if(d)try{const s=(await b.fetchModelById(d)).data;r.model_id=s.id,I.value=s.sizes,r.items=s.sizes.map(e=>({size_id:String(e.size_id),size_name:e.size_name,qty:0,variant:e.variant}))}catch(t){console.error("Failed to fetch model sizes",t)}});const E=[{title:"Produksi",href:`/production/${o.activity_role}`}],M=O(),P=async()=>{var d,t,s;try{let e=1;o.activity_role=="CUTTING"&&(e=1),(o.activity_role=="FINISHING"||o.activity_role=="SEWING")&&(e=h.value.map(u=>{var m;return(m=_.value.find(U=>U.id===u))==null?void 0:m.id}).filter(u=>u!==null)),o.activity_role=="LUBANG_KANCING"&&(e=4);const p=typeof c.value=="number"?c.value:((d=c.value)==null?void 0:d.id)??0;await M.createProduction({model_id:r.model_id,activity_role_id:e,activity_role:String(o.activity_role),employee_id:p,remark:r.remark||"",items:r.items.filter(u=>u.qty>0)}),x.success("Produksi berhasil dibuat"),V.visit(`/production/${o.activity_role}`)}catch(e){x.error(((s=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:s.message)??"Gagal membuat produksi")}};return(d,t)=>{const s=W("Input");return i(),l(k,null,[f(n(q),{title:"Production Management"}),f(Z,{breadcrumbs:E},{default:H(()=>[a("div",ee,[a("h1",te,v(o.activity_role.toString().replace(/_/g," ")??"Buat Produksi"),1),a("div",null,[t[6]||(t[6]=a("label",{class:"mb-1 block font-medium"},"Pilih Desain Kerjaan",-1)),S(a("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>g.value=e),class:"w-full rounded border p-2"},[t[5]||(t[5]=a("option",{disabled:"",value:""},"-- Choose a model --",-1)),(i(!0),l(k,null,w(n(T),e=>(i(),l("option",{key:e.id,value:e.id},v(e.description),9,ae))),128))],512),[[K,g.value]])]),a("div",null,[t[7]||(t[7]=a("label",{class:"mb-1 block font-medium"},"Karyawan",-1)),f(n(X),{id:"model.id",modelValue:c.value,"onUpdate:modelValue":t[1]||(t[1]=e=>c.value=e),options:n(z),label:"name",placeholder:"Select Employee",class:"w-full"},null,8,["modelValue","options"])]),o.activity_role==="QUALITY_CHECK"?(i(),l("div",oe,[t[8]||(t[8]=a("p",null,"Periksa kualitas produk dengan teliti sebelum melanjutkan ke proses selanjutnya. Pastikan tidak ada cacat atau kekurangan.",-1)),f(s,{type:"text",modelValue:n(r).remark,"onUpdate:modelValue":t[2]||(t[2]=e=>n(r).remark=e),placeholder:"Tambahkan catatan atau remark jika diperlukan",class:"mt-2 w-full rounded border p-2"},null,8,["modelValue"])])):N("",!0),_.value.length&&o.activity_role==="FINISHING"||o.activity_role==="SEWING"?(i(),l("div",se,[t[9]||(t[9]=a("p",{class:"font-semibold mb-2"},"Pilih pekerjaan yang dilakukan:",-1)),a("div",le,[(i(!0),l(k,null,w(_.value,e=>(i(),l("label",{key:e.id,class:"flex items-center gap-2"},[S(a("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=p=>h.value=p),value:e.id},null,8,ie),[[L,h.value]]),D(" "+v(e.name),1)]))),128))])])):N("",!0),I.value.length>0?(i(),l("div",re,[t[11]||(t[11]=a("h2",{class:"mb-2 font-semibold"},"Model Ukuran",-1)),a("table",ne,[t[10]||(t[10]=a("thead",null,[a("tr",{class:"bg-gray-100"},[a("th",{class:"border px-3 text-sm py-2 text-left"},"Size"),a("th",{class:"border px-3 text-sm py-2 text-left"},"Variant"),a("th",{class:"border px-3 text-sm py-2 text-left"},"Qty")])],-1)),a("tbody",null,[(i(!0),l(k,null,w(n(r).items,(e,p)=>{var u;return i(),l("tr",{key:`size-${p}-${e.size_id}`},[a("td",de,v(((u=I.value.find(m=>m.size_id===e.size_id))==null?void 0:u.size_name)||e.size_id),1),a("td",ue,v(e.variant),1),a("td",me,[S(a("input",{type:"number",min:"0",class:"w-full rounded border px-2 py-1","onUpdate:modelValue":m=>e.qty=m},null,8,ce),[[Q,e.qty,void 0,{number:!0}]])])])}),128))])])])):N("",!0),a("div",pe,[a("button",{onClick:P,class:"rounded text-sm bg-blue-600 px-4 py-2 text-white hover:bg-blue-700",disabled:n(r).processing},"Simpan",8,ye),a("button",{onClick:t[4]||(t[4]=e=>n(V).visit(`/production/${o.activity_role}`)),type:"button",class:"rounded text-sm bg-gray-500 px-4 py-2 text-white hover:bg-gray-600"}," Cancel ")])])]),_:1})],64)}}});export{he as default};
