import{R as ee,b as A,d as te,r as k,T as se,q as le,o as ae,c as oe,f as v,g as f,p as r,u as a,Z as ie,x as c,k as o,C as T,D as y,y as _,F as R,B as M,E as ne,j as w,l as z,O as re,N as de,U as ce,n as ue}from"./app-Caryf2_U.js";import{_ as fe}from"./Input.vue_vue_type_script_setup_true_lang-g99uCs6l.js";import{_ as ve,a as me,b as E,c as G,d as _e,e as V}from"./TableRow.vue_vue_type_script_setup_true_lang-COBSmIS6.js";import{u as pe}from"./useToast-DPf0E9Cv.js";import{i as he,_ as ge}from"./AppLayout.vue_vue_type_script_setup_true_lang-Db8DdtVX.js";import{u as ye}from"./useActivityGroupStore-BvmxF546.js";import{P}from"./plus-Bdiubz6N.js";import{T as be}from"./trash-2-DLsGEARf.js";import"./index-Br0w8i2J.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-D97I65uB.js";const ke=ee("role",{state:()=>({items:[],loaded:!1}),actions:{async fetchRoles(p=!1){if(!(this.loaded&&!p))try{const d=await A.get("/api/roles");this.items=d.data.data,this.loaded=!0}catch(d){console.error("Failed to fetch Roles",d)}},async createRole(p,d){try{await A.post("/api/roles",{name:p,create_prod:d}),await this.fetchRoles()}catch(h){throw h}},async updateRole(p,d,h){try{await A.put(`/api/roles/${p}`,{name:d,create_prod:h}),await this.fetchRoles()}catch(x){throw x}},async deleteRole(p){try{await A.delete(`/api/roles/${p}`),await this.fetchRoles()}catch(d){throw d}},async assignMenusToRole(p,d){try{await A.post("/api/roles/assign-menus",{role_id:p,menus:d})}catch(h){throw h}}}}),we={class:"px-4 py-4"},xe={class:"mb-2 flex items-center justify-between gap-2"},Ce={class:"rounded-md border"},Re=["onClick"],Ae=["title"],Me={key:1,class:"text-sm italic text-gray-400"},$e={key:0,class:"text-green-600 font-semibold"},Ne={key:1,class:"text-red-600 font-semibold"},Se={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},Te={class:"w-96 rounded-lg bg-white p-6"},Ge={class:"mb-4 text-lg font-semibold"},Ve={class:"mb-4 max-h-60 overflow-y-auto"},je=["id","value"],Be=["for"],Fe={class:"flex justify-end gap-2"},ze={key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},Ee={class:"w-96 rounded-lg bg-white p-6"},Pe={class:"mb-4 text-lg font-semibold"},Ue={class:"mb-2 flex items-center border-b pb-2"},Ye=["checked"],De={class:"mb-4 max-h-60 overflow-y-auto"},qe={class:"flex items-center"},Ie=["id","checked","onChange"],Le=["for"],Oe={key:0,class:"ml-6"},Ze=["id","checked","onChange"],He=["for"],Je={class:"flex justify-end gap-2"},Ke={key:2,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},Qe={class:"w-96 rounded-lg bg-white p-6"},We={class:"mb-4"},Xe={class:"mb-4"},et={class:"flex justify-end gap-2"},ut=te({__name:"Index",setup(p){const d=pe(),h=k(!1),x=k(!1),b=k(null),C=k([]),u=k([]),g=se({name:"",create_prod:"Y"}),U=[{title:"Role",href:"/roles"}],m=ke(),{items:Y}=le(m),j=ye(),D=he(),$=k(!1),B=k([]),N=k([]);ae(()=>{m.fetchRoles()});const q=async()=>{var s,e;if(!b.value)return d.error("No role selected");try{await m.assignMenusToRole(b.value.id,u.value),d.success("Menus assigned successfully"),x.value=!1,m.loaded=!1,await m.fetchRoles(!0)}catch(l){d.error(((e=(s=l==null?void 0:l.response)==null?void 0:s.data)==null?void 0:e.message)??"Failed to assign menus")}},I=async s=>{var e;b.value=s,await j.fetchActivity(),B.value=[...j.items],N.value=((e=s.activity_groups)==null?void 0:e.map(l=>String(l.activity_group_id||l.id)))||[],$.value=!0},L=async()=>{var s,e;if(!b.value)return d.error("No role selected");try{await j.assignToRole(b.value.id,N.value),d.success("Activity Groups assigned successfully"),$.value=!1,m.loaded=!1,await ue(),await m.fetchRoles(!0)}catch(l){d.error(((e=(s=l==null?void 0:l.response)==null?void 0:s.data)==null?void 0:e.message)??"Failed to assign activity groups")}},O=async s=>{b.value=s,C.value=await D.fetchAllMenus(s.id),u.value=[],C.value.forEach(e=>{var l;e.checked&&u.value.push(e.id),(l=e.children)==null||l.forEach(n=>{n.checked&&u.value.push(n.id)})}),x.value=!0},Z=async()=>{var s,e,l,n;if(!g.name)return d.error("Name is required");g.create_prod||(g.create_prod="N");try{await m.createRole(g.name,g.create_prod),d.success("Role created successfully"),g.reset(),m.loaded=!1,await m.fetchRoles(!0),h.value=!1}catch(t){const i=(n=(l=(e=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:e.errors)==null?void 0:l.name)==null?void 0:n[0];d.error(i||"Failed to create role")}},H=async s=>{var e,l;if(confirm("Are you sure you want to delete this role?"))try{await m.deleteRole(s),d.success("Role deleted successfully"),m.loaded=!1,await m.fetchRoles()}catch(n){d.error(((l=(e=n==null?void 0:n.response)==null?void 0:e.data)==null?void 0:l.message)??"Failed to delete role")}},S=s=>u.value.includes(s),J=(s,e=8)=>s?s.length>e?s.slice(0,e)+"...":s:"",K=s=>{var n;const e=s.id,l=((n=s.children)==null?void 0:n.map(t=>t.id))||[];if(S(e))u.value=u.value.filter(t=>t!==e&&!l.includes(t));else{u.value.push(e);for(const t of l)u.value.includes(t)||u.value.push(t)}},Q=(s,e)=>{var l;if(S(e)){u.value=u.value.filter(i=>i!==e);const n=C.value.find(i=>i.id===s);((l=n==null?void 0:n.children)==null?void 0:l.some(i=>u.value.includes(i.id)))||(u.value=u.value.filter(i=>i!==s))}else u.value.push(e),u.value.includes(s)||u.value.push(s)},W=s=>{if(s.target.checked){const l=C.value.flatMap(n=>{var i;const t=((i=n.children)==null?void 0:i.map(F=>F.id))||[];return[n.id,...t]}).filter(n=>typeof n=="number");u.value=[...new Set(l)]}else u.value=[]},X=oe(()=>{const s=C.value.flatMap(e=>{var n;const l=((n=e.children)==null?void 0:n.map(t=>t.id))||[];return[e.id,...l]}).filter(e=>typeof e=="number");return s.length>0&&s.every(e=>u.value.includes(e))});return(s,e)=>(f(),v(R,null,[r(a(ie),{title:"Role Management"}),r(ge,{breadcrumbs:U},{default:c(()=>{var l,n;return[o("div",we,[o("div",xe,[r(a(y),{onClick:e[0]||(e[0]=t=>h.value=!0),class:"h-10 rounded-md bg-indigo-600 py-2 text-white hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:c(()=>[r(a(P),{class:"h-4 w-4"}),e[7]||(e[7]=_(" Tambah Role "))]),_:1,__:[7]})]),o("div",Ce,[r(a(ve),null,{default:c(()=>[r(a(me),null,{default:c(()=>[r(a(E),{class:"bg-gray-100"},{default:c(()=>[r(a(G),null,{default:c(()=>e[8]||(e[8]=[_("Name")])),_:1,__:[8]}),r(a(G),null,{default:c(()=>e[9]||(e[9]=[_("Apparel (Menu)")])),_:1,__:[9]}),r(a(G),null,{default:c(()=>e[10]||(e[10]=[_("Buat Produksi")])),_:1,__:[10]}),r(a(G),{class:"w-24"},{default:c(()=>e[11]||(e[11]=[_("Actions")])),_:1,__:[11]})]),_:1})]),_:1}),r(a(_e),null,{default:c(()=>[(f(!0),v(R,null,M(a(Y),t=>(f(),ne(a(E),{key:t.id},{default:c(()=>[r(a(V),null,{default:c(()=>[_(w(t.name),1)]),_:2},1024),r(a(V),null,{default:c(()=>[o("div",{class:"flex cursor-pointer flex-wrap gap-1 rounded-md p-2 transition hover:bg-gray-50",onClick:i=>I(t)},[t.activity_groups&&t.activity_groups.length>0?(f(!0),v(R,{key:0},M(t.activity_groups,i=>(f(),v("span",{key:i.activity_group_id,class:"rounded-full border border-indigo-200 bg-indigo-50 px-2 py-0.5 text-xs font-medium text-gray-700",title:i.activity_group_id},w(J(i.activity_group_id)),9,Ae))),128)):(f(),v("span",Me,"No activity groups"))],8,Re)]),_:2},1024),r(a(V),null,{default:c(()=>[t.create_prod=="Y"?(f(),v("span",$e,"Yes")):(f(),v("span",Ne,"No"))]),_:2},1024),r(a(V),{class:"flex gap-2"},{default:c(()=>[r(a(y),{variant:"ghost",size:"icon",onClick:i=>O(t)},{default:c(()=>[r(a(P),{class:"h-4 w-4"})]),_:2},1032,["onClick"]),r(a(y),{variant:"ghost",size:"icon",onClick:i=>H(t.id)},{default:c(()=>[r(a(be),{class:"h-4 w-4"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),$.value?(f(),v("div",Se,[o("div",Te,[o("h2",Ge,"Assign Activity Group untuk "+w((l=b.value)==null?void 0:l.name),1),o("div",Ve,[(f(!0),v(R,null,M(B.value,t=>(f(),v("div",{key:t.id,class:"mb-2 flex items-center"},[z(o("input",{type:"checkbox",id:t.id,value:t.id,"onUpdate:modelValue":e[1]||(e[1]=i=>N.value=i),class:"mr-2"},null,8,je),[[re,N.value]]),o("label",{for:t.id},w(t.name),9,Be)]))),128))]),o("div",Fe,[r(a(y),{variant:"outline",onClick:e[2]||(e[2]=t=>$.value=!1)},{default:c(()=>e[12]||(e[12]=[_(" Cancel ")])),_:1,__:[12]}),r(a(y),{onClick:L},{default:c(()=>e[13]||(e[13]=[_("Save")])),_:1,__:[13]})])])])):T("",!0),x.value?(f(),v("div",ze,[o("div",Ee,[o("h2",Pe,"Assign Menu to "+w((n=b.value)==null?void 0:n.name),1),o("div",Ue,[o("input",{type:"checkbox",id:"check-all",checked:X.value,onChange:W,class:"mr-2"},null,40,Ye),e[14]||(e[14]=o("label",{for:"check-all",class:"font-medium"},"Check / Uncheck All",-1))]),o("div",De,[(f(!0),v(R,null,M(C.value,t=>(f(),v("div",{key:t.id,class:"mb-2"},[o("div",qe,[o("input",{type:"checkbox",id:`menu-${t.id}`,checked:S(t.id),onChange:i=>K(t),class:"mr-2"},null,40,Ie),o("label",{for:`menu-${t.id}`},w(t.title),9,Le)]),t.children&&t.children.length?(f(),v("div",Oe,[(f(!0),v(R,null,M(t.children,i=>(f(),v("div",{key:i.id,class:"mb-1 flex items-center"},[o("input",{type:"checkbox",id:`menu-${i.id}`,checked:S(i.id),onChange:F=>Q(t.id,i.id),class:"mr-2"},null,40,Ze),o("label",{for:`menu-${i.id}`},w(i.title),9,He)]))),128))])):T("",!0)]))),128))]),o("div",Je,[r(a(y),{type:"button",variant:"outline",onClick:e[3]||(e[3]=t=>x.value=!1),class:"h-10"},{default:c(()=>e[15]||(e[15]=[_("Cancel")])),_:1,__:[15]}),r(a(y),{type:"submit",onClick:q},{default:c(()=>e[16]||(e[16]=[_("Assign")])),_:1,__:[16]})])])])):T("",!0),h.value?(f(),v("div",Ke,[o("div",Qe,[e[21]||(e[21]=o("h2",{class:"mb-4 text-lg font-semibold"},"Tambah Role Baru",-1)),o("form",{onSubmit:de(Z,["prevent"])},[o("div",We,[r(a(fe),{modelValue:a(g).name,"onUpdate:modelValue":e[4]||(e[4]=t=>a(g).name=t),placeholder:"Role Name",required:""},null,8,["modelValue"])]),o("div",Xe,[e[18]||(e[18]=o("label",{class:"block mb-1 font-medium"},"Buat Produksi",-1)),z(o("select",{"onUpdate:modelValue":e[5]||(e[5]=t=>a(g).create_prod=t),class:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},e[17]||(e[17]=[o("option",{value:"Y"},"Yes",-1),o("option",{value:"N"},"No",-1)]),512),[[ce,a(g).create_prod]])]),o("div",et,[r(a(y),{type:"button",variant:"outline",onClick:e[6]||(e[6]=t=>h.value=!1),class:"h-10"},{default:c(()=>e[19]||(e[19]=[_("Cancel")])),_:1,__:[19]}),r(a(y),{type:"submit",class:"h-10 rounded-md bg-indigo-600 py-2 text-white hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:c(()=>e[20]||(e[20]=[_("Create")])),_:1,__:[20]})])],32)])])):T("",!0)])]}),_:1})],64))}});export{ut as default};
