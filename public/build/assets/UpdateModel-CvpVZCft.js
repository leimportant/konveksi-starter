import{d as Z,r as c,q as G,T as J,o as O,f as l,g as d,p as n,u as i,Z as R,x as h,k as o,F as M,B as I,z as b,j as v,N as W,C as u,l as X,U as ee,D as z,V as q,y as N}from"./app-BVpg1Md5.js";import{_ as te}from"./AppLayout.vue_vue_type_script_setup_true_lang-BoGnX1If.js";import{_ as w}from"./Input.vue_vue_type_script_setup_true_lang-Ds7_FPpG.js";import{_ as T}from"./DateInput.vue_vue_type_script_setup_true_lang-DBqTr7A0.js";import{_ as ae}from"./DocumentList.vue_vue_type_script_setup_true_lang-DfpIxjwo.js";import{d as se,_ as ie,a as oe,b as re,c as le}from"./index-D3c9-I4b.js";import{u as de}from"./useModelStore-wo8FX8tz.js";import{u as ne}from"./useCategoryStore-5og_5oGG.js";import{u as ue}from"./useToast-dc7ou10L.js";import"./index-CwjgKOBI.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-Cs930JZ8.js";import"./trash-DpdvDKgu.js";import"./useSizeStore-CPO8tJ8f.js";import"./useProductStore-Dj4UpXTE.js";import"./useMasterActivityRoleStore-BPSHyo_e.js";import"./useUomStore-Duzv_UN9.js";import"./vue3-select-DVgd-hQx.js";const me={class:"rounded-xl bg-white p-6 shadow-sm dark:bg-gray-800"},ce={class:"my-6 flex space-x-4 border-b dark:border-gray-700"},pe=["onClick"],ve={key:0,class:"space-y-6"},_e={key:0,class:"text-destructive"},fe=["value"],ye={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ge={key:0,class:"text-destructive"},ke={class:"hidden"},be={key:0,class:"text-destructive"},xe={class:"hidden"},Ve={key:0,class:"text-destructive"},he={class:"hidden"},Me={key:0,class:"text-destructive"},we={key:1},Se={key:2},$e={key:3,class:"space-y-6"},Ue={key:4},Ce={key:5},De={class:"flex justify-end gap-2"},Ee="Model",Oe=Z({__name:"UpdateModel",props:{modelId:{}},setup(j){const x=j,B=c(Number(x.modelId)).value??"",S=["model","size","activity","gambar","bahan dan biaya","hpp"],m=c(S[0]),s=c({}),$=ne(),{items:F}=G($),P=[{title:"Konveksi",href:"/konveksi"},{title:"Edit Model",href:`/konveksi/model/${x.modelId}/edit`}],U=de(),_=ue(),A=r=>r.map(t=>({...t,product_id:typeof t.product_id=="object"?t.product_id.id:t.product_id})),a=J({description:"",category_id:null,remark:"",start_date:null,end_date:null,estimation_price_pcs:0,estimation_qty:1}),C=c([]),f=c([]),D=c(0),p=c([]),y=c([]),K=()=>{let r=!0;return s.value={},a.description||(s.value.description=["Deskripsi wajib diisi"],r=!1),a.category_id||(s.value.category_id=["Kategori wajib diisi"],r=!1),(!a.estimation_price_pcs||a.estimation_price_pcs<0)&&(s.value.estimation_price_pcs=["Estimasi harga harus angka dan >= 0"],r=!1),(!a.estimation_qty||a.estimation_qty<1)&&(s.value.estimation_qty=["Estimasi qty harus angka dan >= 1"],r=!1),f.value.length===0&&(s.value.sizes=["Data ukuran minimal 1"],r=!1),p.value.length===0&&(s.value.activity=["Data aktivitas minimal 1"],r=!1),y.value.length===0&&(s.value.modelMaterials=["Data material minimal 1"],r=!1),r},L=async()=>{var r,t,e,g,V;try{if(!K())return;await U.updateModel(x.modelId,{...a,sizes:f.value,activity:p.value,documents:C.value,modelMaterials:A(y.value)}),_.success("Model berhasil diperbarui"),q.visit("/konveksi/model/list")}catch(k){if(((r=k.response)==null?void 0:r.status)===422&&((e=(t=k.response)==null?void 0:t.data)!=null&&e.errors)){s.value=k.response.data.errors;for(const Q in s.value)s.value[Q].forEach(Y=>{_.error(Y)})}else(V=(g=k.response)==null?void 0:g.data)!=null&&V.message?_.error(k.response.data.message):_.error("Terjadi kesalahan saat menyimpan model")}};O(async()=>{var r,t;try{Promise.all([$.fetchCategories()]);const e=await U.fetchModelById(x.modelId);console.log("Model Data:",e),e&&(a.description=e.data.description,a.remark=e.data.remark,a.start_date=e.data.start_date?E(e.data.start_date):"",a.end_date=e.data.end_date?E(e.data.end_date):"",a.estimation_price_pcs=e.data.estimation_price_pcs,a.estimation_qty=e.data.estimation_qty,a.category_id=e.data.category_id,f.value=e.data.sizes||[],p.value=e.data.activities||[],C.value=e.data.documents||[],y.value=e.data.model_material||[])}catch(e){(t=(r=e.response)==null?void 0:r.data)!=null&&t.errors?(s.value=e.response.data.errors,_.error("Validasi gagal, silakan periksa form")):_.error("Terjadi kesalahan saat membuat model")}window.addEventListener("popstate",()=>{se.Inertia.visit(window.location.href,{preserveState:!0})})});const H=r=>{const t=p.value.find(e=>e.activity_role_id===r);return(t==null?void 0:t.activity_name)||`Activity ${r}`};function E(r){const t=new Date(r),e=t.getFullYear(),g=String(t.getMonth()+1).padStart(2,"0"),V=String(t.getDate()).padStart(2,"0");return`${e}-${g}-${V}`}return(r,t)=>(d(),l(M,null,[n(i(R),{title:"Edit Model"}),n(te,{breadcrumbs:P},{default:h(()=>[o("div",me,[t[20]||(t[20]=o("div",{class:"border-b pb-4"},[o("h1",{class:"text-2xl font-semibold text-gray-900 dark:text-white"},"Edit Model"),o("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Edit data model, ukuran, dan aktivitas")],-1)),o("div",ce,[(d(),l(M,null,I(S,e=>o("button",{key:e,class:b(["pb-2 text-sm font-medium",{"border-b-2 border-primary text-primary":m.value===e,"text-gray-500 hover:text-gray-700":m.value!==e}]),onClick:g=>m.value=e},v(e.charAt(0).toUpperCase()+e.slice(1)),11,pe)),64))]),o("form",{onSubmit:W(L,["prevent"]),class:"space-y-6"},[m.value==="model"?(d(),l("div",ve,[o("div",null,[t[11]||(t[11]=o("label",{for:"description",class:"text-sm font-medium"},"Nama Model",-1)),n(i(w),{id:"description",modelValue:i(a).description,"onUpdate:modelValue":t[0]||(t[0]=e=>i(a).description=e),placeholder:""},null,8,["modelValue"]),s.value.description?(d(),l("small",_e,v(s.value.description[0]),1)):u("",!0)]),o("div",null,[t[13]||(t[13]=o("label",{for:"category_id",class:"block mb-1 font-medium"},"Kategori",-1)),X(o("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>i(a).category_id=e),class:"w-full text-xs rounded-md border border-input px-3 py-2",required:""},[t[12]||(t[12]=o("option",{value:"0"},"Select Category",-1)),(d(!0),l(M,null,I(i(F),e=>(d(),l("option",{key:e.id,value:e.id},v(e.name),9,fe))),128))],512),[[ee,i(a).category_id]])]),o("div",ye,[o("div",null,[t[14]||(t[14]=o("label",{for:"start_date",class:"text-sm font-medium"},"Tanggal Mulai",-1)),n(i(T),{modelValue:i(a).start_date,"onUpdate:modelValue":t[2]||(t[2]=e=>i(a).start_date=e),id:"start_date",class:b({"border-destructive":s.value.start_date})},null,8,["modelValue","class"]),s.value.start_date?(d(),l("small",ge,v(s.value.start_date[0]),1)):u("",!0)]),o("div",ke,[t[15]||(t[15]=o("label",{for:"end_date",class:"text-sm font-medium"},"Estimasi Selesai",-1)),n(i(T),{modelValue:i(a).end_date,"onUpdate:modelValue":t[3]||(t[3]=e=>i(a).end_date=e),id:"end_date",class:b({"border-destructive":s.value.end_date})},null,8,["modelValue","class"]),s.value.end_date?(d(),l("small",be,v(s.value.end_date[0]),1)):u("",!0)]),o("div",xe,[t[16]||(t[16]=o("label",{for:"estimation_price_pcs",class:"text-sm font-medium"},"Estimasi Harga",-1)),n(i(w),{type:"number",modelValue:i(a).estimation_price_pcs,"onUpdate:modelValue":t[4]||(t[4]=e=>i(a).estimation_price_pcs=e),id:"estimation_price_pcs",class:b({"border-destructive":s.value.estimation_price_pcs})},null,8,["modelValue","class"]),s.value.estimation_price_pcs?(d(),l("small",Ve,v(s.value.estimation_price_pcs[0]),1)):u("",!0)])]),o("div",he,[t[17]||(t[17]=o("label",{for:"remark",class:"text-sm font-medium"},"Catatan",-1)),n(i(w),{modelValue:i(a).remark,"onUpdate:modelValue":t[5]||(t[5]=e=>i(a).remark=e),id:"remark",placeholder:"",class:b({"border-destructive":s.value.remark})},null,8,["modelValue","class"]),s.value.remark?(d(),l("small",Me,v(s.value.remark[0]),1)):u("",!0)])])):u("",!0),m.value==="size"?(d(),l("div",we,[n(ie,{modelValue:f.value,"onUpdate:modelValue":t[6]||(t[6]=e=>f.value=e),"onUpdate:totalQuantity":t[7]||(t[7]=e=>D.value=e)},null,8,["modelValue"])])):u("",!0),m.value==="activity"?(d(),l("div",Se,[n(oe,{modelValue:p.value,"onUpdate:modelValue":t[8]||(t[8]=e=>p.value=e)},null,8,["modelValue"])])):u("",!0),m.value==="gambar"?(d(),l("div",$e,[n(ae,{"reference-id":i(B),"reference-type":Ee},null,8,["reference-id"])])):u("",!0),m.value==="bahan dan biaya"?(d(),l("div",Ue,[n(re,{modelValue:y.value,"onUpdate:modelValue":t[9]||(t[9]=e=>y.value=e)},null,8,["modelValue"])])):u("",!0),m.value==="hpp"?(d(),l("div",Ce,[n(le,{"model-materials":y.value,"activity-items":p.value.map(e=>({...e,activity_name:H(e.activity_role_id)})),"start-date":i(a).start_date,"end-date":i(a).end_date,"total-production":D.value,"size-items":f.value.map(e=>({...e}))},null,8,["model-materials","activity-items","start-date","end-date","total-production","size-items"])])):u("",!0),o("div",De,[n(i(z),{type:"button",class:"bg-amber-600 text-white h-10 rounded-md hover:bg-amber-700",variant:"outline",onClick:t[10]||(t[10]=e=>i(q).visit("/konveksi/model/list"))},{default:h(()=>t[18]||(t[18]=[N(" Batal ")])),_:1,__:[18]}),n(i(z),{type:"submit",class:"bg-indigo-600 text-white py-2 h-10 rounded-md hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:h(()=>t[19]||(t[19]=[N("Simpan Perubahan")])),_:1,__:[19]})])],32)])]),_:1})],64))}});export{Oe as default};
