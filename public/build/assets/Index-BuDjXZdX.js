import{R as J,b as w,d as K,q as O,r as U,o as Q,W as X,f as y,g as _,p as a,u as t,Z as ee,x as r,k as d,C as E,D as v,y as m,F as q,B as M,E as j,j as V,z as te,N as I,l as T,U as z}from"./app-Dlow-IqW.js";import{_ as se}from"./AppLayout.vue_vue_type_script_setup_true_lang-COJZifLC.js";import{_ as g}from"./Input.vue_vue_type_script_setup_true_lang-CSQcVFIn.js";import{_ as ae,a as le,b as F,c as x,d as re,e as k}from"./TableRow.vue_vue_type_script_setup_true_lang-BqTWHXmK.js";import{u as oe}from"./useToast-CbF-WIAa.js";import{P as ne}from"./plus-BPNMVTzo.js";import{S as ie}from"./square-pen-BVDXJV2Q.js";import{T as de}from"./trash-2-hYB1kF2K.js";import"./index-C4W-OPw1.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CiznyD-g.js";const ue=J("customer",{state:()=>({customers:[],customer:null,loading:!1,error:null,total:0,currentPage:1,lastPage:1}),actions:{async fetchCustomers(f=1,i=10,o=""){var n,u;this.loading=!0;try{const b=new URLSearchParams({page:f.toString(),perPage:i.toString()});o&&b.append("name",o);const c=await w.get(`/api/customers?${b}`);this.customers=c.data.data,this.total=c.data.total,this.currentPage=c.data.current_page,this.lastPage=c.data.last_page,this.error=null}catch(b){this.error=((u=(n=b.response)==null?void 0:n.data)==null?void 0:u.message)||"Error fetching customers"}finally{this.loading=!1}},async fetchCustomer(f){var i,o;this.loading=!0;try{const n=await w.get(`/api/customers/${f}`);this.customer=n.data,this.error=null}catch(n){throw this.error=((o=(i=n.response)==null?void 0:i.data)==null?void 0:o.message)||"Error fetching customer",n}finally{this.loading=!1}},async createCustomer(f){var i,o;this.loading=!0;try{const n=await w.post("/api/customers",f);return this.error=null,n.data}catch(n){throw this.error=((o=(i=n.response)==null?void 0:i.data)==null?void 0:o.message)||"Error creating customer",n}finally{this.loading=!1}},async updateCustomer(f,i){var o,n;this.loading=!0;try{const u=await w.put(`/api/customers/${f}`,i);return this.error=null,u.data}catch(u){throw this.error=((n=(o=u.response)==null?void 0:o.data)==null?void 0:n.message)||"Error updating customer",u}finally{this.loading=!1}},async deleteCustomer(f){var i,o;this.loading=!0;try{await w.delete(`/api/customers/${f}`),this.customers=this.customers.filter(n=>n.id!==f),this.error=null}catch(n){throw this.error=((o=(i=n.response)==null?void 0:i.data)==null?void 0:o.message)||"Error deleting customer",n}finally{this.loading=!1}}}}),me={class:"px-4 py-4"},ce={class:"flex justify-between items-center mb-4"},pe={class:"rounded-md border"},fe={key:0,class:"text-center py-4 text-gray-500"},ve={key:1,class:"text-center py-4 text-gray-500"},_e={class:"flex justify-end mt-4 space-x-2"},ge={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},be={class:"bg-white p-6 rounded-lg w-96"},ye={class:"flex justify-end gap-2 pt-2"},he={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Ce={class:"bg-white p-6 rounded-lg w-96"},we={class:"flex justify-end gap-2 pt-2"},h=10,Ae=K({__name:"Index",setup(f){const i=oe(),o=ue(),{customers:n,currentPage:u,lastPage:b,loading:c}=O(o),P=U(""),$=U(!1),S=U(!1),Y=[{title:"Customer",href:"/Customers"}],l=U({id:0,name:"",phone_number:"",address:"",credit_limit:0,is_active:"Y"}),A=()=>{l.value={id:0,name:"",phone_number:"",address:"",credit_limit:0,is_active:"Y"}};Q(()=>{o.fetchCustomers(u.value,h)});const B=X.debounce(async()=>{await o.fetchCustomers(1,h,P.value)},500),N=async p=>{p<1||p>b.value||await o.fetchCustomers(p,h,P.value)},D=()=>N(u.value+1),L=()=>N(u.value-1),R=()=>{A(),$.value=!0},H=p=>{l.value={...p},S.value=!0},W=async()=>{var p,e;try{const{...s}=l.value;await o.createCustomer(s),i.success("Customer created"),A(),$.value=!1,await o.fetchCustomers(u.value,h)}catch(s){console.error(s),i.error(((e=(p=s.response)==null?void 0:p.data)==null?void 0:e.message)||"Failed to create customer")}},Z=async()=>{var p,e;try{if(!l.value.id)throw new Error("Customer ID is required for update");await o.updateCustomer(l.value.id,{name:l.value.name,phone_number:l.value.phone_number,address:l.value.address,credit_limit:l.value.credit_limit,is_active:l.value.is_active}),i.success("Customer updated"),S.value=!1,await o.fetchCustomers(u.value,h)}catch(s){console.error(s),i.error(((e=(p=s.response)==null?void 0:p.data)==null?void 0:e.message)||"Failed to update customer")}},G=async p=>{var e,s;if(confirm("Are you sure you want to delete this customer?"))try{await o.deleteCustomer(p),i.success("Customer deleted"),await o.fetchCustomers(u.value,h)}catch(C){console.error(C),i.error(((s=(e=C.response)==null?void 0:e.data)==null?void 0:s.message)||"Failed to delete customer")}};return(p,e)=>(_(),y(q,null,[a(t(ee),{title:"Customer Management"}),a(se,{breadcrumbs:Y},{default:r(()=>[d("div",me,[d("div",ce,[a(t(v),{onClick:R,disabled:t(c),class:"bg-indigo-600 text-white py-2 h-10 rounded-md hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:r(()=>[a(t(ne),{class:"h-4 w-4 mr-1"}),e[13]||(e[13]=m(" Tambah "))]),_:1,__:[13]},8,["disabled"]),a(t(g),{modelValue:P.value,"onUpdate:modelValue":e[0]||(e[0]=s=>P.value=s),placeholder:"Search customer name",class:"w-64",onInput:t(B),disabled:t(c)},null,8,["modelValue","onInput","disabled"])]),d("div",pe,[a(t(ae),null,{default:r(()=>[a(t(le),null,{default:r(()=>[a(t(F),{class:"bg-gray-100"},{default:r(()=>[a(t(x),null,{default:r(()=>e[14]||(e[14]=[m("Name")])),_:1,__:[14]}),a(t(x),null,{default:r(()=>e[15]||(e[15]=[m("Phone")])),_:1,__:[15]}),a(t(x),null,{default:r(()=>e[16]||(e[16]=[m("Address")])),_:1,__:[16]}),a(t(x),null,{default:r(()=>e[17]||(e[17]=[m("Status")])),_:1,__:[17]}),a(t(x),{class:"w-24"},{default:r(()=>e[18]||(e[18]=[m("Actions")])),_:1,__:[18]})]),_:1})]),_:1}),a(t(re),null,{default:r(()=>[(_(!0),y(q,null,M(t(n),s=>(_(),j(t(F),{key:s.id},{default:r(()=>[a(t(k),null,{default:r(()=>[m(V(s.name),1)]),_:2},1024),a(t(k),null,{default:r(()=>[m(V(s.phone_number),1)]),_:2},1024),a(t(k),null,{default:r(()=>[m(V(s.address),1)]),_:2},1024),a(t(k),null,{default:r(()=>[d("span",{class:te(s.is_active==="Y"?"text-green-600":"text-red-500")},V(s.is_active==="Y"?"Active":"Inactive"),3)]),_:2},1024),a(t(k),{class:"flex gap-2"},{default:r(()=>[a(t(v),{variant:"ghost",size:"icon",onClick:C=>H(s)},{default:r(()=>[a(t(ie),{class:"h-4 w-4"})]),_:2},1032,["onClick"]),a(t(v),{variant:"ghost",size:"icon",onClick:C=>G(s.id),disabled:t(c)},{default:r(()=>[a(t(de),{class:"h-4 w-4"})]),_:2},1032,["onClick","disabled"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),t(c)?(_(),y("div",fe,"Loading...")):E("",!0),!t(c)&&t(n).length===0?(_(),y("div",ve,"No customers found.")):E("",!0)]),d("div",_e,[a(t(v),{variant:"outline",onClick:L,disabled:t(u)===1||t(c)},{default:r(()=>e[19]||(e[19]=[m("Previous")])),_:1,__:[19]},8,["disabled"]),(_(!0),y(q,null,M(t(b),s=>(_(),j(t(v),{key:s,onClick:C=>N(s),variant:s===t(u)?"default":"outline",disabled:t(c)},{default:r(()=>[m(V(s),1)]),_:2},1032,["onClick","variant","disabled"]))),128)),a(t(v),{variant:"outline",onClick:D,disabled:t(u)===t(b)||t(c)},{default:r(()=>e[20]||(e[20]=[m("Next")])),_:1,__:[20]},8,["disabled"])]),$.value?(_(),y("div",ge,[d("div",be,[e[24]||(e[24]=d("h2",{class:"text-lg font-semibold mb-4"},"Add Customer",-1)),d("form",{onSubmit:I(W,["prevent"]),class:"space-y-3"},[a(t(g),{modelValue:l.value.name,"onUpdate:modelValue":e[1]||(e[1]=s=>l.value.name=s),placeholder:"Name",required:""},null,8,["modelValue"]),a(t(g),{modelValue:l.value.phone_number,"onUpdate:modelValue":e[2]||(e[2]=s=>l.value.phone_number=s),placeholder:"Phone",required:""},null,8,["modelValue"]),a(t(g),{modelValue:l.value.address,"onUpdate:modelValue":e[3]||(e[3]=s=>l.value.address=s),placeholder:"Address",required:""},null,8,["modelValue"]),a(t(g),{modelValue:l.value.credit_limit,"onUpdate:modelValue":e[4]||(e[4]=s=>l.value.credit_limit=s),placeholder:"Credit Limit",type:"number",required:""},null,8,["modelValue"]),T(d("select",{"onUpdate:modelValue":e[5]||(e[5]=s=>l.value.is_active=s),class:"w-full border rounded px-2 py-1"},e[21]||(e[21]=[d("option",{value:"Y"},"Active",-1),d("option",{value:"N"},"Inactive",-1)]),512),[[z,l.value.is_active]]),d("div",ye,[a(t(v),{type:"button",variant:"outline",onClick:e[6]||(e[6]=s=>$.value=!1),class:"h-10"},{default:r(()=>e[22]||(e[22]=[m("Cancel")])),_:1,__:[22]}),a(t(v),{type:"submit",disabled:t(c)},{default:r(()=>e[23]||(e[23]=[m("Create")])),_:1,__:[23]},8,["disabled"])])],32)])])):E("",!0),S.value?(_(),y("div",he,[d("div",Ce,[e[28]||(e[28]=d("h2",{class:"text-lg font-semibold mb-4"},"Edit Customer",-1)),d("form",{onSubmit:I(Z,["prevent"]),class:"space-y-3"},[a(t(g),{modelValue:l.value.name,"onUpdate:modelValue":e[7]||(e[7]=s=>l.value.name=s),placeholder:"Name",required:""},null,8,["modelValue"]),a(t(g),{modelValue:l.value.phone_number,"onUpdate:modelValue":e[8]||(e[8]=s=>l.value.phone_number=s),placeholder:"Phone",required:""},null,8,["modelValue"]),a(t(g),{modelValue:l.value.address,"onUpdate:modelValue":e[9]||(e[9]=s=>l.value.address=s),placeholder:"Address",required:""},null,8,["modelValue"]),a(t(g),{modelValue:l.value.credit_limit,"onUpdate:modelValue":e[10]||(e[10]=s=>l.value.credit_limit=s),placeholder:"Credit Limit",type:"number",required:""},null,8,["modelValue"]),T(d("select",{"onUpdate:modelValue":e[11]||(e[11]=s=>l.value.is_active=s),class:"w-full border rounded px-2 py-1"},e[25]||(e[25]=[d("option",{value:"Y"},"Active",-1),d("option",{value:"N"},"Inactive",-1)]),512),[[z,l.value.is_active]]),d("div",we,[a(t(v),{type:"button",variant:"outline",onClick:e[12]||(e[12]=s=>S.value=!1),class:"h-10"},{default:r(()=>e[26]||(e[26]=[m("Cancel")])),_:1,__:[26]}),a(t(v),{type:"submit",disabled:t(c)},{default:r(()=>e[27]||(e[27]=[m("Update")])),_:1,__:[27]},8,["disabled"])])],32)])])):E("",!0)])]),_:1})],64))}});export{Ae as default};
