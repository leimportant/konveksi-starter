import{U as Y,b as R,d as ee,r as b,T as te,q as se,o as ae,c as le,f as v,g as f,p as r,u as o,Z as oe,x as u,k as n,C as N,D as p,y as h,F as x,B as A,E as ie,j as k,l as ne,S as re,R as de,n as ce}from"./app-DwD40pha.js";import{_ as ue}from"./Input.vue_vue_type_script_setup_true_lang-BTbx_jFa.js";import{_ as fe,a as ve,b as z,c as G,d as me,e as V}from"./TableRow.vue_vue_type_script_setup_true_lang-CfA40aCL.js";import{u as he}from"./useToast-kXqWmEvq.js";import{j as _e,_ as pe}from"./AppLayout.vue_vue_type_script_setup_true_lang-Dqw9mkBO.js";import{u as ge}from"./useActivityGroupStore-fyNxZAaF.js";import{P as E}from"./plus-__n5aCyv.js";import{T as ye}from"./trash-2-V7C6kpaQ.js";import"./index-CCvz1xt-.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-B0XSFyw3.js";const be=Y("role",{state:()=>({items:[],loaded:!1}),actions:{async fetchRoles(_=!1){if(!(this.loaded&&!_))try{const d=await R.get("/api/roles");this.items=d.data.data,this.loaded=!0}catch(d){console.error("Failed to fetch Roles",d)}},async createRole(_){try{await R.post("/api/roles",{name:_}),await this.fetchRoles()}catch(d){throw d}},async updateRole(_,d){try{await R.put(`/api/roles/${_}`,{name:d}),await this.fetchRoles()}catch(g){throw g}},async deleteRole(_){try{await R.delete(`/api/roles/${_}`),await this.fetchRoles()}catch(d){throw d}},async assignMenusToRole(_,d){try{await R.post("/api/roles/assign-menus",{role_id:_,menus:d})}catch(g){throw g}}}}),ke={class:"px-4 py-4"},we={class:"mb-2 flex items-center justify-between gap-2"},xe={class:"rounded-md border"},Ce=["onClick"],Re=["title"],Ae={key:1,class:"text-sm italic text-gray-400"},$e={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},Me={class:"w-96 rounded-lg bg-white p-6"},Se={class:"mb-4 text-lg font-semibold"},Te={class:"mb-4 max-h-60 overflow-y-auto"},Ne=["id","value"],je=["for"],Ge={class:"flex justify-end gap-2"},Ve={key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},Fe={class:"w-96 rounded-lg bg-white p-6"},Be={class:"mb-4 text-lg font-semibold"},ze={class:"mb-2 flex items-center border-b pb-2"},Ee=["checked"],De={class:"mb-4 max-h-60 overflow-y-auto"},Ue={class:"flex items-center"},qe=["id","checked","onChange"],Ie=["for"],Pe={key:0,class:"ml-6"},Le=["id","checked","onChange"],Ze=["for"],He={class:"flex justify-end gap-2"},Je={key:2,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},Ke={class:"w-96 rounded-lg bg-white p-6"},Oe={class:"mb-4"},Qe={class:"flex justify-end gap-2"},nt=ee({__name:"Index",setup(_){const d=he(),g=b(!1),$=b(!1),y=b(null),w=b([]),c=b([]),C=te({name:""}),D=[{title:"Role",href:"/roles"}],m=be(),{items:U}=se(m),j=ge(),q=_e(),M=b(!1),F=b([]),S=b([]);ae(()=>{m.fetchRoles()});const I=async()=>{var s,e;if(!y.value)return d.error("No role selected");try{await m.assignMenusToRole(y.value.id,c.value),d.success("Menus assigned successfully"),$.value=!1,m.loaded=!1,await m.fetchRoles(!0)}catch(a){d.error(((e=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:e.message)??"Failed to assign menus")}},P=async s=>{var e;y.value=s,await j.fetchActivity(),F.value=[...j.items],S.value=((e=s.activity_groups)==null?void 0:e.map(a=>String(a.activity_group_id||a.id)))||[],M.value=!0},L=async()=>{var s,e;if(!y.value)return d.error("No role selected");try{await j.assignToRole(y.value.id,S.value),d.success("Activity Groups assigned successfully"),M.value=!1,m.loaded=!1,await ce(),await m.fetchRoles(!0)}catch(a){d.error(((e=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:e.message)??"Failed to assign activity groups")}},Z=async s=>{y.value=s,w.value=await q.fetchAllMenus(s.id),c.value=[],w.value.forEach(e=>{var a;e.checked&&c.value.push(e.id),(a=e.children)==null||a.forEach(i=>{i.checked&&c.value.push(i.id)})}),$.value=!0},H=async()=>{var s,e,a,i;if(!C.name)return d.error("Name is required");try{await m.createRole(C.name),d.success("Role created successfully"),C.reset(),m.loaded=!1,await m.fetchRoles(!0),g.value=!1}catch(t){const l=(i=(a=(e=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:e.errors)==null?void 0:a.name)==null?void 0:i[0];d.error(l||"Failed to create role")}},J=async s=>{var e,a;if(confirm("Are you sure you want to delete this role?"))try{await m.deleteRole(s),d.success("Role deleted successfully"),m.loaded=!1,await m.fetchRoles()}catch(i){d.error(((a=(e=i==null?void 0:i.response)==null?void 0:e.data)==null?void 0:a.message)??"Failed to delete role")}},T=s=>c.value.includes(s),K=(s,e=8)=>s?s.length>e?s.slice(0,e)+"...":s:"",O=s=>{var i;const e=s.id,a=((i=s.children)==null?void 0:i.map(t=>t.id))||[];if(T(e))c.value=c.value.filter(t=>t!==e&&!a.includes(t));else{c.value.push(e);for(const t of a)c.value.includes(t)||c.value.push(t)}},Q=(s,e)=>{var a;if(T(e)){c.value=c.value.filter(l=>l!==e);const i=w.value.find(l=>l.id===s);((a=i==null?void 0:i.children)==null?void 0:a.some(l=>c.value.includes(l.id)))||(c.value=c.value.filter(l=>l!==s))}else c.value.push(e),c.value.includes(s)||c.value.push(s)},W=s=>{if(s.target.checked){const a=w.value.flatMap(i=>{var l;const t=((l=i.children)==null?void 0:l.map(B=>B.id))||[];return[i.id,...t]}).filter(i=>typeof i=="number");c.value=[...new Set(a)]}else c.value=[]},X=le(()=>{const s=w.value.flatMap(e=>{var i;const a=((i=e.children)==null?void 0:i.map(t=>t.id))||[];return[e.id,...a]}).filter(e=>typeof e=="number");return s.length>0&&s.every(e=>c.value.includes(e))});return(s,e)=>(f(),v(x,null,[r(o(oe),{title:"Role Management"}),r(pe,{breadcrumbs:D},{default:u(()=>{var a,i;return[n("div",ke,[n("div",we,[r(o(p),{onClick:e[0]||(e[0]=t=>g.value=!0),class:"h-10 rounded-md bg-indigo-600 py-2 text-white hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:u(()=>[r(o(E),{class:"h-4 w-4"}),e[6]||(e[6]=h(" Tambah Role "))]),_:1,__:[6]})]),n("div",xe,[r(o(fe),null,{default:u(()=>[r(o(ve),null,{default:u(()=>[r(o(z),{class:"bg-gray-100"},{default:u(()=>[r(o(G),null,{default:u(()=>e[7]||(e[7]=[h("Name")])),_:1,__:[7]}),r(o(G),null,{default:u(()=>e[8]||(e[8]=[h("Apparel (Menu)")])),_:1,__:[8]}),r(o(G),{class:"w-24"},{default:u(()=>e[9]||(e[9]=[h("Actions")])),_:1,__:[9]})]),_:1})]),_:1}),r(o(me),null,{default:u(()=>[(f(!0),v(x,null,A(o(U),t=>(f(),ie(o(z),{key:t.id},{default:u(()=>[r(o(V),null,{default:u(()=>[h(k(t.name),1)]),_:2},1024),r(o(V),null,{default:u(()=>[n("div",{class:"flex cursor-pointer flex-wrap gap-1 rounded-md p-2 transition hover:bg-gray-50",onClick:l=>P(t)},[t.activity_groups&&t.activity_groups.length>0?(f(!0),v(x,{key:0},A(t.activity_groups,l=>(f(),v("span",{key:l.activity_group_id,class:"rounded-full border border-indigo-200 bg-indigo-50 px-2 py-0.5 text-xs font-medium text-gray-700",title:l.activity_group_id},k(K(l.activity_group_id)),9,Re))),128)):(f(),v("span",Ae,"No activity groups"))],8,Ce)]),_:2},1024),r(o(V),{class:"flex gap-2"},{default:u(()=>[r(o(p),{variant:"ghost",size:"icon",onClick:l=>Z(t)},{default:u(()=>[r(o(E),{class:"h-4 w-4"})]),_:2},1032,["onClick"]),r(o(p),{variant:"ghost",size:"icon",onClick:l=>J(t.id)},{default:u(()=>[r(o(ye),{class:"h-4 w-4"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),M.value?(f(),v("div",$e,[n("div",Me,[n("h2",Se,"Assign Activity Group untuk "+k((a=y.value)==null?void 0:a.name),1),n("div",Te,[(f(!0),v(x,null,A(F.value,t=>(f(),v("div",{key:t.id,class:"mb-2 flex items-center"},[ne(n("input",{type:"checkbox",id:t.id,value:t.id,"onUpdate:modelValue":e[1]||(e[1]=l=>S.value=l),class:"mr-2"},null,8,Ne),[[re,S.value]]),n("label",{for:t.id},k(t.name),9,je)]))),128))]),n("div",Ge,[r(o(p),{variant:"outline",onClick:e[2]||(e[2]=t=>M.value=!1)},{default:u(()=>e[10]||(e[10]=[h(" Cancel ")])),_:1,__:[10]}),r(o(p),{onClick:L},{default:u(()=>e[11]||(e[11]=[h("Save")])),_:1,__:[11]})])])])):N("",!0),$.value?(f(),v("div",Ve,[n("div",Fe,[n("h2",Be,"Assign Menu to "+k((i=y.value)==null?void 0:i.name),1),n("div",ze,[n("input",{type:"checkbox",id:"check-all",checked:X.value,onChange:W,class:"mr-2"},null,40,Ee),e[12]||(e[12]=n("label",{for:"check-all",class:"font-medium"},"Check / Uncheck All",-1))]),n("div",De,[(f(!0),v(x,null,A(w.value,t=>(f(),v("div",{key:t.id,class:"mb-2"},[n("div",Ue,[n("input",{type:"checkbox",id:`menu-${t.id}`,checked:T(t.id),onChange:l=>O(t),class:"mr-2"},null,40,qe),n("label",{for:`menu-${t.id}`},k(t.title),9,Ie)]),t.children&&t.children.length?(f(),v("div",Pe,[(f(!0),v(x,null,A(t.children,l=>(f(),v("div",{key:l.id,class:"mb-1 flex items-center"},[n("input",{type:"checkbox",id:`menu-${l.id}`,checked:T(l.id),onChange:B=>Q(t.id,l.id),class:"mr-2"},null,40,Le),n("label",{for:`menu-${l.id}`},k(l.title),9,Ze)]))),128))])):N("",!0)]))),128))]),n("div",He,[r(o(p),{type:"button",variant:"outline",onClick:e[3]||(e[3]=t=>$.value=!1),class:"h-10"},{default:u(()=>e[13]||(e[13]=[h("Cancel")])),_:1,__:[13]}),r(o(p),{type:"submit",onClick:I},{default:u(()=>e[14]||(e[14]=[h("Assign")])),_:1,__:[14]})])])])):N("",!0),g.value?(f(),v("div",Je,[n("div",Ke,[e[17]||(e[17]=n("h2",{class:"mb-4 text-lg font-semibold"},"Tambah Role Baru",-1)),n("form",{onSubmit:de(H,["prevent"])},[n("div",Oe,[r(o(ue),{modelValue:o(C).name,"onUpdate:modelValue":e[4]||(e[4]=t=>o(C).name=t),placeholder:"Role Name",required:""},null,8,["modelValue"])]),n("div",Qe,[r(o(p),{type:"button",variant:"outline",onClick:e[5]||(e[5]=t=>g.value=!1),class:"h-10"},{default:u(()=>e[15]||(e[15]=[h("Cancel")])),_:1,__:[15]}),r(o(p),{type:"submit",class:"h-10 rounded-md bg-indigo-600 py-2 text-white hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:u(()=>e[16]||(e[16]=[h("Create")])),_:1,__:[16]})])],32)])])):N("",!0)])]}),_:1})],64))}});export{nt as default};
