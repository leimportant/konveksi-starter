import{d as P,r as c,o as V,f as l,g as n,k as s,C as y,P as N,y as $,j as I,F as z,B as L,p as S,u as U,R,b as x}from"./app-C_ERrFFf.js";import{u}from"./useToast-V99G7AaL.js";import{T as W}from"./trash-K0J-AwXu.js";const E={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6"},H={class:"flex flex-col sm:flex-row items-start sm:items-center gap-2"},J={key:0,class:"w-full bg-gray-200 rounded-full h-2.5 mb-4"},Y={class:"mt-8"},q={key:0,class:"text-center text-gray-500 py-4"},A={key:1,class:"text-center text-red-500"},K={key:2,class:"text-center text-gray-500"},O={key:3,class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"},Q=["src","alt","onClick"],X=["src"],Z={class:"text-xs text-gray-600 truncate"},ee=["onClick"],te=["src"],le=P({__name:"DocumentList",props:{referenceId:{},referenceType:{}},setup(M,{expose:T}){const d=M,o=c([]),g=c(!0),f=c(null),m=c(null),i=c(0),b=c(!1),w=async()=>{try{g.value=!0;const e=await x.get("/api/document-attachments",{params:{reference_id:d.referenceId,reference_type:d.referenceType}});o.value=e.data.data}catch(e){f.value=e.message||"Gagal memuat media"}finally{g.value=!1}},j=async e=>{var k,_,C;const a=e.target,t=(k=a.files)==null?void 0:k[0];if(!t)return;if(!d.referenceId){u().error("ID Referensi tidak tersedia. Silakan pilih data yang benar.");return}if(t.size>100*1024*1024){u().error("Ukuran file terlalu besar. Maksimal 100MB.");return}const r=new FormData;r.append("file",t),r.append("reference_id",String(d.referenceId)),r.append("reference_type",d.referenceType),r.append("remark",""),b.value=!0,i.value=0;try{const h=await x.post("/api/document-attachments/upload",r,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:v=>{v.total&&(i.value=Math.round(v.loaded/v.total*100))}});o.value.push(h.data),u().success("Media berhasil diunggah.")}catch(h){u().error(((C=(_=h.response)==null?void 0:_.data)==null?void 0:C.message)||"Gagal mengunggah media.")}finally{b.value=!1,i.value=0,a.value=""}},B=async e=>{var a,t;if(confirm("Yakin ingin menghapus media ini?"))try{await x.delete(`/api/document-attachments/${e}`),o.value=o.value.filter(r=>r.id!==e),u().success("Media berhasil dihapus.")}catch(r){u().error(((t=(a=r.response)==null?void 0:a.data)==null?void 0:t.message)||"Gagal menghapus media.")}},p=e=>e?e.startsWith("storage/")?"/"+e:e.startsWith("/storage/")?e:"/storage/"+e:"",D=e=>["jpg","jpeg","png","gif","webp"].includes(e.toLowerCase()),F=e=>["mp4","webm","ogg"].includes(e.toLowerCase()),G=e=>m.value=e;return V(w),T({fetchDocuments:w}),(e,a)=>(n(),l("div",null,[s("div",E,[a[2]||(a[2]=s("div",null,[s("span",{class:"text-sm text-gray-500"},"Format yang didukung: JPG, PNG, GIF, MP4")],-1)),s("div",H,[s("input",{type:"file",accept:"image/*,video/*",onChange:j,ref:"fileInput",class:"block text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"},null,544)])]),i.value>0&&i.value<100?(n(),l("div",J,[s("div",{class:"bg-blue-600 h-2.5 rounded-full",style:N({width:i.value+"%"})},null,4)])):y("",!0),s("div",Y,[g.value?(n(),l("div",q,a[3]||(a[3]=[s("svg",{class:"animate-spin h-5 w-5 text-gray-500 mx-auto mb-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})],-1),$(" Memuat media... ")]))):f.value?(n(),l("div",A,"Terjadi kesalahan: "+I(f.value),1)):o.value.length===0?(n(),l("div",K,"Belum ada media yang diunggah.")):(n(),l("ul",O,[(n(!0),l(z,null,L(o.value,t=>(n(),l("li",{key:t.id,class:"relative border rounded-md p-3 flex flex-col gap-2 bg-white shadow hover:shadow-lg transition"},[D(t.extension)?(n(),l("img",{key:0,src:p(t.path),alt:t.filename,class:"w-full h-40 object-cover rounded cursor-pointer transition hover:scale-105",onClick:r=>G(p(t.path))},null,8,Q)):F(t.extension)?(n(),l("video",{key:1,src:p(t.path),controls:"",class:"w-full h-40 object-cover rounded"},null,8,X)):y("",!0),s("div",Z,I(t.filename),1),s("button",{onClick:r=>B(t.id),class:"absolute top-2 right-2 bg-red-500 hover:bg-red-600 text-white text-sm p-1 rounded-full shadow transition duration-200","aria-label":"Hapus"},[S(U(W),{class:"w-5 h-5"})],8,ee)]))),128))])),m.value?(n(),l("div",{key:4,class:"fixed inset-0 bg-black bg-opacity-80 flex flex-col items-center justify-center z-50 p-4",onClick:a[1]||(a[1]=R(t=>m.value=null,["self"]))},[s("img",{src:m.value,class:"max-h-[80vh] max-w-[90vw] rounded shadow-lg"},null,8,te),s("button",{onClick:a[0]||(a[0]=t=>m.value=null),class:"mt-4 px-4 py-2 bg-white text-black rounded shadow hover:bg-gray-200"}," Tutup ")])):y("",!0)])]))}});export{le as _};
