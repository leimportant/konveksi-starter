import{d as Q,r as N,T as X,q as Y,c as ee,o as te,b as z,f as c,g as u,p as o,u as t,Z as se,x as r,k as a,C as g,D as h,y as m,V as le,F as U,B as C,E as T,z as v,j as p,l as k,m as F,W as R,S as ae}from"./app-Di3VD2wF.js";import{_ as oe}from"./AppLayout.vue_vue_type_script_setup_true_lang-YamAR-Dq.js";import{_ as re}from"./Input.vue_vue_type_script_setup_true_lang-YgRub-mj.js";import{_ as ne,a as ie,b as A,c as _,d as de,e as x}from"./TableRow.vue_vue_type_script_setup_true_lang-sJPd0PKL.js";import{u as ue}from"./useToast-CJi-_njE.js";import{u as me}from"./useUserStore-gAXz-0mJ.js";import{P as ce}from"./plus-Dq8C2eKT.js";import{P as pe}from"./pen-BPybTX5d.js";import{T as fe}from"./trash-2-DlkDCp_O.js";import"./index-DnLtb5dp.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CVeNkWmG.js";const be={class:"px-4 py-4"},ve={class:"flex justify-between items-center gap-2 mb-2"},_e={class:"overflow-x-auto rounded-md border"},xe={class:"flex flex-wrap justify-end mt-4 gap-2"},ye=["disabled"],ge=["onClick","disabled"],he=["disabled"],ke={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4 min-h-screen"},we={class:"bg-white p-6 rounded-lg w-full max-w-md space-y-4 max-h-[90vh] overflow-y-auto"},Ue={class:"space-y-3"},Ce={key:0,class:"text-red-500 text-xs mt-1"},Ve={key:0,class:"text-red-500 text-xs mt-1"},$e={key:0,class:"text-red-500 text-xs mt-1"},Pe=["value"],Se={key:0,class:"text-red-500 text-xs mt-1"},Ee=["value"],Ne={key:0,class:"text-red-500 text-xs mt-1"},Te={class:"inline-flex items-center text-sm"},Fe={class:"flex justify-end gap-2 pt-2"},Ge=Q({__name:"Index",setup(Be){const b=ue(),y=N(!1),B=N([]),l=X({name:"",email:"",phone_number:"",location_id:null,role:null,active:!0,id:0}),D=[{title:"Users",href:"/users"}],f=me(),{users:M,currentPage:w,lastPage:L,loading:V,filterName:$}=Y(f),P=ee(()=>L.value||1),S=async n=>{n<1||n>P.value||await f.fetchUsers(n)},I=()=>S(w.value+1),q=()=>S(w.value-1),W=async(n,e)=>{const s=e.target;f.setFilter(n,s.value),await f.fetchUsers()},j=N([]),Z=async()=>{try{const n=await z.get("/api/locations");B.value=n.data.data||[]}catch(n){console.error(n),b.error("Failed to fetch locations")}};te(()=>{f.fetchUsers(),G(),Z()});const G=async()=>{try{const n=await z.get("/api/roles");j.value=n.data.data||[]}catch(n){console.error(n),b.error("Failed to fetch roles")}},H=async()=>{var n,e,s,i;try{await f.createUser({name:l.name,email:l.email,phone_number:l.phone_number,location_id:l.location_id,role:l.role,active:l.active}),b.success("User created successfully"),l.reset(),await f.fetchUsers(),y.value=!1}catch(d){const E=((e=(n=d==null?void 0:d.response)==null?void 0:n.data)==null?void 0:e.message)||"Failed to create user";b.error(E),(i=(s=d==null?void 0:d.response)==null?void 0:s.data)!=null&&i.errors&&l.setError(d.response.data.errors)}},J=async n=>{const e=M.value.find(s=>s.id===n);e&&(l.reset(),l.name=e.name,l.email=e.email,l.phone_number=e.phone_number,l.location_id=e.location_id??null,l.role=e.roles&&e.roles.length>0?e.roles[0].id:null,l.active=e.active,l.id=e.id,y.value=!0)},K=async()=>{var n,e,s,i;try{await f.updateUser(l.id,{name:l.name,email:l.email,phone_number:l.phone_number,location_id:l.location_id,role:l.role,active:l.active}),b.success("User updated successfully"),l.reset(),await f.fetchUsers(),y.value=!1}catch(d){const E=((e=(n=d==null?void 0:d.response)==null?void 0:n.data)==null?void 0:e.message)||"Failed to update user";b.error(E),(i=(s=d==null?void 0:d.response)==null?void 0:s.data)!=null&&i.errors&&l.setError(d.response.data.errors)}},O=async n=>{var e,s;if(confirm("Are you sure you want to delete this user?"))try{await f.deleteUser(n),b.success("User deleted successfully"),await f.fetchUsers()}catch(i){b.error(((s=(e=i==null?void 0:i.response)==null?void 0:e.data)==null?void 0:s.message)||"Failed to delete user")}};return(n,e)=>(u(),c(U,null,[o(t(se),{title:"User Management"}),o(oe,{breadcrumbs:D},{default:r(()=>[a("div",be,[a("div",ve,[o(t(h),{onClick:e[0]||(e[0]=s=>y.value=!0),class:"bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500 flex items-center"},{default:r(()=>[o(t(ce),{class:"h-4 w-4 mr-2"}),e[10]||(e[10]=m(" Tambah User "))]),_:1,__:[10]}),o(t(re),{modelValue:t($),"onUpdate:modelValue":e[1]||(e[1]=s=>le($)?$.value=s:null),placeholder:"Search",onInput:e[2]||(e[2]=s=>W("name",s)),class:"w-full sm:w-64","aria-label":"Search"},null,8,["modelValue"])]),a("div",_e,[o(t(ne),{class:"min-w-[800px]"},{default:r(()=>[o(t(ie),null,{default:r(()=>[o(t(A),{class:"bg-gray-100"},{default:r(()=>[o(t(_),null,{default:r(()=>e[11]||(e[11]=[m("Name")])),_:1,__:[11]}),o(t(_),null,{default:r(()=>e[12]||(e[12]=[m("Phone Number")])),_:1,__:[12]}),o(t(_),null,{default:r(()=>e[13]||(e[13]=[m("Location")])),_:1,__:[13]}),o(t(_),null,{default:r(()=>e[14]||(e[14]=[m("Email")])),_:1,__:[14]}),o(t(_),null,{default:r(()=>e[15]||(e[15]=[m("Role")])),_:1,__:[15]}),o(t(_),null,{default:r(()=>e[16]||(e[16]=[m("Status")])),_:1,__:[16]}),o(t(_),{class:"w-24"},{default:r(()=>e[17]||(e[17]=[m("Actions")])),_:1,__:[17]})]),_:1})]),_:1}),o(t(de),null,{default:r(()=>[(u(!0),c(U,null,C(t(M),s=>(u(),T(t(A),{key:s.id},{default:r(()=>[o(t(x),{class:v(s.active?"":"line-through text-red-500")},{default:r(()=>[m(p(s.name),1)]),_:2},1032,["class"]),o(t(x),{class:v(s.active?"":"line-through text-red-500")},{default:r(()=>[m(p(s.phone_number),1)]),_:2},1032,["class"]),o(t(x),{class:v(s.active?"":"line-through text-red-500")},{default:r(()=>{var i;return[m(p(((i=s.location)==null?void 0:i.name)||"-"),1)]}),_:2},1032,["class"]),o(t(x),{class:v(s.active?"":"line-through text-red-500")},{default:r(()=>[m(p(s.email),1)]),_:2},1032,["class"]),o(t(x),{class:v(s.active?"":"line-through text-red-500")},{default:r(()=>{var i,d;return[m(p(((d=(i=s.roles)==null?void 0:i[0])==null?void 0:d.name)||s.employee_status),1)]}),_:2},1032,["class"]),o(t(x),null,{default:r(()=>[a("span",{class:v(s.active?"text-green-600":"text-red-600")},p(s.active?"Active":"Inactive"),3)]),_:2},1024),o(t(x),{class:"flex gap-2"},{default:r(()=>[o(t(h),{variant:"ghost",size:"icon",onClick:i=>J(s.id)},{default:r(()=>[o(t(pe),{class:"h-4 w-4"})]),_:2},1032,["onClick"]),o(t(h),{variant:"ghost",size:"icon",onClick:i=>O(s.id)},{default:r(()=>[o(t(fe),{class:"h-4 w-4"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),a("div",xe,[a("button",{onClick:q,disabled:t(w)===1||t(V),class:"px-3 py-1 rounded border border-gray-300 text-gray-700 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed"}," Previous ",8,ye),(u(!0),c(U,null,C(P.value,s=>(u(),c("button",{key:s,onClick:i=>S(s),class:v(["px-3 py-1 rounded border text-sm",s===t(w)?"bg-blue-600 border-blue-600 text-white":"border-gray-300 text-gray-700 hover:bg-gray-100"]),disabled:t(V)},p(s),11,ge))),128)),a("button",{onClick:I,disabled:t(w)===P.value||t(V),class:"px-3 py-1 rounded border border-gray-300 text-gray-700 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed"}," Next ",8,he)]),y.value?(u(),c("div",ke,[a("div",we,[e[29]||(e[29]=a("h2",{class:"text-lg font-semibold"},"Tambah User Baru",-1)),a("div",Ue,[a("div",null,[e[18]||(e[18]=a("label",{class:"block text-sm mb-1"},"Name",-1)),k(a("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>t(l).name=s),type:"text",class:"w-full border rounded px-3 py-2 text-sm",placeholder:"Enter name"},null,512),[[F,t(l).name]]),t(l).errors.name?(u(),c("p",Ce,p(t(l).errors.name),1)):g("",!0)]),a("div",null,[e[19]||(e[19]=a("label",{class:"block text-sm mb-1"},"Email",-1)),k(a("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>t(l).email=s),type:"email",class:"w-full border rounded px-3 py-2 text-sm",placeholder:"Enter email"},null,512),[[F,t(l).email]]),t(l).errors.email?(u(),c("p",Ve,p(t(l).errors.email),1)):g("",!0)]),a("div",null,[e[20]||(e[20]=a("label",{class:"block text-sm mb-1"},"Phone Number",-1)),k(a("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>t(l).phone_number=s),type:"text",class:"w-full border rounded px-3 py-2 text-sm",placeholder:"Enter phone number"},null,512),[[F,t(l).phone_number]]),t(l).errors.phone_number?(u(),c("p",$e,p(t(l).errors.phone_number),1)):g("",!0)]),a("div",null,[e[22]||(e[22]=a("label",{class:"block text-sm mb-1"},"Location",-1)),k(a("select",{"onUpdate:modelValue":e[6]||(e[6]=s=>t(l).location_id=s),class:"w-full border rounded px-3 py-2 text-sm"},[e[21]||(e[21]=a("option",{value:""},"Select location",-1)),(u(!0),c(U,null,C(B.value,s=>(u(),c("option",{key:s.id,value:s.id},p(s.name),9,Pe))),128))],512),[[R,t(l).location_id]]),t(l).errors.location_id?(u(),c("p",Se,p(t(l).errors.location_id),1)):g("",!0)]),a("div",null,[e[24]||(e[24]=a("label",{class:"block text-sm mb-1"},"Role",-1)),k(a("select",{"onUpdate:modelValue":e[7]||(e[7]=s=>t(l).role=s),class:"w-full border rounded px-3 py-2 text-sm"},[e[23]||(e[23]=a("option",{value:""},"Select role",-1)),(u(!0),c(U,null,C(j.value,s=>(u(),c("option",{key:s.id,value:s.id},p(s.name),9,Ee))),128))],512),[[R,t(l).role]]),t(l).errors.role?(u(),c("p",Ne,p(t(l).errors.role),1)):g("",!0)]),a("div",null,[a("label",Te,[k(a("input",{type:"checkbox","onUpdate:modelValue":e[8]||(e[8]=s=>t(l).active=s),class:"form-checkbox mr-2"},null,512),[[ae,t(l).active]]),e[25]||(e[25]=m(" Active "))])])]),a("div",Fe,[o(t(h),{variant:"outline",onClick:e[9]||(e[9]=s=>y.value=!1),class:"h-10"},{default:r(()=>e[26]||(e[26]=[m("Cancel")])),_:1,__:[26]}),t(l).id?(u(),T(t(h),{key:1,onClick:K},{default:r(()=>e[28]||(e[28]=[m("Update")])),_:1,__:[28]})):(u(),T(t(h),{key:0,onClick:H},{default:r(()=>e[27]||(e[27]=[m("Submit")])),_:1,__:[27]}))])])])):g("",!0)])]),_:1})],64))}});export{Ge as default};
