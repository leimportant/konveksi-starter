import{d as T,f as n,g as r,z as h,A as O,Q as P,r as x,c as R,o as G,w as H,a as J,p as d,u as i,Z as Q,x as _,k as a,F as g,B as b,C as k,j as u,D as U,y as C,E as Z,G as q,n as D}from"./app-CVBAo0jO.js";import{u as W,a as X,b as Y,c as ee,_ as se,g as te}from"./AppLayout.vue_vue_type_script_setup_true_lang-DBdUGih5.js";import{_ as ae}from"./Input.vue_vue_type_script_setup_true_lang-poTMR4WG.js";import"./index-D0JVoBCz.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-Bdp-WMDe.js";const re=T({__name:"ScrollArea",props:{customClass:{}},setup(M){return(v,m)=>(r(),n("div",{class:h(["overflow-y-auto",v.customClass]),ref:"container"},[O(v.$slots,"default")],2))}}),ne={class:"flex h-full flex-col gap-4 p-2"},oe={key:0,class:"bg-gray-40 gap-2 rounded-lg p-4 py-2"},ie={class:"space-y-2"},le=["onClick"],ce={class:"flex items-center justify-between"},de={class:"font-semibold"},ue={key:0,class:"inline-flex h-5 w-5 items-center justify-center rounded-full bg-indigo-600 text-xs font-semibold text-white"},_e={class:"truncate text-sm text-gray-600"},fe={key:1,class:"flex h-[75vh] flex-col overflow-hidden rounded-lg border bg-white"},me={class:"flex items-center justify-between border-b bg-gray-50 p-4"},pe={class:"text-lg font-semibold"},ge={class:"flex-1 overflow-hidden bg-gray-50 p-4"},he={class:"space-y-4"},ve={class:"max-w-[75%] space-y-1"},ye={class:"whitespace-pre-wrap break-words"},we={key:0,class:"mt-1 flex flex-wrap gap-2"},xe={class:"text-xs text-gray-500"},be={class:"border-t bg-white p-4"},ke={class:"flex items-center gap-2"},Se=T({__name:"ChatMessage",props:{orderId:{},currentUserId:{},currentUserName:{},currentUserAvatar:{},receiverId:{}},setup(M){const m=P().props.auth.user,V=m.employee_status=="customer"?"customer":"admin";console.log("user chat"),console.log(m.employee_status);const B=[{title:"Pesan",href:"/messages"}],l=M,c=W(),f=x(""),p=x(null),o=x(l.orderId??null),I=R(()=>!!o.value),$=()=>{p.value&&(p.value.scrollTop=p.value.scrollHeight)},A=async()=>{o.value&&(await c.fetchMessages(o.value),await D(),$())},y=s=>{const t=s.sender_id===m.id;return{container:t?"justify-end":"justify-start",row:t?"flex-row-reverse":"flex-row",bubble:t?"bg-indigo-600 text-white":"border bg-white text-gray-800"}},j=s=>{var t;return s.sender_type==="admin"?"AD":te(((t=s.sender)==null?void 0:t.name)??"User")},E=s=>{const t=new Date(s);return isNaN(t.getTime())&&t.setTime(Date.now()),t.toLocaleString("id-ID",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})},K=s=>{try{return Array.isArray(s)?s:JSON.parse(s||"[]")}catch{return[]}},z=async s=>{await c.markAsRead(s)},N=async()=>{f.value.trim()&&(await c.sendMessage({sender_type:V,receiver_id:l.receiverId,sender_name:l.currentUserName,message:f.value,order_id:o.value,content_data:""}),f.value="",await D(),$())},F=async s=>{o.value=s,await A(),await z(s)},L=()=>{o.value=null};return G(async()=>{l.orderId?(o.value=l.orderId,await A()):await c.fetchConversations()}),H(o,(s,t)=>{s?(c.fetchMessages(s),window.Echo.private(`chat.${s}`).listen("ChatMessageSent",e=>{c.addMessage(e.chatMessage)})):t&&window.Echo.leave(`chat.${t}`)}),J(()=>{o.value&&window.Echo.leave(`chat.${o.value}`)}),(s,t)=>(r(),n(g,null,[d(i(Q),{title:"Pesan Management"}),d(se,{breadcrumbs:B},{default:_(()=>[a("div",ne,[I.value?(r(),n("div",fe,[a("div",me,[a("h2",pe,"Order #"+u(o.value),1),d(i(U),{variant:"ghost",size:"sm",class:"text-indigo-600 hover:bg-indigo-100",onClick:L},{default:_(()=>t[1]||(t[1]=[C("← Kembali")])),_:1,__:[1]})]),a("div",ge,[d(re,{ref_key:"chatContainer",ref:p,class:"h-full pr-4"},{default:_(()=>[a("div",he,[(r(!0),n(g,null,b(i(c).messages,e=>{var w;return r(),n("div",{key:e.id,class:h(["flex",y(e).container])},[a("div",{class:h(["flex max-w-full items-start gap-3",y(e).row])},[d(i(X),{class:"size-10 shrink-0"},{default:_(()=>[e.sender_id===l.currentUserId&&l.currentUserAvatar?(r(),Z(i(Y),{key:0,src:l.currentUserAvatar,alt:e.sender_name},null,8,["src","alt"])):k("",!0),d(i(ee),null,{default:_(()=>[C(u(j(e)),1)]),_:2},1024)]),_:2},1024),a("div",ve,[a("div",{class:h(["rounded-lg p-3 text-sm shadow",y(e).bubble])},[a("p",ye,u(e.message),1)],2),(w=e.content_data)!=null&&w.length?(r(),n("div",we,[(r(!0),n(g,null,b(K(e.content_data),S=>(r(),n("span",{key:S,class:"..."},u(S),1))),128))])):k("",!0),a("div",xe,u(E(e.created_at)),1)])],2)],2)}),128))])]),_:1},512)]),a("div",be,[a("div",ke,[d(i(ae),{modelValue:f.value,"onUpdate:modelValue":t[0]||(t[0]=e=>f.value=e),placeholder:"Ketik pesan...",onKeyup:q(N,["enter"]),class:"flex-1 rounded-md border px-4 py-2 text-sm"},null,8,["modelValue"]),d(i(U),{onClick:N,class:"rounded-md bg-indigo-600 px-4 py-2 text-sm text-white hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-400"},{default:_(()=>t[2]||(t[2]=[C(" Kirim ")])),_:1,__:[2]})])])])):(r(),n("div",oe,[a("ul",ie,[(r(!0),n(g,null,b(i(c).conversations,e=>(r(),n("li",{key:e.order_id,class:"cursor-pointer rounded border p-3 hover:bg-gray-100",onClick:w=>F(e.order_id)},[a("div",ce,[a("div",de,"Order #"+u(e.order_id),1),e.unread_count>0?(r(),n("span",ue,u(e.unread_count),1)):k("",!0)]),a("div",_e,u(e.last_message),1)],8,le))),128))])]))])]),_:1})],64))}});export{Se as default};
