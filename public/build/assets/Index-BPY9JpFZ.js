import{d as U,q as Z,r as y,c as w,o as H,f as i,g as n,p as d,u as o,Z as J,x as _,k as e,D as k,y as j,G as W,F as P,B as F,j as l,E as z,C as B,z as X}from"./app-DVcE8dC8.js";import{_ as Y}from"./Input.vue_vue_type_script_setup_true_lang-D2oHzJVe.js";import{u as tt}from"./useToast-C6n08DS1.js";import{_ as et}from"./AppLayout.vue_vue_type_script_setup_true_lang-DmVi_qmP.js";import{u as st}from"./useProductionStore-D4TdAQOR.js";import{P as at}from"./plus-ExgEdE3O.js";import{S as ot}from"./square-pen-DT4ISDxQ.js";import{T as rt}from"./trash-2-BkJdis34.js";import{V as nt}from"./view-bA6q4miy.js";import"./index-S-BFqM3K.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BchqU6hv.js";const lt={class:"px-3 py-4"},it={class:"mb-4 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},dt={class:"flex flex-1 gap-2"},ct={key:0,class:"py-4 text-center text-sm text-gray-500"},ut={key:1,class:"space-y-2"},pt={class:"overflow-x-auto rounded-md border border-gray-200 dark:border-gray-700"},gt={class:"min-w-full table-auto text-left text-sm text-gray-800 dark:text-gray-100"},yt={class:"whitespace-nowrap px-3 py-2 align-top"},_t={class:"whitespace-nowrap px-3 py-2 align-top"},xt={class:"whitespace-normal px-3 py-2 align-top"},vt={class:"truncate px-3 py-2 align-top"},ht={class:"whitespace-nowrap px-3 py-2 align-top"},ft={key:0,class:"flex flex-col gap-1 rounded-lg border border-gray-200 bg-gray-50 p-1 text-[11px] text-gray-700"},bt={class:"font-semibold"},mt={key:1,class:"text-xs italic text-gray-400"},wt={class:"max-w-[160px] truncate px-3 py-2 align-top"},kt={class:"max-w-[160px] truncate px-3 py-2 align-top"},Pt={class:"px-3 py-2 text-right align-top"},St={class:"flex justify-end gap-1 sm:gap-2"},$t={class:"bg-gray-50 font-semibold dark:bg-gray-800"},Ct={class:"px-3 py-2 text-right"},Tt={class:"px-3 py-2"},Dt={class:"hidden"},Ft={class:"px-3 py-2 text-right"},Vt={class:"mt-4 flex justify-end space-x-2"},It=["disabled"],Nt=["onClick","disabled"],jt=["disabled"],Gt=U({__name:"Index",props:{activity_role:{}},setup(O){const S=tt(),x=st(),{productions:v,currentPage:u,lastPage:q,loading:h}=Z(x),V=y(50),I=y("created_at"),N=y("desc"),f=O,R=[{title:"Production",href:`/production/${f.activity_role}`}],$=w(()=>q.value||1),C=async a=>{var s,t;a<1||a>$.value||(await x.fetchProductions({page:a,per_page:V.value,sort_field:I.value,sort_order:N.value,activity_role_id:f.activity_role,search:b.value,date_from:(s=m.value.from)==null?void 0:s.toISOString(),date_to:(t=m.value.to)==null?void 0:t.toISOString()}),u.value=a)},A=()=>C(u.value+1),K=()=>C(u.value-1),b=y(""),m=y({from:null,to:null});function T(a){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(a)}const D=async(a=1)=>{var s,t,r,p;try{await x.fetchProductions({page:a||u.value,per_page:V.value,sort_field:I.value,sort_order:N.value,activity_role_id:f.activity_role,search:b.value,date_from:(s=m.value.from)==null?void 0:s.toISOString(),date_to:(t=m.value.to)==null?void 0:t.toISOString()})}catch(c){S.error(((p=(r=c==null?void 0:c.response)==null?void 0:r.data)==null?void 0:p.message)??"Failed to fetch productions")}},L=w(()=>v.value.reduce((a,s)=>{const t=String(s.total_price).replace(/[^\d]/g,""),r=parseFloat(t)||0;return a+r},0)),M=w(()=>v.value.reduce((a,s)=>{const t=parseFloat(String(s.price_per_pcs).replace(/[^\d.-]/g,""))||0;return a+t},0)),Q=w(()=>v.value.reduce((a,s)=>{var r;const t=((r=s.items)==null?void 0:r.reduce((p,c)=>p+(parseFloat(String(c.qty))||0),0))||0;return a+t},0));H(D);const E=async a=>{var s,t;if(confirm("Are you sure you want to delete this production?"))try{await x.deleteProduction(a),S.success("Production deleted successfully"),await D(1)}catch(r){S.error(((t=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:t.message)??"Failed to delete production")}};return(a,s)=>(n(),i(P,null,[d(o(J),{title:"Production Management"}),d(et,{breadcrumbs:R},{default:_(()=>[e("div",lt,[e("div",it,[e("div",dt,[d(o(k),{onClick:s[0]||(s[0]=t=>a.$inertia.visit(`/production/${f.activity_role}/create`)),class:"flex flex-shrink-0 items-center gap-2 rounded-md bg-indigo-600 px-3 py-2 text-sm font-medium text-white hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:_(()=>[d(o(at),{class:"h-4 w-4"}),s[3]||(s[3]=j(" Tambah Data "))]),_:1,__:[3]}),d(o(Y),{modelValue:b.value,"onUpdate:modelValue":s[1]||(s[1]=t=>b.value=t),placeholder:"Search...",class:"flex-1 text-sm",onKeyup:s[2]||(s[2]=W(t=>D(1),["enter"]))},null,8,["modelValue"])])]),o(h)?(n(),i("div",ct,"Loading...")):(n(),i("div",ut,[e("div",pt,[e("table",gt,[s[7]||(s[7]=e("thead",{class:"bg-gray-100 text-xs font-semibold uppercase text-gray-600 dark:bg-gray-800 dark:text-gray-300"},[e("tr",null,[e("th",{class:"px-3 py-2"},"Tanggal"),e("th",{class:"px-3 py-2"},"Karyawan"),e("th",{class:"px-3 py-2"},"Model"),e("th",{class:"px-3 py-2"},"Activity"),e("th",{class:"px-3 py-2"},"Size/Qty"),e("th",{class:"px-3 py-2"},"Price/PCS"),e("th",{class:"px-3 py-2"},"Total"),e("th",{class:"px-3 py-2 text-right"},"Actions")])],-1)),e("tbody",null,[(n(!0),i(P,null,F(o(v),t=>{var r,p,c;return n(),i("tr",{key:t.id,class:"border-b border-gray-100 hover:bg-gray-50 dark:border-gray-700 dark:hover:bg-gray-800"},[e("td",yt,l(t.created_at?new Date(t.created_at).toLocaleDateString():"-"),1),e("td",_t,l(t.employee_name||"-"),1),e("td",xt,l(((r=t.model)==null?void 0:r.description)||"-"),1),e("td",vt,l(((p=t.activity_role)==null?void 0:p.name)||"-"),1),e("td",ht,[(c=t.items)!=null&&c.length?(n(),i("div",ft,[(n(!0),i(P,null,F(t.items,(g,G)=>(n(),i("div",{key:G,class:"flex items-center justify-between rounded-md bg-white px-1.5 py-0.5 shadow-sm"},[e("span",null,l(g.size_id)+" - "+l(g.variant),1),s[4]||(s[4]=j()),e("span",bt,l(g.qty),1)]))),128))])):(n(),i("span",mt,"-"))]),e("td",wt,l(T((t==null?void 0:t.price_per_pcs)||0)),1),e("td",kt,l((t==null?void 0:t.total_price)||0),1),e("td",Pt,[e("div",St,[t.status===1||t.status===3?(n(),z(o(k),{key:0,variant:"ghost",size:"icon",class:"hover:bg-gray-100 dark:hover:bg-gray-700",onClick:g=>a.$inertia.visit(`/production/${t.activity_role_id}/edit/${t.id}`)},{default:_(()=>[d(o(ot),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):B("",!0),t.status===1||t.status===3?(n(),z(o(k),{key:1,variant:"ghost",size:"icon",class:"hover:bg-gray-100 dark:hover:bg-gray-700",onClick:g=>E(t.id)},{default:_(()=>[d(o(rt),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):B("",!0),d(o(k),{variant:"ghost",size:"icon",class:"hover:bg-gray-100 dark:hover:bg-gray-700",onClick:g=>a.$inertia.visit(`/production/${t.activity_role_id}/view/${t.id}`)},{default:_(()=>[d(o(nt),{class:"h-4 w-4"})]),_:2},1032,["onClick"])])])])}),128))]),e("tfoot",null,[e("tr",$t,[s[5]||(s[5]=e("td",{colspan:"4",class:"px-3 py-2 text-right"},"Total:",-1)),e("td",Ct,l(Q.value),1),e("td",Tt,[e("div",Dt,l(T(M.value)),1)]),e("td",Ft,l(T(L.value)),1),s[6]||(s[6]=e("td",null,null,-1))])])])]),e("div",Vt,[e("button",{onClick:K,disabled:o(u)===1||o(h),class:"rounded border border-gray-300 px-3 py-1 text-gray-700 hover:bg-gray-100 disabled:cursor-not-allowed disabled:opacity-50"}," Previous ",8,It),(n(!0),i(P,null,F($.value,t=>(n(),i("button",{key:t,onClick:r=>C(t),class:X(["rounded border px-3 py-1 text-sm",t===o(u)?"border-blue-600 bg-blue-600 text-white":"border-gray-300 text-gray-700 hover:bg-gray-100"]),disabled:o(h)},l(t),11,Nt))),128)),e("button",{onClick:A,disabled:o(u)===$.value||o(h),class:"rounded border border-gray-300 px-3 py-1 text-gray-700 hover:bg-gray-100 disabled:cursor-not-allowed disabled:opacity-50"}," Next ",8,jt)])]))])]),_:1})],64))}});export{Gt as default};
