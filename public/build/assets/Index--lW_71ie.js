import{d as X,q as Y,r as p,c as S,o as ee,f as i,g as n,p as c,u as l,Z as te,x as y,k as t,l as q,m as E,D as x,y as $,G as oe,F as f,B as D,j as d,E as M,C as R,z as se}from"./app-Di3VD2wF.js";import{_ as ae}from"./Input.vue_vue_type_script_setup_true_lang-YgRub-mj.js";import{u as re}from"./useToast-CJi-_njE.js";import{_ as le}from"./AppLayout.vue_vue_type_script_setup_true_lang-YamAR-Dq.js";import{u as ne}from"./useProductionStore-CdgbEAs1.js";import{P as ie}from"./plus-Dq8C2eKT.js";import{S as de}from"./square-pen-C71ayQ9p.js";import{T as ce}from"./trash-2-DlkDCp_O.js";import{V as ue}from"./view-Du4WYTet.js";import"./index-DnLtb5dp.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CVeNkWmG.js";const pe={class:"px-3 py-4"},ge={class:"flex flex-col gap-3"},ye={class:"flex flex-col gap-3"},fe={class:"flex flex-col sm:flex-row gap-3"},xe={class:"flex-1 flex flex-col min-w-0"},me={class:"flex-1 flex flex-col min-w-0"},ve={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2"},_e={class:"flex flex-1 gap-2"},be={key:0,class:"py-4 text-center text-sm text-gray-500"},he={key:1,class:"space-y-2"},we={class:"overflow-x-auto rounded-md border border-gray-200 dark:border-gray-700"},ke={class:"min-w-full table-auto text-left text-sm text-gray-800 dark:text-gray-100"},Pe={class:"bg-gray-200 dark:bg-gray-700 font-semibold"},Se={colspan:"8",class:"px-3 py-2"},$e={class:"whitespace-nowrap px-3 py-2 align-top"},De={class:"whitespace-nowrap px-3 py-2 align-top"},Ce={key:0,class:"flex flex-col gap-1 rounded-lg border border-gray-200 bg-gray-50 p-1 text-[11px] text-gray-700"},Te={class:"font-semibold"},Ve={key:1,class:"text-xs italic text-gray-400"},Fe={class:"truncate px-3 py-2 align-top"},Ie={class:"max-w-[80px] truncate px-3 py-2 align-top"},Ne={class:"px-3 py-2 align-top"},je={class:"flex justify-end gap-1 sm:gap-2"},ze={class:"bg-gray-50 font-semibold dark:bg-gray-800"},Be={class:"px-3 py-2 text-right"},Oe={class:"px-3 py-2"},qe={class:"mt-4 flex justify-end space-x-2"},Ee=["disabled"],Me=["onClick","disabled"],Re=["disabled"],Ye=X({__name:"Index",props:{activity_role:{}},setup(U){const C=re(),m=ne(),{productions:T,currentPage:u,lastPage:A,loading:v}=Y(m),_=p(""),b=p(""),I=p(50),N=p("created_at"),j=p("desc"),h=U,L=[{title:"Production",href:`/production/${h.activity_role}`}],V=S(()=>A.value||1),F=async s=>{var e,o;s<1||s>V.value||(await m.fetchProductions({page:s,per_page:I.value,sort_field:N.value,sort_order:j.value,activity_role_id:h.activity_role,search:w.value,date_from:(e=z.value.from)==null?void 0:e.toISOString(),date_to:(o=z.value.to)==null?void 0:o.toISOString()}),u.value=s)},Q=()=>F(u.value+1),K=()=>F(u.value-1),w=p(""),z=p({from:null,to:null});function B(s){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(s)}const k=async(s=1)=>{var e,o;try{await m.fetchProductions({page:s||u.value,per_page:I.value,sort_field:N.value,sort_order:j.value,activity_role_id:h.activity_role,search:w.value,date_from:_.value,date_to:b.value})}catch(r){C.error(((o=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:o.message)??"Failed to fetch productions")}},G=S(()=>{const s={};return T.value.forEach(e=>{var r,a;const o=`${e.employee_name||"Unknown"} - ${((r=e.model)==null?void 0:r.description)||"No Model"}`;s[o]||(s[o]={employee_name:e.employee_name,model_description:(a=e.model)==null?void 0:a.description,items:[]}),s[o].items.push(e)}),s}),Z=S(()=>T.value.reduce((s,e)=>{var r;const o=((r=e.items)==null?void 0:r.reduce((a,P)=>a+(parseFloat(String(P.qty))||0),0))||0;return s+o},0)),H=S(()=>T.value.reduce((s,e)=>{const o=String(e.total_price).replace(/[^\d]/g,""),r=parseFloat(o)||0;return s+r},0));ee(()=>{const s=new Date,e=new Date;e.setDate(s.getDate()-6),_.value=e.toISOString().split("T")[0],b.value=s.toISOString().split("T")[0],k()});const J=async s=>{var e,o;if(confirm("Are you sure you want to delete this production?"))try{await m.deleteProduction(s),C.success("Production deleted successfully"),await k(1)}catch(r){C.error(((o=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:o.message)??"Failed to delete production")}};return(s,e)=>(n(),i(f,null,[c(l(te),{title:"Production Management"}),c(le,{breadcrumbs:L},{default:y(()=>[t("div",pe,[t("div",ge,[t("div",ye,[t("div",fe,[t("div",xe,[e[6]||(e[6]=t("label",{class:"text-xs font-medium text-gray-600 mb-1"},"Start Date",-1)),q(t("input",{type:"date","onUpdate:modelValue":e[0]||(e[0]=o=>_.value=o),class:"w-full max-w-full rounded-md border border-gray-300 px-3 py-1.5 text-sm shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"},null,512),[[E,_.value]])]),t("div",me,[e[7]||(e[7]=t("label",{class:"text-xs font-medium text-gray-600 mb-1"},"End Date",-1)),q(t("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=o=>b.value=o),class:"w-full max-w-full rounded-md border border-gray-300 px-3 py-1.5 text-sm shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"},null,512),[[E,b.value]])])]),t("div",ve,[t("div",_e,[c(l(x),{onClick:e[2]||(e[2]=o=>s.$inertia.visit(`/production/${h.activity_role}/create`)),class:"flex items-center gap-2 rounded-md bg-indigo-600 px-3 py-1.5 text-sm font-medium text-white hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500 flex-shrink-0"},{default:y(()=>[c(l(ie),{class:"h-4 w-4"}),e[8]||(e[8]=$(" Tambah Data "))]),_:1,__:[8]}),c(l(ae),{modelValue:w.value,"onUpdate:modelValue":e[3]||(e[3]=o=>w.value=o),placeholder:"Search...",class:"flex-1 rounded-md border border-gray-300 px-3 py-1.5 text-sm shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 min-w-0",onKeyup:e[4]||(e[4]=oe(o=>k(1),["enter"]))},null,8,["modelValue"]),c(l(x),{onClick:e[5]||(e[5]=o=>k(1)),class:"flex-shrink-0 rounded-md bg-green-600 px-3 py-1.5 text-sm font-medium text-white hover:bg-green-700 focus:ring-2 focus:ring-green-500"},{default:y(()=>e[9]||(e[9]=[$(" Cari ")])),_:1,__:[9]})])])])]),l(v)?(n(),i("div",be,"Loading...")):(n(),i("div",he,[t("div",we,[t("table",ke,[e[14]||(e[14]=t("thead",{class:"bg-gray-100 text-xs font-semibold uppercase text-gray-600 dark:bg-gray-800 dark:text-gray-300"},[t("tr",null,[t("th",{class:"px-3 py-2"},"Tanggal"),t("th",{class:"px-3 py-2"},"Size/Qty"),t("th",{class:"px-3 py-2"},"Price/PCS"),t("th",{class:"px-3 py-2"},"Total"),t("th",{class:"px-3 py-2 text-right"},"Actions")])],-1)),t("tbody",null,[(n(!0),i(f,null,D(G.value,(o,r)=>(n(),i(f,{key:r},[t("tr",Pe,[t("td",Se," ðŸ‘¤ "+d(o.employee_name||"-")+" â€” ðŸ§µ "+d(o.model_description||"-"),1)]),(n(!0),i(f,null,D(o.items,a=>{var P,O;return n(),i("tr",{key:a.id,class:"border-b border-gray-100 hover:bg-gray-50 dark:border-gray-700 dark:hover:bg-gray-800"},[t("td",$e,[$(d(a.created_at?new Date(a.created_at).toLocaleDateString():"-")+" ",1),e[10]||(e[10]=t("br",null,null,-1)),$(" "+d(((P=a.activity_role)==null?void 0:P.name)||"-"),1)]),t("td",De,[(O=a.items)!=null&&O.length?(n(),i("div",Ce,[(n(!0),i(f,null,D(a.items,(g,W)=>(n(),i("div",{key:W,class:"flex items-center justify-between rounded-md bg-white px-1.5 py-0.5 shadow-sm"},[t("span",null,d(g.size_id)+" - "+d(g.variant),1),t("span",Te,d(g.qty),1)]))),128))])):(n(),i("span",Ve,"-"))]),t("td",Fe,d(B((a==null?void 0:a.price_per_pcs)||0)),1),t("td",Ie,d((a==null?void 0:a.total_price)||0),1),t("td",Ne,[t("div",je,[a.status===1||a.status===3?(n(),M(l(x),{key:0,variant:"ghost",size:"icon",class:"hover:bg-gray-100 dark:hover:bg-gray-700",onClick:g=>s.$inertia.visit(`/production/${a.activity_role_id}/edit/${a.id}`)},{default:y(()=>[c(l(de),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):R("",!0),a.status===1||a.status===3?(n(),M(l(x),{key:1,variant:"ghost",size:"icon",class:"hover:bg-gray-100 dark:hover:bg-gray-700",onClick:g=>J(a.id)},{default:y(()=>[c(l(ce),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):R("",!0),c(l(x),{variant:"ghost",size:"icon",class:"hover:bg-gray-100 dark:hover:bg-gray-700",onClick:g=>s.$inertia.visit(`/production/${a.activity_role_id}/view/${a.id}`)},{default:y(()=>[c(l(ue),{class:"h-4 w-4"})]),_:2},1032,["onClick"])])])])}),128))],64))),128))]),t("tfoot",null,[t("tr",ze,[e[11]||(e[11]=t("td",{class:"px-3 py-2 text-right"},null,-1)),t("td",Be,"Total Â :Â  "+d(Z.value),1),e[12]||(e[12]=t("td",{class:"px-3 py-2"},null,-1)),t("td",Oe,d(B(H.value)),1),e[13]||(e[13]=t("td",null,null,-1))])])])]),t("div",qe,[t("button",{onClick:K,disabled:l(u)===1||l(v),class:"rounded border border-gray-300 px-3 py-1 text-gray-700 hover:bg-gray-100 disabled:cursor-not-allowed disabled:opacity-50"}," Previous ",8,Ee),(n(!0),i(f,null,D(V.value,o=>(n(),i("button",{key:o,onClick:r=>F(o),class:se(["rounded border px-3 py-1 text-sm",o===l(u)?"border-blue-600 bg-blue-600 text-white":"border-gray-300 text-gray-700 hover:bg-gray-100"]),disabled:l(v)},d(o),11,Me))),128)),t("button",{onClick:Q,disabled:l(u)===V.value||l(v),class:"rounded border border-gray-300 px-3 py-1 text-gray-700 hover:bg-gray-100 disabled:cursor-not-allowed disabled:opacity-50"}," Next ",8,Re)])]))])]),_:1})],64))}});export{Ye as default};
