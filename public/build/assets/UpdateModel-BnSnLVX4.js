import{d as H,r as p,T as K,o as Q,f as i,g as n,p as d,u as a,Z as Y,x as M,k as o,F as C,B as Z,z as g,j as _,R as G,C as m,D as E,N as z,y as N}from"./app-CDwT_d22.js";import{_ as J}from"./AppLayout.vue_vue_type_script_setup_true_lang-Der2molT.js";import{_ as $}from"./Input.vue_vue_type_script_setup_true_lang-DI3z5g3h.js";import{_ as D}from"./DateInput.vue_vue_type_script_setup_true_lang-CXuxPN2C.js";import{_ as O}from"./DocumentList.vue_vue_type_script_setup_true_lang-BIVHjdkj.js";import{d as R,_ as W,a as X,b as ee,c as te}from"./index-DiZMXLga.js";import{u as ae}from"./useModelStore-uFcljaIA.js";import{u as se}from"./useToast-QNKpNeGN.js";import"./index-BixaK_zC.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-DijOI3sT.js";import"./trash-BuGkwHYr.js";import"./useSizeStore-BR7iZ6mA.js";import"./useProductStore-gLu5eZil.js";import"./useMasterActivityRoleStore-BHTe2KM4.js";import"./useUomStore-Dpvbaewu.js";import"./vue3-select-CZF6Jhom.js";const oe={class:"rounded-xl bg-white p-6 shadow-sm dark:bg-gray-800"},re={class:"my-6 flex space-x-4 border-b dark:border-gray-700"},de=["onClick"],le={key:0,class:"space-y-6"},ie={key:0,class:"text-destructive"},ne={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},me={key:0,class:"text-destructive"},ue={key:0,class:"text-destructive"},pe={key:0,class:"text-destructive"},ce={key:0,class:"text-destructive"},ve={key:1},_e={key:2},fe={key:3,class:"space-y-6"},ye={key:4},ke={key:5},be={class:"flex justify-end gap-2"},ge="Model",Fe=H({__name:"UpdateModel",props:{modelId:{}},setup(T){const x=T,B=p(Number(x.modelId)).value??"",w=["model","size","activity","gambar","bahan dan biaya","hpp"],u=p(w[0]),r=p({}),j=[{title:"Konveksi",href:"/konveksi"},{title:"Edit Model",href:`/konveksi/model/${x.modelId}/edit`}],S=ae(),c=se(),F=l=>l.map(e=>({...e,product_id:typeof e.product_id=="object"?e.product_id.id:e.product_id})),s=K({description:"",remark:"",start_date:null,end_date:null,estimation_price_pcs:0,estimation_qty:1}),h=p([]),f=p([]),U=p(0),v=p([]),y=p([]),q=async()=>{var l,e,t,k,V;try{await S.updateModel(x.modelId,{...s,sizes:f.value,activity:v.value,documents:h.value,modelMaterials:F(y.value)}),c.success("Model berhasil diperbarui"),z.visit("/konveksi/model/list")}catch(b){if(((l=b.response)==null?void 0:l.status)===422&&((t=(e=b.response)==null?void 0:e.data)!=null&&t.errors)){r.value=b.response.data.errors;for(const L in r.value)r.value[L].forEach(P=>{c.error(P)})}else(V=(k=b.response)==null?void 0:k.data)!=null&&V.message?c.error(b.response.data.message):c.error("Terjadi kesalahan saat menyimpan model")}};Q(async()=>{var l,e;try{const t=await S.fetchModelById(x.modelId);console.log("Model Data:",t),t&&(s.description=t.data.description,s.remark=t.data.remark,s.start_date=t.data.start_date?I(t.data.start_date):"",s.end_date=t.data.end_date?I(t.data.end_date):"",s.estimation_price_pcs=t.data.estimation_price_pcs,s.estimation_qty=t.data.estimation_qty,f.value=t.data.sizes||[],v.value=t.data.activities||[],h.value=t.data.documents||[],y.value=t.data.model_material||[])}catch(t){(e=(l=t.response)==null?void 0:l.data)!=null&&e.errors?(r.value=t.response.data.errors,c.error("Validasi gagal, silakan periksa form")):c.error("Terjadi kesalahan saat membuat model")}window.addEventListener("popstate",()=>{R.Inertia.visit(window.location.href,{preserveState:!0})})});const A=l=>{const e=v.value.find(t=>t.activity_role_id===l);return(e==null?void 0:e.activity_name)||`Activity ${l}`};function I(l){const e=new Date(l),t=e.getFullYear(),k=String(e.getMonth()+1).padStart(2,"0"),V=String(e.getDate()).padStart(2,"0");return`${t}-${k}-${V}`}return(l,e)=>(n(),i(C,null,[d(a(Y),{title:"Edit Model"}),d(J,{breadcrumbs:j},{default:M(()=>[o("div",oe,[e[17]||(e[17]=o("div",{class:"border-b pb-4"},[o("h1",{class:"text-2xl font-semibold text-gray-900 dark:text-white"},"Edit Model"),o("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Edit data model, ukuran, dan aktivitas")],-1)),o("div",re,[(n(),i(C,null,Z(w,t=>o("button",{key:t,class:g(["pb-2 text-sm font-medium",{"border-b-2 border-primary text-primary":u.value===t,"text-gray-500 hover:text-gray-700":u.value!==t}]),onClick:k=>u.value=t},_(t.charAt(0).toUpperCase()+t.slice(1)),11,de)),64))]),o("form",{onSubmit:G(q,["prevent"]),class:"space-y-6"},[u.value==="model"?(n(),i("div",le,[o("div",null,[e[10]||(e[10]=o("label",{for:"description",class:"text-sm font-medium"},"Nama Model",-1)),d(a($),{id:"description",modelValue:a(s).description,"onUpdate:modelValue":e[0]||(e[0]=t=>a(s).description=t),placeholder:""},null,8,["modelValue"]),r.value.description?(n(),i("small",ie,_(r.value.description[0]),1)):m("",!0)]),o("div",ne,[o("div",null,[e[11]||(e[11]=o("label",{for:"start_date",class:"text-sm font-medium"},"Tanggal Mulai",-1)),d(a(D),{modelValue:a(s).start_date,"onUpdate:modelValue":e[1]||(e[1]=t=>a(s).start_date=t),id:"start_date",class:g({"border-destructive":r.value.start_date})},null,8,["modelValue","class"]),r.value.start_date?(n(),i("small",me,_(r.value.start_date[0]),1)):m("",!0)]),o("div",null,[e[12]||(e[12]=o("label",{for:"end_date",class:"text-sm font-medium"},"Estimasi Selesai",-1)),d(a(D),{modelValue:a(s).end_date,"onUpdate:modelValue":e[2]||(e[2]=t=>a(s).end_date=t),id:"end_date",class:g({"border-destructive":r.value.end_date})},null,8,["modelValue","class"]),r.value.end_date?(n(),i("small",ue,_(r.value.end_date[0]),1)):m("",!0)]),o("div",null,[e[13]||(e[13]=o("label",{for:"estimation_price_pcs",class:"text-sm font-medium"},"Estimasi Harga",-1)),d(a($),{type:"number",modelValue:a(s).estimation_price_pcs,"onUpdate:modelValue":e[3]||(e[3]=t=>a(s).estimation_price_pcs=t),id:"estimation_price_pcs",class:g({"border-destructive":r.value.estimation_price_pcs})},null,8,["modelValue","class"]),r.value.estimation_price_pcs?(n(),i("small",pe,_(r.value.estimation_price_pcs[0]),1)):m("",!0)])]),o("div",null,[e[14]||(e[14]=o("label",{for:"remark",class:"text-sm font-medium"},"Catatan",-1)),d(a($),{modelValue:a(s).remark,"onUpdate:modelValue":e[4]||(e[4]=t=>a(s).remark=t),id:"remark",placeholder:"",class:g({"border-destructive":r.value.remark})},null,8,["modelValue","class"]),r.value.remark?(n(),i("small",ce,_(r.value.remark[0]),1)):m("",!0)])])):m("",!0),u.value==="size"?(n(),i("div",ve,[d(W,{modelValue:f.value,"onUpdate:modelValue":e[5]||(e[5]=t=>f.value=t),"onUpdate:totalQuantity":e[6]||(e[6]=t=>U.value=t)},null,8,["modelValue"])])):m("",!0),u.value==="activity"?(n(),i("div",_e,[d(X,{modelValue:v.value,"onUpdate:modelValue":e[7]||(e[7]=t=>v.value=t)},null,8,["modelValue"])])):m("",!0),u.value==="gambar"?(n(),i("div",fe,[d(O,{"reference-id":a(B),"reference-type":ge},null,8,["reference-id"])])):m("",!0),u.value==="bahan dan biaya"?(n(),i("div",ye,[d(ee,{modelValue:y.value,"onUpdate:modelValue":e[8]||(e[8]=t=>y.value=t)},null,8,["modelValue"])])):m("",!0),u.value==="hpp"?(n(),i("div",ke,[d(te,{"model-materials":y.value,"activity-items":v.value.map(t=>({...t,activity_name:A(t.activity_role_id)})),"start-date":a(s).start_date,"end-date":a(s).end_date,"total-production":U.value,"size-items":f.value.map(t=>({...t}))},null,8,["model-materials","activity-items","start-date","end-date","total-production","size-items"])])):m("",!0),o("div",be,[d(a(E),{type:"button",variant:"outline",onClick:e[9]||(e[9]=t=>a(z).visit("/konveksi/model/list"))},{default:M(()=>e[15]||(e[15]=[N(" Batal ")])),_:1,__:[15]}),d(a(E),{type:"submit",class:"bg-indigo-600 text-white py-2 h-10 rounded-md hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:M(()=>e[16]||(e[16]=[N("Simpan Perubahan")])),_:1,__:[16]})])],32)])]),_:1})],64))}});export{Fe as default};
