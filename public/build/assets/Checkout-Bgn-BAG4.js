import{d as Z,r as c,c as j,o as W,P as h,b as T,f as n,g as l,p,u as m,Z as ee,x as y,k as t,C as v,y as x,j as i,X as te,D as w,F as V,B as L,l as E,Y as G}from"./app-CxjlAAmy.js";import{u as se}from"./useToast-C62M7Wea.js";import{_ as re}from"./AppLayout.vue_vue_type_script_setup_true_lang-CUqc4D3a.js";import{u as oe}from"./useCartStore-llEsIILW.js";import"./index-CnSYX7tt.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CwHWoZIt.js";const ae={class:"container mx-auto px-4 py-8"},ne={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-gray-600 bg-opacity-75"},le={class:"w-full max-w-md rounded-lg bg-white p-8 text-center shadow-xl"},ie={key:0},de={class:"mb-4 text-lg"},ue={class:"font-semibold"},ce={class:"mb-6 flex justify-center"},pe={key:1,class:"fixed inset-0 flex h-full w-full items-center justify-center overflow-y-auto bg-gray-600 bg-opacity-50"},me={class:"w-full max-w-md rounded-lg bg-white p-4 shadow-xl"},ge={key:0},fe={class:"mb-4 text-center"},be={class:"flex justify-end gap-2"},_e={key:2,class:"grid grid-cols-1 gap-4 lg:grid-cols-3"},ye={class:"mb-8 rounded-2xl bg-white p-8 shadow-xl lg:col-span-2"},ve={key:0,class:"mb-4 mt-2 text-sm font-medium text-green-600"},xe={class:"flex items-center space-x-4"},ke=["src"],he={class:"flex-1"},we={class:"text-sm text-gray-900"},Ce={class:"text-xs text-gray-600"},Pe={class:"text-xs text-gray-600"},De={class:"text-sm font-bold text-gray-900"},je={key:0,class:"text-sm text-gray-500 line-through"},Ie={class:"mt-4 space-y-4 border-gray-300 pt-6"},Be={class:"flex items-center justify-between text-sm font-semibold text-gray-800"},Me={class:"flex items-center justify-between text-sm font-semibold text-gray-800"},Te={class:"flex items-center justify-between border-t border-gray-200 pt-4 text-sm font-bold text-gray-900"},Se={class:"rounded-2xl bg-white p-2 shadow-xl lg:col-span-1"},qe={class:"space-y-4"},Ae={class:"flex cursor-pointer items-center rounded-sm border border-gray-200 p-4 shadow-sm transition-all duration-200 has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 has-[:checked]:ring-2 has-[:checked]:ring-blue-500"},Fe=["innerHTML"],Ne={class:"flex cursor-pointer items-center rounded-sm border border-gray-200 p-4 shadow-sm transition-all duration-200 has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 has-[:checked]:ring-2 has-[:checked]:ring-blue-500"},Ue=["innerHTML"],Ve={class:"mt-8 flex justify-end space-x-4"},$e={key:3,class:"text-center text-gray-600"},Ge=Z({__name:"Checkout",props:{user:Object},setup(O){const Q=O,k=oe(),f=se(),S=c(null),q=c(!1),I=c(null),B=c(null),A=c(!1),u=c(null),F=c(null),N=c(null),C=c(null),$=j(()=>k.cartItems.reduce((r,e)=>{const s=e.quantity||0,d=e.price_sell_grosir&&e.price_sell_grosir>0&&s>1?e.price_sell_grosir:e.price_sell||0;return r+s*d},0)),Y=j(()=>U.value.some(r=>(r.price_sell_grosir??0)>0&&r.quantity>1)),z=j(()=>k.cartItems.reduce((r,e)=>{const s=e.quantity||0,d=e.price_sell_grosir&&e.price_sell_grosir>0&&s>1,b=d?e.price_grosir||0:e.price||0,a=d?e.price_sell_grosir||0:e.price_sell||0,_=b-a;return r+_*s},0)),H=j(()=>$.value-z.value);function P(r){const e=typeof r=="string"?parseFloat(r):r;return!e||e<=0?"-":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:2}).format(e)}const U=j(()=>k.cartItems);W(async()=>{k.cartItems.length===0&&(f.warning("Your cart is empty. Please add items before checking out."),h.visit("/home"));try{const r=await T.get("/api/setting/cod_store");F.value=r.data.message}catch(r){console.error("Error fetching COD store setting:",r),F.value="Could not load COD store information."}try{const r=await T.get("/api/setting/bank_transfer");N.value=r.data.message}catch(r){console.error("Error fetching bank transfer setting:",r),N.value="Could not load bank transfer information."}});const J=async()=>{var r,e,s,d,b;if(!u.value){f.error("Silahkan pilih metode pembayaran.");return}if(confirm("Apakah anda yakin ingin proses?"))try{const a={customer_id:(r=Q.user)==null?void 0:r.customer_id,items:k.cartItems.filter(o=>{var g;return(g=o.product)==null?void 0:g.id}).map(o=>{var g,M;return{product_id:o.product.id,quantity:o.quantity,price:o.price??0,price_sell:o.price_sell??0,size_id:o.size_id??((g=o.product)==null?void 0:g.size_id)??"",uom_id:o.uom_id??((M=o.product)==null?void 0:M.uom_id)??"PCS",discount:o.discount??0,price_grosir:o.price_grosir??0,price_sell_grosir:o.price_sell_grosir??0,discount_grosir:o.discount_grosir??0}}),payment_method:u.value,total_amount:H.value};u.value!=="bank_transfer"&&C.value&&(a.payment_proof=C.value);const _=new FormData;for(const o in a)a[o]!==null&&(o==="items"?a.items.forEach((g,M)=>{for(const R in g)_.append(`items[${M}][${R}]`,g[R])}):_.append(o,a[o]));const D=await T.post("/api/orders",_,{headers:{"Content-Type":"multipart/form-data"}});f.success("Berhasil!"),k.clearCart(),u.value==="cod_store"?(I.value=D.data.order.id,q.value=!0):u.value==="bank_transfer"?(B.value=D.data.order.id,A.value=!0,S.value=D.data.bank_account_info):h.visit("/order-history")}catch(a){const _=((s=(e=a==null?void 0:a.response)==null?void 0:e.data)==null?void 0:s.message)||"Checkout gagal",D=((b=(d=a==null?void 0:a.response)==null?void 0:d.data)==null?void 0:b.error)||"";f.error(`${_}: ${D}`),console.error("Checkout error:",a)}},X=async()=>{if(!C.value||!B.value){f.error("Silahkan pilih bukti transfer dan pastikan order ID tersedia.");return}const r=new FormData;r.append("payment_proof",C.value);try{await T.post(`/api/orders/${B.value}/upload-payment-proof`,r,{headers:{"Content-Type":"multipart/form-data"}}),f.success("Bukti transfer berhasil diunggah!"),A.value=!1,h.visit("/order-history")}catch(e){f.error("Gagal mengunggah bukti transfer."),console.error("Upload payment proof error:",e)}},K=()=>{h.visit("/home")};return(r,e)=>(l(),n(V,null,[p(m(ee),{title:"Checkout Produk"}),p(re,null,{default:y(()=>[t("div",ae,[q.value?(l(),n("div",ne,[t("div",le,[e[8]||(e[8]=t("h2",{class:"mb-4 text-sm font-bold"},"Pesanan Dikonfirmasi!",-1)),I.value?(l(),n("div",ie,[t("p",de,[e[5]||(e[5]=x(" ID Pesanan Anda: ")),t("span",ue,i(I.value),1)]),e[7]||(e[7]=t("p",{class:"text-md mb-6 text-gray-600"},"Silakan tunjukkan QR code ini di toko untuk melakukan pembayaran.",-1)),t("div",ce,[p(te,{value:I.value,size:200,level:"H"},null,8,["value"])]),p(m(w),{onClick:e[0]||(e[0]=s=>m(h).visit("/home"))},{default:y(()=>e[6]||(e[6]=[x("Kembali ke Beranda")])),_:1,__:[6]})])):v("",!0)])])):v("",!0),A.value?(l(),n("div",pe,[t("div",me,[e[11]||(e[11]=t("h2",{class:"mb-4 text-center text-2xl font-bold"},"Pesanan Berhasil!",-1)),e[12]||(e[12]=t("p",{class:"mb-4 text-center"},"Pesanan Anda berhasil dibuat. Silakan transfer total pembayaran ke rekening berikut:",-1)),S.value?(l(),n("div",ge,[(l(!0),n(V,null,L(S.value,s=>(l(),n("div",{key:s.id},[t("p",null,"Bank: "+i(s.id),1),t("p",null,"Atas Name: "+i(s.name),1),t("p",null,"No. Rekening: "+i(s.account_number),1)]))),128))])):v("",!0),t("p",fe,"ID Pesanan: "+i(B.value),1),e[13]||(e[13]=t("label",{for:"paymentProofUpload",class:"mb-2 block text-sm font-medium text-gray-700"},"Unggah Bukti Transfer",-1)),t("input",{type:"file",id:"paymentProofUpload",onChange:e[1]||(e[1]=s=>{var d;return C.value=((d=s.target.files)==null?void 0:d[0])||null}),class:"mb-4 mt-1 block w-full text-sm text-gray-500 file:mr-4 file:rounded-full file:border-0 file:bg-blue-50 file:px-4 file:py-2 file:text-sm file:font-semibold file:text-blue-700 hover:file:bg-blue-100"},null,32),t("div",be,[p(m(w),{onClick:X,class:"rounded-md bg-indigo-600 py-2 text-white hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:y(()=>e[9]||(e[9]=[x("Kirim Bukti Pembayaran")])),_:1,__:[9]}),p(m(w),{onClick:e[2]||(e[2]=s=>m(h).visit("/home")),type:"button",variant:"outline"},{default:y(()=>e[10]||(e[10]=[x("Nanti Saja")])),_:1,__:[10]})])])])):v("",!0),U.value.length>0&&!q.value?(l(),n("div",_e,[t("div",ye,[e[17]||(e[17]=t("h2",{class:"text-l mb-6 text-gray-800"},"Rincian Pesanan",-1)),Y.value?(l(),n("div",ve," ðŸŽ‰ Hore, selamat Anda mendapatkan promo harga grosir dengan pembelian lebih dari satu! ")):v("",!0),(l(!0),n(V,null,L(U.value,s=>{var d,b,a;return l(),n("div",{key:(d=s.product)==null?void 0:d.id,class:"mb-6 flex items-center justify-between border-b border-gray-200 pb-4 last:mb-0 last:border-b-0"},[t("div",xe,[(b=s.product)!=null&&b.image?(l(),n("img",{key:0,src:s.product.image,alt:"Gambar Produk",class:"h-14 w-14 rounded-lg object-cover shadow-md"},null,8,ke)):v("",!0),t("div",he,[t("p",we,i(((a=s.product)==null?void 0:a.name)??"Produk Tidak Dikenal"),1),t("p",Ce,"Jumlah: "+i(s.quantity),1),t("p",Pe,"Ukuran: "+i(s.size_id)+" - "+i(s.uom_id),1)])]),t("div",null,[t("p",De,i(P(s.quantity>1&&(s.price_sell_grosir??0)>0?s.price_sell_grosir??0:s.price_sell??0)),1),s.quantity>1&&(s.price_sell_grosir??0)>0&&(s.price??0)>0||(s.price_sell??0)<(s.price??0)?(l(),n("p",je,i(P(s.price??0)),1)):v("",!0)])])}),128)),t("div",Ie,[t("div",Be,[e[14]||(e[14]=t("span",null,"Subtotal:",-1)),t("span",null,i(P($.value)),1)]),t("div",Me,[e[15]||(e[15]=t("span",null,"Diskon:",-1)),t("span",null,"- "+i(P(z.value)),1)]),t("div",Te,[e[16]||(e[16]=t("span",null,"Total:",-1)),t("span",null,i(P(H.value)),1)])])]),t("div",Se,[e[22]||(e[22]=t("h2",{class:"mb-6 text-sm font-bold text-gray-800"},"Metode Pembayaran",-1)),t("div",qe,[t("label",Ae,[E(t("input",{type:"radio",name:"paymentMethod",value:"cod_store","onUpdate:modelValue":e[3]||(e[3]=s=>u.value=s),class:"form-radio h-5 w-5 text-blue-600"},null,512),[[G,u.value]]),e[18]||(e[18]=t("span",{class:"ml-4 text-sm font-medium text-gray-800"},"Bayar di Toko",-1))]),t("div",{class:"rounded border border-green-600 p-1 text-xs text-black",innerHTML:F.value},null,8,Fe),t("label",Ne,[E(t("input",{type:"radio",name:"paymentMethod",value:"bank_transfer","onUpdate:modelValue":e[4]||(e[4]=s=>u.value=s),class:"form-radio h-5 w-5 text-blue-600"},null,512),[[G,u.value]]),e[19]||(e[19]=t("span",{class:"ml-4 text-sm font-medium text-gray-800"},"Transfer Bank",-1))]),t("div",{class:"rounded border border-green-600 p-1 text-xs text-black",innerHTML:N.value},null,8,Ue),t("div",Ve,[p(m(w),{onClick:K,class:"w-full rounded-md bg-orange-600 py-2 text-white hover:bg-orange-700 focus:ring-2 focus:ring-indigo-500"},{default:y(()=>e[20]||(e[20]=[x("Batal")])),_:1,__:[20]}),p(m(w),{onClick:J,class:"w-full rounded-md bg-indigo-600 py-2 text-white hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:y(()=>e[21]||(e[21]=[x("Proses")])),_:1,__:[21]})])])])])):(l(),n("div",$e,[e[24]||(e[24]=t("p",null,"Keranjang Anda kosong. Silakan tambahkan produk terlebih dahulu sebelum checkout.",-1)),p(m(w),{class:"mt-4",onClick:K},{default:y(()=>e[23]||(e[23]=[x("Kembali ke Keranjang")])),_:1,__:[23]})]))])]),_:1})],64))}});export{Ge as default};
