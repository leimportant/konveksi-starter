import{d as H,q as I,Q as J,r as w,aS as j,c as E,o as Q,f as y,g as c,p as o,u as a,Z as W,x as r,k as t,l as k,m as C,G as Y,D as _,y as d,F as x,B as T,E as P,C as U,j as u,am as Z,z as X,M as ee}from"./app-DR4Jy6yW.js";import{_ as te,a as ae,b as S,c as F,d as se,e as K}from"./TableRow.vue_vue_type_script_setup_true_lang-rDRD19s5.js";import{u as oe}from"./useToast-y1na9xm2.js";import{_ as ne}from"./AppLayout.vue_vue_type_script_setup_true_lang-Dd5xIQr2.js";import{u as re}from"./useKasbonStore-CqUqNNpC.js";import{S as le}from"./search-CyXDEp-K.js";import{P as ie}from"./plus-BPXDVYkz.js";import{C as ue}from"./credit-card-foAJ56TZ.js";import{C as de}from"./circle-check-big-Ds9HLl0R.js";import"./index-Bt7HHK1w.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BgHw7Xn7.js";const me={class:"px-4 py-4"},ce={class:"mb-4 flex flex-col items-center justify-between gap-3 sm:flex-row"},pe={class:"flex w-full items-center gap-3 sm:w-auto"},fe={class:"overflow-x-auto rounded-lg border shadow-sm"},be={class:"flex w-full items-center justify-between"},ge={class:"flex items-center gap-1"},ye={class:"text-md mt-1 uppercase text-gray-800"},_e={class:"mt-1 text-xs text-gray-500"},xe={class:"mt-4 flex justify-end space-x-2"},ve=["disabled"],he=["disabled"],we={class:"space-y-4"},ke={class:"mt-1 text-sm text-gray-500"},Ce={class:"font-semibold text-gray-700"},Pe={class:"space-y-2"},Se={class:"text-sm text-gray-600"},Ke={class:"font-semibold text-gray-900"},Ne={class:"flex justify-end gap-2 pt-2"},Re=H({__name:"Mutasi",setup(Me){const f=re(),{mutasiList:N,pagination:m,loading:M}=I(f),$=oe(),z=J().props.auth.user,p=w(""),O=[{title:"Mutasi Kasbon",href:"/kasbon/mutasi"}],v=j({search:""}),b=w(!1),i=j({employee_id:0,amount:0,lastSaldoKasbon:0}),D=w(""),B=()=>{var e;const n=typeof p.value=="string"?p.value:((e=p.value)==null?void 0:e.value)??"";f.fetchMutasi(1,50,{search:v.search,status:n})},R=E(()=>{const n={};return N.value.forEach(e=>{const s=e.employee_name||"-";n[s]||(n[s]=[]),n[s].push(e)}),n}),h=E(()=>Math.ceil(m.value.total/m.value.per_page)||1),V=async n=>{n<1||n>h.value||await f.fetchMutasi(n)},q=()=>V(m.value.current_page+1),A=()=>V(m.value.current_page-1),G=(n,e)=>{const s=N.value.find(g=>g.kasbon_id===n);D.value=(s==null?void 0:s.employee_name)||"-",i.employee_id=n,i.amount=e,i.lastSaldoKasbon=e,b.value=!0},L=async()=>{if(!confirm("Yakin ingin melakukan pembayaran kasbon ini?"))return;const n={employee_id:i.employee_id,amount:Number(i.amount),type:"Pembayaran",description:Number(i.amount)===Number(i.lastSaldoKasbon)?"Pelunasan Kasbon":"Pembayaran Kasbon"};try{await f.bayarKasbon(n),$.success("Pembayaran kasbon berhasil!"),b.value=!1}catch(e){$.error(e.message||"Gagal melakukan pembayaran kasbon.")}};return Q(()=>{const e=new Date().toISOString().slice(0,7);p.value=e,f.fetchMutasi()}),(n,e)=>(c(),y(x,null,[o(a(W),{title:"History Mutasi Management"}),o(ne,{breadcrumbs:O},{default:r(()=>[t("div",me,[t("div",ce,[t("div",pe,[k(t("input",{type:"month","onUpdate:modelValue":e[0]||(e[0]=s=>p.value=s),class:"w-full rounded-lg border border-gray-300 bg-white px-2 py-2 text-gray-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:w-auto"},null,512),[[C,p.value]]),k(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>v.search=s),type:"text",placeholder:"Cari data...",onKeyup:Y(B,["enter"]),class:"w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 sm:w-56"},null,544),[[C,v.search]]),o(a(_),{onClick:B,class:"flex items-center gap-1 bg-indigo-600 text-white hover:bg-indigo-700"},{default:r(()=>[o(a(le),{class:"h-4 w-4"}),e[5]||(e[5]=d(" Cari "))]),_:1,__:[5]})])]),t("div",fe,[o(a(te),{class:"min-w-full"},{default:r(()=>[o(a(ae),null,{default:r(()=>[o(a(S),{class:"bg-gray-100"},{default:r(()=>[o(a(F),{class:"px-4 py-2 text-left text-sm font-medium text-gray-700"},{default:r(()=>e[6]||(e[6]=[d("Name")])),_:1,__:[6]}),o(a(F),{class:"px-4 py-2 text-right text-sm font-medium text-gray-700"},{default:r(()=>e[7]||(e[7]=[d("Amount")])),_:1,__:[7]})]),_:1})]),_:1}),o(a(se),null,{default:r(()=>[(c(!0),y(x,null,T(R.value,(s,g)=>(c(),y(x,{key:g},[o(a(S),{class:"border-b bg-gray-50"},{default:r(()=>[o(a(K),{class:"px-4 py-2 font-semibold text-gray-800",colspan:"3"},{default:r(()=>[t("div",be,[t("span",null,u(g),1),a(z).employee_status.toUpperCase()=="OWNER"?(c(),P(a(_),{key:0,onClick:l=>G(s[0].kasbon_id,s[s.length-1].saldo_kasbon),variant:"outline",class:"flex h-7 items-center gap-1 rounded-md border-purple-600 px-2 py-1 text-purple-700 hover:bg-purple-600 hover:text-white"},{default:r(()=>[o(a(ie),{class:"h-4 w-4"}),e[8]||(e[8]=t("span",{class:"text-xs"},"Bayar Kasbon",-1))]),_:2,__:[8]},1032,["onClick"])):U("",!0)])]),_:2},1024)]),_:2},1024),(c(!0),y(x,null,T(s,l=>(c(),P(a(S),{key:l.id,class:"border-b bg-white align-top"},{default:r(()=>[o(a(K),{class:"flex flex-col px-4 py-1 text-sm text-gray-600"},{default:r(()=>[t("div",ge,[l.type==="Kasbon"||l.type==="Pembayaran"?(c(),P(Z(l.type==="Kasbon"?a(ue):a(de)),{key:0,class:"h-4 w-4 text-blue-500"})):U("",!0),t("span",null,u(l.created_at?new Date(l.created_at).toLocaleDateString("id-ID"):"-"),1)]),t("div",ye,u(l.type),1)]),_:2},1024),o(a(K),{class:X(["px-4 py-1 text-right align-top text-sm font-medium",l.type==="Kasbon"?"text-green-600":l.type==="Pembayaran"?"text-red-600":""])},{default:r(()=>[d(u(Number(l.amount||0).toLocaleString())+" ",1),t("div",_e," saldo kasbon: "+u(Number(l.saldo_kasbon||0).toLocaleString()),1)]),_:2},1032,["class"])]),_:2},1024))),128))],64))),128))]),_:1})]),_:1})]),t("div",xe,[t("button",{onClick:A,disabled:a(m).current_page===1||a(M),class:"rounded border px-3 py-1 hover:bg-gray-100 disabled:opacity-50"}," Previous ",8,ve),t("span",null,"Page "+u(a(m).current_page)+" / "+u(h.value),1),t("button",{onClick:q,disabled:a(m).current_page>=h.value||a(M),class:"rounded border px-3 py-1 hover:bg-gray-100 disabled:opacity-50"}," Next ",8,he)])])]),_:1}),o(ee,{show:b.value,onClose:e[4]||(e[4]=s=>b.value=!1),onConfirm:L},{default:r(()=>[t("div",we,[t("div",null,[e[10]||(e[10]=t("h3",{class:"text-lg font-semibold tracking-tight text-gray-900"},"Bayar Kasbon",-1)),t("p",ke,[e[9]||(e[9]=d(" Pembayaran untuk ")),t("span",Ce,u(D.value),1)])]),t("div",Pe,[e[11]||(e[11]=t("label",{for:"amount",class:"block text-sm font-medium text-gray-700"},"Jumlah Pembayaran",-1)),k(t("input",{type:"number",id:"amount","onUpdate:modelValue":e[2]||(e[2]=s=>i.amount=s),class:"block w-full rounded-lg border border-gray-300 bg-gray-50 px-3 py-2 text-sm shadow-sm transition focus:border-purple-500 focus:bg-white focus:ring-2 focus:ring-purple-200"},null,512),[[C,i.amount]])]),t("p",Se,[e[12]||(e[12]=d(" Sisa kasbon: ")),t("span",Ke,u(Number(i.lastSaldoKasbon).toLocaleString()),1)]),t("div",Ne,[o(a(_),{onClick:e[3]||(e[3]=s=>b.value=!1),variant:"outline",class:"h-9 rounded-md border border-gray-300 bg-white px-4 text-sm font-medium text-gray-700 hover:bg-gray-100 hover:text-gray-900"},{default:r(()=>e[13]||(e[13]=[d(" Cancel ")])),_:1,__:[13]}),o(a(_),{onClick:L,class:"h-9 rounded-md bg-purple-600 px-4 text-sm font-medium text-white shadow-sm hover:bg-purple-700 focus:ring-2 focus:ring-purple-500"},{default:r(()=>e[14]||(e[14]=[d(" Save ")])),_:1,__:[14]})])])]),_:1},8,["show"])],64))}});export{Re as default};
