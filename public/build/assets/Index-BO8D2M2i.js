import{d as H,q as J,r as _,c as v,o as W,f as i,g as l,p as c,u as n,Z as X,x as m,k as e,D as P,y as V,G as Y,F as y,B as S,j as d,E as B,C as O,z as tt}from"./app-C_7gepFS.js";import{_ as et}from"./Input.vue_vue_type_script_setup_true_lang-BksqHJ6o.js";import{u as st}from"./useToast-DIFAMESj.js";import{_ as ot}from"./AppLayout.vue_vue_type_script_setup_true_lang-D6NsqNWA.js";import{u as at}from"./useProductionStore-zNVArBfY.js";import{P as rt}from"./plus-MNNZnVAB.js";import{S as nt}from"./square-pen-DQBgJ-FN.js";import{T as lt}from"./trash-2-Cw548T3L.js";import{V as it}from"./view-G_AnNL72.js";import"./index-Dlh229Jd.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-d_IhnATg.js";const dt={class:"px-3 py-4"},ct={class:"mb-4 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},ut={class:"flex flex-1 gap-2"},pt={key:0,class:"py-4 text-center text-sm text-gray-500"},gt={key:1,class:"space-y-2"},yt={class:"overflow-x-auto rounded-md border border-gray-200 dark:border-gray-700"},_t={class:"min-w-full table-auto text-left text-sm text-gray-800 dark:text-gray-100"},vt={class:"bg-gray-200 dark:bg-gray-700 font-semibold"},mt={colspan:"8",class:"px-3 py-2"},xt={class:"whitespace-nowrap px-3 py-2 align-top"},ft={class:"whitespace-nowrap px-3 py-2 align-top"},ht={key:0,class:"flex flex-col gap-1 rounded-lg border border-gray-200 bg-gray-50 p-1 text-[11px] text-gray-700"},bt={class:"font-semibold"},kt={key:1,class:"text-xs italic text-gray-400"},wt={class:"max-w-[160px] truncate px-3 py-2 align-top"},Pt={class:"max-w-[160px] truncate px-3 py-2 align-top"},St={class:"px-3 py-2 text-right align-top"},$t={class:"flex justify-end gap-1 sm:gap-2"},Ct={class:"bg-gray-50 font-semibold dark:bg-gray-800"},Tt={class:"px-3 py-2 text-right"},Dt={class:"px-3 py-2"},Ft={class:"hidden"},Vt={class:"px-3 py-2 text-right"},It={class:"mt-4 flex justify-end space-x-2"},Nt=["disabled"],jt=["onClick","disabled"],zt=["disabled"],Gt=H({__name:"Index",props:{activity_role:{}},setup(q){const $=st(),x=at(),{productions:f,currentPage:p,lastPage:R,loading:h}=J(x),I=_(50),N=_("created_at"),j=_("desc"),b=q,E=[{title:"Production",href:`/production/${b.activity_role}`}],C=v(()=>R.value||1),T=async a=>{var t,s;a<1||a>C.value||(await x.fetchProductions({page:a,per_page:I.value,sort_field:N.value,sort_order:j.value,activity_role_id:b.activity_role,search:k.value,date_from:(t=w.value.from)==null?void 0:t.toISOString(),date_to:(s=w.value.to)==null?void 0:s.toISOString()}),p.value=a)},L=()=>T(p.value+1),M=()=>T(p.value-1),k=_(""),w=_({from:null,to:null});function D(a){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(a)}const F=async(a=1)=>{var t,s,r,o;try{await x.fetchProductions({page:a||p.value,per_page:I.value,sort_field:N.value,sort_order:j.value,activity_role_id:b.activity_role,search:k.value,date_from:(t=w.value.from)==null?void 0:t.toISOString(),date_to:(s=w.value.to)==null?void 0:s.toISOString()})}catch(u){$.error(((o=(r=u==null?void 0:u.response)==null?void 0:r.data)==null?void 0:o.message)??"Failed to fetch productions")}},Q=v(()=>{const a={};return f.value.forEach(t=>{var r,o;const s=`${t.employee_name||"Unknown"} - ${((r=t.model)==null?void 0:r.description)||"No Model"}`;a[s]||(a[s]={employee_name:t.employee_name,model_description:(o=t.model)==null?void 0:o.description,items:[]}),a[s].items.push(t)}),a}),A=v(()=>f.value.reduce((a,t)=>{var r;const s=((r=t.items)==null?void 0:r.reduce((o,u)=>o+(parseFloat(String(u.qty))||0),0))||0;return a+s},0)),K=v(()=>f.value.reduce((a,t)=>{const s=parseFloat(String(t.price_per_pcs).replace(/[^\d.-]/g,""))||0;return a+s},0)),U=v(()=>f.value.reduce((a,t)=>{const s=String(t.total_price).replace(/[^\d]/g,""),r=parseFloat(s)||0;return a+r},0));W(F);const G=async a=>{var t,s;if(confirm("Are you sure you want to delete this production?"))try{await x.deleteProduction(a),$.success("Production deleted successfully"),await F(1)}catch(r){$.error(((s=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:s.message)??"Failed to delete production")}};return(a,t)=>(l(),i(y,null,[c(n(X),{title:"Production Management"}),c(ot,{breadcrumbs:E},{default:m(()=>[e("div",dt,[e("div",ct,[e("div",ut,[c(n(P),{onClick:t[0]||(t[0]=s=>a.$inertia.visit(`/production/${b.activity_role}/create`)),class:"flex flex-shrink-0 items-center gap-2 rounded-md bg-indigo-600 px-3 py-2 text-sm font-medium text-white hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:m(()=>[c(n(rt),{class:"h-4 w-4"}),t[3]||(t[3]=V(" Tambah Data "))]),_:1,__:[3]}),c(n(et),{modelValue:k.value,"onUpdate:modelValue":t[1]||(t[1]=s=>k.value=s),placeholder:"Search...",class:"flex-1 text-sm",onKeyup:t[2]||(t[2]=Y(s=>F(1),["enter"]))},null,8,["modelValue"])])]),n(h)?(l(),i("div",pt,"Loading...")):(l(),i("div",gt,[e("div",yt,[e("table",_t,[t[7]||(t[7]=e("thead",{class:"bg-gray-100 text-xs font-semibold uppercase text-gray-600 dark:bg-gray-800 dark:text-gray-300"},[e("tr",null,[e("th",{class:"px-3 py-2"},"Tanggal"),e("th",{class:"px-3 py-2"},"Size/Qty"),e("th",{class:"px-3 py-2"},"Price/PCS"),e("th",{class:"px-3 py-2"},"Total"),e("th",{class:"px-3 py-2 text-right"},"Actions")])],-1)),e("tbody",null,[(l(!0),i(y,null,S(Q.value,(s,r)=>(l(),i(y,{key:r},[e("tr",vt,[e("td",mt," ðŸ‘¤ "+d(s.employee_name||"-")+" â€” ðŸ§µ "+d(s.model_description||"-"),1)]),(l(!0),i(y,null,S(s.items,o=>{var u,z;return l(),i("tr",{key:o.id,class:"border-b border-gray-100 hover:bg-gray-50 dark:border-gray-700 dark:hover:bg-gray-800"},[e("td",xt,[V(d(o.created_at?new Date(o.created_at).toLocaleDateString():"-")+" ",1),t[4]||(t[4]=e("br",null,null,-1)),V(" "+d(((u=o.activity_role)==null?void 0:u.name)||"-"),1)]),e("td",ft,[(z=o.items)!=null&&z.length?(l(),i("div",ht,[(l(!0),i(y,null,S(o.items,(g,Z)=>(l(),i("div",{key:Z,class:"flex items-center justify-between rounded-md bg-white px-1.5 py-0.5 shadow-sm"},[e("span",null,d(g.size_id)+" - "+d(g.variant),1),e("span",bt,d(g.qty),1)]))),128))])):(l(),i("span",kt,"-"))]),e("td",wt,d(D((o==null?void 0:o.price_per_pcs)||0)),1),e("td",Pt,d((o==null?void 0:o.total_price)||0),1),e("td",St,[e("div",$t,[o.status===1||o.status===3?(l(),B(n(P),{key:0,variant:"ghost",size:"icon",class:"hover:bg-gray-100 dark:hover:bg-gray-700",onClick:g=>a.$inertia.visit(`/production/${o.activity_role_id}/edit/${o.id}`)},{default:m(()=>[c(n(nt),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):O("",!0),o.status===1||o.status===3?(l(),B(n(P),{key:1,variant:"ghost",size:"icon",class:"hover:bg-gray-100 dark:hover:bg-gray-700",onClick:g=>G(o.id)},{default:m(()=>[c(n(lt),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):O("",!0),c(n(P),{variant:"ghost",size:"icon",class:"hover:bg-gray-100 dark:hover:bg-gray-700",onClick:g=>a.$inertia.visit(`/production/${o.activity_role_id}/view/${o.id}`)},{default:m(()=>[c(n(it),{class:"h-4 w-4"})]),_:2},1032,["onClick"])])])])}),128))],64))),128))]),e("tfoot",null,[e("tr",Ct,[t[5]||(t[5]=e("td",{colspan:"2",class:"px-3 py-2 text-right"},"Total:",-1)),e("td",Tt,d(A.value),1),e("td",Dt,[e("div",Ft,d(D(K.value)),1)]),e("td",Vt,d(D(U.value)),1),t[6]||(t[6]=e("td",null,null,-1))])])])]),e("div",It,[e("button",{onClick:M,disabled:n(p)===1||n(h),class:"rounded border border-gray-300 px-3 py-1 text-gray-700 hover:bg-gray-100 disabled:cursor-not-allowed disabled:opacity-50"}," Previous ",8,Nt),(l(!0),i(y,null,S(C.value,s=>(l(),i("button",{key:s,onClick:r=>T(s),class:tt(["rounded border px-3 py-1 text-sm",s===n(p)?"border-blue-600 bg-blue-600 text-white":"border-gray-300 text-gray-700 hover:bg-gray-100"]),disabled:n(h)},d(s),11,jt))),128)),e("button",{onClick:L,disabled:n(p)===C.value||n(h),class:"rounded border border-gray-300 px-3 py-1 text-gray-700 hover:bg-gray-100 disabled:cursor-not-allowed disabled:opacity-50"}," Next ",8,zt)])]))])]),_:1})],64))}});export{Gt as default};
