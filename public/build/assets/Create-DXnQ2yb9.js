import{d as B,q as F,r as y,T as $,o as j,w as q,e as H,f as n,g as u,p as v,u as s,Z as W,x as K,k as a,C as I,j as f,F as N,B as w,l as V,y as D,P as L,m as Q,V as C,b as R}from"./app-BjS9V559.js";import{u as Y}from"./useToast-Bup2DHTh.js";import{_ as Z}from"./AppLayout.vue_vue_type_script_setup_true_lang-DZvDN96H.js";import{u as J}from"./useModelStore-BsarVh0d.js";import{u as O}from"./useProductionStore-YCGoXz7y.js";import{A as G}from"./vue3-select-ESnee7IN.js";import"./index-CPQH5Eah.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-Cx1FFA3U.js";const X={class:"space-y-6 p-6"},ee={class:"text-2xl font-bold"},te={key:0,class:"mt-4 p-4 bg-yellow-50 border border-yellow-300 rounded text-sm text-yellow-700"},ae={key:1,class:"mt-4 p-4 bg-blue-50 border border-blue-300 rounded text-sm text-blue-700"},oe={class:"flex flex-col gap-2"},le=["value"],se={key:2},ie={class:"w-full table-auto border"},re={class:"border px-3 py-2 text-sm"},de={class:"border px-3 py-2 text-sm"},ne={class:"border px-3 py-2 text-sm"},ue=["onUpdate:modelValue"],me={class:"flex gap-2"},ce=["disabled"],ge=B({__name:"Create",props:{activity_role:{}},setup(T){const k=Y(),b=J(),{models:P,employees:z}=F(b),o=T,x=y(null),c=y(0),g=y([]),_=y([]),h=y([]),i=$({model_id:null,activity_role_id:Number(o.activity_role),employee_id:null,items:[],remark:""}),S=async(r="SEWING")=>{var t,l;try{const e=await R.get("/api/activity-roles",{params:{group_menu:r}});_.value=e.data.data}catch(e){k.error(((l=(t=e.response)==null?void 0:t.data)==null?void 0:l.message)||"Gagal mengambil data tugas finishing")}};j(async()=>{await b.fetchModels({page:1,is_close:"N"}),o.activity_role==="FINISHING"&&await S("FINISHING"),o.activity_role==="SEWING"&&await S("SEWING"),await b.fetchActivityEmployee(String(o.activity_role))}),q(x,async r=>{if(r)try{const l=(await b.fetchModelById(r)).data;i.model_id=l.id,g.value=l.sizes,i.items=l.sizes.map(e=>({size_id:String(e.size_id),size_name:e.size_name,qty:0,variant:e.variant}))}catch(t){console.error("Failed to fetch model sizes",t)}});const E=[{title:"Produksi",href:`/production/${o.activity_role}`}],M=O(),U=async()=>{var r,t,l;try{let e=1;o.activity_role=="CUTTING"&&(e=1),(o.activity_role=="FINISHING"||o.activity_role=="SEWING")&&(e=h.value.map(d=>{var m;return(m=_.value.find(A=>A.id===d))==null?void 0:m.id}).filter(d=>d!==null)),o.activity_role=="LUBANG_KANCING"&&(e=4);const p=typeof c.value=="number"?c.value:((r=c.value)==null?void 0:r.id)??0;await M.createProduction({model_id:i.model_id,activity_role_id:e,activity_role:String(o.activity_role),employee_id:p,remark:i.remark||"",items:i.items.filter(d=>d.qty>0)}),k.success("Produksi berhasil dibuat"),C.visit(`/production/${o.activity_role}`)}catch(e){k.error(((l=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:l.message)??"Gagal membuat produksi")}};return(r,t)=>{const l=H("Input");return u(),n(N,null,[v(s(W),{title:"Production Management"}),v(Z,{breadcrumbs:E},{default:K(()=>[a("div",X,[a("h1",ee,f(o.activity_role.toString().replace(/_/g," ")??"Buat Produksi"),1),a("div",null,[t[5]||(t[5]=a("label",{class:"mb-1 block font-medium"},"Pilih Desain Kerjaan",-1)),v(s(G),{id:"model.id",modelValue:x.value,"onUpdate:modelValue":t[0]||(t[0]=e=>x.value=e),reduce:e=>e.id,options:s(P),label:"description",placeholder:"Select Model",class:"w-full"},null,8,["modelValue","reduce","options"])]),a("div",null,[t[6]||(t[6]=a("label",{class:"mb-1 block font-medium"},"Karyawan",-1)),v(s(G),{id:"model.id",modelValue:c.value,"onUpdate:modelValue":t[1]||(t[1]=e=>c.value=e),options:s(z),label:"name",placeholder:"Select Employee",class:"w-full"},null,8,["modelValue","options"])]),o.activity_role==="QUALITY_CHECK"?(u(),n("div",te,[t[7]||(t[7]=a("p",null,"Periksa kualitas produk dengan teliti sebelum melanjutkan ke proses selanjutnya. Pastikan tidak ada cacat atau kekurangan.",-1)),v(l,{type:"text",modelValue:s(i).remark,"onUpdate:modelValue":t[2]||(t[2]=e=>s(i).remark=e),placeholder:"Tambahkan catatan atau remark jika diperlukan",class:"mt-2 w-full rounded border p-2"},null,8,["modelValue"])])):I("",!0),_.value.length&&o.activity_role==="FINISHING"||o.activity_role==="SEWING"?(u(),n("div",ae,[t[8]||(t[8]=a("p",{class:"font-semibold mb-2"},"Pilih pekerjaan yang dilakukan:",-1)),a("div",oe,[(u(!0),n(N,null,w(_.value,e=>(u(),n("label",{key:e.id,class:"flex items-center gap-2"},[V(a("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=p=>h.value=p),value:e.id},null,8,le),[[L,h.value]]),D(" "+f(e.name),1)]))),128))])])):I("",!0),g.value.length>0?(u(),n("div",se,[t[10]||(t[10]=a("h2",{class:"mb-2 font-semibold"},"Model Ukuran",-1)),a("table",ie,[t[9]||(t[9]=a("thead",null,[a("tr",{class:"bg-gray-100"},[a("th",{class:"border px-3 text-sm py-2 text-left"},"Size"),a("th",{class:"border px-3 text-sm py-2 text-left"},"Variant"),a("th",{class:"border px-3 text-sm py-2 text-left"},"Qty")])],-1)),a("tbody",null,[(u(!0),n(N,null,w(s(i).items,(e,p)=>{var d;return u(),n("tr",{key:`size-${p}-${e.size_id}`},[a("td",re,f(((d=g.value.find(m=>m.size_id===e.size_id))==null?void 0:d.size_name)||e.size_id),1),a("td",de,f(e.variant),1),a("td",ne,[V(a("input",{type:"number",min:"0",class:"w-full rounded border px-2 py-1","onUpdate:modelValue":m=>e.qty=m},null,8,ue),[[Q,e.qty,void 0,{number:!0}]])])])}),128))])])])):I("",!0),a("div",me,[a("button",{onClick:U,class:"rounded text-sm bg-blue-600 px-4 py-2 text-white hover:bg-blue-700",disabled:s(i).processing},"Simpan",8,ce),a("button",{onClick:t[4]||(t[4]=e=>s(C).visit(`/production/${o.activity_role}`)),type:"button",class:"rounded text-sm bg-gray-500 px-4 py-2 text-white hover:bg-gray-600"}," Cancel ")])])]),_:1})],64)}}});export{ge as default};
