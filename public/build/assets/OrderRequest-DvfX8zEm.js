import{d as _e,r,c as Q,o as ye,a as xe,w as Y,f,g as m,p as l,u as t,Z as ke,x as n,k as o,z as w,j as c,y as i,F as N,B as H,C as V,D as v,E as S,a0 as we,a1 as F,a2 as Ce,b as he}from"./app-DLPGG9ip.js";import{_ as $e,a as De,b as R,c as y,d as Pe,e as b}from"./TableRow.vue_vue_type_script_setup_true_lang-CN4U8teA.js";import{_ as Ve}from"./Textarea.vue_vue_type_script_setup_true_lang-CXnyaFdD.js";import{u as Se}from"./useToast-C_MTCQMf.js";import{_ as Te}from"./AppLayout.vue_vue_type_script_setup_true_lang-jY_tTzzq.js";import{_ as O}from"./Input.vue_vue_type_script_setup_true_lang-J7eywKQe.js";import{_ as Ne}from"./DateInput.vue_vue_type_script_setup_true_lang-DCqqyLpP.js";import{u as Z}from"./useOrderCustomer-Df1Bn09e.js";import{d as Oe}from"./debounce-BcZQbp_F.js";import"./index-DhuvfouN.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-DDHXcYGj.js";const Me={class:"px-4 py-4"},ze={class:"px-2 py-2 sm:px-4 sm:py-4 bg-white min-h-screen overflow-x-auto"},Be={class:"mb-4 flex flex-wrap gap-2 border-b"},Ie={key:0,class:"text-center text-gray-500 text-sm py-6"},Ue={key:1,class:"text-center text-red-500 text-sm py-6"},Fe={key:2,class:"text-center text-gray-500 text-sm py-6"},Re={class:"relative bg-white dark:bg-gray-800"},je={key:0,class:"absolute left-0 top-full z-50 mt-2 w-44 rounded-md bg-white dark:bg-gray-800 text-black dark:text-white shadow-lg ring-1 ring-black ring-opacity-5"},Ke={class:"py-1 text-left text-sm"},Ee={class:"space-y-1"},Le={class:"mt-1 text-right font-semibold"},Ge={class:"space-y-4 p-4 sm:p-6"},qe={class:"flex justify-end gap-2 pt-2"},Ae={class:"flex justify-center p-4"},Je={class:"space-y-3 p-4 text-sm"},Qe={class:"flex justify-end gap-2"},ia=_e({__name:"OrderRequest",setup(Ye){const j=r(!1),x=r(!1),C=r(!1),T=r(""),W=r(""),h=r([]),K=r(null),$=r(""),{orders:E,isLoading:L,error:G,pagination:q,fetchOrderRequest:D,cancelOrder:X,deleteOrder:ee,checkShipping:ae,updateShipping:te,setFilterOrderRequest:le}=Z(),d=r("cart"),se=r(null),M=r(""),z=r(""),B=r(""),I=r(null),P=r(null),p=r(1),k=r(10),ne=Q(()=>{var s,e;return Math.ceil((((s=q.value)==null?void 0:s.total)||0)/(((e=q.value)==null?void 0:e.per_page)||1))}),_=r(null),A=()=>{if(_.value){const{scrollTop:s,scrollHeight:e,clientHeight:a}=_.value;s+a>=e-100&&!L.value&&p.value<ne.value&&(p.value++,D({status:d.value,page:p.value,per_page:k.value,append:!0}))}},{fetchBankAccount:oe}=Z(),ie=s=>({1:"Pending",2:"Menunggu Pembayaran",3:"Menunggu Konfirmasi",4:"On Progress",5:"Sedang Dikemas",6:"Selesai",7:"Dibatalkan",8:"Konfirmasi Pembatalan",9:"Dikirim",10:"Disetujui",11:"Ditolak"})[s]||"-",g=Se();ye(()=>{p.value=1,oe(),D({status:d.value,page:p.value,per_page:k.value,name:$.value}),_.value&&_.value.addEventListener("scroll",A)}),xe(()=>{_.value&&_.value.removeEventListener("scroll",A)}),Y(d,s=>{p.value=1,D({status:s,page:p.value,per_page:k.value,name:$.value})}),Y($,Oe(s=>{E.value=[],p.value=1,le("name",s,{status:d.value,page:p.value,per_page:k.value,append:!1})},400));const J=Q(()=>E.value),ue=(s,e)=>{K.value=e,h.value=s,C.value=!0},U=r();function re(s){U.value=U.value===s?null:s}const de=async s=>{try{const e=await ae(s);se.value=e,x.value=!0}catch(e){console.log(e),alert("Gagal mengambil data pengiriman.")}};async function me(s){try{await X(s),g.success("Pesanan berhasil dibatalkan."),setTimeout(()=>{p.value=1,D({status:d.value,page:p.value,per_page:k.value})},500)}catch(e){console.log(e),g.error("Gagal membatalkan pesanan.")}}async function pe(s){try{await ee(s),g.success("Pesanan berhasil dibatalkan."),setTimeout(()=>{p.value=1,D({status:d.value,page:p.value,per_page:k.value})},500)}catch(e){console.log(e),g.error("Gagal membatalkan pesanan.")}}const ve=async()=>{try{const s={message:T.value,content_data:h.value.length>0?h.value:null,sender_type:"admin",receiver_id:K.value,order_id:h.value.length>0?h.value[0]:null};console.log("Sending message payload:",s),await he.post("/api/chat/send",s),C.value=!1,T.value="",g.success("Pesan berhasil dikirim")}catch(s){console.error("Failed to send message:",s),g.error("Gagal mengirim pesan")}};function ge(s){var a;const e=s.target;(a=e.files)!=null&&a.length&&(I.value=e.files[0])}const fe=async s=>{x.value=!0,P.value=s};async function ce(){var e,a;const s=new FormData;if(!P.value){g.error("Order ID tidak tersedia");return}s.append("resi_number",M.value),s.append("delivery_provider",z.value),s.append("estimation_date",B.value),I.value&&s.append("delivery_proof",I.value);try{const u=await te(P.value,s);g.success((u==null?void 0:u.message)||"Pengiriman berhasil diperbarui"),x.value=!1}catch(u){console.error("Gagal memperbarui pengiriman:",u);const be=((a=(e=u==null?void 0:u.response)==null?void 0:e.data)==null?void 0:a.message)||"Terjadi kesalahan saat memperbarui pengiriman";g.error(be)}}return(s,e)=>(m(),f(N,null,[l(t(ke),{title:"Riwayat Order"}),l(Te,null,{default:n(()=>[o("div",Me,[o("section",ze,[l(t(O),{modelValue:$.value,"onUpdate:modelValue":e[0]||(e[0]=a=>$.value=a),placeholder:"Search",class:"w-64","aria-label":"Search"},null,8,["modelValue"]),o("div",Be,[o("button",{onClick:e[1]||(e[1]=a=>d.value="cart"),class:w(["rounded-t px-4 py-2 text-sm md:",d.value==="cart"?"border-b-2 text-indigo-400 border-indigo-600 font-semibold":"text-gray-500"])}," Keranjang Konsumen ",2),o("button",{onClick:e[2]||(e[2]=a=>d.value="pending"),class:w(["rounded-t px-4 py-2 text-sm md:",d.value==="pending"?"border-b-2 text-indigo-400 border-indigo-600 font-semibold":"text-gray-500"])}," Pesanan Active ",2),o("button",{onClick:e[3]||(e[3]=a=>d.value="done"),class:w(["rounded-t px-4 py-2 text-sm md:",d.value==="done"?"border-b-2  text-indigo-400 border-indigo-600 font-semibold":"text-gray-500"])}," Selesai ",2),o("button",{onClick:e[4]||(e[4]=a=>d.value="cancel"),class:w(["rounded-t px-4 py-2 text-sm md:",d.value==="cancel"?"border-b-2  text-indigo-400 border-indigo-600 font-semibold":"text-gray-500"])}," Dibatalkan ",2)]),t(L)?(m(),f("div",Ie,"Memuat pesanan...")):t(G)?(m(),f("div",Ue,c(t(G)),1)):J.value.length===0?(m(),f("div",Fe,"Tidak ada pesanan ditemukan.")):(m(),f("div",{key:3,ref_key:"tableContainer",ref:_,class:"overflow-x-auto border rounded h-[calc(100vh-250px)] overflow-y-auto"},[l(t($e),{class:"w-full"},{default:n(()=>[l(t(De),null,{default:n(()=>[l(t(R),{class:"bg-gray-100"},{default:n(()=>[l(t(y),{class:"w-[5%]"},{default:n(()=>e[15]||(e[15]=[i("#")])),_:1,__:[15]}),l(t(y),{class:"w-[10%]"},{default:n(()=>e[16]||(e[16]=[i("No. Order")])),_:1,__:[16]}),l(t(y),{class:"w-[10%]"},{default:n(()=>e[17]||(e[17]=[i("Customer")])),_:1,__:[17]}),l(t(y),{class:"w-[10%]"},{default:n(()=>e[18]||(e[18]=[i("Tanggal")])),_:1,__:[18]}),l(t(y),{class:"w-[10%]"},{default:n(()=>e[19]||(e[19]=[i("Total")])),_:1,__:[19]}),l(t(y),{class:"w-[10%]"},{default:n(()=>e[20]||(e[20]=[i("Status")])),_:1,__:[20]}),l(t(y),{class:"w-[10%] text-center"},{default:n(()=>e[21]||(e[21]=[i("Pembayaran")])),_:1,__:[21]})]),_:1})]),_:1}),l(t(Pe),null,{default:n(()=>[(m(!0),f(N,null,H(J.value,a=>(m(),f(N,{key:a.id},[l(t(R),{class:"text-xs sm:text-sm"},{default:n(()=>[l(t(b),null,{default:n(()=>[o("div",Re,[l(t(v),{onClick:u=>re(a.id),size:"icon",variant:"ghost"},{default:n(()=>e[22]||(e[22]=[i("â‹®")])),_:2,__:[22]},1032,["onClick"]),U.value===a.id?(m(),f("div",je,[o("div",Ke,[l(t(v),{variant:"ghost",size:"icon",onClick:u=>ue([a.id],a.customer_id),class:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700"},{default:n(()=>e[23]||(e[23]=[i(" Kirim Pesan ")])),_:2,__:[23]},1032,["onClick"]),a.is_paid!=="Y"?(m(),S(t(v),{key:0,variant:"ghost",size:"icon",onClick:u=>me(a.id),class:"w-full text-left px-4 py-2 text-red-500 hover:bg-gray-100 dark:hover:bg-gray-700"},{default:n(()=>e[24]||(e[24]=[i(" Batalkan Pesanan ")])),_:2,__:[24]},1032,["onClick"])):V("",!0),d.value==="cart"?(m(),S(t(v),{key:1,variant:"ghost",size:"icon",onClick:u=>pe(a.id),class:"w-full text-left px-4 py-2 text-red-500 hover:bg-gray-100 dark:hover:bg-gray-700"},{default:n(()=>e[25]||(e[25]=[i(" Delete Pesanan ")])),_:2,__:[25]},1032,["onClick"])):V("",!0),a.resi_number==""&&a.is_paid=="Y"&&a.payment_method==="bank_transfer"?(m(),S(t(v),{key:2,variant:"ghost",size:"icon",onClick:u=>fe(a.id),class:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700"},{default:n(()=>e[26]||(e[26]=[i(" Update Resi ")])),_:2,__:[26]},1032,["onClick"])):V("",!0),a.resi_number==""&&a.is_paid=="Y"&&a.payment_method==="bank_transfer"?(m(),S(t(v),{key:3,variant:"ghost",size:"icon",onClick:u=>de(a.id),class:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700"},{default:n(()=>e[27]||(e[27]=[i(" Status Pengiriman ")])),_:2,__:[27]},1032,["onClick"])):V("",!0)])])):V("",!0)])]),_:2},1024),l(t(b),null,{default:n(()=>[i(c(a.id),1)]),_:2},1024),l(t(b),null,{default:n(()=>{var u;return[i(c(((u=a.customer)==null?void 0:u.name)||a.customer_id+" - N/A"),1)]}),_:2},1024),l(t(b),null,{default:n(()=>[i(c(new Date(a.created_at).toLocaleDateString("id-ID")),1)]),_:2},1024),l(t(b),null,{default:n(()=>[i(c(new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(Number(a.total_amount))),1)]),_:2},1024),l(t(b),null,{default:n(()=>[o("span",{class:w({"text-yellow-600":a.status===1,"text-green-600":a.status===2,"text-red-600":a.status===3})},c(ie(a.status)),3)]),_:2},1024),l(t(b),{class:"text-center"},{default:n(()=>[o("span",{class:w(["inline-block rounded-full border px-2 py-0.5 text-xs",a.payment_method==="bank_transfer"?"border-yellow-600 text-yellow-600":a.payment_method==="cod_store"?"border-green-600 text-green-600":"border-gray-300 text-gray-500"])},c(a.payment_method==="bank_transfer"?"Transfer":a.payment_method==="cod_store"?"Bayar Di Toko":"-"),3)]),_:2},1024)]),_:2},1024),l(t(R),null,{default:n(()=>[l(t(b),{colspan:"7",class:"bg-blue-50 p-3 text-xs sm:text-sm"},{default:n(()=>[e[28]||(e[28]=o("h4",{class:"mb-1 font-medium"},"Detail Pesanan:",-1)),o("div",Ee,[(m(!0),f(N,null,H(a.order_items,u=>(m(),S(we,{key:u.id,item:u},null,8,["item"]))),128))]),o("div",Le," Subtotal: "+c(new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(Number(a.total_amount))),1)]),_:2,__:[28]},1024)]),_:2},1024)],64))),128))]),_:1})]),_:1})],512))])]),l(F,{show:C.value,onClose:e[7]||(e[7]=a=>C.value=!1)},{default:n(()=>[o("div",Ge,[e[31]||(e[31]=o("h2",{class:"text-center font-semibold text-gray-800 sm:text-lg"},"Kirim Pesan",-1)),l(t(Ve),{modelValue:T.value,"onUpdate:modelValue":e[5]||(e[5]=a=>T.value=a),class:"h-32 w-full resize-none rounded-md border border-gray-300 p-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"Tulis pesan..."},null,8,["modelValue"]),o("div",qe,[l(t(v),{onClick:e[6]||(e[6]=a=>C.value=!1),variant:"outline"},{default:n(()=>e[29]||(e[29]=[i("Batal")])),_:1,__:[29]}),l(t(v),{onClick:ve,class:"bg-indigo-600 text-white"},{default:n(()=>e[30]||(e[30]=[i("Kirim")])),_:1,__:[30]})])])]),_:1},8,["show"]),l(F,{show:j.value,onClose:e[8]||(e[8]=a=>j.value=!1)},{default:n(()=>[o("div",Ae,[l(Ce,{value:W.value,size:256},null,8,["value"])])]),_:1},8,["show"]),l(F,{show:x.value,onClose:e[14]||(e[14]=a=>x.value=!1)},{default:n(()=>[o("div",Je,[e[39]||(e[39]=o("h3",{class:"font-semibold"},"Update Pengiriman",-1)),o("div",null,[e[32]||(e[32]=o("label",null,"No Order:",-1)),l(t(O),{modelValue:P.value,"onUpdate:modelValue":e[9]||(e[9]=a=>P.value=a),readonly:""},null,8,["modelValue"])]),o("div",null,[e[33]||(e[33]=o("label",null,"No Resi:",-1)),l(t(O),{modelValue:M.value,"onUpdate:modelValue":e[10]||(e[10]=a=>M.value=a),placeholder:"Masukkan nomor resi"},null,8,["modelValue"])]),o("div",null,[e[34]||(e[34]=o("label",null,"Jasa Pengirim:",-1)),l(t(O),{modelValue:z.value,"onUpdate:modelValue":e[11]||(e[11]=a=>z.value=a),placeholder:"JNE/J&T/Sicepat dll"},null,8,["modelValue"])]),o("div",null,[e[35]||(e[35]=o("label",null,"Estimasi Tiba:",-1)),l(t(Ne),{id:"estimation_date",modelValue:B.value,"onUpdate:modelValue":e[12]||(e[12]=a=>B.value=a)},null,8,["modelValue"])]),o("div",null,[e[36]||(e[36]=o("label",null,"Bukti Pengiriman (opsional):",-1)),o("input",{type:"file",onChange:ge},null,32)]),o("div",Qe,[l(t(v),{onClick:e[13]||(e[13]=a=>x.value=!1),variant:"outline"},{default:n(()=>e[37]||(e[37]=[i("Batal")])),_:1,__:[37]}),l(t(v),{onClick:ce,class:"bg-blue-600 text-white"},{default:n(()=>e[38]||(e[38]=[i("Simpan")])),_:1,__:[38]})])])]),_:1},8,["show"])]),_:1})],64))}});export{ia as default};
