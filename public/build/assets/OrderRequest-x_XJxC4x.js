import{d as _e,r,c as Q,o as ye,a as xe,w as Y,f as c,g as p,p as l,u as t,Z as ke,x as n,k as o,C as h,z as C,j as b,y as u,F as N,B as Z,D as g,E as V,H as we,M as j,I as he,n as Ce,b as $e}from"./app-DsktKL_a.js";import{_ as De,a as Pe,b as K,c as y,d as Se,e as _}from"./TableRow.vue_vue_type_script_setup_true_lang-mP0UKJBV.js";import{_ as Ve}from"./Textarea.vue_vue_type_script_setup_true_lang-IBfSRi32.js";import{u as Te}from"./useToast-1_4gvpGh.js";import{_ as Ne}from"./AppLayout.vue_vue_type_script_setup_true_lang-D7PbBda3.js";import{_ as O}from"./Input.vue_vue_type_script_setup_true_lang-CrbVcHa3.js";import{_ as Oe}from"./DateInput.vue_vue_type_script_setup_true_lang-Dgksf7ar.js";import{u as W}from"./useOrderCustomer-DPVR2aRu.js";import{d as Me}from"./debounce-BcZQbp_F.js";import"./index-Bh10JP8J.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CVKRphLI.js";const Ie={class:"px-4 py-4"},ze={class:"fixed px-2 py-2 sm:px-4 sm:py-4 bg-white"},Be={class:"mb-4 flex flex-wrap gap-2 border-b"},Ue={key:0,class:"text-center text-gray-500 text-sm py-6"},Fe={key:1,class:"text-center text-red-500 text-sm py-6"},Re={key:2,class:"text-center text-gray-500 text-sm py-6"},je={class:"relative bg-white dark:bg-gray-800"},Ke={key:0,class:"absolute left-0 top-full z-50 mt-2 w-44 rounded-md bg-white dark:bg-gray-800 text-black dark:text-white shadow-lg ring-1 ring-black ring-opacity-5"},Ee={class:"py-1 text-left text-sm"},He={class:"space-y-1"},Le={class:"mt-1 text-right font-semibold"},Ge={class:"space-y-4 p-4 sm:p-6"},qe={class:"flex justify-end gap-2 pt-2"},Ae={class:"flex justify-center p-4"},Je={class:"space-y-3 p-4 text-sm"},Qe={class:"flex justify-end gap-2"},ua=_e({__name:"OrderRequest",setup(Ye){const E=r(!1),x=r(!1),$=r(!1),T=r(""),X=r(""),D=r([]),H=r(null),k=r(""),{orders:ee,isLoading:L,error:G,pagination:q,fetchOrderRequest:P,cancelOrder:ae,deleteOrder:te,checkShipping:le,updateShipping:se,setFilterOrderRequest:ne}=W(),d=r("cart"),oe=r(null),M=r(""),I=r(""),z=r(""),B=r(null),S=r(null),m=r(1),w=r(50),A=Q(()=>{var s,e;return Math.ceil((((s=q.value)==null?void 0:s.total)||0)/(((e=q.value)==null?void 0:e.per_page)||50))}),v=r(null),U=()=>{if(v.value){const{scrollTop:s,scrollHeight:e,clientHeight:a}=v.value;if(s+a>=e-200&&!L.value&&m.value<A.value){const i=e;m.value++,P({status:d.value,page:m.value,per_page:w.value,append:!0,name:k.value}).then(()=>{Ce(()=>{if(v.value){const R=v.value.scrollHeight;v.value.scrollTop+=R-i}})})}}},{fetchBankAccount:ie}=W(),ue=s=>({1:"Pending",2:"Menunggu Pembayaran",3:"Menunggu Konfirmasi",4:"On Progress",5:"Sedang Dikemas",6:"Selesai",7:"Dibatalkan",8:"Konfirmasi Pembatalan",9:"Dikirim",10:"Disetujui",11:"Ditolak"})[s]||"-",f=Te();ye(()=>{m.value=1,ie(),P({status:d.value,page:m.value,per_page:w.value,name:k.value}),v.value&&v.value.addEventListener("scroll",U)}),xe(()=>{v.value&&v.value.removeEventListener("scroll",U)}),Y(d,s=>{m.value=1,console.log("ScrollPage:",m.value,"TotalPages:",A.value),P({status:s,page:m.value,per_page:w.value,name:k.value})}),Y(k,Me(s=>{m.value=1,ne("name",s,{status:d.value,page:m.value,per_page:w.value,append:!1})},400));const J=Q(()=>ee.value),re=(s,e)=>{H.value=e,D.value=s,$.value=!0},F=r();function de(s){F.value=F.value===s?null:s}const me=async s=>{try{const e=await le(s);oe.value=e,x.value=!0}catch(e){console.log(e),alert("Gagal mengambil data pengiriman.")}};async function pe(s){try{await ae(s),f.success("Pesanan berhasil dibatalkan."),setTimeout(()=>{m.value=1,P({status:d.value,page:m.value,per_page:w.value})},500)}catch(e){console.log(e),f.error("Gagal membatalkan pesanan.")}}async function ve(s){try{await te(s),f.success("Pesanan berhasil dibatalkan."),setTimeout(()=>{m.value=1,P({status:d.value,page:m.value,per_page:w.value})},500)}catch(e){console.log(e),f.error("Gagal membatalkan pesanan.")}}const ge=async()=>{try{const s={message:T.value,content_data:D.value.length>0?D.value:null,sender_type:"admin",receiver_id:H.value,order_id:D.value.length>0?D.value[0]:null};console.log("Sending message payload:",s),await $e.post("/api/chat/send",s),$.value=!1,T.value="",f.success("Pesan berhasil dikirim")}catch(s){console.error("Failed to send message:",s),f.error("Gagal mengirim pesan")}};function fe(s){var a;const e=s.target;(a=e.files)!=null&&a.length&&(B.value=e.files[0])}const ce=async s=>{x.value=!0,S.value=s};async function be(){var e,a;const s=new FormData;if(!S.value){f.error("Order ID tidak tersedia");return}s.append("resi_number",M.value),s.append("delivery_provider",I.value),s.append("estimation_date",z.value),B.value&&s.append("delivery_proof",B.value);try{const i=await se(S.value,s);f.success((i==null?void 0:i.message)||"Pengiriman berhasil diperbarui"),x.value=!1}catch(i){console.error("Gagal memperbarui pengiriman:",i);const R=((a=(e=i==null?void 0:i.response)==null?void 0:e.data)==null?void 0:a.message)||"Terjadi kesalahan saat memperbarui pengiriman";f.error(R)}}return(s,e)=>(p(),c(N,null,[l(t(ke),{title:"Riwayat Order"}),l(Ne,null,{default:n(()=>[o("div",Ie,[o("section",ze,[l(t(O),{modelValue:k.value,"onUpdate:modelValue":e[0]||(e[0]=a=>k.value=a),placeholder:"Search",class:"w-64","aria-label":"Search"},null,8,["modelValue"]),o("div",Be,[o("button",{onClick:e[1]||(e[1]=a=>d.value="cart"),class:C(["rounded-t px-4 py-2 text-sm md:",d.value==="cart"?"border-b-2 text-indigo-400 border-indigo-600 font-semibold":"text-gray-500"])}," Keranjang Konsumen ",2),o("button",{onClick:e[2]||(e[2]=a=>d.value="pending"),class:C(["rounded-t px-4 py-2 text-sm md:",d.value==="pending"?"border-b-2 text-indigo-400 border-indigo-600 font-semibold":"text-gray-500"])}," Pesanan Active ",2),o("button",{onClick:e[3]||(e[3]=a=>d.value="done"),class:C(["rounded-t px-4 py-2 text-sm md:",d.value==="done"?"border-b-2  text-indigo-400 border-indigo-600 font-semibold":"text-gray-500"])}," Selesai ",2),o("button",{onClick:e[4]||(e[4]=a=>d.value="cancel"),class:C(["rounded-t px-4 py-2 text-sm md:",d.value==="cancel"?"border-b-2  text-indigo-400 border-indigo-600 font-semibold":"text-gray-500"])}," Dibatalkan ",2)]),t(L)?(p(),c("div",Ue,"Memuat pesanan...")):t(G)?(p(),c("div",Fe,b(t(G)),1)):J.value.length===0?(p(),c("div",Re,"Tidak ada pesanan ditemukan.")):h("",!0),o("div",{ref_key:"tableContainer",ref:v,onScroll:U,class:"relative overflow-auto h-[calc(100vh-180px)] sm:h-[calc(100vh-200px)] lg:h-[calc(100vh-250px)]"},[l(t(De),{class:"w-full text-sm"},{default:n(()=>[l(t(Pe),null,{default:n(()=>[l(t(K),{class:"bg-gray-100 text-sm leading-tight py-1"},{default:n(()=>[l(t(y),{class:"w-[5%]"},{default:n(()=>e[15]||(e[15]=[u("#")])),_:1,__:[15]}),l(t(y),{class:"w-[10%]"},{default:n(()=>e[16]||(e[16]=[u("No. Order")])),_:1,__:[16]}),l(t(y),{class:"w-[10%]"},{default:n(()=>e[17]||(e[17]=[u("Customer")])),_:1,__:[17]}),l(t(y),{class:"w-[10%]"},{default:n(()=>e[18]||(e[18]=[u("Tanggal")])),_:1,__:[18]}),l(t(y),{class:"w-[10%]"},{default:n(()=>e[19]||(e[19]=[u("Total")])),_:1,__:[19]}),l(t(y),{class:"w-[10%]"},{default:n(()=>e[20]||(e[20]=[u("Status")])),_:1,__:[20]}),l(t(y),{class:"w-[10%] text-center"},{default:n(()=>e[21]||(e[21]=[u("Pembayaran")])),_:1,__:[21]})]),_:1})]),_:1}),l(t(Se),null,{default:n(()=>[(p(!0),c(N,null,Z(J.value,a=>(p(),c(N,{key:a.id},[l(t(K),{class:"text-xs sm:text-sm"},{default:n(()=>[l(t(_),null,{default:n(()=>[o("div",je,[l(t(g),{onClick:i=>de(a.id),size:"icon",variant:"ghost"},{default:n(()=>e[22]||(e[22]=[u("â‹®")])),_:2,__:[22]},1032,["onClick"]),F.value===a.id?(p(),c("div",Ke,[o("div",Ee,[l(t(g),{variant:"ghost",size:"icon",onClick:i=>re([a.id],a.customer_id),class:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700"},{default:n(()=>e[23]||(e[23]=[u(" Kirim Pesan ")])),_:2,__:[23]},1032,["onClick"]),a.is_paid!=="Y"?(p(),V(t(g),{key:0,variant:"ghost",size:"icon",onClick:i=>pe(a.id),class:"w-full text-left px-4 py-2 text-red-500 hover:bg-gray-100 dark:hover:bg-gray-700"},{default:n(()=>e[24]||(e[24]=[u(" Batalkan Pesanan ")])),_:2,__:[24]},1032,["onClick"])):h("",!0),d.value==="cart"?(p(),V(t(g),{key:1,variant:"ghost",size:"icon",onClick:i=>ve(a.id),class:"w-full text-left px-4 py-2 text-red-500 hover:bg-gray-100 dark:hover:bg-gray-700"},{default:n(()=>e[25]||(e[25]=[u(" Delete Pesanan ")])),_:2,__:[25]},1032,["onClick"])):h("",!0),a.resi_number==""&&a.is_paid=="Y"&&a.payment_method==="bank_transfer"?(p(),V(t(g),{key:2,variant:"ghost",size:"icon",onClick:i=>ce(a.id),class:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700"},{default:n(()=>e[26]||(e[26]=[u(" Update Resi ")])),_:2,__:[26]},1032,["onClick"])):h("",!0),a.resi_number==""&&a.is_paid=="Y"&&a.payment_method==="bank_transfer"?(p(),V(t(g),{key:3,variant:"ghost",size:"icon",onClick:i=>me(a.id),class:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700"},{default:n(()=>e[27]||(e[27]=[u(" Status Pengiriman ")])),_:2,__:[27]},1032,["onClick"])):h("",!0)])])):h("",!0)])]),_:2},1024),l(t(_),null,{default:n(()=>[u(b(a.id),1)]),_:2},1024),l(t(_),null,{default:n(()=>{var i;return[u(b(((i=a.customer)==null?void 0:i.name)||a.customer_id+" - N/A"),1)]}),_:2},1024),l(t(_),null,{default:n(()=>[u(b(new Date(a.created_at).toLocaleDateString("id-ID")),1)]),_:2},1024),l(t(_),null,{default:n(()=>[u(b(new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(Number(a.total_amount))),1)]),_:2},1024),l(t(_),null,{default:n(()=>[o("span",{class:C({"text-yellow-600":a.status===1,"text-green-600":a.status===2,"text-red-600":a.status===3})},b(ue(a.status)),3)]),_:2},1024),l(t(_),{class:"text-center"},{default:n(()=>[o("span",{class:C(["inline-block rounded-full border px-2 py-0.5 text-xs",a.payment_method==="bank_transfer"?"border-yellow-600 text-yellow-600":a.payment_method==="cod_store"?"border-green-600 text-green-600":"border-gray-300 text-gray-500"])},b(a.payment_method==="bank_transfer"?"Transfer":a.payment_method==="cod_store"?"Bayar Di Toko":"-"),3)]),_:2},1024)]),_:2},1024),l(t(K),null,{default:n(()=>[l(t(_),{colspan:"7",class:"bg-blue-50 p-3 text-xs sm:text-sm"},{default:n(()=>[e[28]||(e[28]=o("h4",{class:"mb-1 font-medium"},"Detail Pesanan:",-1)),o("div",He,[(p(!0),c(N,null,Z(a.order_items,i=>(p(),V(we,{key:i.id,item:i},null,8,["item"]))),128))]),o("div",Le," Subtotal: "+b(new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(Number(a.total_amount))),1)]),_:2,__:[28]},1024)]),_:2},1024)],64))),128))]),_:1})]),_:1})],544)])]),l(j,{show:$.value,onClose:e[7]||(e[7]=a=>$.value=!1)},{default:n(()=>[o("div",Ge,[e[31]||(e[31]=o("h2",{class:"text-center font-semibold text-gray-800 sm:text-lg"},"Kirim Pesan",-1)),l(t(Ve),{modelValue:T.value,"onUpdate:modelValue":e[5]||(e[5]=a=>T.value=a),class:"h-32 w-full resize-none rounded-md border border-gray-300 p-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"Tulis pesan..."},null,8,["modelValue"]),o("div",qe,[l(t(g),{onClick:e[6]||(e[6]=a=>$.value=!1),variant:"outline"},{default:n(()=>e[29]||(e[29]=[u("Batal")])),_:1,__:[29]}),l(t(g),{onClick:ge,class:"bg-indigo-600 text-white"},{default:n(()=>e[30]||(e[30]=[u("Kirim")])),_:1,__:[30]})])])]),_:1},8,["show"]),l(j,{show:E.value,onClose:e[8]||(e[8]=a=>E.value=!1)},{default:n(()=>[o("div",Ae,[l(he,{value:X.value,size:256},null,8,["value"])])]),_:1},8,["show"]),l(j,{show:x.value,onClose:e[14]||(e[14]=a=>x.value=!1)},{default:n(()=>[o("div",Je,[e[39]||(e[39]=o("h3",{class:"font-semibold"},"Update Pengiriman",-1)),o("div",null,[e[32]||(e[32]=o("label",null,"No Order:",-1)),l(t(O),{modelValue:S.value,"onUpdate:modelValue":e[9]||(e[9]=a=>S.value=a),readonly:""},null,8,["modelValue"])]),o("div",null,[e[33]||(e[33]=o("label",null,"No Resi:",-1)),l(t(O),{modelValue:M.value,"onUpdate:modelValue":e[10]||(e[10]=a=>M.value=a),placeholder:"Masukkan nomor resi"},null,8,["modelValue"])]),o("div",null,[e[34]||(e[34]=o("label",null,"Jasa Pengirim:",-1)),l(t(O),{modelValue:I.value,"onUpdate:modelValue":e[11]||(e[11]=a=>I.value=a),placeholder:"JNE/J&T/Sicepat dll"},null,8,["modelValue"])]),o("div",null,[e[35]||(e[35]=o("label",null,"Estimasi Tiba:",-1)),l(t(Oe),{id:"estimation_date",modelValue:z.value,"onUpdate:modelValue":e[12]||(e[12]=a=>z.value=a)},null,8,["modelValue"])]),o("div",null,[e[36]||(e[36]=o("label",null,"Bukti Pengiriman (opsional):",-1)),o("input",{type:"file",onChange:fe},null,32)]),o("div",Qe,[l(t(g),{onClick:e[13]||(e[13]=a=>x.value=!1),variant:"outline"},{default:n(()=>e[37]||(e[37]=[u("Batal")])),_:1,__:[37]}),l(t(g),{onClick:be,class:"bg-blue-600 text-white"},{default:n(()=>e[38]||(e[38]=[u("Simpan")])),_:1,__:[38]})])])]),_:1},8,["show"])]),_:1})],64))}});export{ua as default};
