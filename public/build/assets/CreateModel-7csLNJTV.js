import{d as O,r as g,q as R,c as N,T as W,o as X,w as ee,f as r,g as d,p as u,u as i,Z as te,x as V,k as s,j as c,F as M,B as C,z as ae,N as T,C as m,l as se,U as ie,D as S,V as B,y as j}from"./app-BfIoWC47.js";import{_ as le}from"./AppLayout.vue_vue_type_script_setup_true_lang-BgVTWLY-.js";import{_ as U}from"./Input.vue_vue_type_script_setup_true_lang-5HoeMrQC.js";import{_ as I}from"./DateInput.vue_vue_type_script_setup_true_lang-D_WCgpjH.js";import{_ as oe}from"./DocumentList.vue_vue_type_script_setup_true_lang-Dnvgzqw-.js";import{d as re,_ as de,a as ne,b as ue,c as me}from"./index-OArsYvXD.js";import{u as ce}from"./useModelStore-BXSKVsAa.js";import{u as ve}from"./useToast-D25WqDrG.js";import{u as pe}from"./useCategoryStore-fUxUUd7j.js";import"./index-CoIwPjCz.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CCcLbz8C.js";import"./trash-BecNjTL5.js";import"./useSizeStore-CjIMo38S.js";import"./useProductStore-DljBwCNs.js";import"./useMasterActivityRoleStore-CsbF61hG.js";import"./useUomStore-C941XCyZ.js";import"./vue3-select-B4DAvWe4.js";const _e={class:"rounded-lg bg-white p-4 shadow-sm dark:bg-gray-800 sm:p-6"},fe={class:"border-b pb-3 mb-4"},ge={class:"text-lg font-semibold text-gray-900 dark:text-white"},ye={class:"text-xs text-gray-500 dark:text-gray-400"},ke={class:"flex flex-wrap gap-2 mb-6 text-sm"},be=["onClick"],xe={key:0,class:"space-y-4"},he={key:0,class:"text-red-500"},Ve=["value"],Me={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},De={key:0,class:"text-red-500"},we={class:"hidden"},Ce={key:0,class:"text-red-500"},Se={class:"sm:col-span-2 hidden"},Ue={key:0,class:"text-red-500"},$e={key:0,class:"text-red-500"},qe={key:0,class:"grid grid-cols-2 sm:grid-cols-4 gap-4"},ze=["src"],Ee={class:"absolute bottom-0 inset-x-0 bg-black/60 p-1 text-[11px] text-white truncate"},Ne={key:1},Te={key:2},Be={key:3},je={key:4},Ie={key:5},Ae={class:"flex justify-end border-t pt-4 gap-2 text-sm"},Ke="Model",it=O({__name:"CreateModel",props:{modelData:{}},setup(A){const n=A,$=pe(),K=["model","size","activity","gambar","bahan_dan_biaya","hpp"],v=g("model"),{items:P}=R($),p=N(()=>!!n.modelData),q=g(Math.random().toString(36).substring(2,15)),b=g([]),F=N(()=>p.value?n.modelData.id:q.value),L=o=>b.value.splice(o,1),Q=[{title:"Konveksi",href:"/konveksi"},{title:p.value?"Edit Model":"Create Model",href:p.value?`/konveksi/model/${n.modelData.id}/edit`:"/konveksi/model/create"}],z=ce(),x=ve(),a=W({description:"",category_id:null,remark:"",start_date:null,end_date:null,estimation_price_pcs:0,estimation_qty:1,is_close:"N"}),l=g({}),_=g([]),D=g(0),f=g([]),y=g([]);X(()=>{Promise.all([$.fetchCategories()]),p.value&&(a.description=n.modelData.description,a.remark=n.modelData.remark,a.start_date=n.modelData.start_date,a.end_date=n.modelData.end_date,a.estimation_price_pcs=n.modelData.estimation_price_pcs,a.estimation_qty=n.modelData.estimation_qty,a.is_close=n.modelData.is_close,_.value=n.modelData.sizes||[],f.value=n.modelData.activity||[],y.value=n.modelData.modelMaterials||[],b.value=n.modelData.documents||[]),window.addEventListener("popstate",()=>{re.Inertia.visit(window.location.href,{preserveState:!0})})}),ee(v,o=>{if(o==="size"){const e=_.value.reduce((t,k)=>t+(Number(k.qty)||0),0);D.value=e}});const E=o=>o.map(e=>{var t;return{...e,product_id:typeof e.product_id=="object"&&((t=e.product_id)!=null&&t.id)?e.product_id.id:e.product_id}}),H=()=>{let o=!0;return l.value={},a.description||(l.value.description=["Deskripsi wajib diisi"],o=!1),a.category_id||(l.value.category_id=["Kategori wajib diisi"],o=!1),(!a.estimation_price_pcs||a.estimation_price_pcs<0)&&(l.value.estimation_price_pcs=["Estimasi harga harus angka dan >= 0"],o=!1),(!a.estimation_qty||a.estimation_qty<1)&&(l.value.estimation_qty=["Estimasi qty harus angka dan >= 1"],o=!1),_.value.length===0&&(l.value.sizes=["Data ukuran minimal 1"],o=!1),f.value.length===0&&(l.value.activity=["Data aktivitas minimal 1"],o=!1),y.value.length===0&&(l.value.modelMaterials=["Data material minimal 1"],o=!1),o},Y=async()=>{var o,e,t,k,w;if(H()){if(!a.start_date){l.value.start_date=["Tanggal mulai harus diisi"],x.error("Tanggal mulai harus diisi");return}a.is_close=a.is_close?"Y":"N";try{p.value?(await z.updateModel(n.modelData.id,{...a,sizes:_.value||[],activity:f.value||[],documents:b.value||[],modelMaterials:E(y.value)||[]}),x.success("Model berhasil diperbarui")):(await z.createModel({...a,sizes:_.value||[],activity:f.value||[],uniqId:q.value,documents:b.value||[],modelMaterials:E(y.value)||[]}),x.success("Model berhasil dibuat")),B.visit("/konveksi/model/list")}catch(h){if(((o=h.response)==null?void 0:o.status)===422&&((t=(e=h.response)==null?void 0:e.data)!=null&&t.errors)){l.value=h.response.data.errors;for(const G in l.value)l.value[G].forEach(J=>{x.error(J)})}else(w=(k=h.response)==null?void 0:k.data)!=null&&w.message?x.error(h.response.data.message):x.error("Terjadi kesalahan saat menyimpan model")}}},Z=o=>f.value.find(t=>t.activity_role_id===o)?`Activity ${o}`:"Unknown Activity";return(o,e)=>(d(),r(M,null,[u(i(te),{title:p.value?"Edit Model":"Create Model"},null,8,["title"]),u(le,{breadcrumbs:Q},{default:V(()=>[s("div",_e,[s("div",fe,[s("h1",ge,c(p.value?"Edit Model":"Buat Model Baru"),1),s("p",ye,c(p.value?"Ubah data model, ukuran, dan aktivitas":"Isi data model, ukuran, dan aktivitas"),1)]),s("div",ke,[(d(),r(M,null,C(K,t=>s("button",{key:t,onClick:k=>v.value=t,class:ae(["px-3 py-1.5 rounded-full transition-all",{"bg-indigo-600 text-white":v.value===t,"bg-gray-100 text-gray-600 hover:bg-gray-200":v.value!==t}])},c(t.charAt(0).toUpperCase()+t.slice(1)),11,be)),64))]),s("form",{onSubmit:T(Y,["prevent"]),class:"space-y-5 text-sm"},[v.value==="model"?(d(),r("div",xe,[s("div",null,[e[11]||(e[11]=s("label",{for:"description",class:"block mb-1 font-medium"},"Nama Model",-1)),u(i(U),{id:"description",modelValue:i(a).description,"onUpdate:modelValue":e[0]||(e[0]=t=>i(a).description=t)},null,8,["modelValue"]),l.value.description?(d(),r("small",he,c(l.value.description[0]),1)):m("",!0)]),s("div",null,[e[13]||(e[13]=s("label",{for:"category_id",class:"block mb-1 font-medium"},"Kategori",-1)),se(s("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>i(a).category_id=t),class:"w-full text-xs rounded-md border border-input px-3 py-2",required:""},[e[12]||(e[12]=s("option",{value:"0"},"Select Category",-1)),(d(!0),r(M,null,C(i(P),t=>(d(),r("option",{key:t.id,value:t.id},c(t.name),9,Ve))),128))],512),[[ie,i(a).category_id]])]),s("div",Me,[s("div",null,[e[14]||(e[14]=s("label",{class:"block mb-1 font-medium",for:"start_date"},"Tanggal Mulai",-1)),u(i(I),{id:"start_date",modelValue:i(a).start_date,"onUpdate:modelValue":e[2]||(e[2]=t=>i(a).start_date=t)},null,8,["modelValue"]),l.value.start_date?(d(),r("small",De,c(l.value.start_date[0]),1)):m("",!0)]),s("div",we,[e[15]||(e[15]=s("label",{class:"block mb-1 font-medium",for:"end_date"},"Estimasi Selesai",-1)),u(i(I),{id:"end_date",modelValue:i(a).end_date,"onUpdate:modelValue":e[3]||(e[3]=t=>i(a).end_date=t)},null,8,["modelValue"]),l.value.end_date?(d(),r("small",Ce,c(l.value.end_date[0]),1)):m("",!0)]),s("div",Se,[e[16]||(e[16]=s("label",{class:"block mb-1 font-medium",for:"estimation_price_pcs"},"Estimasi Harga",-1)),u(i(U),{id:"estimation_price_pcs",type:"number",modelValue:i(a).estimation_price_pcs,"onUpdate:modelValue":e[4]||(e[4]=t=>i(a).estimation_price_pcs=t)},null,8,["modelValue"]),l.value.estimation_price_pcs?(d(),r("small",Ue,c(l.value.estimation_price_pcs[0]),1)):m("",!0)])]),s("div",null,[e[17]||(e[17]=s("label",{class:"block mb-1 font-medium",for:"remark"},"Catatan",-1)),u(i(U),{id:"remark",modelValue:i(a).remark,"onUpdate:modelValue":e[5]||(e[5]=t=>i(a).remark=t)},null,8,["modelValue"]),l.value.remark?(d(),r("small",$e,c(l.value.remark[0]),1)):m("",!0)]),b.value.length?(d(),r("div",qe,[(d(!0),r(M,null,C(b.value,(t,k)=>(d(),r("div",{key:t.id,class:"relative group rounded-lg overflow-hidden border"},[s("img",{src:t.url,class:"aspect-square w-full object-cover transition-transform group-hover:scale-105"},null,8,ze),s("div",Ee,c(t.filename),1),u(i(S),{variant:"destructive",size:"icon",class:"absolute top-1 right-1 p-1 h-6 w-6",onClick:T(w=>L(k),["prevent"])},{default:V(()=>e[18]||(e[18]=[s("i",{class:"pi pi-times text-xs"},null,-1)])),_:2,__:[18]},1032,["onClick"])]))),128))])):m("",!0)])):m("",!0),v.value==="size"?(d(),r("div",Ne,[u(de,{modelValue:_.value,"onUpdate:modelValue":e[6]||(e[6]=t=>_.value=t),"onUpdate:totalQuantity":e[7]||(e[7]=t=>D.value=t)},null,8,["modelValue"])])):m("",!0),v.value==="activity"?(d(),r("div",Te,[u(ne,{modelValue:f.value,"onUpdate:modelValue":e[8]||(e[8]=t=>f.value=t)},null,8,["modelValue"])])):m("",!0),v.value==="gambar"?(d(),r("div",Be,[u(oe,{"reference-id":F.value,"reference-type":Ke},null,8,["reference-id"])])):m("",!0),v.value==="bahan_dan_biaya"?(d(),r("div",je,[u(ue,{modelValue:y.value,"onUpdate:modelValue":e[9]||(e[9]=t=>y.value=t)},null,8,["modelValue"])])):m("",!0),v.value==="hpp"?(d(),r("div",Ie,[u(me,{"model-materials":y.value,"activity-items":f.value.map(t=>({...t,activity_name:Z(t.activity_role_id)})),"start-date":i(a).start_date,"end-date":i(a).end_date,"total-production":D.value,"size-items":_.value},null,8,["model-materials","activity-items","start-date","end-date","total-production","size-items"])])):m("",!0),s("div",Ae,[u(i(S),{type:"button",variant:"secondary",onClick:e[10]||(e[10]=t=>i(B).visit("/konveksi"))},{default:V(()=>e[19]||(e[19]=[j(" Batal ")])),_:1,__:[19]}),u(i(S),{type:"submit",loading:i(a).processing,class:"bg-indigo-600 text-white hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:V(()=>[e[20]||(e[20]=s("i",{class:"pi pi-check mr-1"},null,-1)),j(" "+c(p.value?"Perbarui":"Simpan"),1)]),_:1,__:[20]},8,["loading"])])],32)])]),_:1})],64))}});export{it as default};
