import{d as be,r,c as J,o as _e,a as ye,w as Q,f,g as m,p as l,u as t,Z as xe,x as n,k as o,z as k,j as c,y as i,F as O,B as Y,C as P,D as v,E as V,a0 as ke,a1 as U,a2 as we,b as Ce}from"./app-qaMPXsMp.js";import{_ as he,a as $e,b as F,c as _,d as De,e as b}from"./TableRow.vue_vue_type_script_setup_true_lang-CD4AUmIx.js";import{_ as Pe}from"./Textarea.vue_vue_type_script_setup_true_lang-BSw0QrHy.js";import{u as Ve}from"./useToast-B5ZU0kZW.js";import{_ as Se}from"./AppLayout.vue_vue_type_script_setup_true_lang-CRy8KHvq.js";import{_ as T}from"./Input.vue_vue_type_script_setup_true_lang-CEAFwjAq.js";import{_ as Oe}from"./DateInput.vue_vue_type_script_setup_true_lang-Wae95czJ.js";import{u as H}from"./useOrderCustomer-DuVu3TvV.js";import{d as Te}from"./debounce-BcZQbp_F.js";import"./index-8DWS1PRa.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-Db90b6pr.js";const Ne={class:"px-4 py-4"},Me={class:"px-2 py-2 sm:px-4 sm:py-4 bg-white min-h-screen overflow-x-auto"},ze={class:"mb-4 flex flex-wrap gap-2 border-b"},Be={key:0,class:"text-center text-gray-500 text-sm py-6"},Ie={key:1,class:"text-center text-red-500 text-sm py-6"},Ue={key:2,class:"text-center text-gray-500 text-sm py-6"},Fe={key:3,class:"overflow-x-auto border rounded"},Re={class:"relative bg-white dark:bg-gray-800"},Ee={key:0,class:"absolute left-0 top-full z-50 mt-2 w-44 rounded-md bg-white dark:bg-gray-800 text-black dark:text-white shadow-lg ring-1 ring-black ring-opacity-5"},je={class:"py-1 text-left text-sm"},Ke={class:"space-y-1"},Le={class:"mt-1 text-right font-semibold"},Ge={class:"space-y-4 p-4 sm:p-6"},qe={class:"flex justify-end gap-2 pt-2"},Ae={class:"flex justify-center p-4"},Je={class:"space-y-3 p-4 text-sm"},Qe={class:"flex justify-end gap-2"},ia=be({__name:"OrderRequest",setup(Ye){const R=r(!1),y=r(!1),w=r(!1),S=r(""),W=r(""),C=r([]),E=r(null),h=r(""),{orders:j,isLoading:K,error:L,pagination:G,fetchOrderRequest:$,cancelOrder:Z,deleteOrder:X,checkShipping:ee,updateShipping:ae,setFilterOrderRequest:te}=H(),d=r("cart"),le=r(null),N=r(""),M=r(""),z=r(""),B=r(null),D=r(null),p=r(1),x=r(10),se=J(()=>{var s,e;return Math.ceil((((s=G.value)==null?void 0:s.total)||0)/(((e=G.value)==null?void 0:e.per_page)||1))}),q=()=>{document.documentElement.scrollTop+window.innerHeight>=document.documentElement.offsetHeight-100&&!K.value&&p.value<se.value&&(p.value++,$({status:d.value,page:p.value,per_page:x.value,append:!0}))},{fetchBankAccount:ne}=H(),oe=s=>({1:"Pending",2:"Menunggu Pembayaran",3:"Menunggu Konfirmasi",4:"On Progress",5:"Sedang Dikemas",6:"Selesai",7:"Dibatalkan",8:"Konfirmasi Pembatalan",9:"Dikirim",10:"Disetujui",11:"Ditolak"})[s]||"-",g=Ve();_e(()=>{p.value=1,ne(),$({status:d.value,page:p.value,per_page:x.value,name:h.value}),window.addEventListener("scroll",q)}),ye(()=>{window.removeEventListener("scroll",q)}),Q(d,s=>{p.value=1,$({status:s,page:p.value,per_page:x.value,name:h.value})}),Q(h,Te(s=>{j.value=[],p.value=1,te("name",s,{status:d.value,page:p.value,per_page:x.value,append:!1})},400));const A=J(()=>j.value),ie=(s,e)=>{E.value=e,C.value=s,w.value=!0},I=r();function ue(s){I.value=I.value===s?null:s}const re=async s=>{try{const e=await ee(s);le.value=e,y.value=!0}catch(e){console.log(e),alert("Gagal mengambil data pengiriman.")}};async function de(s){try{await Z(s),g.success("Pesanan berhasil dibatalkan."),setTimeout(()=>{p.value=1,$({status:d.value,page:p.value,per_page:x.value})},500)}catch(e){console.log(e),g.error("Gagal membatalkan pesanan.")}}async function me(s){try{await X(s),g.success("Pesanan berhasil dibatalkan."),setTimeout(()=>{p.value=1,$({status:d.value,page:p.value,per_page:x.value})},500)}catch(e){console.log(e),g.error("Gagal membatalkan pesanan.")}}const pe=async()=>{try{const s={message:S.value,content_data:C.value.length>0?C.value:null,sender_type:"admin",receiver_id:E.value,order_id:C.value.length>0?C.value[0]:null};console.log("Sending message payload:",s),await Ce.post("/api/chat/send",s),w.value=!1,S.value="",g.success("Pesan berhasil dikirim")}catch(s){console.error("Failed to send message:",s),g.error("Gagal mengirim pesan")}};function ve(s){var a;const e=s.target;(a=e.files)!=null&&a.length&&(B.value=e.files[0])}const ge=async s=>{y.value=!0,D.value=s};async function fe(){var e,a;const s=new FormData;if(!D.value){g.error("Order ID tidak tersedia");return}s.append("resi_number",N.value),s.append("delivery_provider",M.value),s.append("estimation_date",z.value),B.value&&s.append("delivery_proof",B.value);try{const u=await ae(D.value,s);g.success((u==null?void 0:u.message)||"Pengiriman berhasil diperbarui"),y.value=!1}catch(u){console.error("Gagal memperbarui pengiriman:",u);const ce=((a=(e=u==null?void 0:u.response)==null?void 0:e.data)==null?void 0:a.message)||"Terjadi kesalahan saat memperbarui pengiriman";g.error(ce)}}return(s,e)=>(m(),f(O,null,[l(t(xe),{title:"Riwayat Order"}),l(Se,null,{default:n(()=>[o("div",Ne,[o("section",Me,[l(t(T),{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=a=>h.value=a),placeholder:"Search",class:"w-64","aria-label":"Search"},null,8,["modelValue"]),o("div",ze,[o("button",{onClick:e[1]||(e[1]=a=>d.value="cart"),class:k(["rounded-t px-4 py-2 text-sm md:",d.value==="cart"?"border-b-2 text-indigo-400 border-indigo-600 font-semibold":"text-gray-500"])}," Keranjang Konsumen ",2),o("button",{onClick:e[2]||(e[2]=a=>d.value="pending"),class:k(["rounded-t px-4 py-2 text-sm md:",d.value==="pending"?"border-b-2 text-indigo-400 border-indigo-600 font-semibold":"text-gray-500"])}," Pesanan Active ",2),o("button",{onClick:e[3]||(e[3]=a=>d.value="done"),class:k(["rounded-t px-4 py-2 text-sm md:",d.value==="done"?"border-b-2  text-indigo-400 border-indigo-600 font-semibold":"text-gray-500"])}," Selesai ",2),o("button",{onClick:e[4]||(e[4]=a=>d.value="cancel"),class:k(["rounded-t px-4 py-2 text-sm md:",d.value==="cancel"?"border-b-2  text-indigo-400 border-indigo-600 font-semibold":"text-gray-500"])}," Dibatalkan ",2)]),t(K)?(m(),f("div",Be,"Memuat pesanan...")):t(L)?(m(),f("div",Ie,c(t(L)),1)):A.value.length===0?(m(),f("div",Ue,"Tidak ada pesanan ditemukan.")):(m(),f("div",Fe,[l(t(he),{class:"max-h-screen w-full"},{default:n(()=>[l(t($e),null,{default:n(()=>[l(t(F),{class:"bg-gray-100"},{default:n(()=>[l(t(_),{class:"w-[5%]"},{default:n(()=>e[15]||(e[15]=[i("#")])),_:1,__:[15]}),l(t(_),{class:"w-[10%]"},{default:n(()=>e[16]||(e[16]=[i("No. Order")])),_:1,__:[16]}),l(t(_),{class:"w-[10%]"},{default:n(()=>e[17]||(e[17]=[i("Customer")])),_:1,__:[17]}),l(t(_),{class:"w-[10%]"},{default:n(()=>e[18]||(e[18]=[i("Tanggal")])),_:1,__:[18]}),l(t(_),{class:"w-[10%]"},{default:n(()=>e[19]||(e[19]=[i("Total")])),_:1,__:[19]}),l(t(_),{class:"w-[10%]"},{default:n(()=>e[20]||(e[20]=[i("Status")])),_:1,__:[20]}),l(t(_),{class:"w-[10%] text-center"},{default:n(()=>e[21]||(e[21]=[i("Pembayaran")])),_:1,__:[21]})]),_:1})]),_:1}),l(t(De),null,{default:n(()=>[(m(!0),f(O,null,Y(A.value,a=>(m(),f(O,{key:a.id},[l(t(F),{class:"text-xs sm:text-sm"},{default:n(()=>[l(t(b),null,{default:n(()=>[o("div",Re,[l(t(v),{onClick:u=>ue(a.id),size:"icon",variant:"ghost"},{default:n(()=>e[22]||(e[22]=[i("â‹®")])),_:2,__:[22]},1032,["onClick"]),I.value===a.id?(m(),f("div",Ee,[o("div",je,[l(t(v),{variant:"ghost",size:"icon",onClick:u=>ie([a.id],a.customer_id),class:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700"},{default:n(()=>e[23]||(e[23]=[i(" Kirim Pesan ")])),_:2,__:[23]},1032,["onClick"]),a.is_paid!=="Y"?(m(),V(t(v),{key:0,variant:"ghost",size:"icon",onClick:u=>de(a.id),class:"w-full text-left px-4 py-2 text-red-500 hover:bg-gray-100 dark:hover:bg-gray-700"},{default:n(()=>e[24]||(e[24]=[i(" Batalkan Pesanan ")])),_:2,__:[24]},1032,["onClick"])):P("",!0),d.value==="cart"?(m(),V(t(v),{key:1,variant:"ghost",size:"icon",onClick:u=>me(a.id),class:"w-full text-left px-4 py-2 text-red-500 hover:bg-gray-100 dark:hover:bg-gray-700"},{default:n(()=>e[25]||(e[25]=[i(" Delete Pesanan ")])),_:2,__:[25]},1032,["onClick"])):P("",!0),a.resi_number==""&&a.is_paid=="Y"&&a.payment_method==="bank_transfer"?(m(),V(t(v),{key:2,variant:"ghost",size:"icon",onClick:u=>ge(a.id),class:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700"},{default:n(()=>e[26]||(e[26]=[i(" Update Resi ")])),_:2,__:[26]},1032,["onClick"])):P("",!0),a.resi_number==""&&a.is_paid=="Y"&&a.payment_method==="bank_transfer"?(m(),V(t(v),{key:3,variant:"ghost",size:"icon",onClick:u=>re(a.id),class:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700"},{default:n(()=>e[27]||(e[27]=[i(" Status Pengiriman ")])),_:2,__:[27]},1032,["onClick"])):P("",!0)])])):P("",!0)])]),_:2},1024),l(t(b),null,{default:n(()=>[i(c(a.id),1)]),_:2},1024),l(t(b),null,{default:n(()=>{var u;return[i(c(((u=a.customer)==null?void 0:u.name)||a.customer_id+" - N/A"),1)]}),_:2},1024),l(t(b),null,{default:n(()=>[i(c(new Date(a.created_at).toLocaleDateString("id-ID")),1)]),_:2},1024),l(t(b),null,{default:n(()=>[i(c(new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(Number(a.total_amount))),1)]),_:2},1024),l(t(b),null,{default:n(()=>[o("span",{class:k({"text-yellow-600":a.status===1,"text-green-600":a.status===2,"text-red-600":a.status===3})},c(oe(a.status)),3)]),_:2},1024),l(t(b),{class:"text-center"},{default:n(()=>[o("span",{class:k(["inline-block rounded-full border px-2 py-0.5 text-xs",a.payment_method==="bank_transfer"?"border-yellow-600 text-yellow-600":a.payment_method==="cod_store"?"border-green-600 text-green-600":"border-gray-300 text-gray-500"])},c(a.payment_method==="bank_transfer"?"Transfer":a.payment_method==="cod_store"?"Bayar Di Toko":"-"),3)]),_:2},1024)]),_:2},1024),l(t(F),null,{default:n(()=>[l(t(b),{colspan:"7",class:"bg-blue-50 p-3 text-xs sm:text-sm"},{default:n(()=>[e[28]||(e[28]=o("h4",{class:"mb-1 font-medium"},"Detail Pesanan:",-1)),o("div",Ke,[(m(!0),f(O,null,Y(a.order_items,u=>(m(),V(ke,{key:u.id,item:u},null,8,["item"]))),128))]),o("div",Le," Subtotal: "+c(new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(Number(a.total_amount))),1)]),_:2,__:[28]},1024)]),_:2},1024)],64))),128))]),_:1})]),_:1})]))])]),l(U,{show:w.value,onClose:e[7]||(e[7]=a=>w.value=!1)},{default:n(()=>[o("div",Ge,[e[31]||(e[31]=o("h2",{class:"text-center font-semibold text-gray-800 sm:text-lg"},"Kirim Pesan",-1)),l(t(Pe),{modelValue:S.value,"onUpdate:modelValue":e[5]||(e[5]=a=>S.value=a),class:"h-32 w-full resize-none rounded-md border border-gray-300 p-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"Tulis pesan..."},null,8,["modelValue"]),o("div",qe,[l(t(v),{onClick:e[6]||(e[6]=a=>w.value=!1),variant:"outline"},{default:n(()=>e[29]||(e[29]=[i("Batal")])),_:1,__:[29]}),l(t(v),{onClick:pe,class:"bg-indigo-600 text-white"},{default:n(()=>e[30]||(e[30]=[i("Kirim")])),_:1,__:[30]})])])]),_:1},8,["show"]),l(U,{show:R.value,onClose:e[8]||(e[8]=a=>R.value=!1)},{default:n(()=>[o("div",Ae,[l(we,{value:W.value,size:256},null,8,["value"])])]),_:1},8,["show"]),l(U,{show:y.value,onClose:e[14]||(e[14]=a=>y.value=!1)},{default:n(()=>[o("div",Je,[e[39]||(e[39]=o("h3",{class:"font-semibold"},"Update Pengiriman",-1)),o("div",null,[e[32]||(e[32]=o("label",null,"No Order:",-1)),l(t(T),{modelValue:D.value,"onUpdate:modelValue":e[9]||(e[9]=a=>D.value=a),readonly:""},null,8,["modelValue"])]),o("div",null,[e[33]||(e[33]=o("label",null,"No Resi:",-1)),l(t(T),{modelValue:N.value,"onUpdate:modelValue":e[10]||(e[10]=a=>N.value=a),placeholder:"Masukkan nomor resi"},null,8,["modelValue"])]),o("div",null,[e[34]||(e[34]=o("label",null,"Jasa Pengirim:",-1)),l(t(T),{modelValue:M.value,"onUpdate:modelValue":e[11]||(e[11]=a=>M.value=a),placeholder:"JNE/J&T/Sicepat dll"},null,8,["modelValue"])]),o("div",null,[e[35]||(e[35]=o("label",null,"Estimasi Tiba:",-1)),l(t(Oe),{id:"estimation_date",modelValue:z.value,"onUpdate:modelValue":e[12]||(e[12]=a=>z.value=a)},null,8,["modelValue"])]),o("div",null,[e[36]||(e[36]=o("label",null,"Bukti Pengiriman (opsional):",-1)),o("input",{type:"file",onChange:ve},null,32)]),o("div",Qe,[l(t(v),{onClick:e[13]||(e[13]=a=>y.value=!1),variant:"outline"},{default:n(()=>e[37]||(e[37]=[i("Batal")])),_:1,__:[37]}),l(t(v),{onClick:fe,class:"bg-blue-600 text-white"},{default:n(()=>e[38]||(e[38]=[i("Simpan")])),_:1,__:[38]})])])]),_:1},8,["show"])]),_:1})],64))}});export{ia as default};
