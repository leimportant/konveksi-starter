import{M as X,b as C,d as Y,r as M,T as ee,q as te,c as se,o as ae,f as v,g as f,p as r,u as t,Z as le,x as o,k as l,C as w,D as k,y as p,N as re,F as $,B as F,E as B,z as x,j as _,l as U,m as j,O as R,L as oe}from"./app-0U1VUouX.js";import{_ as ne}from"./AppLayout.vue_vue_type_script_setup_true_lang-BUoA2bSc.js";import{_ as ie}from"./Input.vue_vue_type_script_setup_true_lang-DRddhaah.js";import{_ as de,a as ue,b as A,c as g,d as ce,e as h}from"./TableRow.vue_vue_type_script_setup_true_lang-C1Qc-8DG.js";import{u as me}from"./useToast-DJudyVZB.js";import{P as fe}from"./plus-C7kbl30X.js";import{P as pe}from"./pen-CuPDGY4M.js";import{T as be}from"./trash-2-CAftizK0.js";import"./index-zcIcvFws.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-Adv47xyj.js";const ve=X("user",{state:()=>({users:[],total:0,loaded:!1,loading:!1,currentPage:1,lastPage:1,error:null,filterName:""}),getters:{activeUsers(b){return b.users.filter(n=>n.active)},inactiveUsers(b){return b.users.filter(n=>!n.active)}},actions:{async fetchUsers(b=1,n=10){var d,u;this.loading=!0;try{const s=await C.get("/api/users",{params:{page:b,perPage:n,name:this.filterName}});this.users=s.data.data,this.total=s.data.total,this.currentPage=b,this.lastPage=s.data.last_page||1,this.loaded=!0}catch(s){throw this.error=((u=(d=s.response)==null?void 0:d.data)==null?void 0:u.message)||"Failed to load users",s}finally{this.loading=!1}},setFilter(b,n){b==="name"&&(this.filterName=n,this.currentPage=1,this.fetchUsers(1))},async createUser(b){var n,d;this.loading=!0;try{const u=await C.post("/api/users",b);return await this.fetchUsers(),u.data}catch(u){throw this.error=((d=(n=u.response)==null?void 0:n.data)==null?void 0:d.message)||"Failed to create user",u}finally{this.loading=!1}},async updateUser(b,n){var d,u;this.loading=!0;try{const s=await C.put(`/api/users/${b}`,n);return await this.fetchUsers(),s.data}catch(s){throw this.error=((u=(d=s.response)==null?void 0:d.data)==null?void 0:u.message)||"Failed to update user",s}finally{this.loading=!1}},async deleteUser(b){var n,d;this.loading=!0;try{return await C.delete(`/api/users/${b}`),this.users=this.users.filter(u=>u.id!==b),!0}catch(u){throw this.error=((d=(n=u.response)==null?void 0:n.data)==null?void 0:d.message)||"Failed to delete user",u}finally{this.loading=!1}}}}),_e={class:"px-4 py-4"},ye={class:"flex justify-between items-center gap-2 mb-2"},xe={class:"overflow-x-auto rounded-md border"},ge={class:"flex flex-wrap justify-end mt-4 gap-2"},he=["disabled"],we=["onClick","disabled"],ke=["disabled"],Ue={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4 min-h-screen"},Ce={class:"bg-white p-6 rounded-lg w-full max-w-md space-y-4 max-h-[90vh] overflow-y-auto"},Pe={class:"space-y-3"},$e={key:0,class:"text-red-500 text-xs mt-1"},Fe={key:0,class:"text-red-500 text-xs mt-1"},Ne={key:0,class:"text-red-500 text-xs mt-1"},Ve=["value"],Se={key:0,class:"text-red-500 text-xs mt-1"},Ee=["value"],Te={key:0,class:"text-red-500 text-xs mt-1"},Me={class:"inline-flex items-center text-sm"},Be={class:"flex justify-end gap-2 pt-2"},Ge=Y({__name:"Index",setup(b){const n=me(),d=M(!1),u=M([]),s=ee({name:"",email:"",phone_number:"",location_id:null,role:null,active:!0,id:0}),D=[{title:"Users",href:"/users"}],y=ve(),{users:z,currentPage:P,lastPage:I,loading:N,filterName:V}=te(y),S=se(()=>I.value||1),E=async i=>{i<1||i>S.value||await y.fetchUsers(i)},q=()=>E(P.value+1),O=()=>E(P.value-1),Z=async(i,e)=>{const a=e.target;y.setFilter(i,a.value),await y.fetchUsers()},L=M([]),G=async()=>{try{const i=await C.get("/api/locations");u.value=i.data.data||[]}catch(i){console.error(i),n.error("Failed to fetch locations")}};ae(()=>{y.fetchUsers(),H(),G()});const H=async()=>{try{const i=await C.get("/api/roles");L.value=i.data.data||[]}catch(i){console.error(i),n.error("Failed to fetch roles")}},J=async()=>{var i,e,a,c;try{await y.createUser({name:s.name,email:s.email,phone_number:s.phone_number,location_id:s.location_id,role:s.role,active:s.active}),n.success("User created successfully"),s.reset(),await y.fetchUsers(),d.value=!1}catch(m){const T=((e=(i=m==null?void 0:m.response)==null?void 0:i.data)==null?void 0:e.message)||"Failed to create user";n.error(T),(c=(a=m==null?void 0:m.response)==null?void 0:a.data)!=null&&c.errors&&s.setError(m.response.data.errors)}},K=async i=>{const e=z.value.find(a=>a.id===i);e&&(s.reset(),s.name=e.name,s.email=e.email,s.phone_number=e.phone_number,s.location_id=e.location_id??null,s.role=e.roles&&e.roles.length>0?e.roles[0].id:null,s.active=e.active,s.id=e.id,d.value=!0)},Q=async()=>{var i,e,a,c;try{await y.updateUser(s.id,{name:s.name,email:s.email,phone_number:s.phone_number,location_id:s.location_id,role:s.role,active:s.active}),n.success("User updated successfully"),s.reset(),await y.fetchUsers(),d.value=!1}catch(m){const T=((e=(i=m==null?void 0:m.response)==null?void 0:i.data)==null?void 0:e.message)||"Failed to update user";n.error(T),(c=(a=m==null?void 0:m.response)==null?void 0:a.data)!=null&&c.errors&&s.setError(m.response.data.errors)}},W=async i=>{var e,a;if(confirm("Are you sure you want to delete this user?"))try{await y.deleteUser(i),n.success("User deleted successfully"),await y.fetchUsers()}catch(c){n.error(((a=(e=c==null?void 0:c.response)==null?void 0:e.data)==null?void 0:a.message)||"Failed to delete user")}};return(i,e)=>(f(),v($,null,[r(t(le),{title:"User Management"}),r(ne,{breadcrumbs:D},{default:o(()=>[l("div",_e,[l("div",ye,[r(t(k),{onClick:e[0]||(e[0]=a=>d.value=!0),class:"bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500 flex items-center"},{default:o(()=>[r(t(fe),{class:"h-4 w-4 mr-2"}),e[10]||(e[10]=p(" Tambah User "))]),_:1,__:[10]}),r(t(ie),{modelValue:t(V),"onUpdate:modelValue":e[1]||(e[1]=a=>re(V)?V.value=a:null),placeholder:"Search",onInput:e[2]||(e[2]=a=>Z("name",a)),class:"w-full sm:w-64","aria-label":"Search"},null,8,["modelValue"])]),l("div",xe,[r(t(de),{class:"min-w-[800px]"},{default:o(()=>[r(t(ue),null,{default:o(()=>[r(t(A),{class:"bg-gray-100"},{default:o(()=>[r(t(g),null,{default:o(()=>e[11]||(e[11]=[p("Name")])),_:1,__:[11]}),r(t(g),null,{default:o(()=>e[12]||(e[12]=[p("Phone Number")])),_:1,__:[12]}),r(t(g),null,{default:o(()=>e[13]||(e[13]=[p("Location")])),_:1,__:[13]}),r(t(g),null,{default:o(()=>e[14]||(e[14]=[p("Email")])),_:1,__:[14]}),r(t(g),null,{default:o(()=>e[15]||(e[15]=[p("Role")])),_:1,__:[15]}),r(t(g),null,{default:o(()=>e[16]||(e[16]=[p("Status")])),_:1,__:[16]}),r(t(g),{class:"w-24"},{default:o(()=>e[17]||(e[17]=[p("Actions")])),_:1,__:[17]})]),_:1})]),_:1}),r(t(ce),null,{default:o(()=>[(f(!0),v($,null,F(t(z),a=>(f(),B(t(A),{key:a.id},{default:o(()=>[r(t(h),{class:x(a.active?"":"line-through text-red-500")},{default:o(()=>[p(_(a.name),1)]),_:2},1032,["class"]),r(t(h),{class:x(a.active?"":"line-through text-red-500")},{default:o(()=>[p(_(a.phone_number),1)]),_:2},1032,["class"]),r(t(h),{class:x(a.active?"":"line-through text-red-500")},{default:o(()=>{var c;return[p(_(((c=a.location)==null?void 0:c.name)||"-"),1)]}),_:2},1032,["class"]),r(t(h),{class:x(a.active?"":"line-through text-red-500")},{default:o(()=>[p(_(a.email),1)]),_:2},1032,["class"]),r(t(h),{class:x(a.active?"":"line-through text-red-500")},{default:o(()=>{var c,m;return[p(_(((m=(c=a.roles)==null?void 0:c[0])==null?void 0:m.name)||a.employee_status),1)]}),_:2},1032,["class"]),r(t(h),null,{default:o(()=>[l("span",{class:x(a.active?"text-green-600":"text-red-600")},_(a.active?"Active":"Inactive"),3)]),_:2},1024),r(t(h),{class:"flex gap-2"},{default:o(()=>[r(t(k),{variant:"ghost",size:"icon",onClick:c=>K(a.id)},{default:o(()=>[r(t(pe),{class:"h-4 w-4"})]),_:2},1032,["onClick"]),r(t(k),{variant:"ghost",size:"icon",onClick:c=>W(a.id)},{default:o(()=>[r(t(be),{class:"h-4 w-4"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),l("div",ge,[l("button",{onClick:O,disabled:t(P)===1||t(N),class:"px-3 py-1 rounded border border-gray-300 text-gray-700 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed"}," Previous ",8,he),(f(!0),v($,null,F(S.value,a=>(f(),v("button",{key:a,onClick:c=>E(a),class:x(["px-3 py-1 rounded border text-sm",a===t(P)?"bg-blue-600 border-blue-600 text-white":"border-gray-300 text-gray-700 hover:bg-gray-100"]),disabled:t(N)},_(a),11,we))),128)),l("button",{onClick:q,disabled:t(P)===S.value||t(N),class:"px-3 py-1 rounded border border-gray-300 text-gray-700 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed"}," Next ",8,ke)]),d.value?(f(),v("div",Ue,[l("div",Ce,[e[29]||(e[29]=l("h2",{class:"text-lg font-semibold"},"Tambah User Baru",-1)),l("div",Pe,[l("div",null,[e[18]||(e[18]=l("label",{class:"block text-sm mb-1"},"Name",-1)),U(l("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>t(s).name=a),type:"text",class:"w-full border rounded px-3 py-2 text-sm",placeholder:"Enter name"},null,512),[[j,t(s).name]]),t(s).errors.name?(f(),v("p",$e,_(t(s).errors.name),1)):w("",!0)]),l("div",null,[e[19]||(e[19]=l("label",{class:"block text-sm mb-1"},"Email",-1)),U(l("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>t(s).email=a),type:"email",class:"w-full border rounded px-3 py-2 text-sm",placeholder:"Enter email"},null,512),[[j,t(s).email]]),t(s).errors.email?(f(),v("p",Fe,_(t(s).errors.email),1)):w("",!0)]),l("div",null,[e[20]||(e[20]=l("label",{class:"block text-sm mb-1"},"Phone Number",-1)),U(l("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>t(s).phone_number=a),type:"text",class:"w-full border rounded px-3 py-2 text-sm",placeholder:"Enter phone number"},null,512),[[j,t(s).phone_number]]),t(s).errors.phone_number?(f(),v("p",Ne,_(t(s).errors.phone_number),1)):w("",!0)]),l("div",null,[e[22]||(e[22]=l("label",{class:"block text-sm mb-1"},"Location",-1)),U(l("select",{"onUpdate:modelValue":e[6]||(e[6]=a=>t(s).location_id=a),class:"w-full border rounded px-3 py-2 text-sm"},[e[21]||(e[21]=l("option",{value:""},"Select location",-1)),(f(!0),v($,null,F(u.value,a=>(f(),v("option",{key:a.id,value:a.id},_(a.name),9,Ve))),128))],512),[[R,t(s).location_id]]),t(s).errors.location_id?(f(),v("p",Se,_(t(s).errors.location_id),1)):w("",!0)]),l("div",null,[e[24]||(e[24]=l("label",{class:"block text-sm mb-1"},"Role",-1)),U(l("select",{"onUpdate:modelValue":e[7]||(e[7]=a=>t(s).role=a),class:"w-full border rounded px-3 py-2 text-sm"},[e[23]||(e[23]=l("option",{value:""},"Select role",-1)),(f(!0),v($,null,F(L.value,a=>(f(),v("option",{key:a.id,value:a.id},_(a.name),9,Ee))),128))],512),[[R,t(s).role]]),t(s).errors.role?(f(),v("p",Te,_(t(s).errors.role),1)):w("",!0)]),l("div",null,[l("label",Me,[U(l("input",{type:"checkbox","onUpdate:modelValue":e[8]||(e[8]=a=>t(s).active=a),class:"form-checkbox mr-2"},null,512),[[oe,t(s).active]]),e[25]||(e[25]=p(" Active "))])])]),l("div",Be,[r(t(k),{variant:"outline",onClick:e[9]||(e[9]=a=>d.value=!1),class:"h-10"},{default:o(()=>e[26]||(e[26]=[p("Cancel")])),_:1,__:[26]}),t(s).id?(f(),B(t(k),{key:1,onClick:Q},{default:o(()=>e[28]||(e[28]=[p("Update")])),_:1,__:[28]})):(f(),B(t(k),{key:0,onClick:J},{default:o(()=>e[27]||(e[27]=[p("Submit")])),_:1,__:[27]}))])])])):w("",!0)])]),_:1})],64))}});export{Ge as default};
