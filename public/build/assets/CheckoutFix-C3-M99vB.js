import{d as G,r as c,c as D,o as O,P as v,b as I,f as l,g as i,p as m,u as p,Z as Q,x as g,k as t,C as _,y as b,j as d,X as Y,D as x,F as N,B as J,l as $,Y as z}from"./app-BVfchgiJ.js";import{u as X}from"./useToast-BaJ3qLG3.js";import{_ as Z}from"./AppLayout.vue_vue_type_script_setup_true_lang-CUMNAqQ4.js";import{u as W}from"./useCartStore-DYjn1D-R.js";import"./index-C1tPyWL9.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BEJMLWWB.js";const ee={class:"container mx-auto px-4 py-8"},te={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-gray-600 bg-opacity-75"},se={class:"w-full max-w-md rounded-lg bg-white p-8 text-center shadow-xl"},oe={key:0},ae={class:"mb-4 text-lg"},re={class:"font-semibold"},ne={class:"mb-6 flex justify-center"},le={key:1,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex justify-center items-center"},ie={class:"bg-white p-8 rounded-lg shadow-xl max-w-md w-full"},de={key:0,class:"bg-gray-100 p-4 rounded-md mb-6"},ue=["innerHTML"],ce={class:"text-center mb-4"},me={class:"flex justify-end gap-2"},pe={key:2,class:"grid grid-cols-1 gap-8 lg:grid-cols-3"},fe={class:"mb-8 rounded-2xl bg-white p-8 shadow-xl lg:col-span-2"},ge={class:"flex items-center space-x-4"},be=["src"],ye={class:"flex-1"},ve={class:"text-sm text-gray-900"},xe={class:"text-sm text-gray-600"},ke={class:"text-sm text-gray-600"},_e={class:"text-sm font-bold text-gray-900"},he={class:"mt-4 space-y-4 border-gray-300 pt-6"},we={class:"flex items-center justify-between text-sm font-semibold text-gray-800"},Pe={class:"flex items-center justify-between text-sm font-semibold text-gray-800"},Ce={class:"flex items-center justify-between border-t border-gray-200 pt-4 text-sm font-bold text-gray-900"},De={class:"rounded-2xl bg-white p-8 shadow-xl lg:col-span-1"},Ie={class:"space-y-4"},je={class:"flex cursor-pointer items-center rounded-sm border border-gray-200 p-4 shadow-sm transition-all duration-200 has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 has-[:checked]:ring-2 has-[:checked]:ring-blue-500"},Me=["innerHTML"],Te={class:"flex cursor-pointer items-center rounded-sm border border-gray-200 p-4 shadow-sm transition-all duration-200 has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 has-[:checked]:ring-2 has-[:checked]:ring-blue-500"},Be=["innerHTML"],Fe={class:"mt-8 flex justify-end space-x-4"},Se={key:3,class:"text-center text-gray-600"},$e=G({__name:"CheckoutFix",props:{user:Object},setup(K){const R=K,y=W(),f=X(),j=c(!1),h=c(null),w=c(null),M=c(!1),T=c(null),u=c(null),B=c(null),F=c(null),k=c(null),S=D(()=>y.cartItems.reduce((s,e)=>s+(e.quantity||0)*(e.price||0),0)),U=D(()=>y.cartItems.reduce((s,e)=>{const o=e.price||0,r=e.price_sell||0,a=o-r;return s+a*(e.quantity||0)},0)),V=D(()=>S.value-U.value);function P(s){const e=typeof s=="string"?parseFloat(s):s;return!e||e<=0?"-":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:2}).format(e)}const A=D(()=>y.cartItems);O(async()=>{y.cartItems.length===0&&(f.warning("Your cart is empty. Please add items before checking out."),v.visit("/home"));try{const s=await I.get("/api/setting/cod_store");B.value=s.data.message}catch(s){console.error("Error fetching COD store setting:",s),B.value="Could not load COD store information."}try{const s=await I.get("/api/setting/bank_transfer");F.value=s.data.message}catch(s){console.error("Error fetching bank transfer setting:",s),F.value="Could not load bank transfer information."}});const q=async()=>{var s;if(!u.value){f.error("Silahkan pilih metode pembayaran.");return}if(confirm("Apakah anda yakin ingin proses?"))try{const e={customer_id:(s=R.user)==null?void 0:s.customer_id,items:y.cartItems.filter(a=>{var n;return(n=a.product)==null?void 0:n.id}).map(a=>{var n,C;return{product_id:a.product.id,quantity:a.quantity,price:a.price||0,price_sell:a.price_sell||0,size_id:a.size_id??((n=a.product)==null?void 0:n.size_id)??"",uom_id:a.uom_id??((C=a.product)==null?void 0:C.uom_id)??"PCS",discount:(a.price||0)-(a.price_sell||0)}}),payment_method:u.value,total_amount:V.value};u.value!=="bank_transfer"&&k.value&&(e.payment_proof=k.value);const o=new FormData;for(const a in e)e[a]!==null&&(a==="items"?e.items.forEach((n,C)=>{for(const L in n)o.append(`items[${C}][${L}]`,n[L])}):o.append(a,e[a]));const r=await I.post("/api/orders",o,{headers:{"Content-Type":"multipart/form-data"}});f.success("Berhasil!"),y.clearCart(),u.value==="cod_store"?(h.value=r.data.order.id,j.value=!0):u.value==="bank_transfer"?(w.value=r.data.order.id,M.value=!0,T.value=r.data.bank_account_info):v.visit("/")}catch(e){f.error("Gagal memproses checkout."),console.error("Checkout error:",e)}},E=async()=>{if(!k.value||!w.value){f.error("Silahkan pilih bukti transfer dan pastikan order ID tersedia.");return}const s=new FormData;s.append("payment_proof",k.value);try{await I.post(`/api/orders/${w.value}/upload-payment-proof`,s,{headers:{"Content-Type":"multipart/form-data"}}),f.success("Bukti transfer berhasil diunggah!"),M.value=!1,v.visit("/")}catch(e){f.error("Gagal mengunggah bukti transfer."),console.error("Upload payment proof error:",e)}},H=()=>{v.visit("/home")};return(s,e)=>(i(),l(N,null,[m(p(Q),{title:"Checkout Produk"}),m(Z,null,{default:g(()=>[t("div",ee,[j.value?(i(),l("div",te,[t("div",se,[e[8]||(e[8]=t("h2",{class:"mb-4 text-xl font-bold"},"Pesanan Dikonfirmasi!",-1)),h.value?(i(),l("div",oe,[t("p",ae,[e[5]||(e[5]=b(" ID Pesanan Anda: ")),t("span",re,d(h.value),1)]),e[7]||(e[7]=t("p",{class:"text-md mb-6 text-gray-600"},"Silakan tunjukkan QR code ini di toko untuk melakukan pembayaran.",-1)),t("div",ne,[m(Y,{value:h.value,size:200,level:"H"},null,8,["value"])]),m(p(x),{onClick:e[0]||(e[0]=o=>p(v).visit("/"))},{default:g(()=>e[6]||(e[6]=[b("Kembali ke Beranda")])),_:1,__:[6]})])):_("",!0)])])):_("",!0),M.value?(i(),l("div",le,[t("div",ie,[e[12]||(e[12]=t("h2",{class:"text-2xl font-bold mb-4 text-center"},"Pesanan Berhasil!",-1)),e[13]||(e[13]=t("p",{class:"text-center mb-4"},"Pesanan Anda berhasil dibuat. Silakan transfer total pembayaran ke rekening berikut:",-1)),T.value?(i(),l("div",de,[e[9]||(e[9]=t("p",{class:"font-semibold"},"Informasi Rekening Bank:",-1)),t("div",{innerHTML:T.value},null,8,ue)])):_("",!0),t("p",ce,"ID Pesanan: "+d(w.value),1),e[14]||(e[14]=t("label",{for:"paymentProofUpload",class:"block text-sm font-medium text-gray-700 mb-2"},"Unggah Bukti Transfer",-1)),t("input",{type:"file",id:"paymentProofUpload",onChange:e[1]||(e[1]=o=>{var r;return k.value=((r=o.target.files)==null?void 0:r[0])||null}),class:"mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 mb-4"},null,32),t("div",me,[m(p(x),{onClick:E,class:"bg-indigo-600 text-white py-2 h-10 rounded-md hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:g(()=>e[10]||(e[10]=[b("Kirim Bukti Pembayaran")])),_:1,__:[10]}),m(p(x),{onClick:e[2]||(e[2]=o=>p(v).visit("/")),type:"button",variant:"outline"},{default:g(()=>e[11]||(e[11]=[b("Nanti Saja")])),_:1,__:[11]})])])])):_("",!0),A.value.length>0&&!j.value?(i(),l("div",pe,[t("div",fe,[e[18]||(e[18]=t("h2",{class:"mb-6 text-l text-gray-800"},"Rincian Pesanan",-1)),(i(!0),l(N,null,J(A.value,o=>{var r,a,n;return i(),l("div",{key:(r=o.product)==null?void 0:r.id,class:"mb-6 flex items-center justify-between border-b border-gray-200 pb-4 last:mb-0 last:border-b-0"},[t("div",ge,[(a=o.product)!=null&&a.image?(i(),l("img",{key:0,src:o.product.image,alt:"Gambar Produk",class:"h-14 w-14 rounded-lg object-cover shadow-md"},null,8,be)):_("",!0),t("div",ye,[t("p",ve,d(((n=o.product)==null?void 0:n.name)??"Produk Tidak Dikenal"),1),t("p",xe,"Jumlah: "+d(o.quantity),1),t("p",ke,"Ukuran: "+d(o.size_id)+" - "+d(o.uom_id),1)])]),t("p",_e,d(P(o.price_sell??0)),1)])}),128)),t("div",he,[t("div",we,[e[15]||(e[15]=t("span",null,"Subtotal:",-1)),t("span",null,d(P(S.value)),1)]),t("div",Pe,[e[16]||(e[16]=t("span",null,"Diskon:",-1)),t("span",null,"- "+d(P(U.value)),1)]),t("div",Ce,[e[17]||(e[17]=t("span",null,"Total:",-1)),t("span",null,d(P(V.value)),1)])])]),t("div",De,[e[23]||(e[23]=t("h2",{class:"mb-6 text-sm font-bold text-gray-800"},"Metode Pembayaran",-1)),t("div",Ie,[t("label",je,[$(t("input",{type:"radio",name:"paymentMethod",value:"cod_store","onUpdate:modelValue":e[3]||(e[3]=o=>u.value=o),class:"form-radio h-5 w-5 text-blue-600"},null,512),[[z,u.value]]),e[19]||(e[19]=t("span",{class:"ml-4 text-sm font-medium text-gray-800"},"Bayar di Toko",-1))]),t("div",{class:"rounded border border-green-600 p-1 text-xs text-black",innerHTML:B.value},null,8,Me),t("label",Te,[$(t("input",{type:"radio",name:"paymentMethod",value:"bank_transfer","onUpdate:modelValue":e[4]||(e[4]=o=>u.value=o),class:"form-radio h-5 w-5 text-blue-600"},null,512),[[z,u.value]]),e[20]||(e[20]=t("span",{class:"ml-4 text-sm font-medium text-gray-800"},"Transfer Bank",-1))]),t("div",{class:"rounded border border-green-600 p-1 text-xs text-black",innerHTML:F.value},null,8,Be),t("div",Fe,[m(p(x),{onClick:H,class:"w-full bg-orange-600 text-white py-2 rounded-md hover:bg-orange-700 focus:ring-2 focus:ring-indigo-500"},{default:g(()=>e[21]||(e[21]=[b("Batal")])),_:1,__:[21]}),m(p(x),{onClick:q,class:"w-full bg-indigo-600 text-white py-2 h-10 rounded-md hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:g(()=>e[22]||(e[22]=[b("Proses")])),_:1,__:[22]})])])])])):(i(),l("div",Se,[e[25]||(e[25]=t("p",null,"Keranjang Anda kosong. Silakan tambahkan produk terlebih dahulu sebelum checkout.",-1)),m(p(x),{class:"mt-4",onClick:H},{default:g(()=>e[24]||(e[24]=[b("Kembali ke Keranjang")])),_:1,__:[24]})]))])]),_:1})],64))}});export{$e as default};
