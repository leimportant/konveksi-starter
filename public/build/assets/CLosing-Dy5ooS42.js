import{d as F,q as I,r as N,c as R,o as G,f as c,g as a,p as u,u as l,Z,x as d,k as t,l as x,S as P,m as D,D as S,y as m,j as r,P as H,E as h,C as $,F as f,B as j,z as V}from"./app-DcayTgff.js";import{_ as J,a as W,b as B,c as M,d as X,e as z}from"./TableRow.vue_vue_type_script_setup_true_lang-DkvmPCoJ.js";import{_ as Y}from"./AppLayout.vue_vue_type_script_setup_true_lang-DjZoO2mf.js";import{u as ee}from"./usePayrollStore-Bc5ftEiu.js";import{C as E}from"./circle-check-big-BgZS2KbR.js";import{D as te}from"./dollar-sign-Bkuz44NJ.js";import"./index-Dl6GSmOf.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-B9gsBjlq.js";const se={class:"space-y-4 p-6"},le={class:"grid grid-cols-2 gap-3 sm:grid-cols-2"},oe={class:"flex flex-col"},ae={class:"flex flex-col"},ne={class:"flex items-center gap-2"},re={class:"flex items-center gap-2"},ie={class:"ml-4 flex items-center"},de={class:"relative inline-flex cursor-pointer items-center"},ue={class:"overflow-hidden rounded-md border"},ce={class:"border rounded-lg bg-white shadow-sm p-3 mb-2 transition hover:shadow-md"},ge={class:"flex items-center justify-between mb-2"},fe={class:"flex items-center gap-2"},pe=["checked","onChange"],me={class:"text-sm font-semibold text-gray-900"},be={class:"flex justify-between items-center"},_e={class:"font-semibold text-gray-900"},ye={class:"flex justify-between items-center"},xe={class:"font-semibold text-gray-900"},he={class:"flex justify-between items-center"},ve={class:"font-semibold text-gray-900"},ke={class:"flex justify-between items-center"},we=["onUpdate:modelValue","onChange"],Ce={key:1,class:"font-semibold text-gray-900"},De={class:"col-span-full flex justify-between items-center bg-green-50 rounded-md p-1 font-bold"},Se={class:"col-span-full flex justify-between items-center bg-red-50 rounded-md p-1 font-bold"},je={class:"mt-2 flex gap-2"},Te={class:"w-full text-xs"},$e={class:"bg-gray-200 font-bold dark:bg-gray-700"},Le={colspan:"4",class:"px-3 py-2"},Ne={class:"bg-blue-50 font-semibold"},Pe={colspan:"4",class:"px-3 py-2"},Ve={class:"p-2"},Be={class:"p-2 text-right"},Me={class:"bg-blue-100 font-bold"},ze={class:"p-2 text-right"},Ee={key:0},Ue={class:"flex justify-end"},Ze=F({__name:"CLosing",setup(qe){const g=ee(),{employees:T,startDate:v,endDate:k,selectedEmployees:b}=I(g),w=N(""),U=R(()=>w.value?T.value.filter(n=>{var e;return(e=n.employee_name)==null?void 0:e.toLowerCase().includes(w.value.toLowerCase())}):T.value),_=N(!0),q=n=>{const e=n.target;g.selectedEmployees=e.checked?T.value.map(s=>s.employee_id):[]},A=[{title:"Payroll Closing Management",href:"/payroll/closing"}];G(()=>{const n=new Date,e=new Date;e.setDate(n.getDate()-6),v.value=e.toISOString().split("T")[0],k.value=n.toISOString().split("T")[0],g.loadPayrollData()});const O=n=>n.reduce((e,s)=>e+Number(s.qty),0),K=n=>{if(!n)return"-";const e=n.split("T")[0],[s,o,i]=e.split("-");return`${i}/${o}/${s}`},Q=n=>{if(!n.details)return{};const e={};n.details.forEach(o=>{var y;const i=((y=o.created_at)==null?void 0:y.split("T")[0])||"-",p=o.model_desc||"-";e[i]||(e[i]={}),e[i][p]||(e[i][p]=[]),e[i][p].push(o)});const s={};return Object.keys(e).sort((o,i)=>i.localeCompare(o)).forEach(o=>{s[o]={},Object.keys(e[o]).sort().forEach(i=>{s[o][i]=e[o][i]})}),s};return(n,e)=>(a(),c(f,null,[u(l(Z),{title:"Payroll Management"}),u(Y,{breadcrumbs:A},{default:d(()=>[t("div",se,[t("div",le,[t("div",oe,[e[4]||(e[4]=t("label",{class:"mb-1 text-xs font-medium"},"Tanggal Mulai",-1)),x(t("input",{type:"date","onUpdate:modelValue":e[0]||(e[0]=s=>P(v)?v.value=s:null),class:"rounded-md border px-3 py-1.5 text-sm shadow-sm focus:border-indigo-500 focus:ring"},null,512),[[D,l(v),void 0,{lazy:!0}]])]),t("div",ae,[e[5]||(e[5]=t("label",{class:"mb-1 text-xs font-medium"},"Tanggal Akhir",-1)),x(t("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=s=>P(k)?k.value=s:null),class:"rounded-md border px-3 py-1.5 text-sm shadow-sm focus:border-indigo-500 focus:ring"},null,512),[[D,l(k),void 0,{lazy:!0}]])])]),t("div",ne,[u(l(S),{onClick:l(g).loadPayrollData,size:"sm",class:"rounded bg-blue-600 px-4 py-2 text-sm text-white hover:bg-blue-700"},{default:d(()=>e[6]||(e[6]=[m(" Tampilkan ")])),_:1,__:[6]},8,["onClick"]),x(t("input",{type:"text",placeholder:"Cari Karyawan","onUpdate:modelValue":e[2]||(e[2]=s=>w.value=s),class:"rounded-md border px-3 py-1.5 text-sm shadow-sm focus:border-indigo-500 focus:ring"},null,512),[[D,w.value,void 0,{lazy:!0}]])]),t("div",re,[u(l(S),{onClick:l(g).closePayroll,disabled:l(b).length===0,class:"bg-green-600 text-white hover:bg-green-700 disabled:cursor-not-allowed disabled:opacity-50"},{default:d(()=>[u(l(E),{class:"h-4 w-4"}),m(" Bayar ("+r(l(b).length)+") ",1)]),_:1},8,["onClick","disabled"]),t("div",ie,[t("label",de,[x(t("input",{id:"detailToggle",type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=s=>_.value=s),class:"peer sr-only"},null,512),[[H,_.value]]),e[7]||(e[7]=t("div",{class:"peer h-6 w-11 rounded-full bg-gray-200 after:absolute after:left-[2px] after:top-[2px] after:h-5 after:w-5 after:rounded-full after:border after:border-gray-300 after:bg-white after:transition-all after:content-[''] peer-checked:bg-blue-600 peer-checked:after:translate-x-full peer-checked:after:border-white"},null,-1)),e[8]||(e[8]=t("span",{class:"ml-3 text-sm"},"Detail",-1))])])]),t("div",ue,[u(l(J),null,{default:d(()=>[u(l(W),null,{default:d(()=>[u(l(B),{class:"bg-gray-50"},{default:d(()=>[u(l(M),null,{default:d(()=>[t("input",{type:"checkbox",onChange:q},null,32),e[9]||(e[9]=m(" Karyawan"))]),_:1,__:[9]}),_.value?(a(),h(l(M),{key:0},{default:d(()=>e[10]||(e[10]=[m("Detail")])),_:1,__:[10]})):$("",!0)]),_:1})]),_:1}),u(l(X),null,{default:d(()=>[(a(!0),c(f,null,j(U.value,s=>(a(),h(l(B),{key:s.employee_id,class:"bg-white align-top hover:bg-gray-50"},{default:d(()=>[u(l(z),{class:"align-top"},{default:d(()=>[t("div",ce,[t("div",ge,[t("div",fe,[t("input",{type:"checkbox",checked:l(b).includes(s.employee_id),onChange:()=>l(g).toggleSelect(s.employee_id),class:"h-4 w-4 accent-green-500"},null,40,pe),t("span",me,r(s.employee_name),1)]),t("span",{class:V(["rounded-full px-2 py-0.5 text-xs font-semibold capitalize",s.status==="closed"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"])},r(s.status),3)]),t("div",{class:V(["grid gap-1 text-sm text-gray-700",_.value?"grid-cols-1":"sm:grid-cols-2 md:grid-cols-3"])},[t("div",be,[e[11]||(e[11]=t("span",null,"Qty",-1)),t("span",_e,r(s.total_qty),1)]),t("div",ye,[e[12]||(e[12]=t("span",null,"Upah",-1)),t("span",xe,r(Number(s.total_upah).toLocaleString()),1)]),t("div",he,[e[13]||(e[13]=t("span",null,"Makan",-1)),t("span",ve,r(Number(s.uang_makan).toLocaleString()),1)]),t("div",ke,[e[14]||(e[14]=t("span",null,"Potongan",-1)),s.sisa_kasbon>0?x((a(),c("input",{key:0,type:"number","onUpdate:modelValue":o=>s.potongan=o,onChange:o=>l(g).updatePotongan(s.employee_id,s.potongan),class:"w-20 text-right text-sm border-b border-gray-300 focus:border-green-500 focus:outline-none"},null,40,we)),[[D,s.potongan,void 0,{number:!0}]]):(a(),c("span",Ce,"0"))]),t("div",De,[e[15]||(e[15]=t("span",null,"Total Gaji",-1)),t("span",null,r(Number(s.total_gaji).toLocaleString()),1)]),t("div",Se,[e[16]||(e[16]=t("span",null,"Sisa Kasbon",-1)),t("span",null,r(Number(s.sisa_kasbon).toLocaleString()),1)])],2),t("div",je,[u(l(S),{variant:"outline",onClick:o=>l(g).closeSingle(s),disabled:s.status==="closed",class:"flex-1 flex items-center justify-center gap-2 rounded-md bg-green-600 text-white text-sm font-semibold hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition"},{default:d(()=>[s.status!=="closed"?(a(),h(l(te),{key:0,class:"h-4 w-4"})):(a(),h(l(E),{key:1,class:"h-4 w-4"})),e[17]||(e[17]=m(" Bayar "))]),_:2,__:[17]},1032,["onClick","disabled"])])])]),_:2},1024),_.value?(a(),h(l(z),{key:0,class:"p-0 align-top sm:p-2"},{default:d(()=>{var o;return[t("table",Te,[(a(!0),c(f,null,j(Q(s),(i,p)=>(a(),c(f,{key:p},[t("tr",$e,[t("td",Le,"ðŸ“… "+r(K(p)),1)]),(a(!0),c(f,null,j(i,(y,L)=>(a(),c(f,{key:L},[t("tr",Ne,[t("td",Pe,"ðŸ§µ Model: "+r(L),1)]),(a(!0),c(f,null,j(y,C=>(a(),c("tr",{key:C.id,class:"border-b bg-white"},[t("td",Ve,r(C.size_id)+" - "+r(C.variant),1),t("td",Be,r(Number(C.qty).toLocaleString()),1)]))),128)),t("tr",Me,[e[18]||(e[18]=t("td",{class:"p-2 text-right"},"Total ",-1)),t("td",ze,r(O(y).toLocaleString()),1)])],64))),128))],64))),128)),(o=s.details)!=null&&o.length?$("",!0):(a(),c("tr",Ee,e[19]||(e[19]=[t("td",{colspan:"4",class:"p-4 text-center text-gray-500"},"Tidak ada data rincian aktivitas.",-1)])))])]}),_:2},1024)):$("",!0)]),_:2},1024))),128))]),_:1})]),_:1})]),t("div",Ue,[u(l(S),{onClick:l(g).closePayroll,disabled:l(b).length===0,class:"bg-green-600 text-white"},{default:d(()=>[m(" Close Selected ("+r(l(b).length)+") ",1)]),_:1},8,["onClick","disabled"])])])]),_:1})],64))}});export{Ze as default};
