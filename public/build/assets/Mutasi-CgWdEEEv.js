import{d as H,q as J,Q,r as k,aS as L,c as j,o as W,f as y,g as c,p as n,u as a,Z as Y,x as r,k as t,l as C,m as S,G as Z,D as x,y as d,F as _,B as T,E as P,C as U,j as u,am as I,z as X,M as ee,b as te}from"./app-Dlow-IqW.js";import{_ as ae,a as se,b as K,c as F,d as oe,e as N}from"./TableRow.vue_vue_type_script_setup_true_lang-BqTWHXmK.js";import{u as ne}from"./useToast-CbF-WIAa.js";import{_ as re}from"./AppLayout.vue_vue_type_script_setup_true_lang-COJZifLC.js";import{u as le}from"./useKasbonStore-vdF1inmj.js";import{S as ie}from"./search-DVCjSKaa.js";import{P as ue}from"./plus-BPNMVTzo.js";import{C as de}from"./credit-card-KXvLuOf6.js";import{C as me}from"./circle-check-big-6IL7sV7A.js";import"./index-C4W-OPw1.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CiznyD-g.js";const ce={class:"px-4 py-4"},pe={class:"mb-4 flex flex-col items-center justify-between gap-3 sm:flex-row"},fe={class:"flex w-full items-center gap-3 sm:w-auto"},be={class:"overflow-x-auto rounded-lg border shadow-sm"},ge={class:"flex w-full items-center justify-between"},ye={class:"flex items-center gap-1"},xe={class:"text-md mt-1 uppercase text-gray-800"},_e={class:"mt-1 text-xs text-gray-500"},ve={class:"mt-4 flex justify-end space-x-2"},he=["disabled"],we=["disabled"],ke={class:"space-y-4"},Ce={class:"mt-1 text-sm text-gray-500"},Se={class:"font-semibold text-gray-700"},Pe={class:"space-y-2"},Ke={class:"text-sm text-gray-600"},Ne={class:"font-semibold text-gray-900"},Me={class:"flex justify-end gap-2 pt-2"},Re=H({__name:"Mutasi",setup($e){const f=le(),{mutasiList:M,pagination:m,loading:$}=J(f),v=ne(),z=Q().props.auth.user,p=k(""),G=[{title:"Mutasi Kasbon",href:"/kasbon/mutasi"}],h=L({search:""}),b=k(!1),i=L({employee_id:0,amount:0,lastSaldoKasbon:0}),D=k(""),B=()=>{var e;const o=typeof p.value=="string"?p.value:((e=p.value)==null?void 0:e.value)??"";f.fetchMutasi(1,50,{search:h.search,status:o})},O=j(()=>{const o={};return M.value.forEach(e=>{const s=e.employee_name||"-";o[s]||(o[s]=[]),o[s].push(e)}),o}),w=j(()=>Math.ceil(m.value.total/m.value.per_page)||1),V=async o=>{o<1||o>w.value||await f.fetchMutasi(o)},R=()=>V(m.value.current_page+1),q=()=>V(m.value.current_page-1),A=async o=>{const e=M.value.find(s=>s.employee_id===o);D.value=(e==null?void 0:e.employee_name)||"-";try{const g=(await te.get(`/api/kasbon/saldo/${o}`)).data.saldo_kasbon;i.employee_id=o,i.amount=g,i.lastSaldoKasbon=g,b.value=!0}catch(s){console.error("Error fetching latest kasbon saldo:",s),v.error("Gagal memuat saldo kasbon terbaru.")}},E=async()=>{if(!confirm("Yakin ingin melakukan pembayaran kasbon ini?"))return;const o={employee_id:i.employee_id,amount:Number(i.amount),type:"Pembayaran",description:Number(i.amount)===Number(i.lastSaldoKasbon)?"Pelunasan Kasbon":"Pembayaran Kasbon"};try{await f.bayarKasbon(o),v.success("Pembayaran kasbon berhasil!"),b.value=!1}catch(e){v.error(e.message||"Gagal melakukan pembayaran kasbon.")}};return W(()=>{const e=new Date().toISOString().slice(0,7);p.value=e,f.fetchMutasi()}),(o,e)=>(c(),y(_,null,[n(a(Y),{title:"History Mutasi Management"}),n(re,{breadcrumbs:G},{default:r(()=>[t("div",ce,[t("div",pe,[t("div",fe,[C(t("input",{type:"month","onUpdate:modelValue":e[0]||(e[0]=s=>p.value=s),class:"w-full rounded-lg border border-gray-300 bg-white px-2 py-2 text-gray-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:w-auto"},null,512),[[S,p.value]]),C(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>h.search=s),type:"text",placeholder:"Cari data...",onKeyup:Z(B,["enter"]),class:"w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 sm:w-56"},null,544),[[S,h.search]]),n(a(x),{onClick:B,class:"flex items-center gap-1 bg-indigo-600 text-white hover:bg-indigo-700"},{default:r(()=>[n(a(ie),{class:"h-4 w-4"}),e[5]||(e[5]=d(" Cari "))]),_:1,__:[5]})])]),t("div",be,[n(a(ae),{class:"min-w-full"},{default:r(()=>[n(a(se),null,{default:r(()=>[n(a(K),{class:"bg-gray-100"},{default:r(()=>[n(a(F),{class:"px-4 py-2 text-left text-sm font-medium text-gray-700"},{default:r(()=>e[6]||(e[6]=[d("Name")])),_:1,__:[6]}),n(a(F),{class:"px-4 py-2 text-right text-sm font-medium text-gray-700"},{default:r(()=>e[7]||(e[7]=[d("Amount")])),_:1,__:[7]})]),_:1})]),_:1}),n(a(oe),null,{default:r(()=>[(c(!0),y(_,null,T(O.value,(s,g)=>(c(),y(_,{key:g},[n(a(K),{class:"border-b bg-gray-50"},{default:r(()=>[n(a(N),{class:"px-4 py-2 font-semibold text-gray-800",colspan:"3"},{default:r(()=>[t("div",ge,[t("span",null,u(g),1),a(z).employee_status.toUpperCase()=="OWNER"?(c(),P(a(x),{key:0,onClick:l=>A(s[0].employee_id),variant:"outline",class:"flex h-7 items-center gap-1 rounded-md border-purple-600 px-2 py-1 text-purple-700 hover:bg-purple-600 hover:text-white"},{default:r(()=>[n(a(ue),{class:"h-4 w-4"}),e[8]||(e[8]=t("span",{class:"text-xs"},"Bayar Kasbon",-1))]),_:2,__:[8]},1032,["onClick"])):U("",!0)])]),_:2},1024)]),_:2},1024),(c(!0),y(_,null,T(s,l=>(c(),P(a(K),{key:l.id,class:"border-b bg-white align-top"},{default:r(()=>[n(a(N),{class:"flex flex-col px-4 py-1 text-sm text-gray-600"},{default:r(()=>[t("div",ye,[l.type==="Kasbon"||l.type==="Pembayaran"?(c(),P(I(l.type==="Kasbon"?a(de):a(me)),{key:0,class:"h-4 w-4 text-blue-500"})):U("",!0),t("span",null,u(l.created_at?new Date(l.created_at).toLocaleDateString("id-ID"):"-"),1)]),t("div",xe,u(l.type),1)]),_:2},1024),n(a(N),{class:X(["px-4 py-1 text-right align-top text-sm font-medium",l.type==="Kasbon"?"text-green-600":l.type==="Pembayaran"?"text-red-600":""])},{default:r(()=>[d(u(Number(l.amount||0).toLocaleString())+" ",1),t("div",_e," saldo kasbon: "+u(Number(l.saldo_kasbon||0).toLocaleString()),1)]),_:2},1032,["class"])]),_:2},1024))),128))],64))),128))]),_:1})]),_:1})]),t("div",ve,[t("button",{onClick:q,disabled:a(m).current_page===1||a($),class:"rounded border px-3 py-1 hover:bg-gray-100 disabled:opacity-50"}," Previous ",8,he),t("span",null,"Page "+u(a(m).current_page)+" / "+u(w.value),1),t("button",{onClick:R,disabled:a(m).current_page>=w.value||a($),class:"rounded border px-3 py-1 hover:bg-gray-100 disabled:opacity-50"}," Next ",8,we)])])]),_:1}),n(ee,{show:b.value,onClose:e[4]||(e[4]=s=>b.value=!1),onConfirm:E},{default:r(()=>[t("div",ke,[t("div",null,[e[10]||(e[10]=t("h3",{class:"text-lg font-semibold tracking-tight text-gray-900"},"Bayar Kasbon",-1)),t("p",Ce,[e[9]||(e[9]=d(" Pembayaran untuk ")),t("span",Se,u(D.value),1)])]),t("div",Pe,[e[11]||(e[11]=t("label",{for:"amount",class:"block text-sm font-medium text-gray-700"},"Jumlah Pembayaran",-1)),C(t("input",{type:"number",id:"amount","onUpdate:modelValue":e[2]||(e[2]=s=>i.amount=s),class:"block w-full rounded-lg border border-gray-300 bg-gray-50 px-3 py-2 text-sm shadow-sm transition focus:border-purple-500 focus:bg-white focus:ring-2 focus:ring-purple-200"},null,512),[[S,i.amount]])]),t("p",Ke,[e[12]||(e[12]=d(" Sisa kasbon: ")),t("span",Ne,u(Number(i.lastSaldoKasbon).toLocaleString()),1)]),t("div",Me,[n(a(x),{onClick:e[3]||(e[3]=s=>b.value=!1),variant:"outline",class:"h-9 rounded-md border border-gray-300 bg-white px-4 text-sm font-medium text-gray-700 hover:bg-gray-100 hover:text-gray-900"},{default:r(()=>e[13]||(e[13]=[d(" Cancel ")])),_:1,__:[13]}),n(a(x),{onClick:E,class:"h-9 rounded-md bg-purple-600 px-4 text-sm font-medium text-white shadow-sm hover:bg-purple-700 focus:ring-2 focus:ring-purple-500"},{default:r(()=>e[14]||(e[14]=[d(" Save ")])),_:1,__:[14]})])])]),_:1},8,["show"])],64))}});export{Re as default};
