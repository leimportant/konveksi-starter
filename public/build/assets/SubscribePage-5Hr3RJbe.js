import{b as g,d as f,r as o,f as c,g as u,k as l,p as h,C as w,x as k,y as v,j as b,u as m,D as S}from"./app-Dlow-IqW.js";async function x(r){if(!("serviceWorker"in navigator))throw new Error("Service workers are not supported.");const t=await navigator.serviceWorker.ready,s=await t.pushManager.getSubscription();if(s){const i=s.options.applicationServerKey,y=p(r);if(!_(i,y))console.log("Unsubscribing existing push subscription..."),await s.unsubscribe();else{console.log("Already subscribed with same key.");return}}const e=await t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:p(r)}),n={endpoint:e.endpoint,keys:{p256dh:d(e.getKey("p256dh")),auth:d(e.getKey("auth"))}},a=await g.post("/api/push/subscribe",n);console.log("Subscription berhasil dikirim:",a.data)}function p(r){const t="=".repeat((4-r.length%4)%4),s=(r+t).replace(/-/g,"+").replace(/_/g,"/"),e=window.atob(s),n=new Uint8Array(e.length);for(let a=0;a<e.length;++a)n[a]=e.charCodeAt(a);return n}function d(r){if(!r)return"";const t=new Uint8Array(r);let s="";return t.forEach(e=>s+=String.fromCharCode(e)),window.btoa(s)}function _(r,t){return!r||r.byteLength!==t.byteLength?!1:new Uint8Array(r).every((e,n)=>e===t[n])}const A={class:"p-4 space-y-4"},C={key:0,class:"text-sm text-gray-600"},T=f({__name:"SubscribePage",setup(r){const t="BKhYLRgM_Jf-Ow5eBTrGMJyEXfmCnE-UgGpjYud0eQH-TlEFxUOzCj_-HgTG08Rl9sYxFYmwxrRdLZHGJzHGBfA",s=o(!1),e=o(""),n=async()=>{try{if(!("serviceWorker"in navigator)){e.value="Service Worker tidak didukung di browser ini.";return}await x(t),s.value=!0,e.value="Berhasil subscribe push notification."}catch(a){console.error("Subscription error:",a),e.value="Gagal subscribe. Cek console."}};return(a,i)=>(u(),c("div",A,[i[0]||(i[0]=l("h1",{class:"text-xl font-bold"},"Push Notifications",-1)),i[1]||(i[1]=l("p",null,"Tekan tombol untuk subscribe ke notifikasi.",-1)),h(m(S),{onClick:n,disabled:s.value},{default:k(()=>[v(b(s.value?"Sudah Subscribe":"Subscribe Push"),1)]),_:1},8,["disabled"]),e.value?(u(),c("p",C,b(e.value),1)):w("",!0)]))}});export{T as default};
