import{d as Z,r as c,q as G,T as J,o as O,f as d,g as l,p as n,u as a,Z as R,x as M,k as o,F as h,B as E,z as k,j as p,N as W,C as u,l as X,U as ee,D as z,V as N,y as T}from"./app-Di3m0JM_.js";import{_ as te}from"./AppLayout.vue_vue_type_script_setup_true_lang-CdnJxeNL.js";import{_ as w}from"./Input.vue_vue_type_script_setup_true_lang-CzUVq9az.js";import{_ as j}from"./DateInput.vue_vue_type_script_setup_true_lang-DUK2u7rm.js";import{_ as ae}from"./DocumentList.vue_vue_type_script_setup_true_lang-D2N3yLsS.js";import{d as se,_ as oe,a as ie,b as re,c as de}from"./index-DcNvSSXC.js";import{u as le}from"./useModelStore-IY_ngc1b.js";import{u as ne}from"./useCategoryStore-DfKr-ZsS.js";import{u as ue}from"./useToast-BFDnfwVN.js";import"./index-ZAa7-5mu.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CARa6xu5.js";import"./trash-CpcFBk92.js";import"./useSizeStore-BcCR_w4j.js";import"./useProductStore-BFhWGYv6.js";import"./useMasterActivityRoleStore-BXGYutYs.js";import"./useUomStore-qfqpXTcC.js";import"./vue3-select-C0xVCSQz.js";const me={class:"rounded-xl bg-white p-6 shadow-sm dark:bg-gray-800"},ce={class:"my-6 flex space-x-4 border-b dark:border-gray-700"},pe=["onClick"],ve={key:0,class:"space-y-6"},_e={key:0,class:"text-destructive"},fe=["value"],ye={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ge={key:0,class:"text-destructive"},be={class:"hidden"},ke={key:0,class:"text-destructive"},xe={class:"hidden"},Ve={key:0,class:"text-destructive"},Me={class:"hidden"},he={key:0,class:"text-destructive"},we={key:1},Se={key:2},$e={key:3,class:"space-y-6"},Ue={key:4},Ce={key:5},Ie={class:"flex justify-end gap-2"},De="Model",Oe=Z({__name:"UpdateModel",props:{modelId:{}},setup(B){const x=B,q=c(Number(x.modelId)).value??"",S=["model","size","activity","gambar","bahan dan biaya","hpp"],m=c(S[0]),i=c({}),$=ne(),{items:F}=G($),P=[{title:"Konveksi",href:"/konveksi"},{title:"Edit Model",href:`/konveksi/model/${x.modelId}/edit`}],U=le(),v=ue(),A=r=>r.map(t=>({...t,product_id:typeof t.product_id=="object"?t.product_id.id:t.product_id})),s=J({description:"",category_id:null,remark:"",start_date:null,end_date:null,estimation_price_pcs:0,estimation_qty:1}),C=c([]),f=c([]),I=c(0),_=c([]),y=c([]),K=()=>{let r=!0;return i.value={},s.description||(i.value.description=["Deskripsi wajib diisi"],r=!1),s.category_id||(i.value.category_id=["Kategori wajib diisi"],r=!1),r},L=async()=>{var r,t,e,g,V;try{if(!K())return;await U.updateModel(x.modelId,{...s,sizes:f.value,activity:_.value,documents:C.value,modelMaterials:A(y.value)}),v.success("Model berhasil diperbarui"),N.visit("/konveksi/model/list")}catch(b){if(((r=b.response)==null?void 0:r.status)===422&&((e=(t=b.response)==null?void 0:t.data)!=null&&e.errors)){i.value=b.response.data.errors;for(const Q in i.value)i.value[Q].forEach(Y=>{v.error(Y)})}else(V=(g=b.response)==null?void 0:g.data)!=null&&V.message?v.error(b.response.data.message):v.error("Terjadi kesalahan saat menyimpan model")}};O(async()=>{var r,t;try{Promise.all([$.fetchCategories()]);const e=await U.fetchModelById(x.modelId);console.log("Model Data:",e),e&&(s.description=e.data.description,s.remark=e.data.remark,s.start_date=e.data.start_date?D(e.data.start_date):"",s.end_date=e.data.end_date?D(e.data.end_date):"",s.estimation_price_pcs=e.data.estimation_price_pcs,s.estimation_qty=e.data.estimation_qty,s.category_id=e.data.category_id,f.value=e.data.sizes||[],_.value=e.data.activities||[],C.value=e.data.documents||[],y.value=e.data.model_material||[])}catch(e){(t=(r=e.response)==null?void 0:r.data)!=null&&t.errors?(i.value=e.response.data.errors,v.error("Validasi gagal, silakan periksa form")):v.error("Terjadi kesalahan saat membuat model")}window.addEventListener("popstate",()=>{se.Inertia.visit(window.location.href,{preserveState:!0})})});const H=r=>{const t=_.value.find(e=>e.activity_role_id===r);return(t==null?void 0:t.activity_name)||`Activity ${r}`};function D(r){const t=new Date(r),e=t.getFullYear(),g=String(t.getMonth()+1).padStart(2,"0"),V=String(t.getDate()).padStart(2,"0");return`${e}-${g}-${V}`}return(r,t)=>(l(),d(h,null,[n(a(R),{title:"Edit Model"}),n(te,{breadcrumbs:P},{default:M(()=>[o("div",me,[t[20]||(t[20]=o("div",{class:"border-b pb-4"},[o("h1",{class:"text-2xl font-semibold text-gray-900 dark:text-white"},"Edit Model"),o("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Edit data model, ukuran, dan aktivitas")],-1)),o("div",ce,[(l(),d(h,null,E(S,e=>o("button",{key:e,class:k(["pb-2 text-sm font-medium",{"border-b-2 border-primary text-primary":m.value===e,"text-gray-500 hover:text-gray-700":m.value!==e}]),onClick:g=>m.value=e},p(e.charAt(0).toUpperCase()+e.slice(1)),11,pe)),64))]),o("form",{onSubmit:W(L,["prevent"]),class:"space-y-6"},[m.value==="model"?(l(),d("div",ve,[o("div",null,[t[11]||(t[11]=o("label",{for:"description",class:"text-sm font-medium"},"Nama Model",-1)),n(a(w),{id:"description",modelValue:a(s).description,"onUpdate:modelValue":t[0]||(t[0]=e=>a(s).description=e),placeholder:""},null,8,["modelValue"]),i.value.description?(l(),d("small",_e,p(i.value.description[0]),1)):u("",!0)]),o("div",null,[t[13]||(t[13]=o("label",{for:"category_id",class:"block mb-1 font-medium"},"Kategori",-1)),X(o("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>a(s).category_id=e),class:"w-full text-xs rounded-md border border-input px-3 py-2",required:""},[t[12]||(t[12]=o("option",{value:"0"},"Select Category",-1)),(l(!0),d(h,null,E(a(F),e=>(l(),d("option",{key:e.id,value:e.id},p(e.name),9,fe))),128))],512),[[ee,a(s).category_id]])]),o("div",ye,[o("div",null,[t[14]||(t[14]=o("label",{for:"start_date",class:"text-sm font-medium"},"Tanggal Mulai",-1)),n(a(j),{modelValue:a(s).start_date,"onUpdate:modelValue":t[2]||(t[2]=e=>a(s).start_date=e),id:"start_date",class:k({"border-destructive":i.value.start_date})},null,8,["modelValue","class"]),i.value.start_date?(l(),d("small",ge,p(i.value.start_date[0]),1)):u("",!0)]),o("div",be,[t[15]||(t[15]=o("label",{for:"end_date",class:"text-sm font-medium"},"Estimasi Selesai",-1)),n(a(j),{modelValue:a(s).end_date,"onUpdate:modelValue":t[3]||(t[3]=e=>a(s).end_date=e),id:"end_date",class:k({"border-destructive":i.value.end_date})},null,8,["modelValue","class"]),i.value.end_date?(l(),d("small",ke,p(i.value.end_date[0]),1)):u("",!0)]),o("div",xe,[t[16]||(t[16]=o("label",{for:"estimation_price_pcs",class:"text-sm font-medium"},"Estimasi Harga",-1)),n(a(w),{type:"number",modelValue:a(s).estimation_price_pcs,"onUpdate:modelValue":t[4]||(t[4]=e=>a(s).estimation_price_pcs=e),id:"estimation_price_pcs",class:k({"border-destructive":i.value.estimation_price_pcs})},null,8,["modelValue","class"]),i.value.estimation_price_pcs?(l(),d("small",Ve,p(i.value.estimation_price_pcs[0]),1)):u("",!0)])]),o("div",Me,[t[17]||(t[17]=o("label",{for:"remark",class:"text-sm font-medium"},"Catatan",-1)),n(a(w),{modelValue:a(s).remark,"onUpdate:modelValue":t[5]||(t[5]=e=>a(s).remark=e),id:"remark",placeholder:"",class:k({"border-destructive":i.value.remark})},null,8,["modelValue","class"]),i.value.remark?(l(),d("small",he,p(i.value.remark[0]),1)):u("",!0)])])):u("",!0),m.value==="size"?(l(),d("div",we,[n(oe,{modelValue:f.value,"onUpdate:modelValue":t[6]||(t[6]=e=>f.value=e),"onUpdate:totalQuantity":t[7]||(t[7]=e=>I.value=e)},null,8,["modelValue"])])):u("",!0),m.value==="activity"?(l(),d("div",Se,[n(ie,{modelValue:_.value,"onUpdate:modelValue":t[8]||(t[8]=e=>_.value=e)},null,8,["modelValue"])])):u("",!0),m.value==="gambar"?(l(),d("div",$e,[n(ae,{"reference-id":a(q),"reference-type":De},null,8,["reference-id"])])):u("",!0),m.value==="bahan dan biaya"?(l(),d("div",Ue,[n(re,{modelValue:y.value,"onUpdate:modelValue":t[9]||(t[9]=e=>y.value=e)},null,8,["modelValue"])])):u("",!0),m.value==="hpp"?(l(),d("div",Ce,[n(de,{"model-materials":y.value,"activity-items":_.value.map(e=>({...e,activity_name:H(e.activity_role_id)})),"start-date":a(s).start_date,"end-date":a(s).end_date,"total-production":I.value,"size-items":f.value.map(e=>({...e}))},null,8,["model-materials","activity-items","start-date","end-date","total-production","size-items"])])):u("",!0),o("div",Ie,[n(a(z),{type:"button",class:"bg-amber-600 text-white h-10 rounded-md hover:bg-amber-700",variant:"outline",onClick:t[10]||(t[10]=e=>a(N).visit("/konveksi/model/list"))},{default:M(()=>t[18]||(t[18]=[T(" Batal ")])),_:1,__:[18]}),n(a(z),{type:"submit",class:"bg-indigo-600 text-white py-2 h-10 rounded-md hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:M(()=>t[19]||(t[19]=[T("Simpan Perubahan")])),_:1,__:[19]})])],32)])]),_:1})],64))}});export{Oe as default};
