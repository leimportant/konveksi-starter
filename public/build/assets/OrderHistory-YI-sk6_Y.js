import{d as Se,r,c as L,o as Te,a0 as $e,w as De,b as ae,e as Ie,f as g,g as u,p as s,u as o,Z as Oe,x as n,k as a,j as p,z as I,C as O,y as i,aO as Me,F as M,B as Q,E as z,H as Be,M as H,I as Ne,n as Fe}from"./app-D3IMWQF4.js";import{_ as je,a as He,b as G,c as P,d as Ve,e as k}from"./TableRow.vue_vue_type_script_setup_true_lang-B_PEixSE.js";import{_ as Ae}from"./Textarea.vue_vue_type_script_setup_true_lang-1m_kB6WW.js";import{u as Ue}from"./useToast-Drtd9KeE.js";import{_ as Re}from"./AppLayout.vue_vue_type_script_setup_true_lang-BcwQf37b.js";import{u as W}from"./useOrderCustomer-9q2nkien.js";import{u as Ee}from"./useBankAccountStore-dekpHuay.js";import{_ as Ke}from"./Input.vue_vue_type_script_setup_true_lang-Bw3MkARf.js";import{d as Le}from"./debounce-BfkDp9Vp.js";import"./index-C-72ODlk.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BqgIrXHM.js";const Qe={class:"absolute max-h-screen w-full bg-gray-50 p-4 md:p-2"},ze={class:"mb-6 flex flex-wrap justify-between gap-2"},Ge={class:"w-full flex-1 flex-col flex-wrap rounded-lg bg-indigo-100 p-4 text-center shadow sm:w-[32%] sm:w-[32.999%]"},We={class:"text-medium font-bold text-indigo-900"},Ye={class:"w-full flex-1 flex-col flex-wrap rounded-lg bg-green-100 p-4 text-center shadow sm:w-[32%] sm:w-[32.999%]"},Ze={class:"text-medium font-bold text-green-900"},qe={class:"w-full flex-1 flex-col flex-wrap rounded-lg bg-yellow-100 p-4 text-center shadow sm:w-[32%] sm:w-[32.999%]"},Je={class:"text-small font-bold text-yellow-900"},Xe={class:"mb-4 flex flex-wrap gap-2 border-b"},et={key:0,class:"text-center text-gray-500"},tt={key:1,class:"text-center text-red-500"},at={key:2,class:"text-center text-gray-500"},lt={key:3,class:"overflow-x-auto"},st={key:0,class:"mb-4 flex items-center gap-3"},nt={class:"flex items-center gap-2"},ot=["checked"],rt={class:"flex items-center justify-between gap-2"},it=["checked","onChange","disabled"],ut={key:0,class:"relative inline-block border border-blue-200 text-gray-400 bg-blue-100 text-left"},dt=["onClick"],ct={key:0,class:"absolute z-10 mt-2 w-48 rounded-md bg-white text-gray-800 shadow-lg ring-1 ring-black ring-opacity-5"},mt={class:"py-1 text-sm text-gray-700"},gt={class:"text-gray-600 text-xs"},pt={class:"space-y-1 min-h-[30px]"},vt={class:"mt-1 text-right font-semibold"},ft={class:"space-y-4 p-4 sm:p-6"},bt={class:"flex justify-end gap-2 pt-2"},xt={class:"flex justify-center p-4"},_t={class:"text-sm text-gray-700 space-y-1"},yt=["src"],kt={key:1,class:"w-full h-full bg-gray-200 flex items-center justify-center text-xs text-gray-400 rounded-lg"},wt={class:"mt-4 text-right"},ht={key:0,class:"text-gray-500"},Ct={key:1,class:"space-y-2 max-h-48 overflow-y-auto pr-2"},Pt={class:"font-medium text-gray-700"},St={class:"font-semibold"},Tt={class:"font-mono"},$t={class:"mt-6"},Rt=Se({__name:"OrderHistory",setup(Dt){const V=r(!1),B=r(!1),S=r(!1),N=r(""),Y=r(""),v=r([]),{orders:T,isLoading:w,error:Z,pagination:h,fetchOrders:x,setFilter:le}=W(),m=r("pending"),A=r(!1),f=r(""),{cancelOrder:se,checkShipping:ne}=W(),U=Ee(),C=r(null),_=Ue(),d=r(1),oe=r(10),R=L(()=>{var t,e;return Math.ceil((((t=h.value)==null?void 0:t.total)||0)/(((e=h.value)==null?void 0:e.per_page)||10))}),$=r(null),y=r(null),re=()=>{if(y.value){const{scrollTop:t,scrollHeight:e,clientHeight:c}=y.value;if(t+c>=e-200&&!w.value&&d.value<R.value){const l=e;d.value++,x({status:m.value,page:d.value,per_page:oe.value,append:!0,name:f.value}).then(()=>{Fe(()=>{if(y.value){const b=y.value.scrollHeight;y.value.scrollTop+=b-l}})})}}};let E=new IntersectionObserver(([t])=>{var e;t.isIntersecting&&!w.value&&((e=h.value)!=null&&e.next_page_url)&&ie()},{rootMargin:"200px"});const ie=async()=>{w.value||!h.value||h.value.current_page>=h.value.last_page||(d.value+=1,await x({status:m.value,page:d.value,name:f.value,append:!0}))};Te(()=>{T.value=[],d.value=1,E=new IntersectionObserver(async t=>{t[0].isIntersecting&&!w.value&&!A.value&&d.value<R.value&&(A.value=!0,d.value+=1,await x({page:d.value,per_page:10,append:!0,status:m.value,name:f.value}),A.value=!1)}),$.value&&E.observe($.value),x({page:d.value,per_page:10,append:!1,status:m.value,name:f.value}),U.fetchBankAccount(),ye(),y.value&&(y.value.addEventListener("scroll",re),y.value.addEventListener("scroll",ue))}),$e(()=>{$.value&&E.unobserve($.value)}),De(m,t=>{T.value=[],d.value=1,x({status:t,page:d.value,per_page:10,append:!1,name:f.value})},{immediate:!0});const D=L(()=>T.value),ue=()=>{document.documentElement.scrollTop+window.innerHeight>=document.documentElement.offsetHeight-100&&!w.value&&d.value<R.value&&(d.value++,x({status:m.value,page:d.value,per_page:10,append:!0,name:f.value}))},de=t=>{Y.value=t.join(","),V.value=!0},ce=t=>{t.target.checked?v.value=D.value.filter(c=>c.payment_method==="cod_store").map(c=>c.id):v.value=[]},me=t=>{v.value=t,S.value=!0},ge=t=>{v.value.includes(t)?v.value=v.value.filter(e=>e!==t):v.value.push(t)},K=r();function pe(t){K.value=K.value===t?null:t}const ve=async t=>{try{const e=await ne(t);B.value=!0,C.value=e.data}catch(e){console.log(e),alert("Gagal mengambil data pengiriman.")}},fe=t=>t?t.startsWith("storage/")?"/"+t:t.startsWith("/storage/")?t:"/storage/"+t:"";async function be(t){if(window.confirm("Apakah Anda yakin ingin membatalkan pesanan ini?"))try{await se(t),_.success("Pesanan berhasil dibatalkan."),setTimeout(()=>{T.value=[],d.value=1,x({status:m.value,page:d.value,per_page:10,append:!1,name:f.value})},500)}catch(c){console.log(c),_.error("Gagal membatalkan pesanan.")}}const q=L(()=>v.value.filter(t=>{const e=T.value.find(c=>c.id===t);return e&&e.payment_method==="cod_store"})),xe=async()=>{try{const t={message:N.value,content_data:v.value.length>0?v.value:null,sender_type:"customer",order_id:v.value.length>0?v.value[0]:null};console.log("Sending message payload:",t),await ae.post("/api/chat/send",t),S.value=!1,N.value="",_.success("Pesan berhasil dikirim")}catch(t){console.error("Failed to send message:",t),_.error("Gagal mengirim pesan")}},F=r(!1),j=r(null),_e=t=>{const e=t.target;e.files&&e.files.length>0?j.value=e.files[0]:j.value=null},J=r(0),X=r(0),ee=r(0),ye=async()=>{try{const t=await ae.get("/api/dashboard/customer");J.value=t.data.totalProduk||0,X.value=t.data.totalOrder||0,ee.value=t.data.totalPembelian||0}catch(t){console.error("Failed to fetch dashboard data:",t)}},{uploadPaymentProof:ke}=W(),te=r(null),we=t=>{te.value=t,F.value=!0},he=t=>({1:"Pending",2:"Menunggu Pembayaran",3:"Menunggu Konfirmasi",4:"On Progress",5:"Sedang Dikemas",6:"Selesai",7:"Dibatalkan",8:"Konfirmasi Pembatalan",9:"Dikirim",10:"Disetujui",11:"Ditolak"})[t]||"-",Ce=async()=>{if(!j.value){_.error("Silahkan pilih file bukti transfer terlebih dahulu.");return}const t=te.value;if(!t){_.error("Tidak ada order yang dipilih untuk upload bukti transfer.");return}try{await ke(t,j.value),_.success("Bukti transfer berhasil diunggah!"),F.value=!1,x({status:m.value,page:d.value,per_page:10})}catch(e){console.error(e),_.error("Gagal mengunggah bukti transfer.")}},Pe=Le(async()=>{le("status",m.value,{page:d.value,per_page:10,append:!1,name:f.value})},500);return(t,e)=>{const c=Ie("Button");return u(),g(M,null,[s(o(Oe),{title:"Riwayat Order"}),s(Re,null,{default:n(()=>[a("section",Qe,[a("div",ze,[a("div",Ge,[e[12]||(e[12]=a("p",{class:"text-xs font-medium text-indigo-800"},"Total Produk",-1)),a("p",We,p(J.value),1)]),a("div",Ye,[e[13]||(e[13]=a("p",{class:"text-xs font-medium text-green-800"},"Total Order",-1)),a("p",Ze,p(X.value),1)]),a("div",qe,[e[14]||(e[14]=a("p",{class:"text-xs font-medium text-yellow-800"},"Total Pembelian",-1)),a("p",Je,p(ee.value),1)])]),s(o(Ke),{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=l=>f.value=l),placeholder:"Search",class:"w-64",onInput:o(Pe),"aria-label":"Search"},null,8,["modelValue","onInput"]),a("div",Xe,[a("button",{onClick:e[1]||(e[1]=l=>m.value="pending"),class:I(["rounded-t px-4 py-2 text-sm md:",m.value==="pending"?"border-b-2 text-indigo-400 border-indigo-600 font-semibold":"text-gray-500"])}," Pesanan Saya ",2),a("button",{onClick:e[2]||(e[2]=l=>m.value="done"),class:I(["rounded-t px-4 py-2 text-sm md:",m.value==="done"?"border-b-2  text-indigo-400 border-indigo-600 font-semibold":"text-gray-500"])}," Selesai ",2),a("button",{onClick:e[3]||(e[3]=l=>m.value="cancel"),class:I(["rounded-t px-4 py-2 text-sm md:",m.value==="cancel"?"border-b-2  text-indigo-400 border-indigo-600 font-semibold":"text-gray-500"])}," Dibatalkan ",2)]),o(w)?(u(),g("div",et,"Memuat pesanan...")):o(Z)?(u(),g("div",tt,p(o(Z)),1)):D.value.length===0?(u(),g("div",at,"Tidak ada pesanan ditemukan. ")):(u(),g("div",lt,[m.value==="pending"&&q.value.length>0?(u(),g("div",st,[s(c,{onClick:e[4]||(e[4]=l=>de(q.value)),class:"flex items-center gap-1 rounded-md border border-indigo-600 px-3 py-1 text-indigo-600 hover:underline"},{default:n(()=>[s(o(Me),{class:"h-4 w-4"}),e[15]||(e[15]=i(" Generate QR "))]),_:1,__:[15]})])):O("",!0),s(o(je),{class:"max-h-screen w-full"},{default:n(()=>[s(o(He),null,{default:n(()=>[s(o(G),{class:"bg-gray-100"},{default:n(()=>[s(o(P),{class:"w-[5%]"},{default:n(()=>[a("div",nt,[a("input",{type:"checkbox",checked:v.value.length===D.value.length&&D.value.length>0,onChange:ce},null,40,ot)])]),_:1}),s(o(P),{class:"w-[10%]"},{default:n(()=>e[16]||(e[16]=[i("No. Order")])),_:1,__:[16]}),s(o(P),{class:"w-[10%]"},{default:n(()=>e[17]||(e[17]=[i("Tanggal")])),_:1,__:[17]}),s(o(P),{class:"w-[10%]"},{default:n(()=>e[18]||(e[18]=[i("Total")])),_:1,__:[18]}),s(o(P),{class:"w-[10%]"},{default:n(()=>e[19]||(e[19]=[i("Status")])),_:1,__:[19]}),s(o(P),{class:"w-[10%]"},{default:n(()=>e[20]||(e[20]=[i("Pembayaran")])),_:1,__:[20]})]),_:1})]),_:1}),s(o(Ve),null,{default:n(()=>[(u(!0),g(M,null,Q(D.value,l=>(u(),g(M,{key:l.id},[s(o(G),null,{default:n(()=>[s(o(k),null,{default:n(()=>[a("div",rt,[a("input",{type:"checkbox",checked:v.value.includes(l.id),onChange:b=>ge(l.id),disabled:l.payment_method!=="cod_store"},null,40,it),m.value=="pending"?(u(),g("div",ut,[a("button",{onClick:b=>pe(l.id),class:"rounded bg-gray-100 px-2 py-1 text-sm hover:bg-gray-200"}," ⋮ ",8,dt),K.value===l.id?(u(),g("div",ct,[a("div",mt,[s(c,{onClick:b=>me([l.id]),class:"block w-full px-4 py-2 hover:bg-gray-100"},{default:n(()=>e[21]||(e[21]=[i(" Kirim Pesan ")])),_:2,__:[21]},1032,["onClick"]),s(c,{onClick:b=>be(l.id),class:"block w-full px-4 py-2 text-red-500 hover:bg-gray-100"},{default:n(()=>e[22]||(e[22]=[i(" Ajukan Pembatalan ")])),_:2,__:[22]},1032,["onClick"]),l.is_paid=="Y"?(u(),z(c,{key:0,onClick:b=>ve(l.id),class:"block w-full px-4 py-2 hover:bg-gray-100"},{default:n(()=>e[23]||(e[23]=[i(" Status Pengiriman ")])),_:2,__:[23]},1032,["onClick"])):O("",!0),l.is_paid=="N"&&l.payment_method=="bank_transfer"?(u(),z(c,{key:1,onClick:b=>we(l.id),class:"block w-full px-4 py-2 hover:bg-gray-100"},{default:n(()=>e[24]||(e[24]=[i(" Upload Bukti Transfer ")])),_:2,__:[24]},1032,["onClick"])):O("",!0)])])):O("",!0)])):O("",!0)])]),_:2},1024),s(o(k),{class:"text-gray-800 text-sm leading-snug space-y-0.5"},{default:n(()=>[i(p(l.id),1)]),_:2},1024),s(o(k),{class:"text-gray-800 text-sm leading-snug space-y-0.5"},{default:n(()=>[a("div",gt,p(new Date(l.created_at).toLocaleDateString("id-ID")),1)]),_:2},1024),s(o(k),{class:"text-gray-800"},{default:n(()=>[i(p(new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(Number(l.total_amount))),1)]),_:2},1024),s(o(k),null,{default:n(()=>[a("span",{class:I({"text-yellow-600":l.status===1,"text-green-600":l.status===2,"text-red-600":l.status===3})},p(he(l.status)),3)]),_:2},1024),s(o(k),{class:"text-gray-800 text-center text-xxs"},{default:n(()=>[a("span",{class:I(["text-xxs font-small inline-block rounded-full border px-1 py-1",l.payment_method==="bank_transfer"?"border-yellow-600 text-yellow-600":l.payment_method==="cod_store"?"border-green-600 text-green-600":"border-gray-300 text-gray-500"])},p(l.payment_method==="bank_transfer"?"Transfer":l.payment_method==="cod_store"?"Bayar Di Toko":"-"),3)]),_:2},1024)]),_:2},1024),s(o(G),null,{default:n(()=>[s(o(k),{colspan:"6",class:"rounded-md border border-blue-100 bg-blue-50 p-3"},{default:n(()=>[e[25]||(e[25]=a("h4",{class:"mb-1 text-sm font-semibold"},"Detail Pesanan:",-1)),a("div",pt,[(u(!0),g(M,null,Q(l.order_items,b=>(u(),z(Be,{key:b.id,item:b},null,8,["item"]))),128))]),a("div",vt," Subtotal: "+p(new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(Number(l.total_amount))),1)]),_:2,__:[25]},1024)]),_:2},1024)],64))),128))]),_:1})]),_:1})])),a("div",{ref_key:"bottomMarker",ref:$,class:"min-h-[2px]"},null,512)]),s(H,{show:S.value,onClose:e[7]||(e[7]=l=>S.value=!1)},{default:n(()=>[a("div",ft,[e[28]||(e[28]=a("h2",{class:"text-center font-semibold text-gray-800 sm:text-lg"},"Kirim Pesan",-1)),s(o(Ae),{modelValue:N.value,"onUpdate:modelValue":e[5]||(e[5]=l=>N.value=l),class:"h-32 w-full bg-white resize-none rounded-md border border-gray-300 p-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 sm:h-40",placeholder:"Tulis pesan..."},null,8,["modelValue"]),a("div",bt,[s(c,{onClick:e[6]||(e[6]=l=>S.value=!1),variant:"outline",class:"px-4 py-2 text-sm"},{default:n(()=>e[26]||(e[26]=[i(" Batal ")])),_:1,__:[26]}),s(c,{onClick:xe,class:"bg-indigo-600 px-4 py-2 text-sm text-white hover:bg-indigo-700"},{default:n(()=>e[27]||(e[27]=[i(" Kirim ")])),_:1,__:[27]})])])]),_:1},8,["show"]),s(H,{show:V.value,onClose:e[8]||(e[8]=l=>V.value=!1)},{default:n(()=>[a("div",xt,[s(Ne,{value:Y.value,size:256},null,8,["value"])])]),_:1},8,["show"]),s(H,{show:B.value,onClose:e[10]||(e[10]=l=>B.value=!1),class:"max-w-lg"},{default:n(()=>[e[33]||(e[33]=a("h2",{class:"text-lg font-semibold mb-2"},"Informasi Pengiriman",-1)),a("div",_t,[a("p",null,[e[29]||(e[29]=a("strong",null,"No. Resi:",-1)),i(" "+p(C.value.resi_number),1)]),a("p",null,[e[30]||(e[30]=a("strong",null,"Kurir:",-1)),i(" "+p(C.value.delivery_provider),1)]),a("p",null,[e[31]||(e[31]=a("strong",null,"Estimasi Tiba:",-1)),i(" "+p(new Date(C.value.estimation_date).toLocaleDateString("id-ID")),1)]),a("div",null,[e[32]||(e[32]=i("Bukti Pengiriman ")),C.value.delivery_proof?(u(),g("img",{key:0,src:fe(C.value.delivery_proof),alt:"product",class:"w-full h-full object-cover rounded-lg cursor-pointer"},null,8,yt)):(u(),g("div",kt,"No Image "))])]),a("div",wt,[a("button",{class:"px-4 py-2 bg-blue-600 text-white rounded",onClick:e[9]||(e[9]=l=>B.value=!1)},"Tutup")])]),_:1,__:[33]},8,["show"]),s(H,{show:F.value,onClose:e[11]||(e[11]=l=>F.value=!1),class:"max-w-lg"},{default:n(()=>[e[38]||(e[38]=a("div",{class:"mb-4 text-lg font-semibold"},"Informasi Rekening",-1)),o(U).loading?(u(),g("div",ht,"Memuat data rekening...")):(u(),g("ul",Ct,[(u(!0),g(M,null,Q(o(U).bankAccount,l=>(u(),g("li",{key:l.id,class:"p-3 border rounded-lg bg-gray-50 text-sm md:text-base"},[a("div",Pt,"Bank ID: "+p(l.id),1),a("div",null,[e[34]||(e[34]=i("Atas Nama: ")),a("span",St,p(l.name),1)]),a("div",null,[e[35]||(e[35]=i("No Rekening: ")),a("span",Tt,p(l.account_number),1)])]))),128))])),a("div",$t,[e[36]||(e[36]=a("label",{class:"block mb-1 font-medium"},"Upload Bukti Transfer",-1)),a("input",{type:"file",onChange:_e,class:"block w-full text-sm text-gray-700 file:mr-4 file:py-1 file:px-3 file:rounded-md file:border-0 file:bg-blue-600 file:text-white hover:file:bg-blue-700"},null,32)]),s(c,{class:"mt-4 bg-blue-600 hover:bg-blue-700 px-4 py-2 text-white rounded-md w-full",onClick:Ce},{default:n(()=>e[37]||(e[37]=[i(" Kirim Bukti Transfer ")])),_:1,__:[37]})]),_:1,__:[38]},8,["show"])]),_:1})],64)}}});export{Rt as default};
