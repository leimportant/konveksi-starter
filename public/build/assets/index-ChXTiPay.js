import{d as ae,r as Y,c as R,w as ne,o as le,f as E,g as T,k as i,p as q,F as B,B as H,l as K,C as Ue,W as Re,u as F,j as M,D as se,x as re,y as qe,U as Ge,aT as Qe,b as ie,R as $e,m as ue,aU as Xe,aV as Je,aW as Ke}from"./app-Cy47uJEn.js";import{_ as fe}from"./Input.vue_vue_type_script_setup_true_lang-CqeMOCnl.js";import{u as Ye}from"./useSizeStore-CN7RTX5i.js";import{T as Ne}from"./trash-BI6slANe.js";import{u as Be}from"./useProductStore-C-OGbBGD.js";import{u as Ze}from"./useMasterActivityRoleStore-BQdlihy1.js";import{u as et}from"./useUomStore-C90JD-GW.js";import{A as tt}from"./vue3-select-BbduWhwE.js";const ot={class:"space-y-6"},it={class:"min-w-full divide-y divide-gray-200"},nt={class:"bg-white divide-y divide-gray-200"},st={class:"px-6 py-4 whitespace-nowrap bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"},rt=["onUpdate:modelValue","disabled"],at=["value"],lt={key:0,class:"text-destructive"},ct={class:"px-6 py-4 whitespace-nowrap bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"},dt={class:"px-6 py-4 whitespace-nowrap bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"},ut={class:"px-6 py-4 whitespace-nowrap bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"},xo=ae({__name:"SizeTab",props:{modelValue:{}},emits:["update:modelValue","update:totalQuantity"],setup(v,{emit:A}){const V=v,j=A,L=Ye(),f=Y(V.modelValue.slice()),P=R(()=>f.value.reduce((y,b)=>y+(Number(b.qty)||0),0));ne(P,y=>{j("update:totalQuantity",y)}),ne(f,y=>j("update:modelValue",y),{deep:!0}),le(()=>{L.fetchSizes(),j("update:totalQuantity",P.value)});const C=()=>{f.value.push({size_id:"",qty:0,variant:""})},h=y=>{f.value.splice(y,1)};return(y,b)=>(T(),E("div",ot,[i("table",it,[b[1]||(b[1]=i("thead",null,[i("tr",null,[i("th",{class:"px-6 py-5 text-left text-xs bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring uppercase"},"Size"),i("th",{class:"px-6 py-5 text-left text-xs bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring uppercase"},"Variant"),i("th",{class:"px-6 py-5 text-left text-xs bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring uppercase"},"Quantity"),i("th",{class:"px-6 py-5 text-left text-xs bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring uppercase w-16"},"Action")])],-1)),i("tbody",nt,[(T(!0),E(B,null,H(f.value,($,x)=>(T(),E("tr",{key:x},[i("td",st,[K(i("select",{"onUpdate:modelValue":S=>$.size_id=S,class:"block w-full rounded-md border bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring py-2 px-3 shadow-sm sm:text-sm",disabled:F(L).isLoading},[b[0]||(b[0]=i("option",{disabled:"",value:"0"},"Pilih Ukuran",-1)),(T(!0),E(B,null,H(F(L).sizes,S=>(T(),E("option",{key:S.id,value:S.id},M(S.name),9,at))),128))],8,rt),[[Re,$.size_id]]),F(L).error?(T(),E("small",lt,M(F(L).error),1)):Ue("",!0)]),i("td",ct,[q(F(fe),{type:"text",modelValue:$.variant,"onUpdate:modelValue":S=>$.variant=S,class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),i("td",dt,[q(F(fe),{type:"number",modelValue:$.qty,"onUpdate:modelValue":S=>$.qty=S,class:"w-full",min:"0"},null,8,["modelValue","onUpdate:modelValue"])]),i("td",ut,[q(F(se),{variant:"destructive",size:"icon",onClick:S=>h(x)},{default:re(()=>[q(F(Ne))]),_:2},1032,["onClick"])])]))),128))])]),q(F(se),{type:"button",onClick:C},{default:re(()=>b[2]||(b[2]=[i("i",{class:"pi pi-plus"},null,-1),qe(" Tambah Ukuran ")])),_:1,__:[2]})]))}}),pt=Ge("activity",()=>{const v=Y([]),A=Qe({}),V=Y([]);return{roles:v,rolesMap:A,items:V,fetchRoles:async()=>{try{const C=(await(await fetch("/api/activity-roles")).json()).data;v.value=C,C.forEach(h=>{A[h.id]=h.name}),V.value=C.map(h=>{const y=V.value.find(b=>b.role_id===h.id);return{role_id:h.id,price:(y==null?void 0:y.price)??0}})}catch(f){console.error("Failed to fetch menus",f)}},updatePrice:(f,P)=>{const C=parseFloat(P);V.value[f].price=isNaN(C)?0:C}}}),ft={class:"min-w-full divide-y divide-gray-200"},mt={class:"px-6 py-4 whitespace-nowrap bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"},ht={class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"},_o=ae({__name:"ActivityTab",props:{modelValue:{}},emits:["update:modelValue"],setup(v,{emit:A}){const V=v,j=A,L=pt(),{rolesMap:f}=L,P=Y(V.modelValue);le(async()=>{await L.fetchRoles(),P.value.length===0&&(P.value=Object.keys(f).map(h=>({activity_role_id:parseInt(h),price:0})),j("update:modelValue",P.value))}),ne(P,h=>{j("update:modelValue",h)},{deep:!0});const C=(h,y)=>{const b=parseFloat(y);P.value[h].price=isNaN(b)?0:b};return(h,y)=>(T(),E("div",null,[i("table",ft,[y[0]||(y[0]=i("thead",null,[i("tr",null,[i("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Aktivitas"),i("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Upah Per Hari")])],-1)),i("tbody",null,[(T(!0),E(B,null,H(P.value,(b,$)=>(T(),E("tr",{key:b.activity_role_id,class:"bg-white even:bg-gray-50"},[i("td",mt,M(F(f)[b.activity_role_id]||"Unknown"),1),i("td",ht,[q(F(fe),{type:"number",min:"0",modelValue:b.price,"onUpdate:modelValue":x=>b.price=x,onInput:x=>C($,x.target.value)},null,8,["modelValue","onUpdate:modelValue","onInput"])])]))),128))])])]))}}),vt={class:"space-y-4 sm:space-y-6"},gt={class:"rounded-lg border p-3 sm:p-4 space-y-3 sm:space-y-4"},bt={class:"space-y-2"},yt={class:"grid gap-1 sm:gap-2 text-sm"},wt={class:"flex justify-between"},xt={class:"text-[12px]"},_t={class:"flex justify-between"},St={class:"text-[12px]"},kt={class:"flex justify-between font-medium"},Vt={class:"text-[12px]"},Pt={class:"space-y-2"},Et={class:"grid gap-1 sm:gap-2 text-sm"},Tt={class:"text-[12px]"},It={class:"text-[12px]"},Mt={class:"flex justify-between font-medium pt-2 border-t text-sm sm:"},Dt={class:"text-[12px]"},Ct={class:"flex justify-between font-medium pt-2 border-t text-sm sm:"},jt={class:"text-[12px]"},Lt={class:"space-y-2"},Ot={class:"grid gap-1 sm:gap-2 text-sm"},At={class:"text-[12px]"},$t={class:"text-[12px]"},Ft={class:"space-y-2"},Ut={class:"grid gap-1 sm:gap-2"},Rt={class:"flex flex-col"},qt={class:"text-sm"},Nt={class:"text-xs sm:text-sm text-gray-500"},Bt={class:"flex flex-col items-end"},Ht={class:"text-xs sm:text-sm"},zt={class:"text-sm font-medium"},Wt={class:"flex justify-between font-medium pt-2 border-t text-sm sm:"},Gt={class:"text-[12px]"},Qt={class:"flex justify-between font-bold pt-4 border-t sm:text-lg"},Xt={class:"text-[12px]"},Jt={class:"flex justify-between font-medium text-sm sm:"},Kt={class:"text-[12px]"},So=ae({__name:"HPPTab",props:{modelMaterials:{},activityItems:{},sizeItems:{},startDate:{},endDate:{}},setup(v){const A=v,V=Be(),j=Ze(),L=R(()=>V.items),f=r=>{const a=typeof r=="object"&&r!==null?r.id:r,l=L.value.find(O=>O.id===a);return(l==null?void 0:l.name)||`Material ${a}`},P=R(()=>A.modelMaterials.map(r=>({material_id:typeof r.product_id=="object"?r.product_id.id:r.product_id,qty:r.qty,price:r.price||0}))),C=R(()=>P.value.reduce((r,a)=>r+a.qty*a.price,0)),h=(r,a)=>{if(!r||!a)return 1;const l=new Date(r),O=new Date(a),I=Math.abs(O.getTime()-l.getTime());return Math.ceil(I/(1e3*60*60*24))||1},y=R(()=>A.activityItems.reduce((r,a)=>r+(a.price||0)*x.value,0)),b=R(()=>C.value+y.value),$=R(()=>x.value===0?0:b.value/x.value),x=R(()=>{var r;return((r=A.sizeItems)==null?void 0:r.reduce((a,l)=>a+l.qty,0))||0}),S=r=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(r),u=r=>{const a=j.items.find(l=>l.id===r.activity_role_id);return a!=null&&a.name?a.name:r.activity_name||`Aktivitas ${r.activity_role_id}`};le(async()=>{try{await Promise.all([V.fetchProducts(),j.fetchActivityRoles()])}catch(r){console.error("Failed to fetch data:",r)}});const d=r=>r?new Date(r).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric"}):"-";return(r,a)=>(T(),E("div",vt,[i("div",gt,[a[12]||(a[12]=i("h3",{class:"sm:text-lg font-semibold border-b pb-2"},"Ringkasan HPP",-1)),i("div",bt,[a[3]||(a[3]=i("span",{class:"text-[14px]"},"Durasi Proyek",-1)),i("div",yt,[i("div",wt,[a[0]||(a[0]=i("span",{class:"text-[12px]"},"Tanggal Mulai",-1)),i("span",xt,M(d(r.startDate)),1)]),i("div",_t,[a[1]||(a[1]=i("span",{class:"text-[12px]"},"Tanggal Selesai",-1)),i("span",St,M(d(r.endDate)),1)]),i("div",kt,[a[2]||(a[2]=i("span",{class:"text-[12px]"},"Total Durasi",-1)),i("span",Vt,M(h(r.startDate,r.endDate))+" hari",1)])])]),i("div",Pt,[a[6]||(a[6]=i("span",{class:"text-[14px]"},"Biaya Material",-1)),i("div",Et,[(T(!0),E(B,null,H(r.modelMaterials,l=>(T(),E("div",{key:typeof l.product_id=="object"?l.product_id.id:l.product_id,class:"flex justify-between"},[i("span",Tt,M(f(l.product_id)),1),i("span",It,M(S(l.qty*(l.price||0))),1)]))),128))]),i("div",Mt,[a[4]||(a[4]=i("span",{class:"text-[12px]"},"Total Biaya Material",-1)),i("span",Dt,M(S(C.value)),1)]),i("div",Ct,[a[5]||(a[5]=i("span",{class:"text-[12px]"},"Total Produksi",-1)),i("span",jt,M(x.value),1)])]),i("div",Lt,[a[7]||(a[7]=i("span",{class:"text-[14px]"},"Ukuran",-1)),i("div",Ot,[(T(!0),E(B,null,H(r.sizeItems,l=>(T(),E("div",{key:l.size_id,class:"flex justify-between"},[i("span",At,M(l.size_id),1),i("span",$t,M(l.qty),1)]))),128))])]),i("div",Ft,[a[9]||(a[9]=i("span",{class:"text-[14px]"},"Biaya Aktivitas",-1)),i("div",Ut,[(T(!0),E(B,null,H(r.activityItems,l=>(T(),E("div",{key:l.activity_role_id,class:"flex justify-between"},[i("div",Rt,[i("span",qt,M(u(l)),1),i("span",Nt,M(h(r.startDate,r.endDate))+" hari ",1)]),i("div",Bt,[i("span",Ht,M(S(l.price||0))+" / PCS",1),i("span",zt,M(S((l.price||0)*x.value)),1)])]))),128))]),i("div",Wt,[a[8]||(a[8]=i("span",{class:"text-[12px]"},"Total Biaya Aktivitas",-1)),i("span",Gt,M(S(y.value)),1)])]),i("div",Qt,[a[10]||(a[10]=i("span",{class:"text-[12px]"},"Total HPP",-1)),i("span",Xt,M(S(b.value)),1)]),i("div",Jt,[a[11]||(a[11]=i("span",{class:"text-[12px]"},"HPP per PCS",-1)),i("span",Kt,M(S($.value)),1)])])]))}}),Yt={class:"space-y-4"},Zt={class:"flex justify-between items-center border-b pb-2"},eo={class:"font-medium"},to={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},oo={class:"flex gap-2"},io=["onUpdate:modelValue"],no=["onUpdate:modelValue"],so={key:0,disabled:""},ro=["value","selected"],ao=["onUpdate:modelValue"],lo={class:"md:col-span-2"},co=["onUpdate:modelValue"],uo={class:"flex justify-end"},ko=ae({__name:"ModelMaterialTab",props:{modelValue:{}},emits:["update:modelValue"],setup(v,{emit:A}){const V=v,j=A,L=Be(),f=et(),P=R(()=>L.items),C=R(()=>f.items),h=Y([]),y=()=>{const u=[...V.modelValue];u.push({product_id:null,qty:1,uom_id:null,remark:"",price:null}),j("update:modelValue",u)},b=async u=>{const d=h.value.filter(O=>V.modelValue.some(I=>I.product_id===O.id));let r=[];if(u.length>=2)try{r=(await ie.get("/api/bahan",{params:{search:u}})).data.data}catch(O){console.error("Search error:",O)}const a=[...d,...r],l=Array.from(new Set(a.map(O=>O.id))).map(O=>a.find(I=>I.id===O));h.value=l},$=u=>{const d=[...V.modelValue];d.splice(u,1),j("update:modelValue",d)};le(async()=>{try{const u=V.modelValue.map(I=>I.product_id).filter(I=>I!==null),d=Array.from(new Set(u)),r=[];for(const I of d)try{const N=await ie.get(`/api/bahan/${I}`);N.data&&r.push(N.data)}catch(N){console.error(`Failed to fetch product with ID ${I} for initial modelValue:`,N)}h.value=r,await Promise.all([L.fetchProducts(),f.fetchUoms()]);const a=L.items.map(I=>({id:I.id,name:I.name})),l=[...h.value,...a],O=Array.from(new Set(l.map(I=>I.id))).map(I=>l.find(N=>N.id===I));h.value=O}catch(u){console.error("Failed to fetch data:",u)}});const x=u=>{if(!u)return null;const d=P.value.find(r=>r.id===u);return(d==null?void 0:d.uom_id)||null};ne(()=>V.modelValue,async u=>{for(const d of u)if(d.product_id&&(d.uom_id||(d.uom_id=x(d.product_id)),!h.value.some(a=>a.id===d.product_id)))try{const a=await ie.get(`/api/bahan/${d.product_id}`);a.data&&h.value.push(a.data)}catch(a){console.error(`Failed to fetch product with ID ${d.product_id}:`,a)}},{deep:!0});const S=(u,d)=>{const r=[...V.modelValue];d>=0&&d<r.length&&(u&&typeof u=="object"?(r[d].product_id=u.id,h.value.some(a=>a.id===u.id)||h.value.push(u)):typeof u=="number"&&(r[d].product_id=u,h.value.find(l=>l.id===u)||ie.get(`/api/bahan/${u}`).then(l=>{l.data&&h.value.push(l.data)}).catch(l=>{console.error(`Failed to fetch product with ID ${u}:`,l)})),r[d].uom_id||(r[d].uom_id=x(r[d].product_id)),j("update:modelValue",r))};return(u,d)=>(T(),E("div",Yt,[(T(!0),E(B,null,H(u.modelValue,(r,a)=>(T(),E("div",{key:a,class:"p-4 border rounded-lg space-y-4"},[i("div",Zt,[i("h3",eo,"Material #"+M(a+1),1),q(F(se),{type:"button",variant:"destructive",size:"icon",onClick:$e(l=>$(a),["prevent"])},{default:re(()=>[q(F(Ne))]),_:2},1032,["onClick"])]),i("div",to,[i("div",null,[d[0]||(d[0]=i("label",{class:"text-sm font-medium block mb-1"},"Material",-1)),q(F(tt),{modelValue:r.product_id,"onUpdate:modelValue":[l=>r.product_id=l,l=>S(l,a)],options:h.value,label:"name",value:"id",reduce:l=>l.id,onSearch:b,placeholder:"Pilih Material",class:"w-full text-sm"},null,8,["modelValue","onUpdate:modelValue","options","reduce"])]),i("div",null,[d[2]||(d[2]=i("label",{class:"text-sm font-medium block mb-1"},"Quantity, Unit & Price",-1)),i("div",oo,[K(i("input",{type:"number","onUpdate:modelValue":l=>r.qty=l,min:"1",class:"block w-1/3 rounded-md border bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring py-2 px-3 shadow-sm sm:text-sm"},null,8,io),[[ue,r.qty]]),K(i("select",{"onUpdate:modelValue":l=>r.uom_id=l,class:"block w-1/3 rounded-md border bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring py-2 px-3 shadow-sm sm:text-sm"},[d[1]||(d[1]=i("option",{value:""},"Pilih Unit",-1)),C.value.length===0?(T(),E("option",so,"Loading units...")):Ue("",!0),(T(!0),E(B,null,H(C.value,l=>(T(),E("option",{key:l.id,value:l.id,selected:l.id===x(r.product_id)},M(l.name),9,ro))),128))],8,no),[[Re,r.uom_id]]),K(i("input",{type:"number","onUpdate:modelValue":l=>r.price=l,min:"0",placeholder:"Harga",class:"block w-1/3 rounded-md border bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring py-2 px-3 shadow-sm sm:text-sm"},null,8,ao),[[ue,r.price]])])]),i("div",lo,[d[3]||(d[3]=i("label",{class:"text-sm font-medium block mb-1"},"Remark",-1)),K(i("input",{type:"text","onUpdate:modelValue":l=>r.remark=l,class:"block w-full rounded-md border bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring py-2 px-3 shadow-sm sm:text-sm",placeholder:"Optional remark"},null,8,co),[[ue,r.remark]])])])]))),128)),i("div",uo,[q(F(se),{type:"button",variant:"secondary",onClick:$e(y,["prevent"])},{default:re(()=>d[4]||(d[4]=[i("i",{class:"pi pi-plus mr-2"},null,-1),qe(" Tambah Material ")])),_:1,__:[4]})])]))}});var pe={},Fe;function po(){return Fe||(Fe=1,function(v){function A(s){return s&&typeof s=="object"&&"default"in s?s.default:s}var V=A(Xe()),j=Ke(),L=A(Je());function f(){return(f=Object.assign?Object.assign.bind():function(s){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(s[t]=e[t])}return s}).apply(this,arguments)}var P,C={modal:null,listener:null,show:function(s){var n=this;typeof s=="object"&&(s="All Inertia requests must receive a valid Inertia response, however a plain JSON response was received.<hr>"+JSON.stringify(s));var e=document.createElement("html");e.innerHTML=s,e.querySelectorAll("a").forEach(function(o){return o.setAttribute("target","_top")}),this.modal=document.createElement("div"),this.modal.style.position="fixed",this.modal.style.width="100vw",this.modal.style.height="100vh",this.modal.style.padding="50px",this.modal.style.boxSizing="border-box",this.modal.style.backgroundColor="rgba(0, 0, 0, .6)",this.modal.style.zIndex=2e5,this.modal.addEventListener("click",function(){return n.hide()});var t=document.createElement("iframe");if(t.style.backgroundColor="white",t.style.borderRadius="5px",t.style.width="100%",t.style.height="100%",this.modal.appendChild(t),document.body.prepend(this.modal),document.body.style.overflow="hidden",!t.contentWindow)throw new Error("iframe not yet ready.");t.contentWindow.document.open(),t.contentWindow.document.write(e.outerHTML),t.contentWindow.document.close(),this.listener=this.hideOnEscape.bind(this),document.addEventListener("keydown",this.listener)},hide:function(){this.modal.outerHTML="",this.modal=null,document.body.style.overflow="visible",document.removeEventListener("keydown",this.listener)},hideOnEscape:function(s){s.keyCode===27&&this.hide()}};function h(s,n){var e;return function(){var t=arguments,o=this;clearTimeout(e),e=setTimeout(function(){return s.apply(o,[].slice.call(t))},n)}}function y(s,n,e){for(var t in n===void 0&&(n=new FormData),e===void 0&&(e=null),s=s||{})Object.prototype.hasOwnProperty.call(s,t)&&$(n,b(e,t),s[t]);return n}function b(s,n){return s?s+"["+n+"]":n}function $(s,n,e){return Array.isArray(e)?Array.from(e.keys()).forEach(function(t){return $(s,b(n,t.toString()),e[t])}):e instanceof Date?s.append(n,e.toISOString()):e instanceof File?s.append(n,e,e.name):e instanceof Blob?s.append(n,e):typeof e=="boolean"?s.append(n,e?"1":"0"):typeof e=="string"?s.append(n,e):typeof e=="number"?s.append(n,""+e):e==null?s.append(n,""):void y(e,s,n)}function x(s){return new URL(s.toString(),window.location.toString())}function S(s,n,e,t){t===void 0&&(t="brackets");var o=/^https?:\/\//.test(n.toString()),c=o||n.toString().startsWith("/"),w=!c&&!n.toString().startsWith("#")&&!n.toString().startsWith("?"),k=n.toString().includes("?")||s===v.Method.GET&&Object.keys(e).length,g=n.toString().includes("#"),p=new URL(n.toString(),"http://localhost");return s===v.Method.GET&&Object.keys(e).length&&(p.search=j.stringify(L(j.parse(p.search,{ignoreQueryPrefix:!0}),e),{encodeValuesOnly:!0,arrayFormat:t}),e={}),[[o?p.protocol+"//"+p.host:"",c?p.pathname:"",w?p.pathname.substring(1):"",k?p.search:"",g?p.hash:""].join(""),e]}function u(s){return(s=new URL(s.href)).hash="",s}function d(s,n){return document.dispatchEvent(new CustomEvent("inertia:"+s,n))}(P=v.Method||(v.Method={})).GET="get",P.POST="post",P.PUT="put",P.PATCH="patch",P.DELETE="delete";var r=function(s){return d("finish",{detail:{visit:s}})},a=function(s){return d("navigate",{detail:{page:s}})},l=typeof window>"u",O=function(){function s(){this.visitId=null}var n=s.prototype;return n.init=function(e){var t=e.resolveComponent,o=e.swapComponent;this.page=e.initialPage,this.resolveComponent=t,this.swapComponent=o,this.isBackForwardVisit()?this.handleBackForwardVisit(this.page):this.isLocationVisit()?this.handleLocationVisit(this.page):this.handleInitialPageVisit(this.page),this.setupEventListeners()},n.handleInitialPageVisit=function(e){this.page.url+=window.location.hash,this.setPage(e,{preserveState:!0}).then(function(){return a(e)})},n.setupEventListeners=function(){window.addEventListener("popstate",this.handlePopstateEvent.bind(this)),document.addEventListener("scroll",h(this.handleScrollEvent.bind(this),100),!0)},n.scrollRegions=function(){return document.querySelectorAll("[scroll-region]")},n.handleScrollEvent=function(e){typeof e.target.hasAttribute=="function"&&e.target.hasAttribute("scroll-region")&&this.saveScrollPositions()},n.saveScrollPositions=function(){this.replaceState(f({},this.page,{scrollRegions:Array.from(this.scrollRegions()).map(function(e){return{top:e.scrollTop,left:e.scrollLeft}})}))},n.resetScrollPositions=function(){var e;window.scrollTo(0,0),this.scrollRegions().forEach(function(t){typeof t.scrollTo=="function"?t.scrollTo(0,0):(t.scrollTop=0,t.scrollLeft=0)}),this.saveScrollPositions(),window.location.hash&&((e=document.getElementById(window.location.hash.slice(1)))==null||e.scrollIntoView())},n.restoreScrollPositions=function(){var e=this;this.page.scrollRegions&&this.scrollRegions().forEach(function(t,o){var c=e.page.scrollRegions[o];c&&(typeof t.scrollTo=="function"?t.scrollTo(c.left,c.top):(t.scrollTop=c.top,t.scrollLeft=c.left))})},n.isBackForwardVisit=function(){return window.history.state&&window.performance&&window.performance.getEntriesByType("navigation").length>0&&window.performance.getEntriesByType("navigation")[0].type==="back_forward"},n.handleBackForwardVisit=function(e){var t=this;window.history.state.version=e.version,this.setPage(window.history.state,{preserveScroll:!0,preserveState:!0}).then(function(){t.restoreScrollPositions(),a(e)})},n.locationVisit=function(e,t){try{window.sessionStorage.setItem("inertiaLocationVisit",JSON.stringify({preserveScroll:t})),window.location.href=e.href,u(window.location).href===u(e).href&&window.location.reload()}catch{return!1}},n.isLocationVisit=function(){try{return window.sessionStorage.getItem("inertiaLocationVisit")!==null}catch{return!1}},n.handleLocationVisit=function(e){var t,o,c,w,k=this,g=JSON.parse(window.sessionStorage.getItem("inertiaLocationVisit")||"");window.sessionStorage.removeItem("inertiaLocationVisit"),e.url+=window.location.hash,e.rememberedState=(t=(o=window.history.state)==null?void 0:o.rememberedState)!=null?t:{},e.scrollRegions=(c=(w=window.history.state)==null?void 0:w.scrollRegions)!=null?c:[],this.setPage(e,{preserveScroll:g.preserveScroll,preserveState:!0}).then(function(){g.preserveScroll&&k.restoreScrollPositions(),a(e)})},n.isLocationVisitResponse=function(e){return e&&e.status===409&&e.headers["x-inertia-location"]},n.isInertiaResponse=function(e){return e==null?void 0:e.headers["x-inertia"]},n.createVisitId=function(){return this.visitId={},this.visitId},n.cancelVisit=function(e,t){var o=t.cancelled,c=o!==void 0&&o,w=t.interrupted,k=w!==void 0&&w;!e||e.completed||e.cancelled||e.interrupted||(e.cancelToken.cancel(),e.onCancel(),e.completed=!1,e.cancelled=c,e.interrupted=k,r(e),e.onFinish(e))},n.finishVisit=function(e){e.cancelled||e.interrupted||(e.completed=!0,e.cancelled=!1,e.interrupted=!1,r(e),e.onFinish(e))},n.resolvePreserveOption=function(e,t){return typeof e=="function"?e(t):e==="errors"?Object.keys(t.props.errors||{}).length>0:e},n.visit=function(e,t){var o=this,c=t===void 0?{}:t,w=c.method,k=w===void 0?v.Method.GET:w,g=c.data,p=g===void 0?{}:g,U=c.replace,z=U!==void 0&&U,X=c.preserveScroll,W=X!==void 0&&X,Z=c.preserveState,ee=Z!==void 0&&Z,me=c.only,te=me===void 0?[]:me,he=c.headers,ve=he===void 0?{}:he,ge=c.errorBag,G=ge===void 0?"":ge,be=c.forceFormData,ye=be!==void 0&&be,we=c.onCancelToken,xe=we===void 0?function(){}:we,_e=c.onBefore,Se=_e===void 0?function(){}:_e,ke=c.onStart,Ve=ke===void 0?function(){}:ke,Pe=c.onProgress,Ee=Pe===void 0?function(){}:Pe,Te=c.onFinish,He=Te===void 0?function(){}:Te,Ie=c.onCancel,ze=Ie===void 0?function(){}:Ie,Me=c.onSuccess,De=Me===void 0?function(){}:Me,Ce=c.onError,je=Ce===void 0?function(){}:Ce,Le=c.queryStringArrayFormat,ce=Le===void 0?"brackets":Le,Q=typeof e=="string"?x(e):e;if(!function m(_){return _ instanceof File||_ instanceof Blob||_ instanceof FileList&&_.length>0||_ instanceof FormData&&Array.from(_.values()).some(function(D){return m(D)})||typeof _=="object"&&_!==null&&Object.values(_).some(function(D){return m(D)})}(p)&&!ye||p instanceof FormData||(p=y(p)),!(p instanceof FormData)){var Oe=S(k,Q,p,ce),We=Oe[1];Q=x(Oe[0]),p=We}var J={url:Q,method:k,data:p,replace:z,preserveScroll:W,preserveState:ee,only:te,headers:ve,errorBag:G,forceFormData:ye,queryStringArrayFormat:ce,cancelled:!1,completed:!1,interrupted:!1};if(Se(J)!==!1&&function(m){return d("before",{cancelable:!0,detail:{visit:m}})}(J)){this.activeVisit&&this.cancelVisit(this.activeVisit,{interrupted:!0}),this.saveScrollPositions();var Ae=this.createVisitId();this.activeVisit=f({},J,{onCancelToken:xe,onBefore:Se,onStart:Ve,onProgress:Ee,onFinish:He,onCancel:ze,onSuccess:De,onError:je,queryStringArrayFormat:ce,cancelToken:V.CancelToken.source()}),xe({cancel:function(){o.activeVisit&&o.cancelVisit(o.activeVisit,{cancelled:!0})}}),function(m){d("start",{detail:{visit:m}})}(J),Ve(J),V({method:k,url:u(Q).href,data:k===v.Method.GET?{}:p,params:k===v.Method.GET?p:{},cancelToken:this.activeVisit.cancelToken.token,headers:f({},ve,{Accept:"text/html, application/xhtml+xml","X-Requested-With":"XMLHttpRequest","X-Inertia":!0},te.length?{"X-Inertia-Partial-Component":this.page.component,"X-Inertia-Partial-Data":te.join(",")}:{},G&&G.length?{"X-Inertia-Error-Bag":G}:{},this.page.version?{"X-Inertia-Version":this.page.version}:{}),onUploadProgress:function(m){p instanceof FormData&&(m.percentage=Math.round(m.loaded/m.total*100),function(_){d("progress",{detail:{progress:_}})}(m),Ee(m))}}).then(function(m){var _;if(!o.isInertiaResponse(m))return Promise.reject({response:m});var D=m.data;te.length&&D.component===o.page.component&&(D.props=f({},o.page.props,D.props)),W=o.resolvePreserveOption(W,D),(ee=o.resolvePreserveOption(ee,D))&&(_=window.history.state)!=null&&_.rememberedState&&D.component===o.page.component&&(D.rememberedState=window.history.state.rememberedState);var de=Q,oe=x(D.url);return de.hash&&!oe.hash&&u(de).href===oe.href&&(oe.hash=de.hash,D.url=oe.href),o.setPage(D,{visitId:Ae,replace:z,preserveScroll:W,preserveState:ee})}).then(function(){var m=o.page.props.errors||{};if(Object.keys(m).length>0){var _=G?m[G]?m[G]:{}:m;return function(D){d("error",{detail:{errors:D}})}(_),je(_)}return d("success",{detail:{page:o.page}}),De(o.page)}).catch(function(m){if(o.isInertiaResponse(m.response))return o.setPage(m.response.data,{visitId:Ae});if(o.isLocationVisitResponse(m.response)){var _=x(m.response.headers["x-inertia-location"]),D=Q;D.hash&&!_.hash&&u(D).href===_.href&&(_.hash=D.hash),o.locationVisit(_,W===!0)}else{if(!m.response)return Promise.reject(m);d("invalid",{cancelable:!0,detail:{response:m.response}})&&C.show(m.response.data)}}).then(function(){o.activeVisit&&o.finishVisit(o.activeVisit)}).catch(function(m){if(!V.isCancel(m)){var _=d("exception",{cancelable:!0,detail:{exception:m}});if(o.activeVisit&&o.finishVisit(o.activeVisit),_)return Promise.reject(m)}})}},n.setPage=function(e,t){var o=this,c=t===void 0?{}:t,w=c.visitId,k=w===void 0?this.createVisitId():w,g=c.replace,p=g!==void 0&&g,U=c.preserveScroll,z=U!==void 0&&U,X=c.preserveState,W=X!==void 0&&X;return Promise.resolve(this.resolveComponent(e.component)).then(function(Z){k===o.visitId&&(e.scrollRegions=e.scrollRegions||[],e.rememberedState=e.rememberedState||{},(p=p||x(e.url).href===window.location.href)?o.replaceState(e):o.pushState(e),o.swapComponent({component:Z,page:e,preserveState:W}).then(function(){z||o.resetScrollPositions(),p||a(e)}))})},n.pushState=function(e){this.page=e,window.history.pushState(e,"",e.url)},n.replaceState=function(e){this.page=e,window.history.replaceState(e,"",e.url)},n.handlePopstateEvent=function(e){var t=this;if(e.state!==null){var o=e.state,c=this.createVisitId();Promise.resolve(this.resolveComponent(o.component)).then(function(k){c===t.visitId&&(t.page=o,t.swapComponent({component:k,page:o,preserveState:!1}).then(function(){t.restoreScrollPositions(),a(o)}))})}else{var w=x(this.page.url);w.hash=window.location.hash,this.replaceState(f({},this.page,{url:w.href})),this.resetScrollPositions()}},n.get=function(e,t,o){return t===void 0&&(t={}),o===void 0&&(o={}),this.visit(e,f({},o,{method:v.Method.GET,data:t}))},n.reload=function(e){return e===void 0&&(e={}),this.visit(window.location.href,f({},e,{preserveScroll:!0,preserveState:!0}))},n.replace=function(e,t){var o;return t===void 0&&(t={}),console.warn("Inertia.replace() has been deprecated and will be removed in a future release. Please use Inertia."+((o=t.method)!=null?o:"get")+"() instead."),this.visit(e,f({preserveState:!0},t,{replace:!0}))},n.post=function(e,t,o){return t===void 0&&(t={}),o===void 0&&(o={}),this.visit(e,f({preserveState:!0},o,{method:v.Method.POST,data:t}))},n.put=function(e,t,o){return t===void 0&&(t={}),o===void 0&&(o={}),this.visit(e,f({preserveState:!0},o,{method:v.Method.PUT,data:t}))},n.patch=function(e,t,o){return t===void 0&&(t={}),o===void 0&&(o={}),this.visit(e,f({preserveState:!0},o,{method:v.Method.PATCH,data:t}))},n.delete=function(e,t){return t===void 0&&(t={}),this.visit(e,f({preserveState:!0},t,{method:v.Method.DELETE}))},n.remember=function(e,t){var o,c;t===void 0&&(t="default"),l||this.replaceState(f({},this.page,{rememberedState:f({},(o=this.page)==null?void 0:o.rememberedState,(c={},c[t]=e,c))}))},n.restore=function(e){var t,o;if(e===void 0&&(e="default"),!l)return(t=window.history.state)==null||(o=t.rememberedState)==null?void 0:o[e]},n.on=function(e,t){var o=function(c){var w=t(c);c.cancelable&&!c.defaultPrevented&&w===!1&&c.preventDefault()};return document.addEventListener("inertia:"+e,o),function(){return document.removeEventListener("inertia:"+e,o)}},s}(),I={buildDOMElement:function(s){var n=document.createElement("template");n.innerHTML=s;var e=n.content.firstChild;if(!s.startsWith("<script "))return e;var t=document.createElement("script");return t.innerHTML=e.innerHTML,e.getAttributeNames().forEach(function(o){t.setAttribute(o,e.getAttribute(o)||"")}),t},isInertiaManagedElement:function(s){return s.nodeType===Node.ELEMENT_NODE&&s.getAttribute("inertia")!==null},findMatchingElementIndex:function(s,n){var e=s.getAttribute("inertia");return e!==null?n.findIndex(function(t){return t.getAttribute("inertia")===e}):-1},update:h(function(s){var n=this,e=s.map(function(t){return n.buildDOMElement(t)});Array.from(document.head.childNodes).filter(function(t){return n.isInertiaManagedElement(t)}).forEach(function(t){var o=n.findMatchingElementIndex(t,e);if(o!==-1){var c,w=e.splice(o,1)[0];w&&!t.isEqualNode(w)&&(t==null||(c=t.parentNode)==null||c.replaceChild(w,t))}else{var k;t==null||(k=t.parentNode)==null||k.removeChild(t)}}),e.forEach(function(t){return document.head.appendChild(t)})},1)},N=new O;v.Inertia=N,v.createHeadManager=function(s,n,e){var t={},o=0;function c(){var k=Object.values(t).reduce(function(g,p){return g.concat(p)},[]).reduce(function(g,p){if(p.indexOf("<")===-1)return g;if(p.indexOf("<title ")===0){var U=p.match(/(<title [^>]+>)(.*?)(<\/title>)/);return g.title=U?""+U[1]+n(U[2])+U[3]:p,g}var z=p.match(/ inertia="[^"]+"/);return z?g[z[0]]=p:g[Object.keys(g).length]=p,g},{});return Object.values(k)}function w(){s?e(c()):I.update(c())}return{createProvider:function(){var k=function(){var g=o+=1;return t[g]=[],g.toString()}();return{update:function(g){return function(p,U){U===void 0&&(U=[]),p!==null&&Object.keys(t).indexOf(p)>-1&&(t[p]=U),w()}(k,g)},disconnect:function(){return function(g){g!==null&&Object.keys(t).indexOf(g)!==-1&&(delete t[g],w())}(k)}}}}},v.hrefToUrl=x,v.mergeDataIntoQueryString=S,v.shouldIntercept=function(s){var n=s.currentTarget.tagName.toLowerCase()==="a";return!(s.target&&s!=null&&s.target.isContentEditable||s.defaultPrevented||n&&s.which>1||n&&s.altKey||n&&s.ctrlKey||n&&s.metaKey||n&&s.shiftKey)},v.urlWithoutHash=u}(pe)),pe}var Vo=po();export{xo as _,_o as a,ko as b,So as c,Vo as d};
