import{d as Z,r as p,q as G,T as J,o as O,f as d,g as l,p as n,u as s,Z as R,x as h,k as o,F as w,B as T,z as k,j as v,N as W,C as u,l as X,U as ee,D as E,V as j,y as z}from"./app-DgzxhTP3.js";import{_ as te}from"./AppLayout.vue_vue_type_script_setup_true_lang-D0l3JYCA.js";import{_ as M}from"./Input.vue_vue_type_script_setup_true_lang-CALDZOAz.js";import{_ as N}from"./DateInput.vue_vue_type_script_setup_true_lang-Cwr0bDp0.js";import{_ as ae}from"./DocumentList.vue_vue_type_script_setup_true_lang-C0dCCPPk.js";import{d as se,_ as oe,a as ie,b as re,c as de}from"./index-DJJ_7KZ4.js";import{u as le}from"./useModelStore-CXAE2KVi.js";import{u as ne}from"./useCategoryStore-DkP-9ING.js";import{u as ue}from"./useToast-c3ax_3CI.js";import"./index-CPfE72Op.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BUaCCMKq.js";import"./trash-DahE2WFd.js";import"./useSizeStore-DXrkUaK9.js";import"./useProductStore-CaPXR0AA.js";import"./useMasterActivityRoleStore-BwJGtLVn.js";import"./useUomStore-DDquT3N5.js";import"./vue3-select-C4YVTgih.js";const me={class:"rounded-xl bg-white p-6 shadow-sm dark:bg-gray-800"},ce={class:"my-6 flex space-x-4 border-b dark:border-gray-700"},pe=["onClick"],ve={key:0,class:"space-y-6"},_e={key:0,class:"text-destructive"},fe=["value"],ye={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ge={key:0,class:"text-destructive"},be={class:"hidden"},ke={key:0,class:"text-destructive"},xe={class:"hidden"},Ve={key:0,class:"text-destructive"},he={class:"hidden"},we={key:0,class:"text-destructive"},Me={key:1},Se={key:2},$e={key:3,class:"space-y-6"},Ue={key:4},Ce={key:5},De={class:"flex justify-end gap-2"},Ie="Model",Oe=Z({__name:"UpdateModel",props:{modelId:{}},setup(B){const x=B,q=p(Number(x.modelId)).value??"",S=["model","size","activity","gambar","bahan dan biaya","hpp"],m=p(S[0]),i=p({}),$=ne(),{items:F}=G($),K=[{title:"Konveksi",href:"/konveksi"},{title:"Edit Model",href:`/konveksi/model/${x.modelId}/edit`}],U=le(),c=ue(),P=r=>r.map(t=>({...t,product_id:typeof t.product_id=="object"?t.product_id.id:t.product_id})),a=J({description:"",category_id:null,remark:"",start_date:null,end_date:null,estimation_price_pcs:0,estimation_qty:1}),C=p([]),f=p([]),D=p(0),_=p([]),y=p([]),A=()=>{let r=!0;return i.value={},a.description||(i.value.description=["Deskripsi wajib diisi"],c.error("Deskripsi wajib diisi"),r=!1),a.category_id||(i.value.category_id=["Kategori wajib diisi"],c.error("Kategori wajib diisi"),r=!1),a.start_date||(i.value.start_date=["Tanggal mulai harus diisi"],c.error("Tanggal mulai harus diisi"),r=!1),r},L=async()=>{var r,t,e,g,V;try{if(!A())return;await U.updateModel(x.modelId,{...a,sizes:f.value,activity:_.value,documents:C.value,modelMaterials:P(y.value)}),c.success("Model berhasil diperbarui"),j.visit("/konveksi/model/list")}catch(b){if(((r=b.response)==null?void 0:r.status)===422&&((e=(t=b.response)==null?void 0:t.data)!=null&&e.errors)){i.value=b.response.data.errors;for(const Q in i.value)i.value[Q].forEach(Y=>{c.error(Y)})}else(V=(g=b.response)==null?void 0:g.data)!=null&&V.message?c.error(b.response.data.message):c.error("Terjadi kesalahan saat menyimpan model")}};O(async()=>{var r,t;try{Promise.all([$.fetchCategories()]);const e=await U.fetchModelById(x.modelId);console.log("Model Data:",e),e&&(a.description=e.data.description,a.remark=e.data.remark,a.start_date=e.data.start_date?I(e.data.start_date):"",a.end_date=e.data.end_date?I(e.data.end_date):"",a.estimation_price_pcs=e.data.estimation_price_pcs,a.estimation_qty=e.data.estimation_qty,a.category_id=e.data.category_id,f.value=e.data.sizes||[],_.value=e.data.activities||[],C.value=e.data.documents||[],y.value=e.data.model_material||[])}catch(e){(t=(r=e.response)==null?void 0:r.data)!=null&&t.errors?(i.value=e.response.data.errors,c.error("Validasi gagal, silakan periksa form")):c.error("Terjadi kesalahan saat membuat model")}window.addEventListener("popstate",()=>{se.Inertia.visit(window.location.href,{preserveState:!0})})});const H=r=>{const t=_.value.find(e=>e.activity_role_id===r);return(t==null?void 0:t.activity_name)||`Activity ${r}`};function I(r){const t=new Date(r),e=t.getFullYear(),g=String(t.getMonth()+1).padStart(2,"0"),V=String(t.getDate()).padStart(2,"0");return`${e}-${g}-${V}`}return(r,t)=>(l(),d(w,null,[n(s(R),{title:"Edit Model"}),n(te,{breadcrumbs:K},{default:h(()=>[o("div",me,[t[20]||(t[20]=o("div",{class:"border-b pb-4"},[o("h1",{class:"text-2xl font-semibold text-gray-900 dark:text-white"},"Edit Model"),o("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Edit data model, ukuran, dan aktivitas")],-1)),o("div",ce,[(l(),d(w,null,T(S,e=>o("button",{key:e,class:k(["pb-2 text-sm font-medium",{"border-b-2 border-primary text-primary":m.value===e,"text-gray-500 hover:text-gray-700":m.value!==e}]),onClick:g=>m.value=e},v(e.charAt(0).toUpperCase()+e.slice(1)),11,pe)),64))]),o("form",{onSubmit:W(L,["prevent"]),class:"space-y-6"},[m.value==="model"?(l(),d("div",ve,[o("div",null,[t[11]||(t[11]=o("label",{for:"description",class:"text-sm font-medium"},"Nama Model",-1)),n(s(M),{id:"description",modelValue:s(a).description,"onUpdate:modelValue":t[0]||(t[0]=e=>s(a).description=e),placeholder:""},null,8,["modelValue"]),i.value.description?(l(),d("small",_e,v(i.value.description[0]),1)):u("",!0)]),o("div",null,[t[13]||(t[13]=o("label",{for:"category_id",class:"block mb-1 font-medium"},"Kategori",-1)),X(o("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>s(a).category_id=e),class:"w-full text-xs rounded-md border border-input px-3 py-2",required:""},[t[12]||(t[12]=o("option",{value:"0"},"Select Category",-1)),(l(!0),d(w,null,T(s(F),e=>(l(),d("option",{key:e.id,value:e.id},v(e.name),9,fe))),128))],512),[[ee,s(a).category_id]])]),o("div",ye,[o("div",null,[t[14]||(t[14]=o("label",{for:"start_date",class:"text-sm font-medium"},"Tanggal Mulai",-1)),n(s(N),{modelValue:s(a).start_date,"onUpdate:modelValue":t[2]||(t[2]=e=>s(a).start_date=e),id:"start_date",class:k({"border-destructive":i.value.start_date})},null,8,["modelValue","class"]),i.value.start_date?(l(),d("small",ge,v(i.value.start_date[0]),1)):u("",!0)]),o("div",be,[t[15]||(t[15]=o("label",{for:"end_date",class:"text-sm font-medium"},"Estimasi Selesai",-1)),n(s(N),{modelValue:s(a).end_date,"onUpdate:modelValue":t[3]||(t[3]=e=>s(a).end_date=e),id:"end_date",class:k({"border-destructive":i.value.end_date})},null,8,["modelValue","class"]),i.value.end_date?(l(),d("small",ke,v(i.value.end_date[0]),1)):u("",!0)]),o("div",xe,[t[16]||(t[16]=o("label",{for:"estimation_price_pcs",class:"text-sm font-medium"},"Estimasi Harga",-1)),n(s(M),{type:"number",modelValue:s(a).estimation_price_pcs,"onUpdate:modelValue":t[4]||(t[4]=e=>s(a).estimation_price_pcs=e),id:"estimation_price_pcs",class:k({"border-destructive":i.value.estimation_price_pcs})},null,8,["modelValue","class"]),i.value.estimation_price_pcs?(l(),d("small",Ve,v(i.value.estimation_price_pcs[0]),1)):u("",!0)])]),o("div",he,[t[17]||(t[17]=o("label",{for:"remark",class:"text-sm font-medium"},"Catatan",-1)),n(s(M),{modelValue:s(a).remark,"onUpdate:modelValue":t[5]||(t[5]=e=>s(a).remark=e),id:"remark",placeholder:"",class:k({"border-destructive":i.value.remark})},null,8,["modelValue","class"]),i.value.remark?(l(),d("small",we,v(i.value.remark[0]),1)):u("",!0)])])):u("",!0),m.value==="size"?(l(),d("div",Me,[n(oe,{modelValue:f.value,"onUpdate:modelValue":t[6]||(t[6]=e=>f.value=e),"onUpdate:totalQuantity":t[7]||(t[7]=e=>D.value=e)},null,8,["modelValue"])])):u("",!0),m.value==="activity"?(l(),d("div",Se,[n(ie,{modelValue:_.value,"onUpdate:modelValue":t[8]||(t[8]=e=>_.value=e)},null,8,["modelValue"])])):u("",!0),m.value==="gambar"?(l(),d("div",$e,[n(ae,{"reference-id":s(q),"reference-type":Ie},null,8,["reference-id"])])):u("",!0),m.value==="bahan dan biaya"?(l(),d("div",Ue,[n(re,{modelValue:y.value,"onUpdate:modelValue":t[9]||(t[9]=e=>y.value=e)},null,8,["modelValue"])])):u("",!0),m.value==="hpp"?(l(),d("div",Ce,[n(de,{"model-materials":y.value,"activity-items":_.value.map(e=>({...e,activity_name:H(e.activity_role_id)})),"start-date":s(a).start_date,"end-date":s(a).end_date,"total-production":D.value,"size-items":f.value.map(e=>({...e}))},null,8,["model-materials","activity-items","start-date","end-date","total-production","size-items"])])):u("",!0),o("div",De,[n(s(E),{type:"button",class:"bg-amber-600 text-white h-10 rounded-md hover:bg-amber-700",variant:"outline",onClick:t[10]||(t[10]=e=>s(j).visit("/konveksi/model/list"))},{default:h(()=>t[18]||(t[18]=[z(" Batal ")])),_:1,__:[18]}),n(s(E),{type:"submit",class:"bg-indigo-600 text-white py-2 h-10 rounded-md hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:h(()=>t[19]||(t[19]=[z("Simpan Perubahan")])),_:1,__:[19]})])],32)])]),_:1})],64))}});export{Oe as default};
