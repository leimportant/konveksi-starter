import{d as F,q as $,r as m,T as j,o as B,w as q,e as A,f as d,g as n,p as c,u as s,Z as H,x as W,k as a,C as h,j as v,F as I,B as N,l as V,y as D,P as K,m as L,V as C,b as Q}from"./app-CJ7UkBbN.js";import{u as R}from"./useToast-u_qnC3Ro.js";import{_ as Y}from"./AppLayout.vue_vue_type_script_setup_true_lang-Bsw52OWo.js";import{u as Z}from"./useModelStore-BHTwvovN.js";import{u as J}from"./useProductionStore-CU947ll6.js";import{A as G}from"./vue3-select-C7NpAQDz.js";import"./index-CcHQQhFt.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-Dmg2k5om.js";const O={class:"space-y-6 p-6"},X={class:"text-2xl font-bold"},ee={key:0,class:"mt-4 p-4 bg-yellow-50 border border-yellow-300 rounded text-sm text-yellow-700"},te={key:1,class:"mt-4 p-4 bg-blue-50 border border-blue-300 rounded text-sm text-blue-700"},ae={class:"flex flex-col gap-2"},oe=["value"],le={key:2},se={class:"w-full table-auto border"},ie={class:"border px-3 py-2 text-sm"},re={class:"border px-3 py-2 text-sm"},de={class:"border px-3 py-2 text-sm"},ne=["onUpdate:modelValue"],ue={class:"flex gap-2"},me=["disabled"],xe=F({__name:"Create",props:{activity_role:{}},setup(T){const _=R(),p=Z(),{models:P,employees:z}=$(p),l=T,f=m(null),w=m(null),k=m([]),y=m([]),x=m([]),i=j({model_id:null,activity_role_id:Number(l.activity_role),items:[],remark:""}),S=async(r="SEWING")=>{var t,o;try{const e=await Q.get("/api/activity-roles",{params:{group_menu:r}});y.value=e.data.data}catch(e){_.error(((o=(t=e.response)==null?void 0:t.data)==null?void 0:o.message)||"Gagal mengambil data tugas finishing")}};B(async()=>{await p.fetchModels(1,"N"),l.activity_role==="FINISHING"&&await S("FINISHING"),l.activity_role==="SEWING"&&await S("SEWING"),await p.fetchActivityEmployee(String(l.activity_role))}),q(f,async r=>{if(r)try{const o=(await p.fetchModelById(r)).data;i.model_id=o.id,k.value=o.sizes,i.items=o.sizes.map(e=>({size_id:String(e.size_id),size_name:e.size_name,qty:0,variant:e.variant}))}catch(t){console.error("Failed to fetch model sizes",t)}});const E=[{title:"Produksi",href:`/production/${l.activity_role}`}],M=J(),U=async()=>{var r,t;try{let o=1;l.activity_role=="CUTTING"&&(o=1),(l.activity_role=="FINISHING"||l.activity_role=="SEWING")&&(o=x.value.map(e=>{var u;return(u=y.value.find(b=>b.id===e))==null?void 0:u.id}).filter(e=>e!==null)),await M.createProduction({model_id:i.model_id,activity_role_id:o,remark:i.remark||"",items:i.items.filter(e=>e.qty>0)}),_.success("Produksi berhasil dibuat"),C.visit(`/production/${l.activity_role}`)}catch(o){_.error(((t=(r=o==null?void 0:o.response)==null?void 0:r.data)==null?void 0:t.message)??"Gagal membuat produksi")}};return(r,t)=>{const o=A("Input");return n(),d(I,null,[c(s(H),{title:"Production Management"}),c(Y,{breadcrumbs:E},{default:W(()=>[a("div",O,[a("h1",X,v(l.activity_role.toString().replace(/_/g," ")??"Buat Produksi"),1),a("div",null,[t[5]||(t[5]=a("label",{class:"mb-1 block font-medium"},"Pilih Desain Kerjaan",-1)),c(s(G),{id:"model.id",modelValue:f.value,"onUpdate:modelValue":t[0]||(t[0]=e=>f.value=e),reduce:e=>e.id,options:s(P),label:"description",placeholder:"Select Model",class:"w-full"},null,8,["modelValue","reduce","options"])]),a("div",null,[t[6]||(t[6]=a("label",{class:"mb-1 block font-medium"},"Karyawan",-1)),c(s(G),{id:"model.id",modelValue:w.value,"onUpdate:modelValue":t[1]||(t[1]=e=>w.value=e),options:s(z),label:"name",placeholder:"Select Employee",class:"w-full"},null,8,["modelValue","options"])]),l.activity_role==="QUALITY_CHECK"?(n(),d("div",ee,[t[7]||(t[7]=a("p",null,"Periksa kualitas produk dengan teliti sebelum melanjutkan ke proses selanjutnya. Pastikan tidak ada cacat atau kekurangan.",-1)),c(o,{type:"text",modelValue:s(i).remark,"onUpdate:modelValue":t[2]||(t[2]=e=>s(i).remark=e),placeholder:"Tambahkan catatan atau remark jika diperlukan",class:"mt-2 w-full rounded border p-2"},null,8,["modelValue"])])):h("",!0),y.value.length&&l.activity_role==="FINISHING"||l.activity_role==="SEWING"?(n(),d("div",te,[t[8]||(t[8]=a("p",{class:"font-semibold mb-2"},"Pilih pekerjaan yang dilakukan:",-1)),a("div",ae,[(n(!0),d(I,null,N(y.value,e=>(n(),d("label",{key:e.id,class:"flex items-center gap-2"},[V(a("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=u=>x.value=u),value:e.id},null,8,oe),[[K,x.value]]),D(" "+v(e.name),1)]))),128))])])):h("",!0),k.value.length>0?(n(),d("div",le,[t[10]||(t[10]=a("h2",{class:"mb-2 font-semibold"},"Model Ukuran",-1)),a("table",se,[t[9]||(t[9]=a("thead",null,[a("tr",{class:"bg-gray-100"},[a("th",{class:"border px-3 text-sm py-2 text-left"},"Size"),a("th",{class:"border px-3 text-sm py-2 text-left"},"Variant"),a("th",{class:"border px-3 text-sm py-2 text-left"},"Qty")])],-1)),a("tbody",null,[(n(!0),d(I,null,N(s(i).items,(e,u)=>{var b;return n(),d("tr",{key:`size-${u}-${e.size_id}`},[a("td",ie,v(((b=k.value.find(g=>g.size_id===e.size_id))==null?void 0:b.size_name)||e.size_id),1),a("td",re,v(e.variant),1),a("td",de,[V(a("input",{type:"number",min:"0",class:"w-full rounded border px-2 py-1","onUpdate:modelValue":g=>e.qty=g},null,8,ne),[[L,e.qty,void 0,{number:!0}]])])])}),128))])])])):h("",!0),a("div",ue,[a("button",{onClick:U,class:"rounded text-sm bg-blue-600 px-4 py-2 text-white hover:bg-blue-700",disabled:s(i).processing},"Simpan",8,me),a("button",{onClick:t[4]||(t[4]=e=>s(C).visit(`/production/${l.activity_role}`)),type:"button",class:"rounded text-sm bg-gray-500 px-4 py-2 text-white hover:bg-gray-600"}," Cancel ")])])]),_:1})],64)}}});export{xe as default};
