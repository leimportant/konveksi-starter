import{d as J,r as _,q as O,c as T,T as R,o as W,w as X,f as l,g as i,p as r,u as o,Z as ee,x as M,k as s,j as c,F as h,B as C,z as te,N as q,C as m,l as ae,U as se,D as U,V as B,y as I}from"./app-efsuWaun.js";import{_ as oe}from"./AppLayout.vue_vue_type_script_setup_true_lang-BYTOM3Vg.js";import{_ as $}from"./Input.vue_vue_type_script_setup_true_lang-Dyk-Rhdx.js";import{_ as j}from"./DateInput.vue_vue_type_script_setup_true_lang-CDhRXcpK.js";import{_ as le}from"./DocumentList.vue_vue_type_script_setup_true_lang-BVO_LMSa.js";import{d as ie,_ as de,a as re,b as ne,c as ue}from"./index-04s-RgFU.js";import{u as me}from"./useModelStore-b1-9oNTH.js";import{u as ce}from"./useToast-NHW6HhW0.js";import{u as pe}from"./useCategoryStore-7nLxIJap.js";import"./index-Dn7aIggF.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BrAe7Yrn.js";import"./trash-D_OKupfJ.js";import"./useSizeStore-Dgp30EEm.js";import"./useProductStore-5YWP7bhy.js";import"./useMasterActivityRoleStore-aS09DDTX.js";import"./useUomStore-Dd258WqO.js";import"./vue3-select-CT0opolc.js";const ve={class:"rounded-lg bg-white p-4 shadow-sm dark:bg-gray-800 sm:p-6"},_e={class:"border-b pb-3 mb-4"},fe={class:"text-lg font-semibold text-gray-900 dark:text-white"},ge={class:"text-xs text-gray-500 dark:text-gray-400"},ye={class:"flex flex-wrap gap-2 mb-6 text-sm"},be=["onClick"],ke={key:0,class:"space-y-4"},xe={key:0,class:"text-red-500"},Ve=["value"],Me={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},he={key:0,class:"text-red-500"},we={class:"hidden"},De={key:0,class:"text-red-500"},Ce={class:"sm:col-span-2 hidden"},Ue={key:0,class:"text-red-500"},$e={key:0,class:"text-red-500"},Se={key:0,class:"grid grid-cols-2 sm:grid-cols-4 gap-4"},ze=["src"],Ne={class:"absolute bottom-0 inset-x-0 bg-black/60 p-1 text-[11px] text-white truncate"},Ee={key:1},Te={key:2},qe={key:3},Be={key:4},Ie={key:5},je={class:"flex justify-end border-t pt-4 gap-2 text-sm"},Ae="Model",st=J({__name:"CreateModel",props:{modelData:{}},setup(A){const d=A,S=pe(),P=["model","size","activity","gambar","bahan_dan_biaya","hpp"],p=_("model"),{items:F}=O(S),v=T(()=>!!d.modelData),z=_(Math.random().toString(36).substring(2,15)),b=_([]),K=T(()=>v.value?d.modelData.id:z.value),L=u=>b.value.splice(u,1),Q=[{title:"Konveksi",href:"/konveksi"},{title:v.value?"Edit Model":"Create Model",href:v.value?`/konveksi/model/${d.modelData.id}/edit`:"/konveksi/model/create"}],N=me(),k=ce(),a=R({description:"",category_id:null,remark:"",start_date:null,end_date:null,estimation_price_pcs:0,estimation_qty:1,is_close:"N"}),n=_({}),f=_([]),w=_(0),g=_([]),x=_([]);W(()=>{Promise.all([S.fetchCategories()]),v.value&&(a.description=d.modelData.description,a.remark=d.modelData.remark,a.start_date=d.modelData.start_date,a.end_date=d.modelData.end_date,a.estimation_price_pcs=d.modelData.estimation_price_pcs,a.estimation_qty=d.modelData.estimation_qty,a.is_close=d.modelData.is_close,f.value=d.modelData.sizes||[],g.value=d.modelData.activity||[],x.value=d.modelData.modelMaterials||[],b.value=d.modelData.documents||[]),window.addEventListener("popstate",()=>{ie.Inertia.visit(window.location.href,{preserveState:!0})})}),X(p,u=>{if(u==="size"){const e=f.value.reduce((t,y)=>t+(Number(y.qty)||0),0);w.value=e}});const E=u=>u.map(e=>{var t;return{...e,product_id:typeof e.product_id=="object"&&((t=e.product_id)!=null&&t.id)?e.product_id.id:e.product_id}}),H=async()=>{var u,e,t,y,D;if(!a.start_date){n.value.start_date=["Tanggal mulai harus diisi"],k.error("Tanggal mulai harus diisi");return}a.is_close=a.is_close?"Y":"N";try{v.value?(await N.updateModel(d.modelData.id,{...a,sizes:f.value,activity:g.value,documents:b.value,modelMaterials:E(x.value)}),k.success("Model berhasil diperbarui")):(await N.createModel({...a,sizes:f.value,activity:g.value,uniqId:z.value,documents:b.value,modelMaterials:E(x.value)}),k.success("Model berhasil dibuat")),B.visit("/konveksi/model/list")}catch(V){if(((u=V.response)==null?void 0:u.status)===422&&((t=(e=V.response)==null?void 0:e.data)!=null&&t.errors)){n.value=V.response.data.errors;for(const Z in n.value)n.value[Z].forEach(G=>{k.error(G)})}else(D=(y=V.response)==null?void 0:y.data)!=null&&D.message?k.error(V.response.data.message):k.error("Terjadi kesalahan saat menyimpan model")}},Y=u=>g.value.find(t=>t.activity_role_id===u)?`Activity ${u}`:"Unknown Activity";return(u,e)=>(i(),l(h,null,[r(o(ee),{title:v.value?"Edit Model":"Create Model"},null,8,["title"]),r(oe,{breadcrumbs:Q},{default:M(()=>[s("div",ve,[s("div",_e,[s("h1",fe,c(v.value?"Edit Model":"Buat Model Baru"),1),s("p",ge,c(v.value?"Ubah data model, ukuran, dan aktivitas":"Isi data model, ukuran, dan aktivitas"),1)]),s("div",ye,[(i(),l(h,null,C(P,t=>s("button",{key:t,onClick:y=>p.value=t,class:te(["px-3 py-1.5 rounded-full transition-all",{"bg-indigo-600 text-white":p.value===t,"bg-gray-100 text-gray-600 hover:bg-gray-200":p.value!==t}])},c(t.charAt(0).toUpperCase()+t.slice(1)),11,be)),64))]),s("form",{onSubmit:q(H,["prevent"]),class:"space-y-5 text-sm"},[p.value==="model"?(i(),l("div",ke,[s("div",null,[e[11]||(e[11]=s("label",{for:"description",class:"block mb-1 font-medium"},"Nama Model",-1)),r(o($),{id:"description",modelValue:o(a).description,"onUpdate:modelValue":e[0]||(e[0]=t=>o(a).description=t)},null,8,["modelValue"]),n.value.description?(i(),l("small",xe,c(n.value.description[0]),1)):m("",!0)]),s("div",null,[e[13]||(e[13]=s("label",{for:"category_id",class:"block mb-1 font-medium"},"Kategori",-1)),ae(s("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>o(a).category_id=t),class:"w-full text-xs rounded-md border border-input px-3 py-2",required:""},[e[12]||(e[12]=s("option",{value:"0"},"Select Category",-1)),(i(!0),l(h,null,C(o(F),t=>(i(),l("option",{key:t.id,value:t.id},c(t.name),9,Ve))),128))],512),[[se,o(a).category_id]])]),s("div",Me,[s("div",null,[e[14]||(e[14]=s("label",{class:"block mb-1 font-medium",for:"start_date"},"Tanggal Mulai",-1)),r(o(j),{id:"start_date",modelValue:o(a).start_date,"onUpdate:modelValue":e[2]||(e[2]=t=>o(a).start_date=t)},null,8,["modelValue"]),n.value.start_date?(i(),l("small",he,c(n.value.start_date[0]),1)):m("",!0)]),s("div",we,[e[15]||(e[15]=s("label",{class:"block mb-1 font-medium",for:"end_date"},"Estimasi Selesai",-1)),r(o(j),{id:"end_date",modelValue:o(a).end_date,"onUpdate:modelValue":e[3]||(e[3]=t=>o(a).end_date=t)},null,8,["modelValue"]),n.value.end_date?(i(),l("small",De,c(n.value.end_date[0]),1)):m("",!0)]),s("div",Ce,[e[16]||(e[16]=s("label",{class:"block mb-1 font-medium",for:"estimation_price_pcs"},"Estimasi Harga",-1)),r(o($),{id:"estimation_price_pcs",type:"number",modelValue:o(a).estimation_price_pcs,"onUpdate:modelValue":e[4]||(e[4]=t=>o(a).estimation_price_pcs=t)},null,8,["modelValue"]),n.value.estimation_price_pcs?(i(),l("small",Ue,c(n.value.estimation_price_pcs[0]),1)):m("",!0)])]),s("div",null,[e[17]||(e[17]=s("label",{class:"block mb-1 font-medium",for:"remark"},"Catatan",-1)),r(o($),{id:"remark",modelValue:o(a).remark,"onUpdate:modelValue":e[5]||(e[5]=t=>o(a).remark=t)},null,8,["modelValue"]),n.value.remark?(i(),l("small",$e,c(n.value.remark[0]),1)):m("",!0)]),b.value.length?(i(),l("div",Se,[(i(!0),l(h,null,C(b.value,(t,y)=>(i(),l("div",{key:t.id,class:"relative group rounded-lg overflow-hidden border"},[s("img",{src:t.url,class:"aspect-square w-full object-cover transition-transform group-hover:scale-105"},null,8,ze),s("div",Ne,c(t.filename),1),r(o(U),{variant:"destructive",size:"icon",class:"absolute top-1 right-1 p-1 h-6 w-6",onClick:q(D=>L(y),["prevent"])},{default:M(()=>e[18]||(e[18]=[s("i",{class:"pi pi-times text-xs"},null,-1)])),_:2,__:[18]},1032,["onClick"])]))),128))])):m("",!0)])):m("",!0),p.value==="size"?(i(),l("div",Ee,[r(de,{modelValue:f.value,"onUpdate:modelValue":e[6]||(e[6]=t=>f.value=t),"onUpdate:totalQuantity":e[7]||(e[7]=t=>w.value=t)},null,8,["modelValue"])])):m("",!0),p.value==="activity"?(i(),l("div",Te,[r(re,{modelValue:g.value,"onUpdate:modelValue":e[8]||(e[8]=t=>g.value=t)},null,8,["modelValue"])])):m("",!0),p.value==="gambar"?(i(),l("div",qe,[r(le,{"reference-id":K.value,"reference-type":Ae},null,8,["reference-id"])])):m("",!0),p.value==="bahan_dan_biaya"?(i(),l("div",Be,[r(ne,{modelValue:x.value,"onUpdate:modelValue":e[9]||(e[9]=t=>x.value=t)},null,8,["modelValue"])])):m("",!0),p.value==="hpp"?(i(),l("div",Ie,[r(ue,{"model-materials":x.value,"activity-items":g.value.map(t=>({...t,activity_name:Y(t.activity_role_id)})),"start-date":o(a).start_date,"end-date":o(a).end_date,"total-production":w.value,"size-items":f.value},null,8,["model-materials","activity-items","start-date","end-date","total-production","size-items"])])):m("",!0),s("div",je,[r(o(U),{type:"button",variant:"secondary",onClick:e[10]||(e[10]=t=>o(B).visit("/konveksi"))},{default:M(()=>e[19]||(e[19]=[I(" Batal ")])),_:1,__:[19]}),r(o(U),{type:"submit",loading:o(a).processing,class:"bg-indigo-600 text-white hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:M(()=>[e[20]||(e[20]=s("i",{class:"pi pi-check mr-1"},null,-1)),I(" "+c(v.value?"Perbarui":"Simpan"),1)]),_:1,__:[20]},8,["loading"])])],32)])]),_:1})],64))}});export{st as default};
