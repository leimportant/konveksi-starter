import{d as F,q as O,r as V,Q,T as W,aT as X,c as Y,o as Z,f as c,g as f,p as s,u as t,Z as H,x as l,k as n,C as k,l as ee,G as te,m as ae,D as b,y as r,F as g,B as se,j as y,z as le,R as q}from"./app-Di3VD2wF.js";import{_ as v}from"./Input.vue_vue_type_script_setup_true_lang-YgRub-mj.js";import{_ as oe,a as ne,b as x,c as z,d as ie,e as m}from"./TableRow.vue_vue_type_script_setup_true_lang-sJPd0PKL.js";import{u as de}from"./useToast-CJi-_njE.js";import{_ as re}from"./AppLayout.vue_vue_type_script_setup_true_lang-YamAR-Dq.js";import{u as ue}from"./useKasbonStore-C5zbnOx7.js";import{A as me}from"./vue3-select-DONUR2lV.js";import{S as pe}from"./search-CTdNBa0X.js";import{C as ce,a as fe}from"./circle-x-UouRK05o.js";import{S as be}from"./square-pen-C71ayQ9p.js";import{T as _e}from"./trash-2-DlkDCp_O.js";import"./index-DnLtb5dp.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CVeNkWmG.js";const ge={class:"px-4 py-4"},ye={class:"mb-4 flex flex-col sm:flex-row items-center justify-between gap-3"},ve={class:"flex items-center gap-3 w-full sm:w-auto"},xe={class:"overflow-x-auto rounded-md border"},he={class:"flex items-center justify-between"},we={class:"font-semibold text-gray-800"},Ce={class:"mt-4 flex justify-end space-x-2"},Ve=["disabled"],ke=["disabled"],Ke={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},je={class:"w-96 rounded-lg bg-white p-6"},Se={class:"mb-4"},$e={class:"mb-4"},Pe={class:"mb-4"},De={class:"flex justify-end gap-2"},Ue={key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},Te={class:"w-96 rounded-lg bg-white p-6"},qe={class:"mb-4"},ze={class:"mb-4"},Ae={class:"mb-4"},Ee={class:"flex justify-end gap-2"},He=F({__name:"Index",setup(Me){const u=de(),p=ue(),{kasbonList:A,pagination:_,loading:P}=O(p),K=V(!1),w=V(!1),C=V(null),D=Q().props.auth.user,h=V(""),i=W({id:"",employee_id:0,employee_name:"",amount:0,description:"",status:"Pending"}),E=[{title:"Kasbon",href:"/kasbon"}],j=X({search:""}),U=()=>{var e;const o=typeof h.value=="string"?h.value:((e=h.value)==null?void 0:e.value)??"";p.fetchKasbon(1,50,{search:j.search,status:o})},S=Y(()=>Math.ceil(_.value.total/_.value.per_page)||1),T=async o=>{o<1||o>S.value||await p.fetchKasbon(o)},M=()=>T(_.value.current_page+1),N=()=>T(_.value.current_page-1);Z(()=>{p.fetchKasbon()});const R=async()=>{var o,e;if(!i.employee_id||!i.amount)return u.error("Karyawan dan nominal wajib diisi");try{await p.storeKasbon(i),u.success("Kasbon berhasil ditambahkan"),i.reset(),K.value=!1}catch(a){u.error(((e=(o=a==null?void 0:a.response)==null?void 0:o.data)==null?void 0:e.message)??"Gagal membuat kasbon")}},G=o=>{var e;C.value=o,i.id=o.id,i.employee_id=o.employee_id,i.amount=o.amount,i.description=o.description,i.status=o.status,i.employee_name=(e=o.employee)==null?void 0:e.name,w.value=!0},B=async()=>{var o,e;if(C.value)try{await p.updateKasbon(C.value.id,i),u.success("Kasbon berhasil diperbarui"),w.value=!1,C.value=null}catch(a){u.error(((e=(o=a==null?void 0:a.response)==null?void 0:o.data)==null?void 0:e.message)??"Gagal memperbarui kasbon")}},I=async o=>{var e,a;if(o&&confirm("Yakin ingin menghapus kasbon ini?"))try{await p.deleteKasbon(o),u.success("Kasbon berhasil dihapus")}catch(d){u.error(((a=(e=d==null?void 0:d.response)==null?void 0:e.data)==null?void 0:a.message)??"Gagal menghapus kasbon")}},L=async o=>{var e,a;if(o&&confirm("Setujui kasbon ini?"))try{await p.approveKasbon(o),u.success("Kasbon disetujui dan masuk ke mutasi")}catch(d){u.error(((a=(e=d==null?void 0:d.response)==null?void 0:e.data)==null?void 0:a.message)??"Gagal menyetujui kasbon")}},J=async o=>{var a,d;if(!o)return;const e=prompt("Masukkan alasan penolakan:");if(e)try{await p.rejectKasbon(o,e),u.success("Kasbon ditolak")}catch($){u.error(((d=(a=$==null?void 0:$.response)==null?void 0:a.data)==null?void 0:d.message)??"Gagal menolak kasbon")}};return(o,e)=>(f(),c(g,null,[s(t(H),{title:"Kasbon Management"}),s(re,{breadcrumbs:E},{default:l(()=>[n("div",ge,[n("div",ye,[n("div",ve,[s(t(me),{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=a=>h.value=a),options:[{label:"Semua Status",value:""},{label:"Pending",value:"Pending"},{label:"Approved",value:"Approved"},{label:"Rejected",value:"Rejected"}],placeholder:"Pilih Status",class:"w-40"},null,8,["modelValue"]),ee(n("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>j.search=a),type:"text",placeholder:"Cari data...",onKeyup:te(U,["enter"]),class:"border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 w-full sm:w-56"},null,544),[[ae,j.search]]),s(t(b),{onClick:U,class:"bg-indigo-600 text-white hover:bg-indigo-700 flex items-center gap-1"},{default:l(()=>[s(t(pe),{class:"h-4 w-4"}),e[11]||(e[11]=r(" Cari "))]),_:1,__:[11]})])]),n("div",xe,[s(t(oe),null,{default:l(()=>[s(t(ne),null,{default:l(()=>[s(t(x),{class:"bg-gray-100"},{default:l(()=>[s(t(z),{class:"px-3 py-2"},{default:l(()=>e[12]||(e[12]=[r("Karyawan")])),_:1,__:[12]}),s(t(z),{class:"px-3 py-2"},{default:l(()=>e[13]||(e[13]=[r("Details")])),_:1,__:[13]})]),_:1})]),_:1}),s(t(ie),null,{default:l(()=>[(f(!0),c(g,null,se(t(A),a=>(f(),c(g,{key:a.id},[s(t(x),{class:"bg-gray-50"},{default:l(()=>[s(t(m),{colspan:"2",class:"px-3 py-2"},{default:l(()=>[n("div",he,[n("span",we,y(a.employee?a.employee.name:"-"),1),n("span",{class:le(["inline-block rounded-full border px-2.5 py-0.5 text-xs font-semibold",{"border-yellow-400 bg-yellow-50 text-yellow-700":a.status==="Pending","border-green-400 bg-green-50 text-green-700":a.status==="Approved","border-red-400 bg-red-50 text-red-700":a.status==="Rejected"}])},y(a.status),3)])]),_:2},1024)]),_:2},1024),s(t(x),null,{default:l(()=>[s(t(m),{class:"w-1/4 px-3 py-1 font-medium"},{default:l(()=>e[14]||(e[14]=[r("Tanggal")])),_:1,__:[14]}),s(t(m),{class:"px-3 py-1"},{default:l(()=>[r(y(a.created_at?new Date(a.created_at).toLocaleDateString():"-"),1)]),_:2},1024)]),_:2},1024),s(t(x),null,{default:l(()=>[s(t(m),{class:"w-1/4 px-3 py-1 font-medium"},{default:l(()=>e[15]||(e[15]=[r("Jumlah Kasbon")])),_:1,__:[15]}),s(t(m),{class:"px-3 py-1"},{default:l(()=>[r(y(Number(a.amount).toLocaleString()),1)]),_:2},1024)]),_:2},1024),s(t(x),null,{default:l(()=>[s(t(m),{class:"px-3 py-1 font-medium"},{default:l(()=>e[16]||(e[16]=[r("Keterangan")])),_:1,__:[16]}),s(t(m),{class:"px-3 py-1"},{default:l(()=>[r(y(a.description||"-"),1)]),_:2},1024)]),_:2},1024),s(t(x),null,{default:l(()=>[s(t(m),{class:"px-3 py-1 font-medium"},{default:l(()=>e[17]||(e[17]=[r("Actions")])),_:1,__:[17]}),s(t(m),{class:"flex gap-2 px-3 py-1"},{default:l(()=>[t(D).employee_status&&t(D).employee_status.toUpperCase()==="OWNER"?(f(),c(g,{key:0},[a.status==="Pending"?(f(),c(g,{key:0},[s(t(b),{size:"icon",variant:"ghost",onClick:d=>L(a.id)},{default:l(()=>[s(t(ce),{class:"h-4 w-4 text-green-600"})]),_:2},1032,["onClick"]),s(t(b),{size:"icon",variant:"ghost",onClick:d=>J(a.id)},{default:l(()=>[s(t(fe),{class:"h-4 w-4 text-red-600"})]),_:2},1032,["onClick"])],64)):k("",!0)],64)):(f(),c(g,{key:1},[a.status!=="Approved"?(f(),c(g,{key:0},[s(t(b),{size:"icon",variant:"ghost",onClick:d=>G(a)},{default:l(()=>[s(t(be),{class:"h-4 w-4"})]),_:2},1032,["onClick"]),s(t(b),{size:"icon",variant:"ghost",onClick:d=>I(a.id)},{default:l(()=>[s(t(_e),{class:"h-4 w-4"})]),_:2},1032,["onClick"])],64)):k("",!0)],64))]),_:2},1024)]),_:2},1024),s(t(x),null,{default:l(()=>[s(t(m),{colspan:"2",class:"h-3"})]),_:1})],64))),128))]),_:1})]),_:1})]),n("div",Ce,[n("button",{onClick:N,disabled:t(_).current_page===1||t(P),class:"rounded border px-3 py-1 hover:bg-gray-100 disabled:opacity-50"}," Previous ",8,Ve),n("span",null,"Page "+y(t(_).current_page)+" / "+y(S.value),1),n("button",{onClick:M,disabled:t(_).current_page>=S.value||t(P),class:"rounded border px-3 py-1 hover:bg-gray-100 disabled:opacity-50"}," Next ",8,ke)]),K.value?(f(),c("div",Ke,[n("div",je,[e[20]||(e[20]=n("h2",{class:"mb-4 text-lg font-semibold"},"Tambah Kasbon",-1)),n("form",{onSubmit:q(R,["prevent"])},[n("div",Se,[s(t(v),{modelValue:t(i).employee_id,"onUpdate:modelValue":e[2]||(e[2]=a=>t(i).employee_id=a),placeholder:"Employee ID",required:""},null,8,["modelValue"])]),n("div",$e,[s(t(v),{type:"number",modelValue:t(i).amount,"onUpdate:modelValue":e[3]||(e[3]=a=>t(i).amount=a),placeholder:"Jumlah Kasbon",required:""},null,8,["modelValue"])]),n("div",Pe,[s(t(v),{modelValue:t(i).description,"onUpdate:modelValue":e[4]||(e[4]=a=>t(i).description=a),placeholder:"Deskripsi",required:""},null,8,["modelValue"])]),n("div",De,[s(t(b),{variant:"outline",type:"button",onClick:e[5]||(e[5]=a=>K.value=!1)},{default:l(()=>e[18]||(e[18]=[r("Cancel")])),_:1,__:[18]}),s(t(b),{type:"submit",class:"bg-indigo-600 text-white hover:bg-indigo-700"},{default:l(()=>e[19]||(e[19]=[r("Create")])),_:1,__:[19]})])],32)])])):k("",!0),w.value?(f(),c("div",Ue,[n("div",Te,[e[23]||(e[23]=n("h2",{class:"mb-4 text-lg font-semibold"},"Edit Kasbon",-1)),n("form",{onSubmit:q(B,["prevent"])},[n("div",qe,[s(t(v),{type:"hidden",modelValue:t(i).employee_id,"onUpdate:modelValue":e[6]||(e[6]=a=>t(i).employee_id=a),readonly:"",placeholder:"Employee ID",required:""},null,8,["modelValue"]),s(t(v),{modelValue:t(i).employee_name,"onUpdate:modelValue":e[7]||(e[7]=a=>t(i).employee_name=a),readonly:"",placeholder:"Employee ID",required:""},null,8,["modelValue"])]),n("div",ze,[s(t(v),{type:"number",modelValue:t(i).amount,"onUpdate:modelValue":e[8]||(e[8]=a=>t(i).amount=a),placeholder:"Jumlah Kasbon",required:""},null,8,["modelValue"])]),n("div",Ae,[s(t(v),{modelValue:t(i).description,"onUpdate:modelValue":e[9]||(e[9]=a=>t(i).description=a),placeholder:"Deskripsi",required:""},null,8,["modelValue"])]),n("div",Ee,[s(t(b),{variant:"outline",type:"button",onClick:e[10]||(e[10]=a=>w.value=!1)},{default:l(()=>e[21]||(e[21]=[r("Cancel")])),_:1,__:[21]}),s(t(b),{type:"submit",class:"bg-indigo-600 text-white hover:bg-indigo-700"},{default:l(()=>e[22]||(e[22]=[r("Update")])),_:1,__:[22]})])],32)])])):k("",!0)])]),_:1})],64))}});export{He as default};
