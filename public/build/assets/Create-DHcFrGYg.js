import{d as M,q as U,r as y,T as E,o as F,w as $,e as j,f as l,g as i,p as h,u as d,Z as B,x as q,k as a,C as I,j as c,l as N,F as b,B as S,O as H,y as W,L as D,m as L,P as C,b as A}from"./app-DofvhDou.js";import{u as K}from"./useToast-CGKEkBVM.js";import{_ as Q}from"./AppLayout.vue_vue_type_script_setup_true_lang-B7PCsMYI.js";import{u as O}from"./useModelStore-szfF4Kis.js";import{u as R}from"./useProductionStore-CA1ZSvZ1.js";import"./index-CbCD4o6j.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-Ch3IMM2-.js";const Y={class:"space-y-6 p-6"},Z={class:"text-2xl font-bold"},J=["value"],X={key:0,class:"mt-4 p-4 bg-yellow-50 border border-yellow-300 rounded text-sm text-yellow-700"},ee={key:1,class:"mt-4 p-4 bg-blue-50 border border-blue-300 rounded text-sm text-blue-700"},te={class:"flex flex-col gap-2"},ae=["value"],se={key:2},oe={class:"w-full table-auto border"},le={class:"border px-3 py-2 text-sm"},ie={class:"border px-3 py-2 text-sm"},re={class:"border px-3 py-2 text-sm"},ne=["onUpdate:modelValue"],de={class:"flex gap-2"},ue=["disabled"],fe=M({__name:"Create",props:{activity_role:{}},setup(G){const v=K(),_=O(),{models:T}=U(_),o=G,f=y(null),k=y([]),m=y([]),x=y([]),r=E({model_id:null,activity_role_id:Number(o.activity_role),items:[],remark:""}),w=async(n="SEWING")=>{var t,s;try{const e=await A.get("/api/activity-roles",{params:{group_menu:n}});m.value=e.data.data}catch(e){v.error(((s=(t=e.response)==null?void 0:t.data)==null?void 0:s.message)||"Gagal mengambil data tugas finishing")}};F(async()=>{await _.fetchModels(),o.activity_role==="FINISHING"&&await w("FINISHING"),o.activity_role==="SEWING"&&await w("SEWING")}),$(f,async n=>{if(n)try{const s=(await _.fetchModelById(n)).data;r.model_id=s.id,k.value=s.sizes,r.items=s.sizes.map(e=>({size_id:String(e.size_id),size_name:e.size_name,qty:0,variant:e.variant}))}catch(t){console.error("Failed to fetch model sizes",t)}});const V=[{title:"Produksi",href:`/production/${o.activity_role}`}],P=R(),z=async()=>{var n,t;try{let s=1;o.activity_role=="CUTTING"&&(s=1),(o.activity_role=="FINISHING"||o.activity_role=="SEWING")&&(s=x.value.map(e=>{var u;return(u=m.value.find(p=>p.id===e))==null?void 0:u.id}).filter(e=>e!==null)),await P.createProduction({model_id:r.model_id,activity_role_id:s,remark:r.remark||"",items:r.items.filter(e=>e.qty>0)}),v.success("Produksi berhasil dibuat"),C.visit(`/production/${o.activity_role}`)}catch(s){v.error(((t=(n=s==null?void 0:s.response)==null?void 0:n.data)==null?void 0:t.message)??"Gagal membuat produksi")}};return(n,t)=>{const s=j("Input");return i(),l(b,null,[h(d(B),{title:"Production Management"}),h(Q,{breadcrumbs:V},{default:q(()=>[a("div",Y,[a("h1",Z,c(o.activity_role.toString().replace(/_/g," ")??"Buat Produksi"),1),a("div",null,[t[5]||(t[5]=a("label",{class:"mb-1 block font-medium"},"Pilih Desain Kerjaan",-1)),N(a("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>f.value=e),class:"w-full rounded border p-2"},[t[4]||(t[4]=a("option",{disabled:"",value:""},"-- Choose a model --",-1)),(i(!0),l(b,null,S(d(T),e=>(i(),l("option",{key:e.id,value:e.id},c(e.description),9,J))),128))],512),[[H,f.value]])]),o.activity_role==="QUALITY_CHECK"?(i(),l("div",X,[t[6]||(t[6]=a("p",null,"Periksa kualitas produk dengan teliti sebelum melanjutkan ke proses selanjutnya. Pastikan tidak ada cacat atau kekurangan.",-1)),h(s,{type:"text",modelValue:d(r).remark,"onUpdate:modelValue":t[1]||(t[1]=e=>d(r).remark=e),placeholder:"Tambahkan catatan atau remark jika diperlukan",class:"mt-2 w-full rounded border p-2"},null,8,["modelValue"])])):I("",!0),m.value.length&&o.activity_role==="FINISHING"||o.activity_role==="SEWING"?(i(),l("div",ee,[t[7]||(t[7]=a("p",{class:"font-semibold mb-2"},"Pilih pekerjaan yang dilakukan:",-1)),a("div",te,[(i(!0),l(b,null,S(m.value,e=>(i(),l("label",{key:e.id,class:"flex items-center gap-2"},[N(a("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=u=>x.value=u),value:e.id},null,8,ae),[[D,x.value]]),W(" "+c(e.name),1)]))),128))])])):I("",!0),k.value.length>0?(i(),l("div",se,[t[9]||(t[9]=a("h2",{class:"mb-2 font-semibold"},"Model Ukuran",-1)),a("table",oe,[t[8]||(t[8]=a("thead",null,[a("tr",{class:"bg-gray-100"},[a("th",{class:"border px-3 text-sm py-2 text-left"},"Size"),a("th",{class:"border px-3 text-sm py-2 text-left"},"Variant"),a("th",{class:"border px-3 text-sm py-2 text-left"},"Qty")])],-1)),a("tbody",null,[(i(!0),l(b,null,S(d(r).items,(e,u)=>{var p;return i(),l("tr",{key:`size-${u}-${e.size_id}`},[a("td",le,c(((p=k.value.find(g=>g.size_id===e.size_id))==null?void 0:p.size_name)||e.size_id),1),a("td",ie,c(e.variant),1),a("td",re,[N(a("input",{type:"number",min:"0",class:"w-full rounded border px-2 py-1","onUpdate:modelValue":g=>e.qty=g},null,8,ne),[[L,e.qty,void 0,{number:!0}]])])])}),128))])])])):I("",!0),a("div",de,[a("button",{onClick:z,class:"rounded text-sm bg-blue-600 px-4 py-2 text-white hover:bg-blue-700",disabled:d(r).processing},"Simpan",8,ue),a("button",{onClick:t[3]||(t[3]=e=>d(C).visit(`/production/${o.activity_role}`)),type:"button",class:"rounded text-sm bg-gray-500 px-4 py-2 text-white hover:bg-gray-600"}," Cancel ")])])]),_:1})],64)}}});export{fe as default};
