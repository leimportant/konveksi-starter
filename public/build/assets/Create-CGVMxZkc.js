import{d as j,r as V,o as B,f as n,g as c,p as r,u as d,Z as T,x as p,k as a,K as Q,l as E,C as g,y as b,F as w,B as U,j as f,O as $,D,P as I,b as S}from"./app-CVBAo0jO.js";import{_ as R}from"./AppLayout.vue_vue_type_script_setup_true_lang-DBdUGih5.js";import{_ as v}from"./Input.vue_vue_type_script_setup_true_lang-poTMR4WG.js";import{_ as h}from"./Label.vue_vue_type_script_setup_true_lang-C6Up6iAt.js";import{u as K}from"./useToast-DBfRd4e4.js";import"./index-D0JVoBCz.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-Bdp-WMDe.js";const Z={class:"px-4 py-4"},G={class:"bg-white rounded-md shadow p-6"},H={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"},J=["value"],W={key:0,class:"text-red-600 text-sm mt-1"},X=["value"],Y={key:0,class:"text-red-600 text-sm mt-1"},ee={key:0,class:"text-red-600 text-sm mt-1"},oe={key:0,class:"text-red-600 text-sm mt-1"},te={class:"md:col-span-2"},ae={class:"mb-6"},se={class:"overflow-x-auto"},le={class:"w-full border-collapse"},re={class:"border p-2"},de={key:0,class:"text-red-600 text-xs mt-1"},ie={class:"border p-2"},ue={class:"border p-2"},ne={class:"border p-2"},ce={class:"border p-2"},me={class:"flex justify-end gap-4"},he=j({__name:"Create",setup(_e){const _=K(),m=V(!1),t=V({id:"",location_id:"",product_id:"",sloc_id:"",uom_id:"",remark:"",stock_opname_items:[]}),q=V([]),C=V([]),l=V({product_id:"",location_id:"",sloc_id:"",uom_id:"","stock_opname_items.size_id":"","stock_opname_items.qty_system":"","stock_opname_items.qty_physical":""}),M=async()=>{try{m.value=!0;const[s]=await Promise.all([S.get("/api/locations")]);C.value=s.data.data}catch(s){console.error("Error fetching dropdown data:",s),_.error("Failed to load form data")}finally{m.value=!1}},A=()=>{t.value.stock_opname_items.push({size_id:"",qty_system:0,qty_physical:0,difference:0,note:""})},z=s=>{const e=t.value.stock_opname_items[s];e.difference=e.qty_physical-e.qty_system},x=s=>{l.value[s]&&(l.value[s]="")},F=async()=>{var s,e,o,y,i;try{m.value=!0,Object.keys(l.value).forEach(k=>{l.value[k]=""}),t.value.id||(t.value.id=crypto.randomUUID());let u=!1;if(t.value.product_id||(l.value.product_id="Product is required",u=!0),t.value.location_id||(l.value.location_id="Location is required",u=!0),t.value.sloc_id||(l.value.sloc_id="Storage Location is required",u=!0),t.value.uom_id||(l.value.uom_id="UOM is required",u=!0),t.value.stock_opname_items.length===0&&(_.error("At least one item is required"),u=!0),t.value.stock_opname_items.forEach(k=>{k.size_id||(l.value["stock_opname_items.size_id"]="Size is required",u=!0)}),u)return;await S.post("/api/stock-opnames",t.value),_.success("Stock opname created successfully"),I.visit("/stock-opnames")}catch(u){if(((s=u.response)==null?void 0:s.status)===422&&((o=(e=u.response)==null?void 0:e.data)!=null&&o.errors)){l.value=u.response.data.errors;for(const k in l.value)(Array.isArray(l.value[k])?l.value[k]:[l.value[k]]).forEach(P=>{_.error(P)})}else(i=(y=u.response)==null?void 0:y.data)!=null&&i.message?_.error(u.response.data.message):_.error("Terjadi kesalahan saat menyimpan data")}finally{m.value=!1}};B(()=>{M(),A()});const L=[{title:"Stock Opname",href:"/stock-opnames"},{title:"Create",href:"/stock-opnames/create"}],N=async()=>{if(x("product_id"),!!t.value.product_id)try{m.value=!0;const s=q.value.find(e=>e.id===t.value.product_id);s&&(t.value.sloc_id=s.sloc_id||"",t.value.uom_id=s.uom_id||"",t.value.stock_opname_items=(s.sizes||[]).map(e=>({size_id:String(e.size_id),qty_system:e.qty||0,qty_physical:0,difference:0,note:""})))}catch(s){console.error("Error processing product change:",s),_.error("Failed to process product change")}finally{m.value=!1}},O=async()=>{if(x("location_id"),!!t.value.location_id)try{m.value=!0;const s=await S.get(`/api/combo/product-inventory?location_id=${t.value.location_id}`);console.log(s.data),q.value=Array.isArray(s.data)?s.data.map(e=>({id:e.product_id,name:e.product_name,sloc_id:e.sloc_id||"",uom_id:e.uom_id||"",sizes:e.sizes||[]})):[],t.value.product_id="",t.value.stock_opname_items=[]}catch(s){console.error("Error fetching products by location:",s),_.error("Failed to fetch products by location")}finally{m.value=!1}};return(s,e)=>(c(),n(w,null,[r(d(T),{title:"Create Stock Opname"}),r(R,{breadcrumbs:L},{default:p(()=>[a("div",Z,[e[17]||(e[17]=a("h1",{class:"text-sm font-bold mb-4"},"Create Stock Opname",-1)),a("div",G,[a("form",{onSubmit:Q(F,["prevent"])},[a("div",H,[a("div",null,[r(d(h),{for:"location_id"},{default:p(()=>e[8]||(e[8]=[b("Location")])),_:1,__:[8]}),E(a("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>t.value.location_id=o),id:"location_id",class:"w-full border rounded p-2",onChange:O},[e[9]||(e[9]=a("option",{value:"",disabled:""},"Select location",-1)),(c(!0),n(w,null,U(C.value,o=>(c(),n("option",{key:o.id,value:o.id},f(o.name),9,J))),128))],544),[[$,t.value.location_id]]),l.value.location_id?(c(),n("p",W,f(l.value.location_id),1)):g("",!0)]),a("div",null,[r(d(h),{for:"product_id"},{default:p(()=>e[10]||(e[10]=[b("Product")])),_:1,__:[10]}),E(a("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>t.value.product_id=o),id:"product_id",class:"w-full border rounded p-2",onChange:N},[e[11]||(e[11]=a("option",{value:"",disabled:""},"Select product",-1)),(c(!0),n(w,null,U(q.value,o=>(c(),n("option",{key:o.id,value:o.id},f(o.name),9,X))),128))],544),[[$,t.value.product_id]]),l.value.product_id?(c(),n("p",Y,f(l.value.product_id),1)):g("",!0)]),a("div",null,[r(d(h),{for:"sloc_id"},{default:p(()=>e[12]||(e[12]=[b("Storage Location")])),_:1,__:[12]}),r(d(v),{modelValue:t.value.sloc_id,"onUpdate:modelValue":e[2]||(e[2]=o=>t.value.sloc_id=o),id:"sloc_id",readonly:"",class:"w-full border rounded p-2",onInput:e[3]||(e[3]=o=>x("sloc_id"))},null,8,["modelValue"]),l.value.sloc_id?(c(),n("p",ee,f(l.value.sloc_id),1)):g("",!0)]),a("div",null,[r(d(h),{for:"uom_id"},{default:p(()=>e[13]||(e[13]=[b("Unit of Measure")])),_:1,__:[13]}),r(d(v),{modelValue:t.value.uom_id,"onUpdate:modelValue":e[4]||(e[4]=o=>t.value.uom_id=o),id:"uom_id",readonly:"",class:"w-full border rounded p-2",onChange:e[5]||(e[5]=o=>x("uom_id"))},null,8,["modelValue"]),l.value.uom_id?(c(),n("p",oe,f(l.value.uom_id),1)):g("",!0)]),a("div",te,[r(d(h),{for:"remark"},{default:p(()=>e[14]||(e[14]=[b("Remark")])),_:1,__:[14]}),r(d(v),{modelValue:t.value.remark,"onUpdate:modelValue":e[6]||(e[6]=o=>t.value.remark=o),id:"remark",placeholder:"Enter remark"},null,8,["modelValue"])])]),a("div",ae,[a("div",se,[a("table",le,[e[15]||(e[15]=a("thead",null,[a("tr",{class:"bg-gray-100"},[a("th",{class:"border p-2 text-left"},"Size"),a("th",{class:"border p-2 text-left"},"System Qty"),a("th",{class:"border p-2 text-left"},"Actual Qty"),a("th",{class:"border p-2 text-left"},"Difference"),a("th",{class:"border p-2 text-left"},"Note")])],-1)),a("tbody",null,[(c(!0),n(w,null,U(t.value.stock_opname_items,(o,y)=>(c(),n("tr",{key:y,class:"border-b"},[a("td",re,[r(d(v),{type:"text",modelValue:o.size_id,"onUpdate:modelValue":i=>o.size_id=i,class:"w-full border rounded p-1",readonly:""},null,8,["modelValue","onUpdate:modelValue"]),y===0&&l.value["stock_opname_items.size_id"]?(c(),n("p",de,f(l.value["stock_opname_items.size_id"]),1)):g("",!0)]),a("td",ie,[r(d(v),{type:"number",modelValue:o.qty_system,"onUpdate:modelValue":i=>o.qty_system=i,class:"w-full",onInput:i=>z(y)},null,8,["modelValue","onUpdate:modelValue","onInput"])]),a("td",ue,[r(d(v),{type:"number",modelValue:o.qty_physical,"onUpdate:modelValue":i=>o.qty_physical=i,class:"w-full",onInput:i=>z(y)},null,8,["modelValue","onUpdate:modelValue","onInput"])]),a("td",ne,[r(d(v),{type:"number",modelValue:o.difference,"onUpdate:modelValue":i=>o.difference=i,class:"w-full",readonly:""},null,8,["modelValue","onUpdate:modelValue"])]),a("td",ce,[r(d(v),{modelValue:o.note,"onUpdate:modelValue":i=>o.note=i,class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])])]))),128))])])])]),a("div",me,[r(d(D),{type:"button",variant:"outline",onClick:e[7]||(e[7]=o=>d(I).visit("/stock-opnames"))},{default:p(()=>e[16]||(e[16]=[b(" Cancel ")])),_:1,__:[16]}),r(d(D),{type:"submit",disabled:m.value},{default:p(()=>[b(f(m.value?"Saving...":"Save"),1)]),_:1},8,["disabled"])])],32)])])]),_:1})],64))}});export{he as default};
