import{d as F,r as I,c as P,w as C,o as z,f as d,g as u,k as e,p as D,F as M,B as S,l as j,C as H,O,u as y,j as c,D as q,x as A,y as Q,M as K,aR as G,b as T,K as B,m as N}from"./app-CVBAo0jO.js";import{_ as R}from"./Input.vue_vue_type_script_setup_true_lang-poTMR4WG.js";import{u as J}from"./useSizeStore-C9IBKDHF.js";import{T as E}from"./trash-DZP0NZ5j.js";import{u as L}from"./useProductStore-C2veQbh6.js";import{u as W}from"./useMasterActivityRoleStore-mUgP316c.js";import{u as X}from"./useUomStore-BPCmGhow.js";import{A as Y}from"./vue3-select-CdtwFAhj.js";const Z={class:"space-y-6"},ee={class:"min-w-full divide-y divide-gray-200"},te={class:"bg-white divide-y divide-gray-200"},se={class:"px-6 py-4 whitespace-nowrap bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"},oe=["onUpdate:modelValue","disabled"],ie=["value"],ae={key:0,class:"text-destructive"},ne={class:"px-6 py-4 whitespace-nowrap bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"},le={class:"px-6 py-4 whitespace-nowrap bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"},re={class:"px-6 py-4 whitespace-nowrap bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"},bt=F({__name:"SizeTab",props:{modelValue:{}},emits:["update:modelValue","update:totalQuantity"],setup($,{emit:w}){const f=$,h=w,_=J(),g=I(f.modelValue.slice()),b=P(()=>g.value.reduce((r,l)=>r+(Number(l.qty)||0),0));C(b,r=>{h("update:totalQuantity",r)}),C(g,r=>h("update:modelValue",r),{deep:!0}),z(()=>{_.fetchSizes(),h("update:totalQuantity",b.value)});const v=()=>{g.value.push({size_id:"",qty:0,variant:""})},n=r=>{g.value.splice(r,1)};return(r,l)=>(u(),d("div",Z,[e("table",ee,[l[1]||(l[1]=e("thead",null,[e("tr",null,[e("th",{class:"px-6 py-5 text-left text-xs bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring uppercase"},"Size"),e("th",{class:"px-6 py-5 text-left text-xs bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring uppercase"},"Variant"),e("th",{class:"px-6 py-5 text-left text-xs bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring uppercase"},"Quantity"),e("th",{class:"px-6 py-5 text-left text-xs bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring uppercase w-16"},"Action")])],-1)),e("tbody",te,[(u(!0),d(M,null,S(g.value,(V,x)=>(u(),d("tr",{key:x},[e("td",se,[j(e("select",{"onUpdate:modelValue":p=>V.size_id=p,class:"block w-full rounded-md border bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring py-2 px-3 shadow-sm sm:text-sm",disabled:y(_).isLoading},[l[0]||(l[0]=e("option",{disabled:"",value:"0"},"Pilih Ukuran",-1)),(u(!0),d(M,null,S(y(_).sizes,p=>(u(),d("option",{key:p.id,value:p.id},c(p.name),9,ie))),128))],8,oe),[[O,V.size_id]]),y(_).error?(u(),d("small",ae,c(y(_).error),1)):H("",!0)]),e("td",ne,[D(y(R),{type:"text",modelValue:V.variant,"onUpdate:modelValue":p=>V.variant=p,class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),e("td",le,[D(y(R),{type:"number",modelValue:V.qty,"onUpdate:modelValue":p=>V.qty=p,class:"w-full",min:"0"},null,8,["modelValue","onUpdate:modelValue"])]),e("td",re,[D(y(q),{variant:"destructive",size:"icon",onClick:p=>n(x)},{default:A(()=>[D(y(E))]),_:2},1032,["onClick"])])]))),128))])]),D(y(q),{type:"button",onClick:v},{default:A(()=>l[2]||(l[2]=[e("i",{class:"pi pi-plus"},null,-1),Q(" Tambah Ukuran ")])),_:1,__:[2]})]))}}),de=K("activity",()=>{const $=I([]),w=G({}),f=I([]);return{roles:$,rolesMap:w,items:f,fetchRoles:async()=>{try{const v=(await(await fetch("/api/activity-roles")).json()).data;$.value=v,v.forEach(n=>{w[n.id]=n.name}),f.value=v.map(n=>{const r=f.value.find(l=>l.role_id===n.id);return{role_id:n.id,price:(r==null?void 0:r.price)??0}})}catch(g){console.error("Failed to fetch menus",g)}},updatePrice:(g,b)=>{const v=parseFloat(b);f.value[g].price=isNaN(v)?0:v}}}),ue={class:"min-w-full divide-y divide-gray-200"},ce={class:"px-6 py-4 whitespace-nowrap bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"},pe={class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"},vt=F({__name:"ActivityTab",props:{modelValue:{}},emits:["update:modelValue"],setup($,{emit:w}){const f=$,h=w,_=de(),{rolesMap:g}=_,b=I(f.modelValue);z(async()=>{await _.fetchRoles(),b.value.length===0&&(b.value=Object.keys(g).map(n=>({activity_role_id:parseInt(n),price:0})),h("update:modelValue",b.value))}),C(b,n=>{h("update:modelValue",n)},{deep:!0});const v=(n,r)=>{const l=parseFloat(r);b.value[n].price=isNaN(l)?0:l};return(n,r)=>(u(),d("div",null,[e("table",ue,[r[0]||(r[0]=e("thead",null,[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Aktivitas"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Upah Per Hari")])],-1)),e("tbody",null,[(u(!0),d(M,null,S(b.value,(l,V)=>(u(),d("tr",{key:l.activity_role_id,class:"bg-white even:bg-gray-50"},[e("td",ce,c(y(g)[l.activity_role_id]||"Unknown"),1),e("td",pe,[D(y(R),{type:"number",min:"0",modelValue:l.price,"onUpdate:modelValue":x=>l.price=x,onInput:x=>v(V,x.target.value)},null,8,["modelValue","onUpdate:modelValue","onInput"])])]))),128))])])]))}}),me={class:"space-y-4 sm:space-y-6"},fe={class:"rounded-lg border p-3 sm:p-4 space-y-3 sm:space-y-4"},ge={class:"space-y-2"},be={class:"grid gap-1 sm:gap-2 text-sm"},ve={class:"flex justify-between"},xe={class:"text-[12px]"},_e={class:"flex justify-between"},ye={class:"text-[12px]"},he={class:"flex justify-between font-medium"},ke={class:"text-[12px]"},we={class:"space-y-2"},Ve={class:"grid gap-1 sm:gap-2 text-sm"},$e={class:"text-[12px]"},Pe={class:"text-[12px]"},De={class:"flex justify-between font-medium pt-2 border-t text-sm sm:"},Me={class:"text-[12px]"},Se={class:"flex justify-between font-medium pt-2 border-t text-sm sm:"},Ue={class:"text-[12px]"},je={class:"space-y-2"},Ie={class:"grid gap-1 sm:gap-2 text-sm"},Te={class:"text-[12px]"},Ce={class:"text-[12px]"},qe={class:"space-y-2"},Ae={class:"grid gap-1 sm:gap-2"},Fe={class:"flex flex-col"},ze={class:"text-sm"},Ne={class:"text-xs sm:text-sm text-gray-500"},Re={class:"flex flex-col items-end"},Be={class:"text-xs sm:text-sm"},He={class:"text-sm font-medium"},Oe={class:"flex justify-between font-medium pt-2 border-t text-sm sm:"},Qe={class:"text-[12px]"},Ee={class:"flex justify-between font-bold pt-4 border-t sm:text-lg"},Le={class:"text-[12px]"},Ke={class:"flex justify-between font-medium text-sm sm:"},Ge={class:"text-[12px]"},xt=F({__name:"HPPTab",props:{modelMaterials:{},activityItems:{},sizeItems:{},startDate:{},endDate:{}},setup($){const w=$,f=L(),h=W(),_=P(()=>f.items),g=t=>{const s=typeof t=="object"&&t!==null?t.id:t,o=_.value.find(k=>k.id===s);return(o==null?void 0:o.name)||`Material ${s}`},b=P(()=>w.modelMaterials.map(t=>({material_id:typeof t.product_id=="object"?t.product_id.id:t.product_id,qty:t.qty,price:t.price||0}))),v=P(()=>b.value.reduce((t,s)=>t+s.qty*s.price,0)),n=(t,s)=>{if(!t||!s)return 1;const o=new Date(t),k=new Date(s),m=Math.abs(k.getTime()-o.getTime());return Math.ceil(m/(1e3*60*60*24))||1},r=P(()=>w.activityItems.reduce((t,s)=>t+(s.price||0)*x.value,0)),l=P(()=>v.value+r.value),V=P(()=>x.value===0?0:l.value/x.value),x=P(()=>{var t;return((t=w.sizeItems)==null?void 0:t.reduce((s,o)=>s+o.qty,0))||0}),p=t=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(t),a=t=>{const s=h.items.find(o=>o.id===t.activity_role_id);return s!=null&&s.name?s.name:t.activity_name||`Aktivitas ${t.activity_role_id}`};z(async()=>{try{await Promise.all([f.fetchProducts(),h.fetchActivityRoles()])}catch(t){console.error("Failed to fetch data:",t)}});const i=t=>t?new Date(t).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric"}):"-";return(t,s)=>(u(),d("div",me,[e("div",fe,[s[12]||(s[12]=e("h3",{class:"sm:text-lg font-semibold border-b pb-2"},"Ringkasan HPP",-1)),e("div",ge,[s[3]||(s[3]=e("span",{class:"text-[14px]"},"Durasi Proyek",-1)),e("div",be,[e("div",ve,[s[0]||(s[0]=e("span",{class:"text-[12px]"},"Tanggal Mulai",-1)),e("span",xe,c(i(t.startDate)),1)]),e("div",_e,[s[1]||(s[1]=e("span",{class:"text-[12px]"},"Tanggal Selesai",-1)),e("span",ye,c(i(t.endDate)),1)]),e("div",he,[s[2]||(s[2]=e("span",{class:"text-[12px]"},"Total Durasi",-1)),e("span",ke,c(n(t.startDate,t.endDate))+" hari",1)])])]),e("div",we,[s[6]||(s[6]=e("span",{class:"text-[14px]"},"Biaya Material",-1)),e("div",Ve,[(u(!0),d(M,null,S(t.modelMaterials,o=>(u(),d("div",{key:typeof o.product_id=="object"?o.product_id.id:o.product_id,class:"flex justify-between"},[e("span",$e,c(g(o.product_id)),1),e("span",Pe,c(p(o.qty*(o.price||0))),1)]))),128))]),e("div",De,[s[4]||(s[4]=e("span",{class:"text-[12px]"},"Total Biaya Material",-1)),e("span",Me,c(p(v.value)),1)]),e("div",Se,[s[5]||(s[5]=e("span",{class:"text-[12px]"},"Total Produksi",-1)),e("span",Ue,c(x.value),1)])]),e("div",je,[s[7]||(s[7]=e("span",{class:"text-[14px]"},"Ukuran",-1)),e("div",Ie,[(u(!0),d(M,null,S(t.sizeItems,o=>(u(),d("div",{key:o.size_id,class:"flex justify-between"},[e("span",Te,c(o.size_id),1),e("span",Ce,c(o.qty),1)]))),128))])]),e("div",qe,[s[9]||(s[9]=e("span",{class:"text-[14px]"},"Biaya Aktivitas",-1)),e("div",Ae,[(u(!0),d(M,null,S(t.activityItems,o=>(u(),d("div",{key:o.activity_role_id,class:"flex justify-between"},[e("div",Fe,[e("span",ze,c(a(o)),1),e("span",Ne,c(n(t.startDate,t.endDate))+" hari ",1)]),e("div",Re,[e("span",Be,c(p(o.price||0))+" / PCS",1),e("span",He,c(p((o.price||0)*x.value)),1)])]))),128))]),e("div",Oe,[s[8]||(s[8]=e("span",{class:"text-[12px]"},"Total Biaya Aktivitas",-1)),e("span",Qe,c(p(r.value)),1)])]),e("div",Ee,[s[10]||(s[10]=e("span",{class:"text-[12px]"},"Total HPP",-1)),e("span",Le,c(p(l.value)),1)]),e("div",Ke,[s[11]||(s[11]=e("span",{class:"text-[12px]"},"HPP per PCS",-1)),e("span",Ge,c(p(V.value)),1)])])]))}}),Je={class:"space-y-4"},We={class:"flex justify-between items-center border-b pb-2"},Xe={class:"font-medium"},Ye={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ze={class:"flex gap-2"},et=["onUpdate:modelValue"],tt=["onUpdate:modelValue"],st={key:0,disabled:""},ot=["value","selected"],it=["onUpdate:modelValue"],at={class:"md:col-span-2"},nt=["onUpdate:modelValue"],lt={class:"flex justify-end"},_t=F({__name:"ModelMaterialTab",props:{modelValue:{}},emits:["update:modelValue"],setup($,{emit:w}){const f=$,h=w,_=L(),g=X(),b=P(()=>_.items),v=P(()=>g.items),n=I([]),r=()=>{const a=[...f.modelValue];a.push({product_id:null,qty:1,uom_id:null,remark:"",price:null}),h("update:modelValue",a)},l=async a=>{const i=n.value.filter(k=>f.modelValue.some(m=>m.product_id===k.id));let t=[];if(a.length>=2)try{t=(await T.get("/api/bahan",{params:{search:a}})).data.data}catch(k){console.error("Search error:",k)}const s=[...i,...t],o=Array.from(new Set(s.map(k=>k.id))).map(k=>s.find(m=>m.id===k));n.value=o},V=a=>{const i=[...f.modelValue];i.splice(a,1),h("update:modelValue",i)};z(async()=>{try{const a=f.modelValue.map(m=>m.product_id).filter(m=>m!==null),i=Array.from(new Set(a)),t=[];for(const m of i)try{const U=await T.get(`/api/bahan/${m}`);U.data&&t.push(U.data)}catch(U){console.error(`Failed to fetch product with ID ${m} for initial modelValue:`,U)}n.value=t,await Promise.all([_.fetchProducts(),g.fetchUoms()]);const s=_.items.map(m=>({id:m.id,name:m.name})),o=[...n.value,...s],k=Array.from(new Set(o.map(m=>m.id))).map(m=>o.find(U=>U.id===m));n.value=k}catch(a){console.error("Failed to fetch data:",a)}});const x=a=>{if(!a)return null;const i=b.value.find(t=>t.id===a);return(i==null?void 0:i.uom_id)||null};C(()=>f.modelValue,async a=>{for(const i of a)if(i.product_id&&(i.uom_id||(i.uom_id=x(i.product_id)),!n.value.some(s=>s.id===i.product_id)))try{const s=await T.get(`/api/bahan/${i.product_id}`);s.data&&n.value.push(s.data)}catch(s){console.error(`Failed to fetch product with ID ${i.product_id}:`,s)}},{deep:!0});const p=(a,i)=>{const t=[...f.modelValue];i>=0&&i<t.length&&(a&&typeof a=="object"?(t[i].product_id=a.id,n.value.some(s=>s.id===a.id)||n.value.push(a)):typeof a=="number"&&(t[i].product_id=a,n.value.find(o=>o.id===a)||T.get(`/api/bahan/${a}`).then(o=>{o.data&&n.value.push(o.data)}).catch(o=>{console.error(`Failed to fetch product with ID ${a}:`,o)})),t[i].uom_id||(t[i].uom_id=x(t[i].product_id)),h("update:modelValue",t))};return(a,i)=>(u(),d("div",Je,[(u(!0),d(M,null,S(a.modelValue,(t,s)=>(u(),d("div",{key:s,class:"p-4 border rounded-lg space-y-4"},[e("div",We,[e("h3",Xe,"Material #"+c(s+1),1),D(y(q),{type:"button",variant:"destructive",size:"icon",onClick:B(o=>V(s),["prevent"])},{default:A(()=>[D(y(E))]),_:2},1032,["onClick"])]),e("div",Ye,[e("div",null,[i[0]||(i[0]=e("label",{class:"text-sm font-medium block mb-1"},"Material",-1)),D(y(Y),{modelValue:t.product_id,"onUpdate:modelValue":[o=>t.product_id=o,o=>p(o,s)],options:n.value,label:"name",value:"id",reduce:o=>o.id,onSearch:l,placeholder:"Pilih Material",class:"w-full text-sm"},null,8,["modelValue","onUpdate:modelValue","options","reduce"])]),e("div",null,[i[2]||(i[2]=e("label",{class:"text-sm font-medium block mb-1"},"Quantity, Unit & Price",-1)),e("div",Ze,[j(e("input",{type:"number","onUpdate:modelValue":o=>t.qty=o,min:"1",class:"block w-1/3 rounded-md border bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring py-2 px-3 shadow-sm sm:text-sm"},null,8,et),[[N,t.qty]]),j(e("select",{"onUpdate:modelValue":o=>t.uom_id=o,class:"block w-1/3 rounded-md border bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring py-2 px-3 shadow-sm sm:text-sm"},[i[1]||(i[1]=e("option",{value:""},"Pilih Unit",-1)),v.value.length===0?(u(),d("option",st,"Loading units...")):H("",!0),(u(!0),d(M,null,S(v.value,o=>(u(),d("option",{key:o.id,value:o.id,selected:o.id===x(t.product_id)},c(o.name),9,ot))),128))],8,tt),[[O,t.uom_id]]),j(e("input",{type:"number","onUpdate:modelValue":o=>t.price=o,min:"0",placeholder:"Harga",class:"block w-1/3 rounded-md border bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring py-2 px-3 shadow-sm sm:text-sm"},null,8,it),[[N,t.price]])])]),e("div",at,[i[3]||(i[3]=e("label",{class:"text-sm font-medium block mb-1"},"Remark",-1)),j(e("input",{type:"text","onUpdate:modelValue":o=>t.remark=o,class:"block w-full rounded-md border bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring py-2 px-3 shadow-sm sm:text-sm",placeholder:"Optional remark"},null,8,nt),[[N,t.remark]])])])]))),128)),e("div",lt,[D(y(q),{type:"button",variant:"secondary",onClick:B(r,["prevent"])},{default:A(()=>i[4]||(i[4]=[e("i",{class:"pi pi-plus mr-2"},null,-1),Q(" Tambah Material ")])),_:1,__:[4]})])]))}});export{bt as _,vt as a,_t as b,xt as c};
