import{d as G,r as _,c as E,T as J,o as O,w as W,f as o,g as i,p as d,u as a,Z as X,x as M,k as s,j as p,F as w,B as N,z as Y,K as S,C as m,D as C,P as q,y as B}from"./app-BLOMClMO.js";import{_ as R}from"./AppLayout.vue_vue_type_script_setup_true_lang-_mVlUDwO.js";import{_ as $}from"./Input.vue_vue_type_script_setup_true_lang-DKMhKz4H.js";import{_ as j}from"./DateInput.vue_vue_type_script_setup_true_lang-4GghZd-Y.js";import{_ as ee}from"./DocumentList.vue_vue_type_script_setup_true_lang-C-AH7Esz.js";import{_ as te,a as ae,b as se,c as le}from"./ModelMaterialTab.vue_vue_type_script_setup_true_lang-hTeP5in6.js";import{u as oe}from"./useModelStore-D7wUMwT1.js";import{u as ie}from"./useToast-C9x9jF4x.js";import"./index-nSIjBrBy.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BwS9btDF.js";import"./trash-D5Yo9PJ4.js";import"./useSizeStore-C8oOSw6u.js";import"./useProductStore-Ccg4NMQc.js";import"./useMasterActivityRoleStore-D9nF8fzz.js";import"./useUomStore-BUn0r93C.js";import"./vue3-select-B7GbD4fY.js";const de={class:"rounded-lg bg-white p-4 shadow-sm dark:bg-gray-800 sm:p-6"},re={class:"border-b pb-3 mb-4"},ne={class:"text-lg font-semibold text-gray-900 dark:text-white"},ue={class:"text-xs text-gray-500 dark:text-gray-400"},me={class:"flex flex-wrap gap-2 mb-6 text-sm"},ce=["onClick"],pe={key:0,class:"space-y-4"},ve={key:0,class:"text-red-500"},_e={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},fe={key:0,class:"text-red-500"},ye={key:0,class:"text-red-500"},ge={class:"sm:col-span-2"},ke={key:0,class:"text-red-500"},be={key:0,class:"text-red-500"},xe={key:0,class:"grid grid-cols-2 sm:grid-cols-4 gap-4"},Ve=["src"],Me={class:"absolute bottom-0 inset-x-0 bg-black/60 p-1 text-[11px] text-white truncate"},he={key:1},De={key:2},we={key:3},Ce={key:4},$e={key:5},ze={class:"flex justify-end border-t pt-4 gap-2 text-sm"},Ue="Model",Ge=G({__name:"CreateModel",props:{modelData:{}},setup(I){const r=I,A=["model","size","activity","gambar","bahan_dan_biaya","hpp"],c=_("model"),v=E(()=>!!r.modelData),z=_(Math.random().toString(36).substring(2,15)),k=_([]),P=E(()=>v.value?r.modelData.id:z.value),F=u=>k.value.splice(u,1),K=[{title:"Konveksi",href:"/konveksi"},{title:v.value?"Edit Model":"Create Model",href:v.value?`/konveksi/model/${r.modelData.id}/edit`:"/konveksi/model/create"}],U=oe(),b=ie(),l=J({description:"",remark:"",start_date:null,end_date:null,estimation_price_pcs:0,estimation_qty:1}),n=_({}),f=_([]),h=_(0),y=_([]),x=_([]);O(()=>{v.value&&(l.description=r.modelData.description,l.remark=r.modelData.remark,l.start_date=r.modelData.start_date,l.end_date=r.modelData.end_date,l.estimation_price_pcs=r.modelData.estimation_price_pcs,l.estimation_qty=r.modelData.estimation_qty,f.value=r.modelData.sizes||[],y.value=r.modelData.activity||[],x.value=r.modelData.modelMaterials||[],k.value=r.modelData.documents||[])}),W(c,u=>{if(u==="size"){const e=f.value.reduce((t,g)=>t+(Number(g.qty)||0),0);h.value=e}});const T=u=>u.map(e=>{var t;return{...e,product_id:typeof e.product_id=="object"&&((t=e.product_id)!=null&&t.id)?e.product_id.id:e.product_id}}),Q=async()=>{var u,e,t,g,D;if(!l.start_date){n.value.start_date=["Tanggal mulai harus diisi"],b.error("Tanggal mulai harus diisi");return}try{v.value?(await U.updateModel(r.modelData.id,{...l,sizes:f.value,activity:y.value,documents:k.value,modelMaterials:T(x.value)}),b.success("Model berhasil diperbarui")):(await U.createModel({...l,sizes:f.value,activity:y.value,uniqId:z.value,documents:k.value,modelMaterials:T(x.value)}),b.success("Model berhasil dibuat")),q.visit("/konveksi/model/list")}catch(V){if(((u=V.response)==null?void 0:u.status)===422&&((t=(e=V.response)==null?void 0:e.data)!=null&&t.errors)){n.value=V.response.data.errors;for(const L in n.value)n.value[L].forEach(Z=>{b.error(Z)})}else(D=(g=V.response)==null?void 0:g.data)!=null&&D.message?b.error(V.response.data.message):b.error("Terjadi kesalahan saat menyimpan model")}},H=u=>y.value.find(t=>t.activity_role_id===u)?`Activity ${u}`:"Unknown Activity";return(u,e)=>(i(),o(w,null,[d(a(X),{title:v.value?"Edit Model":"Create Model"},null,8,["title"]),d(R,{breadcrumbs:K},{default:M(()=>[s("div",de,[s("div",re,[s("h1",ne,p(v.value?"Edit Model":"Buat Model Baru"),1),s("p",ue,p(v.value?"Ubah data model, ukuran, dan aktivitas":"Isi data model, ukuran, dan aktivitas"),1)]),s("div",me,[(i(),o(w,null,N(A,t=>s("button",{key:t,onClick:g=>c.value=t,class:Y(["px-3 py-1.5 rounded-full transition-all",{"bg-indigo-600 text-white":c.value===t,"bg-gray-100 text-gray-600 hover:bg-gray-200":c.value!==t}])},p(t.charAt(0).toUpperCase()+t.slice(1)),11,ce)),64))]),s("form",{onSubmit:S(Q,["prevent"]),class:"space-y-5 text-sm"},[c.value==="model"?(i(),o("div",pe,[s("div",null,[e[10]||(e[10]=s("label",{for:"description",class:"block mb-1 font-medium"},"Nama Model",-1)),d(a($),{id:"description",modelValue:a(l).description,"onUpdate:modelValue":e[0]||(e[0]=t=>a(l).description=t)},null,8,["modelValue"]),n.value.description?(i(),o("small",ve,p(n.value.description[0]),1)):m("",!0)]),s("div",_e,[s("div",null,[e[11]||(e[11]=s("label",{class:"block mb-1 font-medium",for:"start_date"},"Tanggal Mulai",-1)),d(a(j),{id:"start_date",modelValue:a(l).start_date,"onUpdate:modelValue":e[1]||(e[1]=t=>a(l).start_date=t)},null,8,["modelValue"]),n.value.start_date?(i(),o("small",fe,p(n.value.start_date[0]),1)):m("",!0)]),s("div",null,[e[12]||(e[12]=s("label",{class:"block mb-1 font-medium",for:"end_date"},"Estimasi Selesai",-1)),d(a(j),{id:"end_date",modelValue:a(l).end_date,"onUpdate:modelValue":e[2]||(e[2]=t=>a(l).end_date=t)},null,8,["modelValue"]),n.value.end_date?(i(),o("small",ye,p(n.value.end_date[0]),1)):m("",!0)]),s("div",ge,[e[13]||(e[13]=s("label",{class:"block mb-1 font-medium",for:"estimation_price_pcs"},"Estimasi Harga",-1)),d(a($),{id:"estimation_price_pcs",type:"number",modelValue:a(l).estimation_price_pcs,"onUpdate:modelValue":e[3]||(e[3]=t=>a(l).estimation_price_pcs=t)},null,8,["modelValue"]),n.value.estimation_price_pcs?(i(),o("small",ke,p(n.value.estimation_price_pcs[0]),1)):m("",!0)])]),s("div",null,[e[14]||(e[14]=s("label",{class:"block mb-1 font-medium",for:"remark"},"Catatan",-1)),d(a($),{id:"remark",modelValue:a(l).remark,"onUpdate:modelValue":e[4]||(e[4]=t=>a(l).remark=t)},null,8,["modelValue"]),n.value.remark?(i(),o("small",be,p(n.value.remark[0]),1)):m("",!0)]),k.value.length?(i(),o("div",xe,[(i(!0),o(w,null,N(k.value,(t,g)=>(i(),o("div",{key:t.id,class:"relative group rounded-lg overflow-hidden border"},[s("img",{src:t.url,class:"aspect-square w-full object-cover transition-transform group-hover:scale-105"},null,8,Ve),s("div",Me,p(t.filename),1),d(a(C),{variant:"destructive",size:"icon",class:"absolute top-1 right-1 p-1 h-6 w-6",onClick:S(D=>F(g),["prevent"])},{default:M(()=>e[15]||(e[15]=[s("i",{class:"pi pi-times text-xs"},null,-1)])),_:2,__:[15]},1032,["onClick"])]))),128))])):m("",!0)])):m("",!0),c.value==="size"?(i(),o("div",he,[d(te,{modelValue:f.value,"onUpdate:modelValue":e[5]||(e[5]=t=>f.value=t),"onUpdate:totalQuantity":e[6]||(e[6]=t=>h.value=t)},null,8,["modelValue"])])):m("",!0),c.value==="activity"?(i(),o("div",De,[d(ae,{modelValue:y.value,"onUpdate:modelValue":e[7]||(e[7]=t=>y.value=t)},null,8,["modelValue"])])):m("",!0),c.value==="gambar"?(i(),o("div",we,[d(ee,{"reference-id":P.value,"reference-type":Ue},null,8,["reference-id"])])):m("",!0),c.value==="bahan_dan_biaya"?(i(),o("div",Ce,[d(se,{modelValue:x.value,"onUpdate:modelValue":e[8]||(e[8]=t=>x.value=t)},null,8,["modelValue"])])):m("",!0),c.value==="hpp"?(i(),o("div",$e,[d(le,{"model-materials":x.value,"activity-items":y.value.map(t=>({...t,activity_name:H(t.activity_role_id)})),"start-date":a(l).start_date,"end-date":a(l).end_date,"total-production":h.value,"size-items":f.value},null,8,["model-materials","activity-items","start-date","end-date","total-production","size-items"])])):m("",!0),s("div",ze,[d(a(C),{type:"button",variant:"secondary",onClick:e[9]||(e[9]=t=>a(q).visit("/konveksi"))},{default:M(()=>e[16]||(e[16]=[B(" Batal ")])),_:1,__:[16]}),d(a(C),{type:"submit",loading:a(l).processing,class:"bg-indigo-600 text-white hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:M(()=>[e[17]||(e[17]=s("i",{class:"pi pi-check mr-1"},null,-1)),B(" "+p(v.value?"Perbarui":"Simpan"),1)]),_:1,__:[17]},8,["loading"])])],32)])]),_:1})],64))}});export{Ge as default};
