import{d as Z,q as H,r as N,aS as J,o as O,w as B,c as S,Q as W,f as d,g as n,p as l,u as s,Z as X,x as i,k as r,l as Y,G as ee,m as te,D as b,y,F as x,B as _,E as w,j as f,C as k,z as se}from"./app-B7re-mFk.js";import{_ as ae,a as oe,b as E,c as j,d as le,e as A}from"./TableRow.vue_vue_type_script_setup_true_lang-B0sOR81Q.js";import{u as ne}from"./useToast-BbWqI8Yc.js";import{_ as re}from"./AppLayout.vue_vue_type_script_setup_true_lang-C4_tZoF7.js";import{u as ie}from"./useTransferStockStore-B4zcRxkj.js";import{d as de}from"./debounce-BcZQbp_F.js";import{A as ce}from"./vue3-select-DdZ8p_AC.js";import{S as ue}from"./search-TNjYZiNn.js";import{E as pe}from"./eye-Jqf9yfk4.js";import{S as me}from"./square-pen-CRckfgVd.js";import{T as fe}from"./trash-2-C9ksuiK3.js";import"./index-BR8vwvch.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CPM37kDP.js";const xe={class:"px-4 py-4"},ge={class:"flex flex-col md:flex-row items-center gap-3 mb-2 w-full"},ye={class:"mb-4 flex flex-col md:flex-row items-center justify-between gap-3 w-full"},_e={class:"overflow-x-auto w-full"},he={class:"text-xs text-gray-500"},ve={key:0,class:"mt-1 space-y-1"},be={class:"mb-1 font-semibold text-gray-800"},we={class:"flex items-center justify-between w-full"},ke={class:"flex-shrink-0"},Te={class:"ml-2 font-semibold flex-shrink-0"},Ce={key:0,class:"mt-1 flex items-center justify-between rounded-md border-t border-gray-300 bg-white px-1.5 pt-1 font-semibold text-[10px] text-gray-800 shadow-sm"},Pe={class:"ml-2 flex-shrink-0"},$e={key:1,class:"text-xs italic text-gray-400"},Se={class:"flex justify-end space-x-1"},je={class:"mt-4 flex flex-wrap justify-end gap-2"},Ae=["disabled"],De=["onClick"],Ve=["disabled"],Je=Z({__name:"Index",setup(Ne){const D=ne(),p=ie(),{transfers:R,currentPage:m,lastPage:z}=H(p),h=N(50),g=N({label:"Pending",value:"Pending"}),q=de(()=>{p.fetchTransfers(1,h.value)},500),v=J({search:"",status:""}),V=()=>{var t;const o=typeof g.value=="string"?g.value:((t=g.value)==null?void 0:t.value)??"";p.filters.productName=v.search,p.filters.status=o,p.fetchTransfers(1,h.value)};O(()=>{p.fetchTransfers(m.value,h.value)}),B(()=>v.search,q),B(m,async o=>{await p.fetchTransfers(o,h.value)});const T=S(()=>z.value||1),F=S(()=>o=>{const t=new Map;return o.forEach(a=>{var c,u;const e=((c=a.product)==null?void 0:c.name)||"Unknown Product";t.has(e)||t.set(e,[]),(u=t.get(e))==null||u.push(a)}),Array.from(t.entries())}),M=S(()=>{const o=new Map;return R.value.forEach(t=>{var e;const a=t.created_at?new Date(t.created_at).toLocaleDateString("id-ID"):"-";o.has(a)||o.set(a,[]),(e=o.get(a))==null||e.push(t)}),Array.from(o.entries()).map(([t,a])=>({key:t,items:a}))}),C=async o=>{o<1||o>T.value||(m.value=o)},I=()=>C(m.value+1),L=()=>C(m.value-1),U=async o=>{var t,a;if(confirm("Are you sure you want to delete this transfer?"))try{await p.deleteTransfer(o),await p.fetchTransfers(),D.success("Transfer deleted successfully")}catch(e){D.error(((a=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:a.message)??"Failed to delete transfer")}},K=W().props.auth.user.location_id,G=[{title:"Transfer Stocks",href:"/transfer-stocks"}];return(o,t)=>(n(),d(x,null,[l(s(X),{title:"Transfer Stocks"}),l(re,{breadcrumbs:G},{default:i(()=>[r("div",xe,[r("div",ge,[l(s(ce),{modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=a=>g.value=a),options:[{label:"Semua",value:""},{label:"Pending",value:"Pending"},{label:"Approve",value:"Approved"},{label:"Reject",value:"Rejected"}],placeholder:"Pilih Status",class:"w-full md:w-[150px] text-sm"},null,8,["modelValue"]),Y(r("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>v.search=a),type:"text",placeholder:"Cari data...",onKeyup:ee(V,["enter"]),class:"w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 md:w-48"},null,544),[[te,v.search]]),l(s(b),{onClick:V,class:"flex items-center gap-1 bg-indigo-600 text-white hover:bg-indigo-700 px-4 py-2 rounded-md"},{default:i(()=>[l(s(ue),{class:"h-4 w-4"}),t[2]||(t[2]=y(" Cari "))]),_:1,__:[2]})]),r("div",ye,[r("div",_e,[l(s(ae),null,{default:i(()=>[l(s(oe),null,{default:i(()=>[l(s(E),{class:"bg-gray-100"},{default:i(()=>[l(s(j),{class:"min-w-[150px] px-3 py-2 text-xs font-semibold text-gray-700"},{default:i(()=>t[3]||(t[3]=[y("Lokasi Tujuan")])),_:1,__:[3]}),l(s(j),{class:"min-w-[200px] px-3 py-2 text-xs font-semibold text-gray-700"},{default:i(()=>t[4]||(t[4]=[y("Detail ")])),_:1,__:[4]}),l(s(j),{class:"w-[100px] px-3 py-2 text-xs font-semibold text-gray-700 text-right"},{default:i(()=>t[5]||(t[5]=[y(" Actions")])),_:1,__:[5]})]),_:1})]),_:1}),l(s(le),null,{default:i(()=>[(n(!0),d(x,null,_(M.value,a=>(n(),d(x,{key:a.key},[(n(!0),d(x,null,_(a.items,e=>(n(),w(s(E),{key:e.id,class:"border-b hover:bg-gray-50"},{default:i(()=>[l(s(A),{class:"min-w-[150px] px-3 py-2 text-sm align-top"},{default:i(()=>{var c;return[y(f(((c=e.location_destination)==null?void 0:c.name)||"-")+" ",1),r("div",he,[r("span",null,f(a.key),1)])]}),_:2},1024),l(s(A),{class:"min-w-[200px] px-3 py-2 text-sm align-top"},{default:i(()=>{var c;return[(c=e.transfer_detail)!=null&&c.length?(n(),d("div",ve,[(n(!0),d(x,null,_(F.value(e.transfer_detail),([u,P])=>(n(),d("div",{key:u,class:"flex flex-col gap-0.5 rounded-lg border border-gray-200 bg-gray-50 p-1 text-[10px] text-gray-700"},[r("div",be,f(u),1),(n(!0),d(x,null,_(P,($,Q)=>(n(),d("div",{key:Q,class:"flex items-center justify-between rounded-md bg-white px-1.5 py-0.5 shadow-sm"},[r("div",we,[r("span",ke,f($.variant),1),r("span",Te,f($.qty)+" "+f($.uom_id),1)])]))),128))]))),128)),e.transfer_detail.length>1?(n(),d("div",Ce,[t[6]||(t[6]=r("span",null,"Total",-1)),r("span",Pe,f(e.transfer_detail.reduce((u,P)=>u+Number(P.qty||0),0)),1)])):k("",!0)])):(n(),d("span",$e,"No details"))]}),_:2},1024),l(s(A),{class:"w-[100px] px-3 py-2 text-right align-top"},{default:i(()=>{var c;return[r("div",Se,[e!=null&&e.id&&(e.status==="Accepted"||e.status==="Rejected")||((c=e.location_destination)==null?void 0:c.id)===s(K)?(n(),w(s(b),{key:0,variant:"ghost",size:"icon",class:"h-7 w-7 hover:bg-gray-100",onClick:u=>o.$inertia.visit(`/transfer-stock/${e.id}/view`)},{default:i(()=>[l(s(pe),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):k("",!0),e!=null&&e.id&&(e.status==="Pending"||e.status==="Rejected")?(n(),w(s(b),{key:1,variant:"ghost",size:"icon",class:"h-7 w-7 hover:bg-gray-100",onClick:u=>o.$inertia.visit(`/transfer-stock/${e.id}/edit`)},{default:i(()=>[l(s(me),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):k("",!0),e!=null&&e.id&&(e.status==="Pending"||e.status==="Rejected")?(n(),w(s(b),{key:2,variant:"ghost",size:"icon",class:"h-7 w-7 hover:bg-gray-100",onClick:u=>U(e.id)},{default:i(()=>[l(s(fe),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):k("",!0)])]}),_:2},1024)]),_:2},1024))),128))],64))),128))]),_:1})]),_:1})])]),r("div",je,[r("button",{onClick:L,disabled:s(m)===1,class:"rounded border border-gray-300 px-3 py-1 text-sm text-gray-700 hover:bg-gray-100 disabled:opacity-50"}," Previous ",8,Ae),(n(!0),d(x,null,_(T.value,a=>(n(),d("button",{key:a,onClick:e=>C(a),class:se(["rounded border px-3 py-1 text-sm",a===s(m)?"border-blue-600 bg-blue-600 text-white":"border-gray-300 text-gray-700 hover:bg-gray-100"])},f(a),11,De))),128)),r("button",{onClick:I,disabled:s(m)===T.value,class:"rounded border border-gray-300 px-3 py-1 text-sm text-gray-700 hover:bg-gray-100 disabled:opacity-50"}," Next ",8,Ve)])])]),_:1})],64))}});export{Je as default};
