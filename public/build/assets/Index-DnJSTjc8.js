import{d as Z,q as H,r as _,c as v,o as J,f as i,g as l,p as c,u as n,Z as W,x as m,k as t,D as P,y as X,G as Y,F as y,B as S,j as d,E as z,C as B,z as tt}from"./app-36B4zYOK.js";import{_ as et}from"./Input.vue_vue_type_script_setup_true_lang-Dw8iDJMQ.js";import{u as st}from"./useToast-21bEKSXO.js";import{_ as ot}from"./AppLayout.vue_vue_type_script_setup_true_lang-GP0QoSo9.js";import{u as at}from"./useProductionStore-CspIaND6.js";import{P as rt}from"./plus-Dt687W4m.js";import{S as nt}from"./square-pen-DeWeLkXW.js";import{T as lt}from"./trash-2-Cz6r8dRN.js";import{V as it}from"./view-BuaiBpgs.js";import"./index-D_L_HNLE.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-C9dYfdTb.js";const dt={class:"px-3 py-4"},ct={class:"mb-4 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},ut={class:"flex flex-1 gap-2"},pt={key:0,class:"py-4 text-center text-sm text-gray-500"},gt={key:1,class:"space-y-2"},yt={class:"overflow-x-auto rounded-md border border-gray-200 dark:border-gray-700"},_t={class:"min-w-full table-auto text-left text-sm text-gray-800 dark:text-gray-100"},vt={class:"bg-gray-200 dark:bg-gray-700 font-semibold"},mt={colspan:"8",class:"px-3 py-2"},xt={class:"whitespace-nowrap px-3 py-2 align-top"},ht={class:"truncate px-3 py-2 align-top"},ft={class:"whitespace-nowrap px-3 py-2 align-top"},bt={key:0,class:"flex flex-col gap-1 rounded-lg border border-gray-200 bg-gray-50 p-1 text-[11px] text-gray-700"},kt={class:"font-semibold"},wt={key:1,class:"text-xs italic text-gray-400"},Pt={class:"max-w-[160px] truncate px-3 py-2 align-top"},St={class:"max-w-[160px] truncate px-3 py-2 align-top"},$t={class:"px-3 py-2 text-right align-top"},Ct={class:"flex justify-end gap-1 sm:gap-2"},Tt={class:"bg-gray-50 font-semibold dark:bg-gray-800"},Dt={class:"px-3 py-2 text-right"},Ft={class:"px-3 py-2"},Vt={class:"hidden"},It={class:"px-3 py-2 text-right"},Nt={class:"mt-4 flex justify-end space-x-2"},jt=["disabled"],zt=["onClick","disabled"],Bt=["disabled"],Zt=Z({__name:"Index",props:{activity_role:{}},setup(O){const $=st(),x=at(),{productions:h,currentPage:p,lastPage:q,loading:f}=H(x),V=_(50),I=_("created_at"),N=_("desc"),b=O,R=[{title:"Production",href:`/production/${b.activity_role}`}],C=v(()=>q.value||1),T=async a=>{var e,s;a<1||a>C.value||(await x.fetchProductions({page:a,per_page:V.value,sort_field:I.value,sort_order:N.value,activity_role_id:b.activity_role,search:k.value,date_from:(e=w.value.from)==null?void 0:e.toISOString(),date_to:(s=w.value.to)==null?void 0:s.toISOString()}),p.value=a)},A=()=>T(p.value+1),E=()=>T(p.value-1),k=_(""),w=_({from:null,to:null});function D(a){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(a)}const F=async(a=1)=>{var e,s,r,o;try{await x.fetchProductions({page:a||p.value,per_page:V.value,sort_field:I.value,sort_order:N.value,activity_role_id:b.activity_role,search:k.value,date_from:(e=w.value.from)==null?void 0:e.toISOString(),date_to:(s=w.value.to)==null?void 0:s.toISOString()})}catch(u){$.error(((o=(r=u==null?void 0:u.response)==null?void 0:r.data)==null?void 0:o.message)??"Failed to fetch productions")}},L=v(()=>{const a={};return h.value.forEach(e=>{var r,o;const s=`${e.employee_name||"Unknown"} - ${((r=e.model)==null?void 0:r.description)||"No Model"}`;a[s]||(a[s]={employee_name:e.employee_name,model_description:(o=e.model)==null?void 0:o.description,items:[]}),a[s].items.push(e)}),a}),M=v(()=>h.value.reduce((a,e)=>{var r;const s=((r=e.items)==null?void 0:r.reduce((o,u)=>o+(parseFloat(String(u.qty))||0),0))||0;return a+s},0)),Q=v(()=>h.value.reduce((a,e)=>{const s=parseFloat(String(e.price_per_pcs).replace(/[^\d.-]/g,""))||0;return a+s},0)),K=v(()=>h.value.reduce((a,e)=>{const s=String(e.total_price).replace(/[^\d]/g,""),r=parseFloat(s)||0;return a+r},0));J(F);const U=async a=>{var e,s;if(confirm("Are you sure you want to delete this production?"))try{await x.deleteProduction(a),$.success("Production deleted successfully"),await F(1)}catch(r){$.error(((s=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:s.message)??"Failed to delete production")}};return(a,e)=>(l(),i(y,null,[c(n(W),{title:"Production Management"}),c(ot,{breadcrumbs:R},{default:m(()=>[t("div",dt,[t("div",ct,[t("div",ut,[c(n(P),{onClick:e[0]||(e[0]=s=>a.$inertia.visit(`/production/${b.activity_role}/create`)),class:"flex flex-shrink-0 items-center gap-2 rounded-md bg-indigo-600 px-3 py-2 text-sm font-medium text-white hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:m(()=>[c(n(rt),{class:"h-4 w-4"}),e[3]||(e[3]=X(" Tambah Data "))]),_:1,__:[3]}),c(n(et),{modelValue:k.value,"onUpdate:modelValue":e[1]||(e[1]=s=>k.value=s),placeholder:"Search...",class:"flex-1 text-sm",onKeyup:e[2]||(e[2]=Y(s=>F(1),["enter"]))},null,8,["modelValue"])])]),n(f)?(l(),i("div",pt,"Loading...")):(l(),i("div",gt,[t("div",yt,[t("table",_t,[e[6]||(e[6]=t("thead",{class:"bg-gray-100 text-xs font-semibold uppercase text-gray-600 dark:bg-gray-800 dark:text-gray-300"},[t("tr",null,[t("th",{class:"px-3 py-2"},"Tanggal"),t("th",{class:"px-3 py-2"},"Activity"),t("th",{class:"px-3 py-2"},"Size/Qty"),t("th",{class:"px-3 py-2"},"Price/PCS"),t("th",{class:"px-3 py-2"},"Total"),t("th",{class:"px-3 py-2 text-right"},"Actions")])],-1)),t("tbody",null,[(l(!0),i(y,null,S(L.value,(s,r)=>(l(),i(y,{key:r},[t("tr",vt,[t("td",mt," ðŸ‘¤ "+d(s.employee_name||"-")+" â€” ðŸ§µ "+d(s.model_description||"-"),1)]),(l(!0),i(y,null,S(s.items,o=>{var u,j;return l(),i("tr",{key:o.id,class:"border-b border-gray-100 hover:bg-gray-50 dark:border-gray-700 dark:hover:bg-gray-800"},[t("td",xt,d(o.created_at?new Date(o.created_at).toLocaleDateString():"-"),1),t("td",ht,d(((u=o.activity_role)==null?void 0:u.name)||"-"),1),t("td",ft,[(j=o.items)!=null&&j.length?(l(),i("div",bt,[(l(!0),i(y,null,S(o.items,(g,G)=>(l(),i("div",{key:G,class:"flex items-center justify-between rounded-md bg-white px-1.5 py-0.5 shadow-sm"},[t("span",null,d(g.size_id)+" - "+d(g.variant),1),t("span",kt,d(g.qty),1)]))),128))])):(l(),i("span",wt,"-"))]),t("td",Pt,d(D((o==null?void 0:o.price_per_pcs)||0)),1),t("td",St,d((o==null?void 0:o.total_price)||0),1),t("td",$t,[t("div",Ct,[o.status===1||o.status===3?(l(),z(n(P),{key:0,variant:"ghost",size:"icon",class:"hover:bg-gray-100 dark:hover:bg-gray-700",onClick:g=>a.$inertia.visit(`/production/${o.activity_role_id}/edit/${o.id}`)},{default:m(()=>[c(n(nt),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):B("",!0),o.status===1||o.status===3?(l(),z(n(P),{key:1,variant:"ghost",size:"icon",class:"hover:bg-gray-100 dark:hover:bg-gray-700",onClick:g=>U(o.id)},{default:m(()=>[c(n(lt),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):B("",!0),c(n(P),{variant:"ghost",size:"icon",class:"hover:bg-gray-100 dark:hover:bg-gray-700",onClick:g=>a.$inertia.visit(`/production/${o.activity_role_id}/view/${o.id}`)},{default:m(()=>[c(n(it),{class:"h-4 w-4"})]),_:2},1032,["onClick"])])])])}),128))],64))),128))]),t("tfoot",null,[t("tr",Tt,[e[4]||(e[4]=t("td",{colspan:"4",class:"px-3 py-2 text-right"},"Total:",-1)),t("td",Dt,d(M.value),1),t("td",Ft,[t("div",Vt,d(D(Q.value)),1)]),t("td",It,d(D(K.value)),1),e[5]||(e[5]=t("td",null,null,-1))])])])]),t("div",Nt,[t("button",{onClick:E,disabled:n(p)===1||n(f),class:"rounded border border-gray-300 px-3 py-1 text-gray-700 hover:bg-gray-100 disabled:cursor-not-allowed disabled:opacity-50"}," Previous ",8,jt),(l(!0),i(y,null,S(C.value,s=>(l(),i("button",{key:s,onClick:r=>T(s),class:tt(["rounded border px-3 py-1 text-sm",s===n(p)?"border-blue-600 bg-blue-600 text-white":"border-gray-300 text-gray-700 hover:bg-gray-100"]),disabled:n(f)},d(s),11,zt))),128)),t("button",{onClick:A,disabled:n(p)===C.value||n(f),class:"rounded border border-gray-300 px-3 py-1 text-gray-700 hover:bg-gray-100 disabled:cursor-not-allowed disabled:opacity-50"}," Next ",8,Bt)])]))])]),_:1})],64))}});export{Zt as default};
