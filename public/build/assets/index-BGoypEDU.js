import{d as le,r as te,c as R,w as ae,o as de,f as S,g as k,k as o,p as j,F as N,B,l as J,U as fe,u as C,j as U,D as Z,x as ee,y as Re,R as We,aS as Ge,b as re,N as Fe,m as pe,C as Qe,aT as Xe,aU as Je,aV as Ke}from"./app-B8MH_BKJ.js";import{_ as z}from"./Input.vue_vue_type_script_setup_true_lang-TmjqPyNx.js";import{u as Ye}from"./useSizeStore-B3Beuzpk.js";import{T as he}from"./trash-BukWLzxv.js";import{u as Ne}from"./useProductStore-Cs1SrElz.js";import{u as Ze}from"./useMasterActivityRoleStore-Cx8OOJxE.js";import{u as et}from"./useUomStore-5CjMCzLY.js";import{A as tt}from"./vue3-select-CDUdqJhK.js";const ot={class:"space-y-6"},nt={class:"hidden md:table min-w-full divide-y divide-gray-200"},st={class:"bg-white divide-y divide-gray-200"},it={class:"px-6 py-4"},rt=["onUpdate:modelValue"],at=["value"],lt={class:"px-6 py-4"},dt={class:"px-6 py-4"},ct={class:"px-6 py-4"},ut={class:"px-6 py-4"},pt={class:"px-6 py-4 text-center"},mt={class:"md:hidden space-y-4"},ft=["onUpdate:modelValue"],ht=["value"],vt={class:"grid grid-cols-2 gap-3"},gt={class:"grid grid-cols-2 gap-3"},yt={class:"pt-2 flex justify-end"},To=le({__name:"SizeTab",props:{modelValue:{}},emits:["update:modelValue","update:totalQuantity"],setup(b,{emit:L}){const T=b,O=L,F=Ye(),h=te(T.modelValue.slice()),I=R(()=>h.value.reduce((x,p)=>x+(Number(p.qty)||0),0));ae(I,x=>O("update:totalQuantity",x)),ae(h,x=>O("update:modelValue",x),{deep:!0}),de(()=>{F.fetchSizes(),O("update:totalQuantity",I.value)});const $=()=>h.value.push({size_id:"",qty:0,variant:"",price_store:0,price_grosir:0}),v=x=>h.value.splice(x,1);return(x,p)=>(k(),S("div",ot,[o("table",nt,[p[1]||(p[1]=o("thead",null,[o("tr",null,[o("th",{class:"px-6 py-3 text-left text-xs font-semibold uppercase"},"Size"),o("th",{class:"px-6 py-3 text-left text-xs font-semibold uppercase"},"Variant"),o("th",{class:"px-6 py-3 text-left text-xs font-semibold uppercase"},"Qty"),o("th",{class:"px-6 py-3 text-left text-xs font-semibold uppercase"},"Harga Satuan"),o("th",{class:"px-6 py-3 text-left text-xs font-semibold uppercase"},"Harga Grosir"),o("th",{class:"px-6 py-3 text-center text-xs font-semibold uppercase w-16"},"Action")])],-1)),o("tbody",st,[(k(!0),S(N,null,B(h.value,(y,w)=>(k(),S("tr",{key:w},[o("td",it,[J(o("select",{"onUpdate:modelValue":u=>y.size_id=u,class:"w-full rounded-md border p-2 text-sm"},[p[0]||(p[0]=o("option",{disabled:"",value:""},"Pilih Ukuran",-1)),(k(!0),S(N,null,B(C(F).sizes,u=>(k(),S("option",{key:u.id,value:u.id},U(u.name),9,at))),128))],8,rt),[[fe,y.size_id]])]),o("td",lt,[j(C(z),{type:"text",modelValue:y.variant,"onUpdate:modelValue":u=>y.variant=u,class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),o("td",dt,[j(C(z),{type:"number",modelValue:y.qty,"onUpdate:modelValue":u=>y.qty=u,class:"w-full",min:"0"},null,8,["modelValue","onUpdate:modelValue"])]),o("td",ct,[j(C(z),{type:"number",modelValue:y.price_store,"onUpdate:modelValue":u=>y.price_store=u,class:"w-full",min:"0"},null,8,["modelValue","onUpdate:modelValue"])]),o("td",ut,[j(C(z),{type:"number",modelValue:y.price_grosir,"onUpdate:modelValue":u=>y.price_grosir=u,class:"w-full",min:"0"},null,8,["modelValue","onUpdate:modelValue"])]),o("td",pt,[j(C(Z),{variant:"destructive",size:"icon",onClick:u=>v(w)},{default:ee(()=>[j(C(he))]),_:2},1032,["onClick"])])]))),128))])]),o("div",mt,[(k(!0),S(N,null,B(h.value,(y,w)=>(k(),S("div",{key:w,class:"border rounded-lg p-4 shadow-sm space-y-4 bg-white"},[o("div",null,[p[3]||(p[3]=o("label",{class:"text-xs font-bold"},"Size",-1)),J(o("select",{"onUpdate:modelValue":u=>y.size_id=u,class:"w-full rounded-md border p-2 text-sm mt-1"},[p[2]||(p[2]=o("option",{disabled:"",value:""},"Pilih Ukuran",-1)),(k(!0),S(N,null,B(C(F).sizes,u=>(k(),S("option",{key:u.id,value:u.id},U(u.name),9,ht))),128))],8,ft),[[fe,y.size_id]])]),o("div",vt,[o("div",null,[p[4]||(p[4]=o("label",{class:"text-xs font-bold"},"Variant",-1)),j(C(z),{type:"text",modelValue:y.variant,"onUpdate:modelValue":u=>y.variant=u,class:"w-full mt-1"},null,8,["modelValue","onUpdate:modelValue"])]),o("div",null,[p[5]||(p[5]=o("label",{class:"text-xs font-bold"},"Qty",-1)),j(C(z),{type:"number",modelValue:y.qty,"onUpdate:modelValue":u=>y.qty=u,class:"w-full mt-1",min:"0"},null,8,["modelValue","onUpdate:modelValue"])])]),o("div",gt,[o("div",null,[p[6]||(p[6]=o("label",{class:"text-xs font-bold"},"Harga Toko",-1)),j(C(z),{type:"number",modelValue:y.price_store,"onUpdate:modelValue":u=>y.price_store=u,class:"w-full mt-1",min:"0"},null,8,["modelValue","onUpdate:modelValue"])]),o("div",null,[p[7]||(p[7]=o("label",{class:"text-xs font-bold"},"Harga Grosir",-1)),j(C(z),{type:"number",modelValue:y.price_grosir,"onUpdate:modelValue":u=>y.price_grosir=u,class:"w-full mt-1",min:"0"},null,8,["modelValue","onUpdate:modelValue"])])]),o("div",yt,[j(C(Z),{variant:"destructive",size:"icon",onClick:u=>v(w)},{default:ee(()=>[j(C(he))]),_:2},1032,["onClick"])])]))),128))]),j(C(Z),{type:"button",onClick:$},{default:ee(()=>p[8]||(p[8]=[Re(" + Tambah Ukuran ")])),_:1,__:[8]})]))}}),bt=We("activity",()=>{const b=te([]),L=Ge({}),T=te([]);return{roles:b,rolesMap:L,items:T,fetchRoles:async()=>{try{const $=(await(await fetch("/api/activity-roles")).json()).data;b.value=$,$.forEach(v=>{L[v.id]=v.name}),T.value=$.map(v=>{const x=T.value.find(p=>p.role_id===v.id);return{role_id:v.id,price:(x==null?void 0:x.price)??0}})}catch(h){console.error("Failed to fetch menus",h)}},updatePrice:(h,I)=>{const $=parseFloat(I);T.value[h].price=isNaN($)?0:$}}}),_t={class:"min-w-full divide-y divide-gray-200"},wt={class:"px-6 py-4 whitespace-nowrap bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"},xt={class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"},Io=le({__name:"ActivityTab",props:{modelValue:{}},emits:["update:modelValue"],setup(b,{emit:L}){const T=b,O=L,F=bt(),{rolesMap:h}=F,I=te(T.modelValue);de(async()=>{await F.fetchRoles(),I.value.length===0&&(I.value=Object.keys(h).map(v=>({activity_role_id:parseInt(v),price:0})),O("update:modelValue",I.value))}),ae(I,v=>{O("update:modelValue",v)},{deep:!0});const $=(v,x)=>{const p=parseFloat(x);I.value[v].price=isNaN(p)?0:p};return(v,x)=>(k(),S("div",null,[o("table",_t,[x[0]||(x[0]=o("thead",null,[o("tr",null,[o("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Aktivitas"),o("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Upah Per Hari")])],-1)),o("tbody",null,[(k(!0),S(N,null,B(I.value,(p,y)=>(k(),S("tr",{key:p.activity_role_id,class:"bg-white even:bg-gray-50"},[o("td",wt,U(C(h)[p.activity_role_id]||"Unknown"),1),o("td",xt,[j(C(z),{type:"number",min:"0",modelValue:p.price,"onUpdate:modelValue":w=>p.price=w,onInput:w=>$(y,w.target.value)},null,8,["modelValue","onUpdate:modelValue","onInput"])])]))),128))])])]))}}),Vt={class:"space-y-4 sm:space-y-6"},St={class:"rounded-lg border p-3 sm:p-4 space-y-3 sm:space-y-4"},kt={class:"space-y-2"},Pt={class:"grid gap-1 sm:gap-2 text-sm"},Et={class:"flex justify-between"},Tt={class:"text-[12px]"},It={class:"flex justify-between"},Mt={class:"text-[12px]"},Ut={class:"flex justify-between font-medium"},Ct={class:"text-[12px]"},Dt={class:"space-y-2"},$t={class:"grid gap-1 sm:gap-2 text-sm"},jt={class:"text-[12px]"},Ot={class:"text-[12px]"},At={class:"flex justify-between font-medium pt-2 border-t text-sm sm:"},Lt={class:"text-[12px]"},Ft={class:"flex justify-between font-medium pt-2 border-t text-sm sm:"},qt={class:"text-[12px]"},Rt={class:"space-y-2"},Nt={class:"grid gap-1 sm:gap-2 text-sm"},Bt={class:"text-[12px]"},Ht={class:"text-[12px]"},zt={class:"space-y-2"},Wt={class:"grid gap-1 sm:gap-2"},Gt={class:"flex flex-col"},Qt={class:"text-sm"},Xt={class:"text-xs sm:text-sm text-gray-500"},Jt={class:"flex flex-col items-end"},Kt={class:"text-xs sm:text-sm"},Yt={class:"text-sm font-medium"},Zt={class:"flex justify-between font-medium pt-2 border-t text-sm sm:"},eo={class:"text-[12px]"},to={class:"flex justify-between font-bold pt-4 border-t sm:text-lg"},oo={class:"text-[12px]"},no={class:"flex justify-between font-medium text-sm sm:"},so={class:"text-[12px]"},Mo=le({__name:"HPPTab",props:{modelMaterials:{},activityItems:{},sizeItems:{},startDate:{},endDate:{}},setup(b){const L=b,T=Ne(),O=Ze(),F=R(()=>T.items),h=r=>{const a=typeof r=="object"&&r!==null?r.id:r,l=F.value.find(A=>A.id===a);return(l==null?void 0:l.name)||`Material ${a}`},I=R(()=>L.modelMaterials.map(r=>({material_id:typeof r.product_id=="object"?r.product_id.id:r.product_id,qty:r.qty,price:r.price||0}))),$=R(()=>I.value.reduce((r,a)=>r+a.qty*a.price,0)),v=(r,a)=>{if(!r||!a)return 1;const l=new Date(r),A=new Date(a),M=Math.abs(A.getTime()-l.getTime());return Math.ceil(M/(1e3*60*60*24))||1},x=R(()=>L.activityItems.reduce((r,a)=>r+(a.price||0)*w.value,0)),p=R(()=>$.value+x.value),y=R(()=>w.value===0?0:p.value/w.value),w=R(()=>{var r;return((r=L.sizeItems)==null?void 0:r.reduce((a,l)=>a+l.qty,0))||0}),u=r=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(r),m=r=>{const a=O.items.find(l=>l.id===r.activity_role_id);return a!=null&&a.name?a.name:r.activity_name||`Aktivitas ${r.activity_role_id}`};de(async()=>{try{await Promise.all([T.fetchProducts(),O.fetchActivityRoles()])}catch(r){console.error("Failed to fetch data:",r)}});const c=r=>r?new Date(r).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric"}):"-";return(r,a)=>(k(),S("div",Vt,[o("div",St,[a[12]||(a[12]=o("h3",{class:"sm:text-lg font-semibold border-b pb-2"},"Ringkasan HPP",-1)),o("div",kt,[a[3]||(a[3]=o("span",{class:"text-[14px]"},"Durasi Proyek",-1)),o("div",Pt,[o("div",Et,[a[0]||(a[0]=o("span",{class:"text-[12px]"},"Tanggal Mulai",-1)),o("span",Tt,U(c(r.startDate)),1)]),o("div",It,[a[1]||(a[1]=o("span",{class:"text-[12px]"},"Tanggal Selesai",-1)),o("span",Mt,U(c(r.endDate)),1)]),o("div",Ut,[a[2]||(a[2]=o("span",{class:"text-[12px]"},"Total Durasi",-1)),o("span",Ct,U(v(r.startDate,r.endDate))+" hari",1)])])]),o("div",Dt,[a[6]||(a[6]=o("span",{class:"text-[14px]"},"Biaya Material",-1)),o("div",$t,[(k(!0),S(N,null,B(r.modelMaterials,l=>(k(),S("div",{key:typeof l.product_id=="object"?l.product_id.id:l.product_id,class:"flex justify-between"},[o("span",jt,U(h(l.product_id)),1),o("span",Ot,U(u(l.qty*(l.price||0))),1)]))),128))]),o("div",At,[a[4]||(a[4]=o("span",{class:"text-[12px]"},"Total Biaya Material",-1)),o("span",Lt,U(u($.value)),1)]),o("div",Ft,[a[5]||(a[5]=o("span",{class:"text-[12px]"},"Total Produksi",-1)),o("span",qt,U(w.value),1)])]),o("div",Rt,[a[7]||(a[7]=o("span",{class:"text-[14px]"},"Ukuran",-1)),o("div",Nt,[(k(!0),S(N,null,B(r.sizeItems,l=>(k(),S("div",{key:l.size_id,class:"flex justify-between"},[o("span",Bt,U(l.size_id),1),o("span",Ht,U(l.qty),1)]))),128))])]),o("div",zt,[a[9]||(a[9]=o("span",{class:"text-[14px]"},"Biaya Aktivitas",-1)),o("div",Wt,[(k(!0),S(N,null,B(r.activityItems,l=>(k(),S("div",{key:l.activity_role_id,class:"flex justify-between"},[o("div",Gt,[o("span",Qt,U(m(l)),1),o("span",Xt,U(v(r.startDate,r.endDate))+" hari ",1)]),o("div",Jt,[o("span",Kt,U(u(l.price||0))+" / PCS",1),o("span",Yt,U(u((l.price||0)*w.value)),1)])]))),128))]),o("div",Zt,[a[8]||(a[8]=o("span",{class:"text-[12px]"},"Total Biaya Aktivitas",-1)),o("span",eo,U(u(x.value)),1)])]),o("div",to,[a[10]||(a[10]=o("span",{class:"text-[12px]"},"Total HPP",-1)),o("span",oo,U(u(p.value)),1)]),o("div",no,[a[11]||(a[11]=o("span",{class:"text-[12px]"},"HPP per PCS",-1)),o("span",so,U(u(y.value)),1)])])]))}}),io={class:"space-y-4"},ro={class:"flex justify-between items-center border-b pb-2"},ao={class:"font-medium"},lo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},co={class:"flex gap-2"},uo=["onUpdate:modelValue"],po=["onUpdate:modelValue"],mo={key:0,disabled:""},fo=["value","selected"],ho=["onUpdate:modelValue"],vo={class:"md:col-span-2"},go=["onUpdate:modelValue"],yo={class:"flex justify-end"},Uo=le({__name:"ModelMaterialTab",props:{modelValue:{}},emits:["update:modelValue"],setup(b,{emit:L}){const T=b,O=L,F=Ne(),h=et(),I=R(()=>F.items),$=R(()=>h.items),v=te([]),x=()=>{const m=[...T.modelValue];m.push({product_id:null,qty:1,uom_id:null,remark:"",price:null}),O("update:modelValue",m)},p=async m=>{const c=v.value.filter(A=>T.modelValue.some(M=>M.product_id===A.id));let r=[];if(m.length>=2)try{r=(await re.get("/api/bahan",{params:{search:m}})).data.data}catch(A){console.error("Search error:",A)}const a=[...c,...r],l=Array.from(new Set(a.map(A=>A.id))).map(A=>a.find(M=>M.id===A));v.value=l},y=m=>{const c=[...T.modelValue];c.splice(m,1),O("update:modelValue",c)};de(async()=>{try{const m=T.modelValue.map(M=>M.product_id).filter(M=>M!==null),c=Array.from(new Set(m)),r=[];for(const M of c)try{const H=await re.get(`/api/bahan/${M}`);H.data&&r.push(H.data)}catch(H){console.error(`Failed to fetch product with ID ${M} for initial modelValue:`,H)}v.value=r,await Promise.all([F.fetchProducts(),h.fetchUoms()]);const a=F.items.map(M=>({id:M.id,name:M.name})),l=[...v.value,...a],A=Array.from(new Set(l.map(M=>M.id))).map(M=>l.find(H=>H.id===M));v.value=A}catch(m){console.error("Failed to fetch data:",m)}});const w=m=>{if(!m)return null;const c=I.value.find(r=>r.id===m);return(c==null?void 0:c.uom_id)||null};ae(()=>T.modelValue,async m=>{for(const c of m)if(c.product_id&&(c.uom_id||(c.uom_id=w(c.product_id)),!v.value.some(a=>a.id===c.product_id)))try{const a=await re.get(`/api/bahan/${c.product_id}`);a.data&&v.value.push(a.data)}catch(a){console.error(`Failed to fetch product with ID ${c.product_id}:`,a)}},{deep:!0});const u=(m,c)=>{const r=[...T.modelValue];c>=0&&c<r.length&&(m&&typeof m=="object"?(r[c].product_id=m.id,v.value.some(a=>a.id===m.id)||v.value.push(m)):typeof m=="number"&&(r[c].product_id=m,v.value.find(l=>l.id===m)||re.get(`/api/bahan/${m}`).then(l=>{l.data&&v.value.push(l.data)}).catch(l=>{console.error(`Failed to fetch product with ID ${m}:`,l)})),r[c].uom_id||(r[c].uom_id=w(r[c].product_id)),O("update:modelValue",r))};return(m,c)=>(k(),S("div",io,[(k(!0),S(N,null,B(m.modelValue,(r,a)=>(k(),S("div",{key:a,class:"p-4 border rounded-lg space-y-4"},[o("div",ro,[o("h3",ao,"Material #"+U(a+1),1),j(C(Z),{type:"button",variant:"destructive",size:"icon",onClick:Fe(l=>y(a),["prevent"])},{default:ee(()=>[j(C(he))]),_:2},1032,["onClick"])]),o("div",lo,[o("div",null,[c[0]||(c[0]=o("label",{class:"text-sm font-medium block mb-1"},"Material",-1)),j(C(tt),{modelValue:r.product_id,"onUpdate:modelValue":[l=>r.product_id=l,l=>u(l,a)],options:v.value,label:"name",value:"id",reduce:l=>l.id,onSearch:p,placeholder:"Pilih Material",class:"w-full text-sm"},null,8,["modelValue","onUpdate:modelValue","options","reduce"])]),o("div",null,[c[2]||(c[2]=o("label",{class:"text-sm font-medium block mb-1"},"Quantity, Unit & Price",-1)),o("div",co,[J(o("input",{type:"number","onUpdate:modelValue":l=>r.qty=l,min:"1",class:"block w-1/3 rounded-md border bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring py-2 px-3 shadow-sm sm:text-sm"},null,8,uo),[[pe,r.qty]]),J(o("select",{"onUpdate:modelValue":l=>r.uom_id=l,class:"block w-1/3 rounded-md border bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring py-2 px-3 shadow-sm sm:text-sm"},[c[1]||(c[1]=o("option",{value:""},"Pilih Unit",-1)),$.value.length===0?(k(),S("option",mo,"Loading units...")):Qe("",!0),(k(!0),S(N,null,B($.value,l=>(k(),S("option",{key:l.id,value:l.id,selected:l.id===w(r.product_id)},U(l.name),9,fo))),128))],8,po),[[fe,r.uom_id]]),J(o("input",{type:"number","onUpdate:modelValue":l=>r.price=l,min:"0",placeholder:"Harga",class:"block w-1/3 rounded-md border bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring py-2 px-3 shadow-sm sm:text-sm"},null,8,ho),[[pe,r.price]])])]),o("div",vo,[c[3]||(c[3]=o("label",{class:"text-sm font-medium block mb-1"},"Remark",-1)),J(o("input",{type:"text","onUpdate:modelValue":l=>r.remark=l,class:"block w-full rounded-md border bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring py-2 px-3 shadow-sm sm:text-sm",placeholder:"Optional remark"},null,8,go),[[pe,r.remark]])])])]))),128)),o("div",yo,[j(C(Z),{type:"button",variant:"secondary",onClick:Fe(x,["prevent"])},{default:ee(()=>c[4]||(c[4]=[o("i",{class:"pi pi-plus mr-2"},null,-1),Re(" Tambah Material ")])),_:1,__:[4]})])]))}});var me={},qe;function bo(){return qe||(qe=1,function(b){function L(i){return i&&typeof i=="object"&&"default"in i?i.default:i}var T=L(Xe()),O=Ke(),F=L(Je());function h(){return(h=Object.assign?Object.assign.bind():function(i){for(var s=1;s<arguments.length;s++){var e=arguments[s];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(i[t]=e[t])}return i}).apply(this,arguments)}var I,$={modal:null,listener:null,show:function(i){var s=this;typeof i=="object"&&(i="All Inertia requests must receive a valid Inertia response, however a plain JSON response was received.<hr>"+JSON.stringify(i));var e=document.createElement("html");e.innerHTML=i,e.querySelectorAll("a").forEach(function(n){return n.setAttribute("target","_top")}),this.modal=document.createElement("div"),this.modal.style.position="fixed",this.modal.style.width="100vw",this.modal.style.height="100vh",this.modal.style.padding="50px",this.modal.style.boxSizing="border-box",this.modal.style.backgroundColor="rgba(0, 0, 0, .6)",this.modal.style.zIndex=2e5,this.modal.addEventListener("click",function(){return s.hide()});var t=document.createElement("iframe");if(t.style.backgroundColor="white",t.style.borderRadius="5px",t.style.width="100%",t.style.height="100%",this.modal.appendChild(t),document.body.prepend(this.modal),document.body.style.overflow="hidden",!t.contentWindow)throw new Error("iframe not yet ready.");t.contentWindow.document.open(),t.contentWindow.document.write(e.outerHTML),t.contentWindow.document.close(),this.listener=this.hideOnEscape.bind(this),document.addEventListener("keydown",this.listener)},hide:function(){this.modal.outerHTML="",this.modal=null,document.body.style.overflow="visible",document.removeEventListener("keydown",this.listener)},hideOnEscape:function(i){i.keyCode===27&&this.hide()}};function v(i,s){var e;return function(){var t=arguments,n=this;clearTimeout(e),e=setTimeout(function(){return i.apply(n,[].slice.call(t))},s)}}function x(i,s,e){for(var t in s===void 0&&(s=new FormData),e===void 0&&(e=null),i=i||{})Object.prototype.hasOwnProperty.call(i,t)&&y(s,p(e,t),i[t]);return s}function p(i,s){return i?i+"["+s+"]":s}function y(i,s,e){return Array.isArray(e)?Array.from(e.keys()).forEach(function(t){return y(i,p(s,t.toString()),e[t])}):e instanceof Date?i.append(s,e.toISOString()):e instanceof File?i.append(s,e,e.name):e instanceof Blob?i.append(s,e):typeof e=="boolean"?i.append(s,e?"1":"0"):typeof e=="string"?i.append(s,e):typeof e=="number"?i.append(s,""+e):e==null?i.append(s,""):void x(e,i,s)}function w(i){return new URL(i.toString(),window.location.toString())}function u(i,s,e,t){t===void 0&&(t="brackets");var n=/^https?:\/\//.test(s.toString()),d=n||s.toString().startsWith("/"),V=!d&&!s.toString().startsWith("#")&&!s.toString().startsWith("?"),E=s.toString().includes("?")||i===b.Method.GET&&Object.keys(e).length,_=s.toString().includes("#"),f=new URL(s.toString(),"http://localhost");return i===b.Method.GET&&Object.keys(e).length&&(f.search=O.stringify(F(O.parse(f.search,{ignoreQueryPrefix:!0}),e),{encodeValuesOnly:!0,arrayFormat:t}),e={}),[[n?f.protocol+"//"+f.host:"",d?f.pathname:"",V?f.pathname.substring(1):"",E?f.search:"",_?f.hash:""].join(""),e]}function m(i){return(i=new URL(i.href)).hash="",i}function c(i,s){return document.dispatchEvent(new CustomEvent("inertia:"+i,s))}(I=b.Method||(b.Method={})).GET="get",I.POST="post",I.PUT="put",I.PATCH="patch",I.DELETE="delete";var r=function(i){return c("finish",{detail:{visit:i}})},a=function(i){return c("navigate",{detail:{page:i}})},l=typeof window>"u",A=function(){function i(){this.visitId=null}var s=i.prototype;return s.init=function(e){var t=e.resolveComponent,n=e.swapComponent;this.page=e.initialPage,this.resolveComponent=t,this.swapComponent=n,this.isBackForwardVisit()?this.handleBackForwardVisit(this.page):this.isLocationVisit()?this.handleLocationVisit(this.page):this.handleInitialPageVisit(this.page),this.setupEventListeners()},s.handleInitialPageVisit=function(e){this.page.url+=window.location.hash,this.setPage(e,{preserveState:!0}).then(function(){return a(e)})},s.setupEventListeners=function(){window.addEventListener("popstate",this.handlePopstateEvent.bind(this)),document.addEventListener("scroll",v(this.handleScrollEvent.bind(this),100),!0)},s.scrollRegions=function(){return document.querySelectorAll("[scroll-region]")},s.handleScrollEvent=function(e){typeof e.target.hasAttribute=="function"&&e.target.hasAttribute("scroll-region")&&this.saveScrollPositions()},s.saveScrollPositions=function(){this.replaceState(h({},this.page,{scrollRegions:Array.from(this.scrollRegions()).map(function(e){return{top:e.scrollTop,left:e.scrollLeft}})}))},s.resetScrollPositions=function(){var e;window.scrollTo(0,0),this.scrollRegions().forEach(function(t){typeof t.scrollTo=="function"?t.scrollTo(0,0):(t.scrollTop=0,t.scrollLeft=0)}),this.saveScrollPositions(),window.location.hash&&((e=document.getElementById(window.location.hash.slice(1)))==null||e.scrollIntoView())},s.restoreScrollPositions=function(){var e=this;this.page.scrollRegions&&this.scrollRegions().forEach(function(t,n){var d=e.page.scrollRegions[n];d&&(typeof t.scrollTo=="function"?t.scrollTo(d.left,d.top):(t.scrollTop=d.top,t.scrollLeft=d.left))})},s.isBackForwardVisit=function(){return window.history.state&&window.performance&&window.performance.getEntriesByType("navigation").length>0&&window.performance.getEntriesByType("navigation")[0].type==="back_forward"},s.handleBackForwardVisit=function(e){var t=this;window.history.state.version=e.version,this.setPage(window.history.state,{preserveScroll:!0,preserveState:!0}).then(function(){t.restoreScrollPositions(),a(e)})},s.locationVisit=function(e,t){try{window.sessionStorage.setItem("inertiaLocationVisit",JSON.stringify({preserveScroll:t})),window.location.href=e.href,m(window.location).href===m(e).href&&window.location.reload()}catch{return!1}},s.isLocationVisit=function(){try{return window.sessionStorage.getItem("inertiaLocationVisit")!==null}catch{return!1}},s.handleLocationVisit=function(e){var t,n,d,V,E=this,_=JSON.parse(window.sessionStorage.getItem("inertiaLocationVisit")||"");window.sessionStorage.removeItem("inertiaLocationVisit"),e.url+=window.location.hash,e.rememberedState=(t=(n=window.history.state)==null?void 0:n.rememberedState)!=null?t:{},e.scrollRegions=(d=(V=window.history.state)==null?void 0:V.scrollRegions)!=null?d:[],this.setPage(e,{preserveScroll:_.preserveScroll,preserveState:!0}).then(function(){_.preserveScroll&&E.restoreScrollPositions(),a(e)})},s.isLocationVisitResponse=function(e){return e&&e.status===409&&e.headers["x-inertia-location"]},s.isInertiaResponse=function(e){return e==null?void 0:e.headers["x-inertia"]},s.createVisitId=function(){return this.visitId={},this.visitId},s.cancelVisit=function(e,t){var n=t.cancelled,d=n!==void 0&&n,V=t.interrupted,E=V!==void 0&&V;!e||e.completed||e.cancelled||e.interrupted||(e.cancelToken.cancel(),e.onCancel(),e.completed=!1,e.cancelled=d,e.interrupted=E,r(e),e.onFinish(e))},s.finishVisit=function(e){e.cancelled||e.interrupted||(e.completed=!0,e.cancelled=!1,e.interrupted=!1,r(e),e.onFinish(e))},s.resolvePreserveOption=function(e,t){return typeof e=="function"?e(t):e==="errors"?Object.keys(t.props.errors||{}).length>0:e},s.visit=function(e,t){var n=this,d=t===void 0?{}:t,V=d.method,E=V===void 0?b.Method.GET:V,_=d.data,f=_===void 0?{}:_,q=d.replace,W=q!==void 0&&q,K=d.preserveScroll,G=K!==void 0&&K,oe=d.preserveState,ne=oe!==void 0&&oe,ve=d.only,se=ve===void 0?[]:ve,ge=d.headers,ye=ge===void 0?{}:ge,be=d.errorBag,Q=be===void 0?"":be,_e=d.forceFormData,we=_e!==void 0&&_e,xe=d.onCancelToken,Ve=xe===void 0?function(){}:xe,Se=d.onBefore,ke=Se===void 0?function(){}:Se,Pe=d.onStart,Ee=Pe===void 0?function(){}:Pe,Te=d.onProgress,Ie=Te===void 0?function(){}:Te,Me=d.onFinish,Be=Me===void 0?function(){}:Me,Ue=d.onCancel,He=Ue===void 0?function(){}:Ue,Ce=d.onSuccess,De=Ce===void 0?function(){}:Ce,$e=d.onError,je=$e===void 0?function(){}:$e,Oe=d.queryStringArrayFormat,ce=Oe===void 0?"brackets":Oe,X=typeof e=="string"?w(e):e;if(!function g(P){return P instanceof File||P instanceof Blob||P instanceof FileList&&P.length>0||P instanceof FormData&&Array.from(P.values()).some(function(D){return g(D)})||typeof P=="object"&&P!==null&&Object.values(P).some(function(D){return g(D)})}(f)&&!we||f instanceof FormData||(f=x(f)),!(f instanceof FormData)){var Ae=u(E,X,f,ce),ze=Ae[1];X=w(Ae[0]),f=ze}var Y={url:X,method:E,data:f,replace:W,preserveScroll:G,preserveState:ne,only:se,headers:ye,errorBag:Q,forceFormData:we,queryStringArrayFormat:ce,cancelled:!1,completed:!1,interrupted:!1};if(ke(Y)!==!1&&function(g){return c("before",{cancelable:!0,detail:{visit:g}})}(Y)){this.activeVisit&&this.cancelVisit(this.activeVisit,{interrupted:!0}),this.saveScrollPositions();var Le=this.createVisitId();this.activeVisit=h({},Y,{onCancelToken:Ve,onBefore:ke,onStart:Ee,onProgress:Ie,onFinish:Be,onCancel:He,onSuccess:De,onError:je,queryStringArrayFormat:ce,cancelToken:T.CancelToken.source()}),Ve({cancel:function(){n.activeVisit&&n.cancelVisit(n.activeVisit,{cancelled:!0})}}),function(g){c("start",{detail:{visit:g}})}(Y),Ee(Y),T({method:E,url:m(X).href,data:E===b.Method.GET?{}:f,params:E===b.Method.GET?f:{},cancelToken:this.activeVisit.cancelToken.token,headers:h({},ye,{Accept:"text/html, application/xhtml+xml","X-Requested-With":"XMLHttpRequest","X-Inertia":!0},se.length?{"X-Inertia-Partial-Component":this.page.component,"X-Inertia-Partial-Data":se.join(",")}:{},Q&&Q.length?{"X-Inertia-Error-Bag":Q}:{},this.page.version?{"X-Inertia-Version":this.page.version}:{}),onUploadProgress:function(g){f instanceof FormData&&(g.percentage=Math.round(g.loaded/g.total*100),function(P){c("progress",{detail:{progress:P}})}(g),Ie(g))}}).then(function(g){var P;if(!n.isInertiaResponse(g))return Promise.reject({response:g});var D=g.data;se.length&&D.component===n.page.component&&(D.props=h({},n.page.props,D.props)),G=n.resolvePreserveOption(G,D),(ne=n.resolvePreserveOption(ne,D))&&(P=window.history.state)!=null&&P.rememberedState&&D.component===n.page.component&&(D.rememberedState=window.history.state.rememberedState);var ue=X,ie=w(D.url);return ue.hash&&!ie.hash&&m(ue).href===ie.href&&(ie.hash=ue.hash,D.url=ie.href),n.setPage(D,{visitId:Le,replace:W,preserveScroll:G,preserveState:ne})}).then(function(){var g=n.page.props.errors||{};if(Object.keys(g).length>0){var P=Q?g[Q]?g[Q]:{}:g;return function(D){c("error",{detail:{errors:D}})}(P),je(P)}return c("success",{detail:{page:n.page}}),De(n.page)}).catch(function(g){if(n.isInertiaResponse(g.response))return n.setPage(g.response.data,{visitId:Le});if(n.isLocationVisitResponse(g.response)){var P=w(g.response.headers["x-inertia-location"]),D=X;D.hash&&!P.hash&&m(D).href===P.href&&(P.hash=D.hash),n.locationVisit(P,G===!0)}else{if(!g.response)return Promise.reject(g);c("invalid",{cancelable:!0,detail:{response:g.response}})&&$.show(g.response.data)}}).then(function(){n.activeVisit&&n.finishVisit(n.activeVisit)}).catch(function(g){if(!T.isCancel(g)){var P=c("exception",{cancelable:!0,detail:{exception:g}});if(n.activeVisit&&n.finishVisit(n.activeVisit),P)return Promise.reject(g)}})}},s.setPage=function(e,t){var n=this,d=t===void 0?{}:t,V=d.visitId,E=V===void 0?this.createVisitId():V,_=d.replace,f=_!==void 0&&_,q=d.preserveScroll,W=q!==void 0&&q,K=d.preserveState,G=K!==void 0&&K;return Promise.resolve(this.resolveComponent(e.component)).then(function(oe){E===n.visitId&&(e.scrollRegions=e.scrollRegions||[],e.rememberedState=e.rememberedState||{},(f=f||w(e.url).href===window.location.href)?n.replaceState(e):n.pushState(e),n.swapComponent({component:oe,page:e,preserveState:G}).then(function(){W||n.resetScrollPositions(),f||a(e)}))})},s.pushState=function(e){this.page=e,window.history.pushState(e,"",e.url)},s.replaceState=function(e){this.page=e,window.history.replaceState(e,"",e.url)},s.handlePopstateEvent=function(e){var t=this;if(e.state!==null){var n=e.state,d=this.createVisitId();Promise.resolve(this.resolveComponent(n.component)).then(function(E){d===t.visitId&&(t.page=n,t.swapComponent({component:E,page:n,preserveState:!1}).then(function(){t.restoreScrollPositions(),a(n)}))})}else{var V=w(this.page.url);V.hash=window.location.hash,this.replaceState(h({},this.page,{url:V.href})),this.resetScrollPositions()}},s.get=function(e,t,n){return t===void 0&&(t={}),n===void 0&&(n={}),this.visit(e,h({},n,{method:b.Method.GET,data:t}))},s.reload=function(e){return e===void 0&&(e={}),this.visit(window.location.href,h({},e,{preserveScroll:!0,preserveState:!0}))},s.replace=function(e,t){var n;return t===void 0&&(t={}),console.warn("Inertia.replace() has been deprecated and will be removed in a future release. Please use Inertia."+((n=t.method)!=null?n:"get")+"() instead."),this.visit(e,h({preserveState:!0},t,{replace:!0}))},s.post=function(e,t,n){return t===void 0&&(t={}),n===void 0&&(n={}),this.visit(e,h({preserveState:!0},n,{method:b.Method.POST,data:t}))},s.put=function(e,t,n){return t===void 0&&(t={}),n===void 0&&(n={}),this.visit(e,h({preserveState:!0},n,{method:b.Method.PUT,data:t}))},s.patch=function(e,t,n){return t===void 0&&(t={}),n===void 0&&(n={}),this.visit(e,h({preserveState:!0},n,{method:b.Method.PATCH,data:t}))},s.delete=function(e,t){return t===void 0&&(t={}),this.visit(e,h({preserveState:!0},t,{method:b.Method.DELETE}))},s.remember=function(e,t){var n,d;t===void 0&&(t="default"),l||this.replaceState(h({},this.page,{rememberedState:h({},(n=this.page)==null?void 0:n.rememberedState,(d={},d[t]=e,d))}))},s.restore=function(e){var t,n;if(e===void 0&&(e="default"),!l)return(t=window.history.state)==null||(n=t.rememberedState)==null?void 0:n[e]},s.on=function(e,t){var n=function(d){var V=t(d);d.cancelable&&!d.defaultPrevented&&V===!1&&d.preventDefault()};return document.addEventListener("inertia:"+e,n),function(){return document.removeEventListener("inertia:"+e,n)}},i}(),M={buildDOMElement:function(i){var s=document.createElement("template");s.innerHTML=i;var e=s.content.firstChild;if(!i.startsWith("<script "))return e;var t=document.createElement("script");return t.innerHTML=e.innerHTML,e.getAttributeNames().forEach(function(n){t.setAttribute(n,e.getAttribute(n)||"")}),t},isInertiaManagedElement:function(i){return i.nodeType===Node.ELEMENT_NODE&&i.getAttribute("inertia")!==null},findMatchingElementIndex:function(i,s){var e=i.getAttribute("inertia");return e!==null?s.findIndex(function(t){return t.getAttribute("inertia")===e}):-1},update:v(function(i){var s=this,e=i.map(function(t){return s.buildDOMElement(t)});Array.from(document.head.childNodes).filter(function(t){return s.isInertiaManagedElement(t)}).forEach(function(t){var n=s.findMatchingElementIndex(t,e);if(n!==-1){var d,V=e.splice(n,1)[0];V&&!t.isEqualNode(V)&&(t==null||(d=t.parentNode)==null||d.replaceChild(V,t))}else{var E;t==null||(E=t.parentNode)==null||E.removeChild(t)}}),e.forEach(function(t){return document.head.appendChild(t)})},1)},H=new A;b.Inertia=H,b.createHeadManager=function(i,s,e){var t={},n=0;function d(){var E=Object.values(t).reduce(function(_,f){return _.concat(f)},[]).reduce(function(_,f){if(f.indexOf("<")===-1)return _;if(f.indexOf("<title ")===0){var q=f.match(/(<title [^>]+>)(.*?)(<\/title>)/);return _.title=q?""+q[1]+s(q[2])+q[3]:f,_}var W=f.match(/ inertia="[^"]+"/);return W?_[W[0]]=f:_[Object.keys(_).length]=f,_},{});return Object.values(E)}function V(){i?e(d()):M.update(d())}return{createProvider:function(){var E=function(){var _=n+=1;return t[_]=[],_.toString()}();return{update:function(_){return function(f,q){q===void 0&&(q=[]),f!==null&&Object.keys(t).indexOf(f)>-1&&(t[f]=q),V()}(E,_)},disconnect:function(){return function(_){_!==null&&Object.keys(t).indexOf(_)!==-1&&(delete t[_],V())}(E)}}}}},b.hrefToUrl=w,b.mergeDataIntoQueryString=u,b.shouldIntercept=function(i){var s=i.currentTarget.tagName.toLowerCase()==="a";return!(i.target&&i!=null&&i.target.isContentEditable||i.defaultPrevented||s&&i.which>1||s&&i.altKey||s&&i.ctrlKey||s&&i.metaKey||s&&i.shiftKey)},b.urlWithoutHash=m}(me)),me}var Co=bo();export{To as _,Io as a,Uo as b,Mo as c,Co as d};
