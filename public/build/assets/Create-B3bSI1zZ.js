import{d as H,q,r as m,T as K,o as W,w as R,e as D,f as n,g as d,p,u as s,Z as Q,x as Y,k as a,C as k,j as g,F as h,B as T,l as C,y as O,O as Z,m as J,V as E,b as M}from"./app-CHIW5jm0.js";import{u as X}from"./useToast-CDft-8Ag.js";import{_ as ee}from"./AppLayout.vue_vue_type_script_setup_true_lang-Cxb_romD.js";import{u as te}from"./useModelStore-BW7FfEl-.js";import{u as ae}from"./useProductionStore-UT8DsJ_Q.js";import{A as w}from"./vue3-select-BuNmsNDY.js";import"./index-BSKfHvh0.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-B_z60PsD.js";const oe={class:"space-y-6 p-6"},le={class:"text-2xl font-bold"},ie={key:0,class:"mt-4 p-4 bg-yellow-50 border border-yellow-300 rounded text-sm text-yellow-700"},se={key:1,class:"mt-4 p-4 bg-blue-50 border border-blue-300 rounded text-sm text-blue-700"},re={class:"flex flex-col gap-2"},ne=["value"],de={key:2},ue={key:3},ce={class:"w-full table-auto border"},me={class:"border px-3 py-2 text-sm"},pe={class:"border px-3 py-2 text-sm"},ye={class:"border px-3 py-2 text-sm"},_e=["onUpdate:modelValue"],ve={class:"flex gap-2"},be=["disabled"],Se=H({__name:"Create",props:{activity_role:{}},setup(P){const v=X(),b=te(),{models:U,employees:A}=q(b),o=P,x=m(null),y=m(0),I=m([]),f=m([]),N=m([]),S=m([]),r=K({model_id:null,activity_role_id:Number(o.activity_role),employee_id:null,items:[],remark:"",location_destination_id:null}),V=async(i="SEWING")=>{var t,l;try{const e=await M.get("/api/activity-roles",{params:{group_menu:i}});f.value=e.data.data}catch(e){v.error(((l=(t=e.response)==null?void 0:t.data)==null?void 0:l.message)||"Gagal mengambil data tugas finishing")}},z=async()=>{var i,t;try{const l=await M.get("/api/locations");S.value=l.data.data}catch(l){v.error(((t=(i=l.response)==null?void 0:i.data)==null?void 0:t.message)||"Gagal mengambil data lokasi")}};let G;const j=(i,t)=>{i.length&&(t(!0),clearTimeout(G),G=window.setTimeout(async()=>{await b.fetchModels({page:1,is_close:"N",search:i}),t(!1)},500))};W(async()=>{o.activity_role==="FINISHING"&&await V("FINISHING"),o.activity_role==="SEWING"&&await V("SEWING"),o.activity_role==="PENGIRIMAN"&&await z(),await b.fetchActivityEmployee(String(o.activity_role))}),R(x,async i=>{if(i)try{const l=(await b.fetchModelById(i)).data;r.model_id=l.id,I.value=l.sizes,r.items=l.sizes.map(e=>({size_id:String(e.size_id),size_name:e.size_name,qty:0,variant:e.variant}))}catch(t){console.error("Failed to fetch model sizes",t)}});const B=[{title:"Produksi",href:`/production/${o.activity_role}`}],F=ae(),L=async()=>{var i,t,l;try{let e=1;o.activity_role=="CUTTING"&&(e=1),(o.activity_role=="FINISHING"||o.activity_role=="SEWING")&&(e=N.value.map(u=>{var c;return(c=f.value.find($=>$.id===u))==null?void 0:c.id}).filter(u=>u!==null)),o.activity_role=="LUBANG_KANCING"&&(e=4),o.activity_role=="PENGIRIMAN"&&(e=12),o.activity_role=="QUALITY_CHECK"&&(e=11);const _=typeof y.value=="number"?y.value:((i=y.value)==null?void 0:i.id)??0;await F.createProduction({model_id:r.model_id,activity_role_id:e,activity_role:String(o.activity_role),employee_id:_,remark:r.remark||"",location_destination_id:r.location_destination_id||null,items:r.items.filter(u=>u.qty>0)}),v.success("Produksi berhasil dibuat"),E.visit(`/production/${o.activity_role}`)}catch(e){v.error(((l=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:l.message)??"Gagal membuat produksi")}};return(i,t)=>{const l=D("Input");return d(),n(h,null,[p(s(Q),{title:"Production Management"}),p(ee,{breadcrumbs:B},{default:Y(()=>[a("div",oe,[a("h1",le,g(o.activity_role.toString().replace(/_/g," ")??"Buat Produksi"),1),a("div",null,[t[6]||(t[6]=a("label",{class:"mb-1 block font-medium"},"Pilih Desain Kerjaan",-1)),p(s(w),{id:"model.id",modelValue:x.value,"onUpdate:modelValue":t[0]||(t[0]=e=>x.value=e),reduce:e=>e.id,options:s(U),label:"description",filterable:!1,onSearch:j,placeholder:"Select Model",class:"w-full"},null,8,["modelValue","reduce","options"])]),a("div",null,[t[7]||(t[7]=a("label",{class:"mb-1 block font-medium"},"Karyawan",-1)),p(s(w),{id:"model.id",modelValue:y.value,"onUpdate:modelValue":t[1]||(t[1]=e=>y.value=e),options:s(A),label:"name",placeholder:"Select Employee",class:"w-full"},null,8,["modelValue","options"])]),o.activity_role==="QUALITY_CHECK"?(d(),n("div",ie,[t[8]||(t[8]=a("p",null,"Periksa kualitas produk dengan teliti sebelum melanjutkan ke proses selanjutnya. Pastikan tidak ada cacat atau kekurangan.",-1)),p(l,{type:"text",modelValue:s(r).remark,"onUpdate:modelValue":t[2]||(t[2]=e=>s(r).remark=e),placeholder:"Tambahkan catatan atau remark jika diperlukan",class:"mt-2 w-full rounded border p-2"},null,8,["modelValue"])])):k("",!0),f.value.length&&o.activity_role==="FINISHING"||o.activity_role==="SEWING"?(d(),n("div",se,[t[9]||(t[9]=a("p",{class:"font-semibold mb-2"},"Pilih pekerjaan yang dilakukan:",-1)),a("div",re,[(d(!0),n(h,null,T(f.value,e=>(d(),n("label",{key:e.id,class:"flex items-center gap-2"},[C(a("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=_=>N.value=_),value:e.id},null,8,ne),[[Z,N.value]]),O(" "+g(e.name),1)]))),128))])])):k("",!0),o.activity_role==="PENGIRIMAN"?(d(),n("div",de,[t[10]||(t[10]=a("label",{class:"mb-1 block font-medium"},"Lokasi Tujuan:",-1)),p(s(w),{id:"location.id",modelValue:s(r).location_destination_id,"onUpdate:modelValue":t[4]||(t[4]=e=>s(r).location_destination_id=e),options:S.value,label:"name",reduce:e=>e.id,placeholder:"Select Location",class:"w-full"},null,8,["modelValue","options","reduce"])])):k("",!0),I.value.length>0?(d(),n("div",ue,[t[12]||(t[12]=a("h2",{class:"mb-2 font-semibold"},"Model Ukuran",-1)),a("table",ce,[t[11]||(t[11]=a("thead",null,[a("tr",{class:"bg-gray-100"},[a("th",{class:"border px-3 text-sm py-2 text-left"},"Size"),a("th",{class:"border px-3 text-sm py-2 text-left"},"Variant"),a("th",{class:"border px-3 text-sm py-2 text-left"},"Qty")])],-1)),a("tbody",null,[(d(!0),n(h,null,T(s(r).items,(e,_)=>{var u;return d(),n("tr",{key:`size-${_}-${e.size_id}`},[a("td",me,g(((u=I.value.find(c=>c.size_id===e.size_id))==null?void 0:u.size_name)||e.size_id),1),a("td",pe,g(e.variant),1),a("td",ye,[C(a("input",{type:"number",min:"0",class:"w-full rounded border px-2 py-1","onUpdate:modelValue":c=>e.qty=c},null,8,_e),[[J,e.qty,void 0,{number:!0}]])])])}),128))])])])):k("",!0),a("div",ve,[a("button",{onClick:L,class:"rounded text-sm bg-blue-600 px-4 py-2 text-white hover:bg-blue-700",disabled:s(r).processing},"Simpan",8,be),a("button",{onClick:t[5]||(t[5]=e=>s(E).visit(`/production/${o.activity_role}`)),type:"button",class:"rounded text-sm bg-gray-500 px-4 py-2 text-white hover:bg-gray-600"}," Cancel ")])])]),_:1})],64)}}});export{Se as default};
