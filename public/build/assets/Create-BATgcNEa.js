import{d as M,r as b,o as P,f as i,g as u,p as r,u as d,Z as j,x as _,k as a,K as A,l as C,C as k,y as f,F as h,B as w,j as m,O as z,D as E,P as $,b as q}from"./app-CJqfVmpi.js";import{_ as B}from"./AppLayout.vue_vue_type_script_setup_true_lang-DY0hRfUP.js";import{_ as p}from"./Input.vue_vue_type_script_setup_true_lang-C7z7rBdL.js";import{_ as V}from"./Label.vue_vue_type_script_setup_true_lang-fxltGLey.js";import{u as K}from"./useToast-zrFUjB3s.js";import"./index-BX9Ggp7C.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-Bjho6l_o.js";const Q={class:"px-4 py-4"},R={class:"bg-white rounded-md shadow p-6"},T={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"},W=["value"],Z={key:0,class:"text-red-600 text-sm mt-1"},G=["value"],H={key:0,class:"text-red-600 text-sm mt-1"},J={key:0,class:"text-red-600 text-sm mt-1"},X={key:0,class:"text-red-600 text-sm mt-1"},Y={class:"md:col-span-2"},ee={class:"mb-6"},oe={class:"overflow-x-auto"},te={class:"w-full border-collapse"},le={class:"border p-2"},ae={key:0,class:"text-red-600 text-xs mt-1"},se={class:"border p-2"},re={class:"border p-2"},de={class:"border p-2"},ie={class:"border p-2"},ue={class:"flex justify-end gap-4"},be=M({__name:"Create",setup(ne){const v=K(),c=b(!1),l=b({id:"",location_id:"",product_id:"",sloc_id:"",uom_id:"",remark:"",stock_opname_items:[]}),x=b([]),U=b([]),s=b({product_id:"",location_id:"",sloc_id:"",uom_id:"","stock_opname_items.size_id":"","stock_opname_items.qty_system":"","stock_opname_items.qty_physical":""}),D=async()=>{try{c.value=!0;const[t]=await Promise.all([q.get("/api/locations")]);U.value=t.data.data}catch(t){console.error("Error fetching dropdown data:",t),v.error("Failed to load form data")}finally{c.value=!1}},F=()=>{l.value.stock_opname_items.push({size_id:"",qty_system:0,qty_physical:0,difference:0,note:""})},S=t=>{const e=l.value.stock_opname_items[t];e.difference=e.qty_physical-e.qty_system},g=t=>{s.value[t]&&(s.value[t]="")},I=async()=>{try{c.value=!0,Object.keys(s.value).forEach(e=>{s.value[e]=""}),l.value.id||(l.value.id=crypto.randomUUID());let t=!1;if(l.value.product_id||(s.value.product_id="Product is required",t=!0),l.value.location_id||(s.value.location_id="Location is required",t=!0),l.value.sloc_id||(s.value.sloc_id="Storage Location is required",t=!0),l.value.uom_id||(s.value.uom_id="UOM is required",t=!0),l.value.stock_opname_items.length===0&&(v.error("At least one item is required"),t=!0),l.value.stock_opname_items.forEach(e=>{e.size_id||(s.value["stock_opname_items.size_id"]="Size is required",t=!0)}),t)return;await q.post("/api/stock-opnames",l.value),v.success("Stock opname created successfully"),$.visit("/stock-opnames")}catch(t){if(console.error("Error submitting form:",t),v.error("Failed to create stock opname"),t.response&&t.response.status===422){const e=t.response.data.errors;Object.keys(e).forEach(o=>{if(o.startsWith("stock_opname_items.")){const y=o.split(".")[0]+"."+o.split(".")[2];s.value[y]=e[o][0]}else s.value[o]=e[o][0]})}}finally{c.value=!1}};P(()=>{D(),F()});const O=[{title:"Stock Opname",href:"/stock-opnames"},{title:"Create",href:"/stock-opnames/create"}],L=async()=>{if(g("product_id"),!!l.value.product_id)try{c.value=!0;const t=x.value.find(e=>e.id===l.value.product_id);t&&(l.value.sloc_id=t.sloc_id||"",l.value.uom_id=t.uom_id||"",l.value.stock_opname_items=(t.sizes||[]).map(e=>({size_id:String(e.size_id),qty_system:e.qty||0,qty_physical:0,difference:0,note:""})))}catch(t){console.error("Error processing product change:",t),v.error("Failed to process product change")}finally{c.value=!1}},N=async()=>{if(g("location_id"),!!l.value.location_id)try{c.value=!0;const t=await q.get(`/api/combo/product-inventory?location_id=${l.value.location_id}`);console.log(t.data),x.value=Array.isArray(t.data)?t.data.map(e=>({id:e.product_id,name:e.product_name,sloc_id:e.sloc_id||"",uom_id:e.uom_id||"",sizes:e.sizes||[]})):[],l.value.product_id="",l.value.stock_opname_items=[]}catch(t){console.error("Error fetching products by location:",t),v.error("Failed to fetch products by location")}finally{c.value=!1}};return(t,e)=>(u(),i(h,null,[r(d(j),{title:"Create Stock Opname"}),r(B,{breadcrumbs:O},{default:_(()=>[a("div",Q,[e[17]||(e[17]=a("h1",{class:"text-xl font-bold mb-4"},"Create Stock Opname",-1)),a("div",R,[a("form",{onSubmit:A(I,["prevent"])},[a("div",T,[a("div",null,[r(d(V),{for:"location_id"},{default:_(()=>e[8]||(e[8]=[f("Location")])),_:1,__:[8]}),C(a("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>l.value.location_id=o),id:"location_id",class:"w-full border rounded p-2",onChange:N},[e[9]||(e[9]=a("option",{value:"",disabled:""},"Select location",-1)),(u(!0),i(h,null,w(U.value,o=>(u(),i("option",{key:o.id,value:o.id},m(o.name),9,W))),128))],544),[[z,l.value.location_id]]),s.value.location_id?(u(),i("p",Z,m(s.value.location_id),1)):k("",!0)]),a("div",null,[r(d(V),{for:"product_id"},{default:_(()=>e[10]||(e[10]=[f("Product")])),_:1,__:[10]}),C(a("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>l.value.product_id=o),id:"product_id",class:"w-full border rounded p-2",onChange:L},[e[11]||(e[11]=a("option",{value:"",disabled:""},"Select product",-1)),(u(!0),i(h,null,w(x.value,o=>(u(),i("option",{key:o.id,value:o.id},m(o.name),9,G))),128))],544),[[z,l.value.product_id]]),s.value.product_id?(u(),i("p",H,m(s.value.product_id),1)):k("",!0)]),a("div",null,[r(d(V),{for:"sloc_id"},{default:_(()=>e[12]||(e[12]=[f("Storage Location")])),_:1,__:[12]}),r(d(p),{modelValue:l.value.sloc_id,"onUpdate:modelValue":e[2]||(e[2]=o=>l.value.sloc_id=o),id:"sloc_id",readonly:"",class:"w-full border rounded p-2",onInput:e[3]||(e[3]=o=>g("sloc_id"))},null,8,["modelValue"]),s.value.sloc_id?(u(),i("p",J,m(s.value.sloc_id),1)):k("",!0)]),a("div",null,[r(d(V),{for:"uom_id"},{default:_(()=>e[13]||(e[13]=[f("Unit of Measure")])),_:1,__:[13]}),r(d(p),{modelValue:l.value.uom_id,"onUpdate:modelValue":e[4]||(e[4]=o=>l.value.uom_id=o),id:"uom_id",readonly:"",class:"w-full border rounded p-2",onChange:e[5]||(e[5]=o=>g("uom_id"))},null,8,["modelValue"]),s.value.uom_id?(u(),i("p",X,m(s.value.uom_id),1)):k("",!0)]),a("div",Y,[r(d(V),{for:"remark"},{default:_(()=>e[14]||(e[14]=[f("Remark")])),_:1,__:[14]}),r(d(p),{modelValue:l.value.remark,"onUpdate:modelValue":e[6]||(e[6]=o=>l.value.remark=o),id:"remark",placeholder:"Enter remark"},null,8,["modelValue"])])]),a("div",ee,[a("div",oe,[a("table",te,[e[15]||(e[15]=a("thead",null,[a("tr",{class:"bg-gray-100"},[a("th",{class:"border p-2 text-left"},"Size"),a("th",{class:"border p-2 text-left"},"System Qty"),a("th",{class:"border p-2 text-left"},"Actual Qty"),a("th",{class:"border p-2 text-left"},"Difference"),a("th",{class:"border p-2 text-left"},"Note")])],-1)),a("tbody",null,[(u(!0),i(h,null,w(l.value.stock_opname_items,(o,y)=>(u(),i("tr",{key:y,class:"border-b"},[a("td",le,[r(d(p),{type:"text",modelValue:o.size_id,"onUpdate:modelValue":n=>o.size_id=n,class:"w-full border rounded p-1",readonly:""},null,8,["modelValue","onUpdate:modelValue"]),y===0&&s.value["stock_opname_items.size_id"]?(u(),i("p",ae,m(s.value["stock_opname_items.size_id"]),1)):k("",!0)]),a("td",se,[r(d(p),{type:"number",modelValue:o.qty_system,"onUpdate:modelValue":n=>o.qty_system=n,class:"w-full",onInput:n=>S(y)},null,8,["modelValue","onUpdate:modelValue","onInput"])]),a("td",re,[r(d(p),{type:"number",modelValue:o.qty_physical,"onUpdate:modelValue":n=>o.qty_physical=n,class:"w-full",onInput:n=>S(y)},null,8,["modelValue","onUpdate:modelValue","onInput"])]),a("td",de,[r(d(p),{type:"number",modelValue:o.difference,"onUpdate:modelValue":n=>o.difference=n,class:"w-full",readonly:""},null,8,["modelValue","onUpdate:modelValue"])]),a("td",ie,[r(d(p),{modelValue:o.note,"onUpdate:modelValue":n=>o.note=n,class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])])]))),128))])])])]),a("div",ue,[r(d(E),{type:"button",variant:"outline",onClick:e[7]||(e[7]=o=>d($).visit("/stock-opnames"))},{default:_(()=>e[16]||(e[16]=[f(" Cancel ")])),_:1,__:[16]}),r(d(E),{type:"submit",disabled:c.value},{default:_(()=>[f(m(c.value?"Saving...":"Save"),1)]),_:1},8,["disabled"])])],32)])])]),_:1})],64))}});export{be as default};
