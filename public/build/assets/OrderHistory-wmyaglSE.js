import{d as pe,r as m,c as A,o as ve,a as xe,w as be,b as q,e as ye,f as u,g as r,p as a,u as o,Z as _e,x as n,k as t,j as c,z as $,C as P,y as i,$ as we,F as T,B as F,E as R,a0 as ke,a1 as I,a2 as he}from"./app-OChygklg.js";import{_ as Ce,a as $e,b as U,c as _,d as Pe,e as b}from"./TableRow.vue_vue_type_script_setup_true_lang-DKI-NP62.js";import{_ as Te}from"./Textarea.vue_vue_type_script_setup_true_lang-6IothAS1.js";import{u as De}from"./useToast-BxESZ6ul.js";import{_ as Se}from"./AppLayout.vue_vue_type_script_setup_true_lang-BfK2xR03.js";import{u as E}from"./useOrderCustomer-BMmPzlC5.js";import{u as Be}from"./useBankAccountStore-BCkYyQKp.js";import"./index-BXtxs2U3.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CIb7ob0q.js";const Oe={class:"absolute max-h-screen w-full bg-gray-50 p-4 md:p-2"},Ie={class:"mb-6 flex flex-wrap justify-between gap-2"},Ne={class:"w-full flex-1 flex-col flex-wrap rounded-lg bg-indigo-100 p-4 text-center shadow sm:w-[32%] sm:w-[32.999%]"},Me={class:"text-medium font-bold text-indigo-900"},je={class:"w-full flex-1 flex-col flex-wrap rounded-lg bg-green-100 p-4 text-center shadow sm:w-[32%] sm:w-[32.999%]"},Ae={class:"text-medium font-bold text-green-900"},Fe={class:"w-full flex-1 flex-col flex-wrap rounded-lg bg-yellow-100 p-4 text-center shadow sm:w-[32%] sm:w-[32.999%]"},Re={class:"text-small font-bold text-yellow-900"},Ue={class:"mb-4 flex flex-wrap gap-2 border-b"},Ee={key:0,class:"text-center text-gray-500"},Ve={key:1,class:"text-center text-red-500"},Ke={key:2,class:"text-center text-gray-500"},Le={key:3,class:"overflow-x-auto"},Qe={key:0,class:"mb-4 flex items-center gap-3"},ze={class:"flex items-center gap-2"},Ge=["checked"],We={class:"flex items-center justify-between gap-2"},He=["checked","onChange","disabled"],Ye={key:0,class:"relative inline-block border border-blue-200 text-gray-400 bg-blue-100 text-left"},Ze=["onClick"],qe={key:0,class:"absolute z-10 mt-2 w-48 rounded-md bg-white text-gray-800 shadow-lg ring-1 ring-black ring-opacity-5"},Je={class:"py-1 text-sm text-gray-700"},Xe={class:"text-gray-600 text-xs"},et={class:"space-y-1"},tt={class:"mt-1 text-right font-semibold"},st={class:"space-y-4 p-4 sm:p-6"},lt={class:"flex justify-end gap-2 pt-2"},at={class:"flex justify-center p-4"},nt={class:"text-sm text-gray-700 space-y-1"},ot=["src"],it={key:1,class:"w-full h-full bg-gray-200 flex items-center justify-center text-xs text-gray-400 rounded-lg"},rt={class:"mt-4 text-right"},ut={key:0,class:"text-gray-500"},dt={key:1,class:"space-y-2 max-h-48 overflow-y-auto pr-2"},mt={class:"font-medium text-gray-700"},ct={class:"font-semibold"},gt={class:"font-mono"},ft={class:"mt-6"},$t=pe({__name:"OrderHistory",setup(pt){const N=m(!1),D=m(!1),w=m(!1),S=m(""),V=m(""),g=m([]),{orders:k,isLoading:K,error:L,pagination:Q,fetchOrders:h}=E(),f=m("pending"),{cancelOrder:J,checkShipping:X}=E(),M=Be(),y=m(null),v=De(),p=m(1),ee=A(()=>{var s,e;return Math.ceil((((s=Q.value)==null?void 0:s.total)||0)/(((e=Q.value)==null?void 0:e.per_page)||1))});ve(()=>{k.value=[],p.value=1,h({status:f.value,page:p.value}),M.fetchBankAccount(),me(),window.addEventListener("scroll",z)}),xe(()=>{window.removeEventListener("scroll",z)}),be(f,s=>{k.value=[],p.value=1,h({status:s,page:p.value})});const C=A(()=>k.value),z=()=>{document.documentElement.scrollTop+window.innerHeight>=document.documentElement.offsetHeight-100&&!K.value&&p.value<ee.value&&(p.value++,h({status:f.value,page:p.value,append:!0}))},te=s=>{V.value=s.join(","),N.value=!0},se=s=>{s.target.checked?g.value=C.value.filter(d=>d.payment_method==="cod_store").map(d=>d.id):g.value=[]},le=s=>{g.value=s,w.value=!0},ae=s=>{g.value.includes(s)?g.value=g.value.filter(e=>e!==s):g.value.push(s)},j=m();function ne(s){j.value=j.value===s?null:s}const oe=async s=>{try{const e=await X(s);D.value=!0,y.value=e.data}catch(e){console.log(e),alert("Gagal mengambil data pengiriman.")}},ie=s=>s?s.startsWith("storage/")?"/"+s:s.startsWith("/storage/")?s:"/storage/"+s:"";async function re(s){if(window.confirm("Apakah Anda yakin ingin membatalkan pesanan ini?"))try{await J(s),v.success("Pesanan berhasil dibatalkan."),setTimeout(()=>{k.value=[],p.value=1,h({status:f.value,page:p.value})},500)}catch(d){console.log(d),v.error("Gagal membatalkan pesanan.")}}const G=A(()=>g.value.filter(s=>{const e=k.value.find(d=>d.id===s);return e&&e.payment_method==="cod_store"})),ue=async()=>{try{const s={message:S.value,content_data:g.value.length>0?g.value:null,sender_type:"customer",order_id:g.value.length>0?g.value[0]:null};console.log("Sending message payload:",s),await q.post("/api/chat/send",s),w.value=!1,S.value="",v.success("Pesan berhasil dikirim")}catch(s){console.error("Failed to send message:",s),v.error("Gagal mengirim pesan")}},B=m(!1),O=m(null),de=s=>{const e=s.target;e.files&&e.files.length>0?O.value=e.files[0]:O.value=null},W=m(0),H=m(0),Y=m(0),me=async()=>{try{const s=await q.get("/api/dashboard/customer");W.value=s.data.totalProduk||0,H.value=s.data.totalOrder||0,Y.value=s.data.totalPembelian||0}catch(s){console.error("Failed to fetch dashboard data:",s)}},{uploadPaymentProof:ce}=E(),Z=m(null),ge=s=>{Z.value=s,B.value=!0},fe=async()=>{if(!O.value){v.error("Silahkan pilih file bukti transfer terlebih dahulu.");return}const s=Z.value;if(!s){v.error("Tidak ada order yang dipilih untuk upload bukti transfer.");return}try{await ce(s,O.value),v.success("Bukti transfer berhasil diunggah!"),B.value=!1,h({status:f.value})}catch(e){console.error(e),v.error("Gagal mengunggah bukti transfer.")}};return(s,e)=>{const d=ye("Button");return r(),u(T,null,[a(o(_e),{title:"Riwayat Order"}),a(Se,null,{default:n(()=>[t("section",Oe,[t("div",Ie,[t("div",Ne,[e[11]||(e[11]=t("p",{class:"text-xs font-medium text-indigo-800"},"Total Produk",-1)),t("p",Me,c(W.value),1)]),t("div",je,[e[12]||(e[12]=t("p",{class:"text-xs font-medium text-green-800"},"Total Order",-1)),t("p",Ae,c(H.value),1)]),t("div",Fe,[e[13]||(e[13]=t("p",{class:"text-xs font-medium text-yellow-800"},"Total Pembelian",-1)),t("p",Re,c(Y.value),1)])]),t("div",Ue,[t("button",{onClick:e[0]||(e[0]=l=>f.value="pending"),class:$(["rounded-t px-4 py-2 text-sm md:",f.value==="pending"?"border-b-2 text-indigo-400 border-indigo-600 font-semibold":"text-gray-500"])}," Pesanan Saya ",2),t("button",{onClick:e[1]||(e[1]=l=>f.value="done"),class:$(["rounded-t px-4 py-2 text-sm md:",f.value==="done"?"border-b-2  text-indigo-400 border-indigo-600 font-semibold":"text-gray-500"])}," Selesai ",2),t("button",{onClick:e[2]||(e[2]=l=>f.value="cancel"),class:$(["rounded-t px-4 py-2 text-sm md:",f.value==="cancel"?"border-b-2  text-indigo-400 border-indigo-600 font-semibold":"text-gray-500"])}," Dibatalkan ",2)]),o(K)?(r(),u("div",Ee,"Memuat pesanan...")):o(L)?(r(),u("div",Ve,c(o(L)),1)):C.value.length===0?(r(),u("div",Ke,"Tidak ada pesanan ditemukan. ")):(r(),u("div",Le,[f.value==="pending"&&G.value.length>0?(r(),u("div",Qe,[a(d,{onClick:e[3]||(e[3]=l=>te(G.value)),class:"flex items-center gap-1 rounded-md border border-indigo-600 px-3 py-1 text-indigo-600 hover:underline"},{default:n(()=>[a(o(we),{class:"h-4 w-4"}),e[14]||(e[14]=i(" Generate QR "))]),_:1,__:[14]})])):P("",!0),a(o(Ce),{class:"max-h-screen w-full"},{default:n(()=>[a(o($e),null,{default:n(()=>[a(o(U),{class:"bg-gray-100"},{default:n(()=>[a(o(_),{class:"w-[5%]"},{default:n(()=>[t("div",ze,[t("input",{type:"checkbox",checked:g.value.length===C.value.length&&C.value.length>0,onChange:se},null,40,Ge)])]),_:1}),a(o(_),{class:"w-[10%]"},{default:n(()=>e[15]||(e[15]=[i("No. Order")])),_:1,__:[15]}),a(o(_),{class:"w-[10%]"},{default:n(()=>e[16]||(e[16]=[i("Tanggal")])),_:1,__:[16]}),a(o(_),{class:"w-[10%]"},{default:n(()=>e[17]||(e[17]=[i("Total")])),_:1,__:[17]}),a(o(_),{class:"w-[10%]"},{default:n(()=>e[18]||(e[18]=[i("Status")])),_:1,__:[18]}),a(o(_),{class:"w-[10%]"},{default:n(()=>e[19]||(e[19]=[i("Pembayaran")])),_:1,__:[19]})]),_:1})]),_:1}),a(o(Pe),null,{default:n(()=>[(r(!0),u(T,null,F(C.value,l=>(r(),u(T,{key:l.id},[a(o(U),null,{default:n(()=>[a(o(b),null,{default:n(()=>[t("div",We,[t("input",{type:"checkbox",checked:g.value.includes(l.id),onChange:x=>ae(l.id),disabled:l.payment_method!=="cod_store"},null,40,He),f.value=="pending"?(r(),u("div",Ye,[t("button",{onClick:x=>ne(l.id),class:"rounded bg-gray-100 px-2 py-1 text-sm hover:bg-gray-200"}," â‹® ",8,Ze),j.value===l.id?(r(),u("div",qe,[t("div",Je,[a(d,{onClick:x=>le([l.id]),class:"block w-full px-4 py-2 hover:bg-gray-100"},{default:n(()=>e[20]||(e[20]=[i(" Kirim Pesan ")])),_:2,__:[20]},1032,["onClick"]),a(d,{onClick:x=>re(l.id),class:"block w-full px-4 py-2 text-red-500 hover:bg-gray-100"},{default:n(()=>e[21]||(e[21]=[i(" Ajukan Pembatalan ")])),_:2,__:[21]},1032,["onClick"]),l.is_paid=="Y"?(r(),R(d,{key:0,onClick:x=>oe(l.id),class:"block w-full px-4 py-2 hover:bg-gray-100"},{default:n(()=>e[22]||(e[22]=[i(" Status Pengiriman ")])),_:2,__:[22]},1032,["onClick"])):P("",!0),l.is_paid=="N"&&l.payment_method=="bank_transfer"?(r(),R(d,{key:1,onClick:x=>ge(l.id),class:"block w-full px-4 py-2 hover:bg-gray-100"},{default:n(()=>e[23]||(e[23]=[i(" Upload Bukti Transfer ")])),_:2,__:[23]},1032,["onClick"])):P("",!0)])])):P("",!0)])):P("",!0)])]),_:2},1024),a(o(b),{class:"text-gray-800 text-sm leading-snug space-y-0.5"},{default:n(()=>[i(c(l.id),1)]),_:2},1024),a(o(b),{class:"text-gray-800 text-sm leading-snug space-y-0.5"},{default:n(()=>[t("div",Xe,c(new Date(l.created_at).toLocaleDateString("id-ID")),1)]),_:2},1024),a(o(b),{class:"text-gray-800"},{default:n(()=>[i(c(new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(Number(l.total_amount))),1)]),_:2},1024),a(o(b),{class:"text-gray-800 text-sm space-y-1"},{default:n(()=>[t("span",{class:$(["text-xs font-semibold",{"text-yellow-600":l.status===1,"text-green-600":l.status===2,"text-red-600":l.status===3}])},c(l.status===1?"Pending":l.status===2?"Selesai":l.status===3?"Menunggu Konfirmasi":l.status===4?"On Progress":l.status===5?"Sedang di kemas":"Dikirim"),3)]),_:2},1024),a(o(b),{class:"text-gray-800 text-center text-xxs"},{default:n(()=>[t("span",{class:$(["text-xxs font-small inline-block rounded-full border px-1 py-1",l.payment_method==="bank_transfer"?"border-yellow-600 text-yellow-600":l.payment_method==="cod_store"?"border-green-600 text-green-600":"border-gray-300 text-gray-500"])},c(l.payment_method==="bank_transfer"?"Transfer":l.payment_method==="cod_store"?"Bayar Di Toko":"-"),3)]),_:2},1024)]),_:2},1024),a(o(U),null,{default:n(()=>[a(o(b),{colspan:"6",class:"rounded-md border border-blue-100 bg-blue-50 p-3"},{default:n(()=>[e[24]||(e[24]=t("h4",{class:"mb-1 text-sm font-semibold"},"Detail Pesanan:",-1)),t("div",et,[(r(!0),u(T,null,F(l.order_items,x=>(r(),R(ke,{key:x.id,item:x},null,8,["item"]))),128))]),t("div",tt," Subtotal: "+c(new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(Number(l.total_amount))),1)]),_:2,__:[24]},1024)]),_:2},1024)],64))),128))]),_:1})]),_:1})]))]),a(I,{show:w.value,onClose:e[6]||(e[6]=l=>w.value=!1)},{default:n(()=>[t("div",st,[e[27]||(e[27]=t("h2",{class:"text-center font-semibold text-gray-800 sm:text-lg"},"Kirim Pesan",-1)),a(o(Te),{modelValue:S.value,"onUpdate:modelValue":e[4]||(e[4]=l=>S.value=l),class:"h-32 w-full bg-white resize-none rounded-md border border-gray-300 p-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 sm:h-40",placeholder:"Tulis pesan..."},null,8,["modelValue"]),t("div",lt,[a(d,{onClick:e[5]||(e[5]=l=>w.value=!1),variant:"outline",class:"px-4 py-2 text-sm"},{default:n(()=>e[25]||(e[25]=[i(" Batal ")])),_:1,__:[25]}),a(d,{onClick:ue,class:"bg-indigo-600 px-4 py-2 text-sm text-white hover:bg-indigo-700"},{default:n(()=>e[26]||(e[26]=[i(" Kirim ")])),_:1,__:[26]})])])]),_:1},8,["show"]),a(I,{show:N.value,onClose:e[7]||(e[7]=l=>N.value=!1)},{default:n(()=>[t("div",at,[a(he,{value:V.value,size:256},null,8,["value"])])]),_:1},8,["show"]),a(I,{show:D.value,onClose:e[9]||(e[9]=l=>D.value=!1),class:"max-w-lg"},{default:n(()=>[e[32]||(e[32]=t("h2",{class:"text-lg font-semibold mb-2"},"Informasi Pengiriman",-1)),t("div",nt,[t("p",null,[e[28]||(e[28]=t("strong",null,"No. Resi:",-1)),i(" "+c(y.value.resi_number),1)]),t("p",null,[e[29]||(e[29]=t("strong",null,"Kurir:",-1)),i(" "+c(y.value.delivery_provider),1)]),t("p",null,[e[30]||(e[30]=t("strong",null,"Estimasi Tiba:",-1)),i(" "+c(new Date(y.value.estimation_date).toLocaleDateString("id-ID")),1)]),t("div",null,[e[31]||(e[31]=i("Bukti Pengiriman ")),y.value.delivery_proof?(r(),u("img",{key:0,src:ie(y.value.delivery_proof),alt:"product",class:"w-full h-full object-cover rounded-lg cursor-pointer"},null,8,ot)):(r(),u("div",it,"No Image "))])]),t("div",rt,[t("button",{class:"px-4 py-2 bg-blue-600 text-white rounded",onClick:e[8]||(e[8]=l=>D.value=!1)},"Tutup")])]),_:1,__:[32]},8,["show"]),a(I,{show:B.value,onClose:e[10]||(e[10]=l=>B.value=!1),class:"max-w-lg"},{default:n(()=>[e[37]||(e[37]=t("div",{class:"mb-4 text-lg font-semibold"},"Informasi Rekening",-1)),o(M).loading?(r(),u("div",ut,"Memuat data rekening...")):(r(),u("ul",dt,[(r(!0),u(T,null,F(o(M).bankAccount,l=>(r(),u("li",{key:l.id,class:"p-3 border rounded-lg bg-gray-50 text-sm md:text-base"},[t("div",mt,"Bank ID: "+c(l.id),1),t("div",null,[e[33]||(e[33]=i("Atas Nama: ")),t("span",ct,c(l.name),1)]),t("div",null,[e[34]||(e[34]=i("No Rekening: ")),t("span",gt,c(l.account_number),1)])]))),128))])),t("div",ft,[e[35]||(e[35]=t("label",{class:"block mb-1 font-medium"},"Upload Bukti Transfer",-1)),t("input",{type:"file",onChange:de,class:"block w-full text-sm text-gray-700 file:mr-4 file:py-1 file:px-3 file:rounded-md file:border-0 file:bg-blue-600 file:text-white hover:file:bg-blue-700"},null,32)]),a(d,{class:"mt-4 bg-blue-600 hover:bg-blue-700 px-4 py-2 text-white rounded-md w-full",onClick:fe},{default:n(()=>e[36]||(e[36]=[i(" Kirim Bukti Transfer ")])),_:1,__:[36]})]),_:1,__:[37]},8,["show"])]),_:1})],64)}}});export{$t as default};
