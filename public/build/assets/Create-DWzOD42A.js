import{d as B,r as V,o as P,f as u,g as c,p as r,u as d,Z as T,x as y,k as t,N as Q,l as E,C as g,y as k,F as w,B as q,j as _,U as $,D,V as I,b as S}from"./app-BCda4m9o.js";import{_ as R}from"./AppLayout.vue_vue_type_script_setup_true_lang-DeOTA85B.js";import{_ as p}from"./Input.vue_vue_type_script_setup_true_lang-BrLdvqN7.js";import{_ as h}from"./Label.vue_vue_type_script_setup_true_lang-bj_1jti1.js";import{u as Z}from"./useToast-B1GKS7hw.js";import"./index-DRGvBej9.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-NKbwG5OI.js";const G={class:"px-4 py-4"},H={class:"bg-white rounded-md shadow p-6"},J={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"},K=["value"],W={key:0,class:"text-red-600 text-sm mt-1"},X=["value"],Y={key:0,class:"text-red-600 text-sm mt-1"},ee={key:0,class:"text-red-600 text-sm mt-1"},oe={key:0,class:"text-red-600 text-sm mt-1"},te={class:"md:col-span-2"},ae={class:"mb-6"},se={class:"overflow-x-auto"},le={class:"w-full border-collapse"},re={class:"border p-2"},de={key:0,class:"text-red-600 text-xs mt-1"},ie={class:"border p-2"},ne={key:0,class:"text-red-600 text-xs mt-1"},ue={class:"border p-2"},ce={class:"border p-2"},me={class:"border p-2"},_e={class:"border p-2"},pe={class:"flex justify-end gap-4"},we=B({__name:"Create",setup(ve){const v=Z(),m=V(!1),a=V({id:"",location_id:"",product_id:"",sloc_id:"",uom_id:"",remark:"",stock_opname_items:[]}),U=V([]),C=V([]),s=V({product_id:"",location_id:"",sloc_id:"",uom_id:"","stock_opname_items.size_id":"","stock_opname_items.variant":"","stock_opname_items.qty_system":"","stock_opname_items.qty_physical":""}),M=async()=>{try{m.value=!0;const[l]=await Promise.all([S.get("/api/locations")]);C.value=l.data.data}catch(l){console.error("Error fetching dropdown data:",l),v.error("Failed to load form data")}finally{m.value=!1}},N=()=>{a.value.stock_opname_items.push({size_id:"",variant:"",qty_system:0,qty_physical:0,difference:0,note:""})},z=l=>{const e=a.value.stock_opname_items[l];e.difference=e.qty_physical-e.qty_system},x=l=>{s.value[l]&&(s.value[l]="")},A=async()=>{var l,e,o,f,i;try{m.value=!0,Object.keys(s.value).forEach(b=>{s.value[b]=""}),a.value.id||(a.value.id=crypto.randomUUID());let n=!1;if(a.value.product_id||(s.value.product_id="Product is required",n=!0),a.value.location_id||(s.value.location_id="Location is required",n=!0),a.value.sloc_id||(s.value.sloc_id="Storage Location is required",n=!0),a.value.uom_id||(s.value.uom_id="UOM is required",n=!0),a.value.stock_opname_items.length===0&&(v.error("At least one item is required"),n=!0),a.value.stock_opname_items.forEach(b=>{b.size_id||(s.value["stock_opname_items.size_id"]="Size is required",n=!0)}),n)return;await S.post("/api/stock-opnames",a.value),v.success("Stock opname created successfully"),I.visit("/stock-opnames")}catch(n){if(((l=n.response)==null?void 0:l.status)===422&&((o=(e=n.response)==null?void 0:e.data)!=null&&o.errors)){s.value=n.response.data.errors;for(const b in s.value)(Array.isArray(s.value[b])?s.value[b]:[s.value[b]]).forEach(j=>{v.error(j)})}else(i=(f=n.response)==null?void 0:f.data)!=null&&i.message?v.error(n.response.data.message):v.error("Terjadi kesalahan saat menyimpan data")}finally{m.value=!1}};P(()=>{M(),N()});const F=[{title:"Stock Opname",href:"/stock-opnames"},{title:"Create",href:"/stock-opnames/create"}],L=async()=>{if(x("product_id"),!!a.value.product_id)try{m.value=!0;const l=U.value.find(e=>e.id===a.value.product_id);l&&(a.value.sloc_id=l.sloc_id||"",a.value.uom_id=l.uom_id||"",a.value.stock_opname_items=(l.sizes||[]).map(e=>({size_id:String(e.size_id),variant:e.variant,qty_system:e.qty||0,qty_physical:0,difference:0,note:""})))}catch(l){console.error("Error processing product change:",l),v.error("Failed to process product change")}finally{m.value=!1}},O=async()=>{if(x("location_id"),!!a.value.location_id)try{m.value=!0;const l=await S.get(`/api/combo/product-inventory?location_id=${a.value.location_id}`);console.log(l.data),U.value=Array.isArray(l.data)?l.data.map(e=>({id:e.product_id,name:e.product_name,sloc_id:e.sloc_id||"",uom_id:e.uom_id||"",sizes:e.sizes||[]})):[],a.value.product_id="",a.value.stock_opname_items=[]}catch(l){console.error("Error fetching products by location:",l),v.error("Failed to fetch products by location")}finally{m.value=!1}};return(l,e)=>(c(),u(w,null,[r(d(T),{title:"Create Stock Opname"}),r(R,{breadcrumbs:F},{default:y(()=>[t("div",G,[e[17]||(e[17]=t("h1",{class:"text-sm font-bold mb-4"},"Create Stock Opname",-1)),t("div",H,[t("form",{onSubmit:Q(A,["prevent"])},[t("div",J,[t("div",null,[r(d(h),{for:"location_id"},{default:y(()=>e[8]||(e[8]=[k("Location")])),_:1,__:[8]}),E(t("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>a.value.location_id=o),id:"location_id",class:"w-full border rounded p-2",onChange:O},[e[9]||(e[9]=t("option",{value:"",disabled:""},"Select location",-1)),(c(!0),u(w,null,q(C.value,o=>(c(),u("option",{key:o.id,value:o.id},_(o.name),9,K))),128))],544),[[$,a.value.location_id]]),s.value.location_id?(c(),u("p",W,_(s.value.location_id),1)):g("",!0)]),t("div",null,[r(d(h),{for:"product_id"},{default:y(()=>e[10]||(e[10]=[k("Product")])),_:1,__:[10]}),E(t("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>a.value.product_id=o),id:"product_id",class:"w-full border rounded p-2",onChange:L},[e[11]||(e[11]=t("option",{value:"",disabled:""},"Select product",-1)),(c(!0),u(w,null,q(U.value,o=>(c(),u("option",{key:o.id,value:o.id},_(o.name),9,X))),128))],544),[[$,a.value.product_id]]),s.value.product_id?(c(),u("p",Y,_(s.value.product_id),1)):g("",!0)]),t("div",null,[r(d(h),{for:"sloc_id"},{default:y(()=>e[12]||(e[12]=[k("Storage Location")])),_:1,__:[12]}),r(d(p),{modelValue:a.value.sloc_id,"onUpdate:modelValue":e[2]||(e[2]=o=>a.value.sloc_id=o),id:"sloc_id",readonly:"",class:"w-full border rounded p-2",onInput:e[3]||(e[3]=o=>x("sloc_id"))},null,8,["modelValue"]),s.value.sloc_id?(c(),u("p",ee,_(s.value.sloc_id),1)):g("",!0)]),t("div",null,[r(d(h),{for:"uom_id"},{default:y(()=>e[13]||(e[13]=[k("Unit of Measure")])),_:1,__:[13]}),r(d(p),{modelValue:a.value.uom_id,"onUpdate:modelValue":e[4]||(e[4]=o=>a.value.uom_id=o),id:"uom_id",readonly:"",class:"w-full border rounded p-2",onChange:e[5]||(e[5]=o=>x("uom_id"))},null,8,["modelValue"]),s.value.uom_id?(c(),u("p",oe,_(s.value.uom_id),1)):g("",!0)]),t("div",te,[r(d(h),{for:"remark"},{default:y(()=>e[14]||(e[14]=[k("Remark")])),_:1,__:[14]}),r(d(p),{modelValue:a.value.remark,"onUpdate:modelValue":e[6]||(e[6]=o=>a.value.remark=o),id:"remark",placeholder:"Enter remark"},null,8,["modelValue"])])]),t("div",ae,[t("div",se,[t("table",le,[e[15]||(e[15]=t("thead",null,[t("tr",{class:"bg-gray-100"},[t("th",{class:"border p-2 text-left"},"Size"),t("th",{class:"border p-2 text-left"},"variant"),t("th",{class:"border p-2 text-left"},"System Qty"),t("th",{class:"border p-2 text-left"},"Actual Qty"),t("th",{class:"border p-2 text-left"},"Difference"),t("th",{class:"border p-2 text-left"},"Note")])],-1)),t("tbody",null,[(c(!0),u(w,null,q(a.value.stock_opname_items,(o,f)=>(c(),u("tr",{key:f,class:"border-b"},[t("td",re,[r(d(p),{type:"text",modelValue:o.size_id,"onUpdate:modelValue":i=>o.size_id=i,class:"w-full border rounded p-1",readonly:""},null,8,["modelValue","onUpdate:modelValue"]),f===0&&s.value["stock_opname_items.size_id"]?(c(),u("p",de,_(s.value["stock_opname_items.size_id"]),1)):g("",!0)]),t("td",ie,[r(d(p),{type:"text",modelValue:o.variant,"onUpdate:modelValue":i=>o.variant=i,class:"w-full border rounded p-1",readonly:""},null,8,["modelValue","onUpdate:modelValue"]),f===0&&s.value["stock_opname_items.size_id"]?(c(),u("p",ne,_(s.value["stock_opname_items.variant"]),1)):g("",!0)]),t("td",ue,[r(d(p),{type:"number",modelValue:o.qty_system,"onUpdate:modelValue":i=>o.qty_system=i,class:"w-full",onInput:i=>z(f)},null,8,["modelValue","onUpdate:modelValue","onInput"])]),t("td",ce,[r(d(p),{type:"number",modelValue:o.qty_physical,"onUpdate:modelValue":i=>o.qty_physical=i,class:"w-full",onInput:i=>z(f)},null,8,["modelValue","onUpdate:modelValue","onInput"])]),t("td",me,[r(d(p),{type:"number",modelValue:o.difference,"onUpdate:modelValue":i=>o.difference=i,class:"w-full",readonly:""},null,8,["modelValue","onUpdate:modelValue"])]),t("td",_e,[r(d(p),{modelValue:o.note,"onUpdate:modelValue":i=>o.note=i,class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])])]))),128))])])])]),t("div",pe,[r(d(D),{type:"button",class:"h-10",variant:"outline",onClick:e[7]||(e[7]=o=>d(I).visit("/stock-opnames"))},{default:y(()=>e[16]||(e[16]=[k(" Cancel ")])),_:1,__:[16]}),r(d(D),{type:"submit",class:"bg-indigo-600 text-white py-2 h-10 rounded-md hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500",disabled:m.value},{default:y(()=>[k(_(m.value?"Saving...":"Save"),1)]),_:1},8,["disabled"])])],32)])])]),_:1})],64))}});export{we as default};
