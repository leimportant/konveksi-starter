import{d as W,q as X,r as g,c as D,o as ee,f as d,g as l,p as u,u as n,Z as te,x,k as t,l as M,m as R,E as U,C as N,D as P,y as C,G as se,F as y,B as S,j as i,z as oe}from"./app-CtV84V4W.js";import{_ as re}from"./Input.vue_vue_type_script_setup_true_lang-CVaywoom.js";import{u as ae}from"./useToast-DdeCQgUM.js";import{_ as le}from"./AppLayout.vue_vue_type_script_setup_true_lang-C6CQiofg.js";import{u as ne}from"./useProductionStore-Dvm0AHoZ.js";import{P as de}from"./plus-BldbluL9.js";import{T as ie}from"./trash-2-MOz5FoHB.js";import{V as ue}from"./view-CfCoQ1Ho.js";import"./index-CfCb_mf1.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-oP5-zCHq.js";const ce={class:"px-3 py-4"},pe={class:"flex flex-col gap-3"},ge={class:"flex-1 flex flex-col min-w-0"},ye={class:"flex gap-3"},me={class:"flex-1 flex flex-col min-w-0"},xe={class:"flex-1 flex flex-col min-w-0"},fe={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2"},ve={class:"flex flex-1 gap-2 items-center"},be={key:0,class:"py-4 text-center text-sm text-gray-500"},_e={key:1,class:"space-y-2"},he={class:"overflow-x-auto rounded-md border border-gray-200 dark:border-gray-700 mt-2"},we={class:"min-w-full table-auto text-left text-sm text-gray-800 dark:text-gray-100"},ke={class:"bg-gray-200 dark:bg-gray-700 font-semibold"},De={colspan:"8",class:"px-3 py-2"},Pe={class:"whitespace-nowrap px-3 py-2 align-top"},Ce={class:"whitespace-nowrap px-3 py-2 align-top"},Se={key:0,class:"flex flex-col gap-1 rounded-lg border border-gray-200 bg-gray-50 p-1 text-[11px] text-gray-700"},$e={class:"font-semibold"},Te={key:0,class:"flex items-center justify-between rounded-md bg-white px-1.5 py-0.5 shadow-sm order-t border-gray-300 px-1.5 pt-0.5 mt-0.5 font-semibold text-[11px] text-gray-800"},Ve={key:1,class:"text-xs italic text-gray-400"},Fe={class:"truncate px-3 py-2 align-top"},Ie={class:"max-w-[80px] truncate px-3 py-2 align-top"},Ne={class:"px-3 py-2 align-top"},je={class:"flex justify-end gap-1 sm:gap-2"},Be={class:"bg-gray-50 font-semibold dark:bg-gray-800"},Oe={class:"px-3 py-2 text-right"},qe={class:"px-3 py-2"},ze={class:"mt-4 flex justify-end space-x-2"},Ee=["disabled"],Me=["onClick","disabled"],Re=["disabled"],We=W({__name:"Index",props:{activity_role:{},isCreate:{}},setup(A){const $=ae(),f=ne(),{productions:T,currentPage:c,lastPage:L,loading:v}=X(f),b=g(""),_=g(""),j=g(50),B=g("created_at"),O=g("desc"),m=A,Q=[{title:"Production",href:`/production/${m.activity_role}`}],V=D(()=>L.value||1),F=async o=>{var e,s;o<1||o>V.value||(await f.fetchProductions({page:o,per_page:j.value,sort_field:B.value,sort_order:O.value,activity_role_id:m.activity_role,search:h.value,date_from:(e=q.value.from)==null?void 0:e.toISOString(),date_to:(s=q.value.to)==null?void 0:s.toISOString()}),c.value=o)},K=()=>F(c.value+1),G=()=>F(c.value-1),h=g(""),q=g({from:null,to:null});function z(o){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(o)}const w=async(o=1)=>{var e,s;try{await f.fetchProductions({page:o||c.value,per_page:j.value,sort_field:B.value,sort_order:O.value,activity_role_id:m.activity_role,search:h.value,date_from:b.value,date_to:_.value})}catch(a){$.error(((s=(e=a==null?void 0:a.response)==null?void 0:e.data)==null?void 0:s.message)??"Failed to fetch productions")}},Y=D(()=>{const o={};return T.value.forEach(e=>{var a,r;const s=`${e.employee_name||"Unknown"} - ${((a=e.model)==null?void 0:a.description)||"No Model"}`;o[s]||(o[s]={employee_name:e.employee_name,model_description:(r=e.model)==null?void 0:r.description,items:[]}),o[s].items.push(e)}),o}),Z=D(()=>T.value.reduce((o,e)=>{var a;const s=((a=e.items)==null?void 0:a.reduce((r,k)=>r+(parseFloat(String(k.qty))||0),0))||0;return o+s},0)),H=D(()=>T.value.reduce((o,e)=>{const s=String(e.total_price).replace(/[^\d]/g,""),a=parseFloat(s)||0;return o+a},0));ee(()=>{const o=new Date,e=new Date;e.setDate(o.getDate()-6),b.value=e.toISOString().split("T")[0],_.value=o.toISOString().split("T")[0],w()});const J=async o=>{var e,s;if(confirm("Are you sure you want to delete this production?"))try{await f.deleteProduction(o),$.success("Production deleted successfully"),await w(1)}catch(a){$.error(((s=(e=a==null?void 0:a.response)==null?void 0:e.data)==null?void 0:s.message)??"Failed to delete production")}};return(o,e)=>(l(),d(y,null,[u(n(te),{title:"Production Management"}),u(le,{breadcrumbs:Q},{default:x(()=>[t("div",ce,[t("div",pe,[t("div",ge,[e[8]||(e[8]=t("div",{class:"flex items-center gap-3"},null,-1)),t("div",ye,[t("div",me,[e[6]||(e[6]=t("label",{class:"text-xs font-medium text-gray-600 mb-1"},"Start Date",-1)),M(t("input",{type:"date","onUpdate:modelValue":e[0]||(e[0]=s=>b.value=s),class:"w-full max-w-full rounded-md border border-gray-300 px-3 py-1.5 text-sm shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"},null,512),[[R,b.value]])]),t("div",xe,[e[7]||(e[7]=t("label",{class:"text-xs font-medium text-gray-600 mb-1"},"End Date",-1)),M(t("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=s=>_.value=s),class:"w-full max-w-full rounded-md border border-gray-300 px-3 py-1.5 text-sm shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"},null,512),[[R,_.value]])])])]),t("div",fe,[t("div",ve,[m.isCreate==="Y"?(l(),U(n(P),{key:0,onClick:e[2]||(e[2]=s=>o.$inertia.visit(`/production/${m.activity_role}/create`)),class:"flex items-center gap-2 rounded-md bg-indigo-600 h-10 px-3 py-1.5 text-sm font-medium text-white hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500 flex-shrink-0"},{default:x(()=>[u(n(de),{class:"h-4 w-4"}),e[9]||(e[9]=C(" Tambah Data "))]),_:1,__:[9]})):N("",!0),u(n(re),{modelValue:h.value,"onUpdate:modelValue":e[3]||(e[3]=s=>h.value=s),placeholder:"Search...",class:"flex-1 rounded-md border border-gray-300 px-3 h-10 py-1 text-sm shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 min-w-0",onKeyup:e[4]||(e[4]=se(s=>w(1),["enter"]))},null,8,["modelValue"]),u(n(P),{onClick:e[5]||(e[5]=s=>w(1)),class:"flex-shrink-0 rounded-md bg-green-600 px-3 h-10 py-1.5 text-sm font-medium text-white hover:bg-green-700 focus:ring-2 focus:ring-green-500"},{default:x(()=>e[10]||(e[10]=[C(" Cari ")])),_:1,__:[10]})])])]),n(v)?(l(),d("div",be,"Loading...")):(l(),d("div",_e,[t("div",he,[t("table",we,[e[16]||(e[16]=t("thead",{class:"bg-gray-100 text-xs font-semibold uppercase text-gray-600 dark:bg-gray-800 dark:text-gray-300"},[t("tr",null,[t("th",{class:"px-3 py-2"},"Tanggal"),t("th",{class:"px-3 py-2"},"Size/Qty"),t("th",{class:"px-3 py-2"},"Price/PCS"),t("th",{class:"px-3 py-2"},"Total"),t("th",{class:"px-3 py-2 text-right"},"Actions")])],-1)),t("tbody",null,[(l(!0),d(y,null,S(Y.value,(s,a)=>(l(),d(y,{key:a},[t("tr",ke,[t("td",De," ðŸ‘¤ "+i(s.employee_name||"-")+" â€” ðŸ§µ "+i(s.model_description||"-"),1)]),(l(!0),d(y,null,S(s.items,r=>{var k,E;return l(),d("tr",{key:r.id,class:"border-b border-gray-100 hover:bg-gray-50 dark:border-gray-700 dark:hover:bg-gray-800"},[t("td",Pe,[C(i(r.created_at?new Date(r.created_at).toLocaleDateString("id-ID"):"-")+" ",1),e[11]||(e[11]=t("br",null,null,-1)),C(" "+i(((k=r.activity_role)==null?void 0:k.name)||"-"),1)]),t("td",Ce,[(E=r.items)!=null&&E.length?(l(),d("div",Se,[(l(!0),d(y,null,S(r.items,(p,I)=>(l(),d("div",{key:I,class:"flex items-center justify-between rounded-md bg-white px-1.5 py-0.5 shadow-sm"},[t("span",null,i(p.size_id)+" - "+i(p.variant),1),t("span",$e,i(p.qty),1)]))),128)),r.items.length>1?(l(),d("div",Te,[e[12]||(e[12]=t("span",null,"Total",-1)),t("span",null,i(r.items.reduce((p,I)=>p+Number(I.qty||0),0)),1)])):N("",!0)])):(l(),d("span",Ve,"-"))]),t("td",Fe,i(z((r==null?void 0:r.price_per_pcs)||0)),1),t("td",Ie,i((r==null?void 0:r.total_price)||0),1),t("td",Ne,[t("div",je,[r.status===1||r.status===3?(l(),U(n(P),{key:0,variant:"ghost",size:"icon",class:"hover:bg-gray-100 dark:hover:bg-gray-700",onClick:p=>J(r.id)},{default:x(()=>[u(n(ie),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):N("",!0),u(n(P),{variant:"ghost",size:"icon",class:"hover:bg-gray-100 dark:hover:bg-gray-700",onClick:p=>o.$inertia.visit(`/production/${r.activity_role_id}/view/${r.id}`)},{default:x(()=>[u(n(ue),{class:"h-4 w-4"})]),_:2},1032,["onClick"])])])])}),128))],64))),128))]),t("tfoot",null,[t("tr",Be,[e[13]||(e[13]=t("td",{class:"px-3 py-2 text-right"},null,-1)),t("td",Oe,"Total Â :Â  "+i(Z.value),1),e[14]||(e[14]=t("td",{class:"px-3 py-2"},null,-1)),t("td",qe,i(z(H.value)),1),e[15]||(e[15]=t("td",null,null,-1))])])])]),t("div",ze,[t("button",{onClick:G,disabled:n(c)===1||n(v),class:"rounded border border-gray-300 px-3 py-1 text-gray-700 hover:bg-gray-100 disabled:cursor-not-allowed disabled:opacity-50"}," Previous ",8,Ee),(l(!0),d(y,null,S(V.value,s=>(l(),d("button",{key:s,onClick:a=>F(s),class:oe(["rounded border px-3 py-1 text-sm",s===n(c)?"border-blue-600 bg-blue-600 text-white":"border-gray-300 text-gray-700 hover:bg-gray-100"]),disabled:n(v)},i(s),11,Me))),128)),t("button",{onClick:K,disabled:n(c)===V.value||n(v),class:"rounded border border-gray-300 px-3 py-1 text-gray-700 hover:bg-gray-100 disabled:cursor-not-allowed disabled:opacity-50"}," Next ",8,Re)])]))])]),_:1})],64))}});export{We as default};
