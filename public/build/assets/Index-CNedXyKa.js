import{d as Z,q as H,r as N,aS as J,o as O,w as B,c as S,Q as W,f as d,g as r,p as l,u as s,Z as X,x as n,k as i,l as Y,G as ee,m as te,D as w,y as _,F as g,B as h,E as k,j as f,C as x,z as se}from"./app-Di3m0JM_.js";import{_ as ae,a as oe,b as E,c as j,d as le,e as A}from"./TableRow.vue_vue_type_script_setup_true_lang-Dj2AGBx6.js";import{u as re}from"./useToast-BFDnfwVN.js";import{_ as ne}from"./AppLayout.vue_vue_type_script_setup_true_lang-CdnJxeNL.js";import{u as ie}from"./useTransferStockStore-CTrnG2Ib.js";import{d as de}from"./debounce-BcZQbp_F.js";import{A as ue}from"./vue3-select-C0xVCSQz.js";import{S as ce}from"./search-Cr4GvZmi.js";import{E as me}from"./eye-CXcBmoRu.js";import{S as pe}from"./square-pen-BRNU7KdB.js";import{T as fe}from"./trash-2-DzJ_pmPH.js";import"./index-ZAa7-5mu.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CARa6xu5.js";const ge={class:"px-4 py-4"},ye={class:"mb-4 flex flex-col sm:flex-row items-center justify-between gap-3"},_e={class:"flex items-center gap-3 w-full sm:w-auto"},he={class:"overflow-x-auto"},xe={class:"text-xs text-gray-500"},ve={key:0,class:"mt-1 space-y-1"},be={class:"mb-1 font-semibold text-gray-800"},we={class:"ml-2 font-semibold flex-shrink-0"},ke={key:0,class:"order-t mt-0.5 flex items-center justify-between rounded-md border-gray-300 bg-white px-1.5 pt-0.5 font-semibold text-[10px] text-gray-800 shadow-sm"},Te={class:"ml-2 flex-shrink-0"},Ce={class:"flex justify-end space-x-1"},Pe={class:"mt-4 flex flex-wrap justify-end gap-1"},$e=["disabled"],Se=["onClick"],je=["disabled"],Qe=Z({__name:"Index",setup(Ae){const D=re(),m=ie(),{transfers:R,currentPage:p,lastPage:z}=H(m),v=N(50),y=N({label:"Pending",value:"Pending"}),q=de(()=>{m.fetchTransfers(1,v.value)},500),b=J({search:"",status:""}),V=()=>{var t;const o=typeof y.value=="string"?y.value:((t=y.value)==null?void 0:t.value)??"";m.filters.productName=b.search,m.filters.status=o,m.fetchTransfers(1,v.value)};O(()=>{m.fetchTransfers(p.value,v.value)}),B(()=>b.search,q),B(p,async o=>{await m.fetchTransfers(o,v.value)});const T=S(()=>z.value||1),F=S(()=>o=>{const t=new Map;return o.forEach(a=>{var u,c;const e=((u=a.product)==null?void 0:u.name)||"Unknown Product";t.has(e)||t.set(e,[]),(c=t.get(e))==null||c.push(a)}),Array.from(t.entries())}),M=S(()=>{const o=new Map;return R.value.forEach(t=>{var e;const a=t.created_at?new Date(t.created_at).toLocaleDateString("id-ID"):"-";o.has(a)||o.set(a,[]),(e=o.get(a))==null||e.push(t)}),Array.from(o.entries()).map(([t,a])=>({key:t,items:a}))}),C=async o=>{o<1||o>T.value||(p.value=o)},I=()=>C(p.value+1),L=()=>C(p.value-1),U=async o=>{var t,a;if(confirm("Are you sure you want to delete this transfer?"))try{await m.deleteTransfer(o),await m.fetchTransfers(),D.success("Transfer deleted successfully")}catch(e){D.error(((a=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:a.message)??"Failed to delete transfer")}},K=W().props.auth.user.location_id,G=[{title:"Transfer Stocks",href:"/transfer-stocks"}];return(o,t)=>(r(),d(g,null,[l(s(X),{title:"Transfer Stocks"}),l(ne,{breadcrumbs:G},{default:n(()=>[i("div",ge,[i("div",ye,[i("div",_e,[l(s(ue),{modelValue:y.value,"onUpdate:modelValue":t[0]||(t[0]=a=>y.value=a),options:[{label:"Semua",value:""},{label:"Pending",value:"Pending"},{label:"Approve",value:"Approved"},{label:"Reject",value:"Rejected"}],placeholder:"Pilih Status",class:"w-full text-sm sm:w-[150px]"},null,8,["modelValue"]),Y(i("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>b.search=a),type:"text",placeholder:"Cari data...",onKeyup:ee(V,["enter"]),class:"w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 sm:w-48"},null,544),[[te,b.search]]),l(s(w),{onClick:V,class:"flex items-center gap-1 bg-indigo-600 text-white hover:bg-indigo-700"},{default:n(()=>[l(s(ce),{class:"h-4 w-4"}),t[2]||(t[2]=_(" Cari "))]),_:1,__:[2]})]),i("div",he,[l(s(ae),null,{default:n(()=>[l(s(oe),null,{default:n(()=>[l(s(E),{class:"bg-gray-100"},{default:n(()=>[l(s(j),{class:"py-2 text-xs font-semibold text-gray-700"},{default:n(()=>t[3]||(t[3]=[_("Lokasi Tujuan")])),_:1,__:[3]}),l(s(j),{class:"py-2 text-xs font-semibold text-gray-700"},{default:n(()=>t[4]||(t[4]=[_("Detail")])),_:1,__:[4]}),l(s(j),{class:"py-2 text-xs font-semibold text-gray-700"},{default:n(()=>t[5]||(t[5]=[_("Actions")])),_:1,__:[5]})]),_:1})]),_:1}),l(s(le),null,{default:n(()=>[(r(!0),d(g,null,h(M.value,a=>(r(),d(g,{key:a.key},[(r(!0),d(g,null,h(a.items,e=>(r(),k(s(E),{key:e.id,class:"border-b hover:bg-gray-50"},{default:n(()=>[l(s(A),{class:"whitespace-nowrap py-2 text-sm align-top"},{default:n(()=>{var u;return[_(f(((u=e.location_destination)==null?void 0:u.name)||"-")+" ",1),i("div",xe,[i("span",null,f(a.key),1)])]}),_:2},1024),l(s(A),{class:"py-2 text-sm align-top"},{default:n(()=>{var u;return[(u=e.transfer_detail)!=null&&u.length?(r(),d("div",ve,[(r(!0),d(g,null,h(F.value(e.transfer_detail),([c,P])=>(r(),d("div",{key:c,class:"flex flex-col gap-0.5 rounded-lg border border-gray-200 bg-gray-50 p-1 text-[10px] text-gray-700"},[i("div",be,f(c),1),(r(!0),d(g,null,h(P,($,Q)=>(r(),d("div",{key:Q,class:"flex items-center justify-between rounded-md bg-white px-1.5 py-0.5 shadow-sm"},[i("span",we,f($.variant)+" "+f($.qty)+" "+f($.uom_id),1)]))),128))]))),128)),e.transfer_detail.length>1?(r(),d("div",ke,[t[6]||(t[6]=i("span",null,"Total",-1)),i("span",Te,f(e.transfer_detail.reduce((c,P)=>c+Number(P.qty||0),0)),1)])):x("",!0)])):x("",!0)]}),_:2},1024),l(s(A),{class:"w-1/12 py-2 text-right"},{default:n(()=>{var u;return[i("div",Ce,[e!=null&&e.id&&(e.status==="Accepted"||e.status==="Rejected")||((u=e.location_destination)==null?void 0:u.id)===s(K)?(r(),k(s(w),{key:0,variant:"ghost",size:"icon",class:"h-7 w-7 hover:bg-gray-100",onClick:c=>o.$inertia.visit(`/transfer-stock/${e.id}/view`)},{default:n(()=>[l(s(me),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):x("",!0),e!=null&&e.id&&(e.status==="Pending"||e.status==="Rejected")?(r(),k(s(w),{key:1,variant:"ghost",size:"icon",class:"h-7 hidden w-7 hover:bg-gray-100",onClick:c=>o.$inertia.visit(`/transfer-stock/${e.id}/edit`)},{default:n(()=>[l(s(pe),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):x("",!0),e!=null&&e.id&&(e.status==="Pending"||e.status==="Rejected")?(r(),k(s(w),{key:2,variant:"ghost",size:"icon",class:"h-7 hidden w-7 hover:bg-gray-100",onClick:c=>U(e.id)},{default:n(()=>[l(s(fe),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):x("",!0)])]}),_:2},1024)]),_:2},1024))),128))],64))),128))]),_:1})]),_:1})]),i("div",Pe,[i("button",{onClick:L,disabled:s(p)===1,class:"rounded border border-gray-300 px-2 py-1 text-xs text-gray-700 hover:bg-gray-100 disabled:opacity-50"}," Previous ",8,$e),(r(!0),d(g,null,h(T.value,a=>(r(),d("button",{key:a,onClick:e=>C(a),class:se(["rounded border px-2 py-1 text-xs",a===s(p)?"border-blue-600 bg-blue-600 text-white":"border-gray-300 text-gray-700 hover:bg-gray-100"])},f(a),11,Se))),128)),i("button",{onClick:I,disabled:s(p)===T.value,class:"rounded border border-gray-300 px-2 py-1 text-xs text-gray-700 hover:bg-gray-100 disabled:opacity-50"}," Next ",8,je)])])])]),_:1})],64))}});export{Qe as default};
