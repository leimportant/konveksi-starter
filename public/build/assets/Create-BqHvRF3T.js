import{d as B,r as I,T as A,o as F,f as m,g as n,p as r,u as e,Z as j,x as o,k as u,K as E,C as _,y as p,j as c,D as b,F as w,B as P,E as R,l as z,O as K,b as U,P as L}from"./app-DofvhDou.js";import{_ as G}from"./AppLayout.vue_vue_type_script_setup_true_lang-B7PCsMYI.js";import{u as Q}from"./useToast-CGKEkBVM.js";import{u as Z}from"./usePurchaseOrder-CoHtxCdK.js";import{A as H}from"./vue3-select-CKabIWLN.js";import{_ as x}from"./Input.vue_vue_type_script_setup_true_lang-DfLgyDBm.js";import{_ as v}from"./Label.vue_vue_type_script_setup_true_lang-C5QfGJyK.js";import{_ as J}from"./Textarea.vue_vue_type_script_setup_true_lang-MIJGk6oK.js";import{_ as W,a as X,b as C,c as f,d as Y,e as y}from"./TableRow.vue_vue_type_script_setup_true_lang-DBrIOr1w.js";import{P as ee}from"./plus-gGs2-okm.js";import{T as te}from"./trash-2-D5F_DDyA.js";import"./index-CbCD4o6j.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-Ch3IMM2-.js";const se={class:"py-6 px-4 sm:px-6 lg:px-8"},re={class:"grid grid-cols-1 sm:grid-cols-2 gap-6"},oe={key:0,class:"text-red-500 text-xs mt-1"},ae={key:0,class:"text-red-500 text-xs mt-1"},le={class:"sm:col-span-2"},de={key:0,class:"text-red-500 text-xs mt-1"},ie={class:"sm:col-span-2"},ue={key:0,class:"text-red-500 text-xs mt-1"},ne={class:"flex justify-between items-center mb-2"},pe={key:0,class:"text-red-500 text-xs mt-1"},me={key:0,class:"text-red-500 text-xs mt-1"},ce=["onUpdate:modelValue"],_e=["value"],fe={key:0,class:"text-red-500 text-xs mt-1"},ye={key:0,class:"text-red-500 text-xs mt-1"},xe={class:"flex justify-end gap-2 mt-4"},De=B({__name:"Create",setup(ge){const g=Q(),{products:S,createPurchaseOrder:O}=Z(),$=I([]),s=A({nota_number:"",purchase_date:new Date().toISOString().slice(0,10),supplier:"",notes:"",items:[]}),V=I([]),D=()=>{s.items.push({product_id:0,qty:1,uom_id:"",price:0,total:0})},N=a=>{s.items.splice(a,1)},T=a=>{const t=S.find(l=>l.id===s.items[a].product_id);t&&(s.items[a].price=t.price,h(a))},h=a=>{const t=s.items[a];t.total=t.qty*t.price},q=async()=>{try{const[a]=await Promise.all([U.get("/api/uoms")]);$.value=a.data.data}catch(a){g.error("Gagal mengambil data dropdown"),console.error(a)}},M=async a=>{if(a.length<2){V.value=[];return}try{const t=await U.get("/api/products",{params:{search:a}});V.value=t.data.data}catch(t){console.error("Search error:",t),g.error("Failed to search products")}};F(()=>{q()});const k=async()=>{if(!s.processing){s.processing=!0;try{const a={...s,items:s.items.map(t=>{var l;return{...t,product_id:((l=t.product_id)==null?void 0:l.id)??t.product_id,uom_id:t.uom_id||""}})};await O(a),g.success("Purchase Order has been created successfully."),s.reset(),L.visit("/purchase-order"),s.items=[]}catch(a){console.error("Error creating purchase order:",a),g.error("Failed to create purchase order.")}finally{s.processing=!1}}};return(a,t)=>(n(),m(w,null,[r(e(j),{title:"Create Purchase Order"}),r(G,{title:"Create Purchase Order"},{header:o(()=>t[4]||(t[4]=[u("h2",{class:"font-semibold text-lg sm:text-xl text-gray-800 leading-tight"}," Create Purchase Order ",-1)])),default:o(()=>[u("div",se,[u("form",{onSubmit:E(k,["prevent"]),class:"space-y-6"},[u("div",re,[u("div",null,[r(e(v),{for:"nota_number"},{default:o(()=>t[5]||(t[5]=[p("Nota/Kwitansi No.")])),_:1,__:[5]}),r(e(x),{id:"nota_number",type:"text",modelValue:e(s).nota_number,"onUpdate:modelValue":t[0]||(t[0]=l=>e(s).nota_number=l)},null,8,["modelValue"]),e(s).errors.nota_number?(n(),m("div",oe,c(e(s).errors.nota_number),1)):_("",!0)]),u("div",null,[r(e(v),{for:"purchase_date"},{default:o(()=>t[6]||(t[6]=[p("Tanggal")])),_:1,__:[6]}),r(e(x),{id:"purchase_date",type:"date",modelValue:e(s).purchase_date,"onUpdate:modelValue":t[1]||(t[1]=l=>e(s).purchase_date=l)},null,8,["modelValue"]),e(s).errors.purchase_date?(n(),m("div",ae,c(e(s).errors.purchase_date),1)):_("",!0)]),u("div",le,[r(e(v),{for:"supplier"},{default:o(()=>t[7]||(t[7]=[p("Supplier")])),_:1,__:[7]}),r(e(x),{id:"supplier",type:"text",modelValue:e(s).supplier,"onUpdate:modelValue":t[2]||(t[2]=l=>e(s).supplier=l)},null,8,["modelValue"]),e(s).errors.supplier?(n(),m("div",de,c(e(s).errors.supplier),1)):_("",!0)]),u("div",ie,[r(e(v),{for:"notes"},{default:o(()=>t[8]||(t[8]=[p("Notes")])),_:1,__:[8]}),r(e(J),{id:"notes",rows:"2",modelValue:e(s).notes,"onUpdate:modelValue":t[3]||(t[3]=l=>e(s).notes=l)},null,8,["modelValue"]),e(s).errors.notes?(n(),m("div",ue,c(e(s).errors.notes),1)):_("",!0)])]),u("div",null,[u("div",ne,[t[10]||(t[10]=u("h3",{class:"text-base sm:text-lg font-semibold text-gray-900"},"Items",-1)),r(e(b),{type:"button",onClick:D,size:"sm",class:"bg-blue-500 hover:bg-blue-600 text-white"},{default:o(()=>[r(e(ee),{class:"w-4 h-4 mr-1"}),t[9]||(t[9]=p(" Add Item "))]),_:1,__:[9]})]),r(e(W),{class:"min-w-full text-sm sm:text-base table-auto"},{default:o(()=>[r(e(X),{class:"bg-gray-50 text-gray-700"},{default:o(()=>[r(e(C),null,{default:o(()=>[r(e(f),{class:"px-3 py-2 text-left font-semibold"},{default:o(()=>t[11]||(t[11]=[p("Product")])),_:1,__:[11]}),r(e(f),{class:"px-3 py-2 text-left font-semibold"},{default:o(()=>t[12]||(t[12]=[p("Qty")])),_:1,__:[12]}),r(e(f),{class:"px-3 py-2 text-left font-semibold"},{default:o(()=>t[13]||(t[13]=[p("UOM")])),_:1,__:[13]}),r(e(f),{class:"px-3 py-2 text-left font-semibold"},{default:o(()=>t[14]||(t[14]=[p("Price")])),_:1,__:[14]}),r(e(f),{class:"px-3 py-2 text-left font-semibold"},{default:o(()=>t[15]||(t[15]=[p("Total")])),_:1,__:[15]}),r(e(f),{class:"px-3 py-2 text-right font-semibold"},{default:o(()=>t[16]||(t[16]=[u("span",{class:"sr-only"},"Actions",-1)])),_:1,__:[16]})]),_:1})]),_:1}),r(e(Y),{class:"bg-white divide-y divide-gray-100"},{default:o(()=>[(n(!0),m(w,null,P(e(s).items,(l,d)=>(n(),R(e(C),{key:d,class:"hover:bg-gray-50"},{default:o(()=>[r(e(y),{class:"px-3 py-2 min-w-[180px] align-top"},{default:o(()=>[r(e(H),{modelValue:l.product_id,"onUpdate:modelValue":i=>l.product_id=i,options:V.value,label:"name",value:"id",onSearch:M,placeholder:"Select product",onInput:i=>T(d)},null,8,["modelValue","onUpdate:modelValue","options","onInput"]),e(s).errors[`items.${d}.product_id`]?(n(),m("div",pe,c(e(s).errors[`items.${d}.product_id`]),1)):_("",!0)]),_:2},1024),r(e(y),{class:"px-3 py-2 w-24 align-top"},{default:o(()=>[r(e(x),{type:"number",modelValue:l.qty,"onUpdate:modelValue":i=>l.qty=i,modelModifiers:{number:!0},onInput:i=>h(d)},null,8,["modelValue","onUpdate:modelValue","onInput"]),e(s).errors[`items.${d}.qty`]?(n(),m("div",me,c(e(s).errors[`items.${d}.qty`]),1)):_("",!0)]),_:2},1024),r(e(y),{class:"px-3 py-2 w-28 align-top"},{default:o(()=>[z(u("select",{"onUpdate:modelValue":i=>e(s).items[d].uom_id=i,class:"w-full rounded-md border text-xs border-input px-3 py-2",required:""},[t[17]||(t[17]=u("option",{value:""},"Select UOM",-1)),(n(!0),m(w,null,P($.value,i=>(n(),m("option",{key:i.id,value:i.id},c(i.name),9,_e))),128))],8,ce),[[K,e(s).items[d].uom_id]]),e(s).errors[`items.${d}.uom_id`]?(n(),m("div",fe,c(e(s).errors[`items.${d}.uom_id`]),1)):_("",!0)]),_:2},1024),r(e(y),{class:"px-3 py-2 w-32 align-top"},{default:o(()=>[r(e(x),{type:"number",modelValue:l.price,"onUpdate:modelValue":i=>l.price=i,modelModifiers:{number:!0},onInput:i=>h(d)},null,8,["modelValue","onUpdate:modelValue","onInput"]),e(s).errors[`items.${d}.price`]?(n(),m("div",ye,c(e(s).errors[`items.${d}.price`]),1)):_("",!0)]),_:2},1024),r(e(y),{class:"px-3 py-2 w-32 align-middle font-medium text-gray-800"},{default:o(()=>[p(c(l.total.toLocaleString("id-ID",{style:"currency",currency:"IDR"})),1)]),_:2},1024),r(e(y),{class:"px-3 py-2 w-12 text-right align-middle"},{default:o(()=>[r(e(b),{type:"button",variant:"destructive",size:"icon",onClick:i=>N(d),class:"hover:bg-red-600"},{default:o(()=>[r(e(te),{class:"w-4 h-4"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),u("div",xe,[r(e(b),{onClick:k,class:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600",disabled:e(s).processing},{default:o(()=>t[18]||(t[18]=[p("Save")])),_:1,__:[18]},8,["disabled"]),r(e(b),{href:a.route("purchase-order.index"),type:"button",class:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600"},{default:o(()=>t[19]||(t[19]=[p(" Cancel ")])),_:1,__:[19]},8,["href"])])],32)])]),_:1})],64))}});export{De as default};
