import{d as $,q as j,r as y,T as q,o as H,w as W,e as K,f as n,g as u,p as b,u as i,Z as D,x as L,k as a,C as I,j as f,F as S,B as V,l as T,y as Q,P as R,m as Y,V as C,b as Z}from"./app-BUIdBR0K.js";import{u as J}from"./useToast-NpPWbmhv.js";import{_ as O}from"./AppLayout.vue_vue_type_script_setup_true_lang-3u43giJ3.js";import{u as X}from"./useModelStore-wFc01wMj.js";import{u as ee}from"./useProductionStore-fTthhAV1.js";import{A as G}from"./vue3-select-H6UUNqe_.js";import"./index-CjYf141v.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-C-o5URw4.js";const te={class:"space-y-6 p-6"},ae={class:"text-2xl font-bold"},oe={key:0,class:"mt-4 p-4 bg-yellow-50 border border-yellow-300 rounded text-sm text-yellow-700"},le={key:1,class:"mt-4 p-4 bg-blue-50 border border-blue-300 rounded text-sm text-blue-700"},se={class:"flex flex-col gap-2"},ie=["value"],re={key:2},de={class:"w-full table-auto border"},ne={class:"border px-3 py-2 text-sm"},ue={class:"border px-3 py-2 text-sm"},me={class:"border px-3 py-2 text-sm"},ce=["onUpdate:modelValue"],pe={class:"flex gap-2"},ye=["disabled"],Ie=$({__name:"Create",props:{activity_role:{}},setup(M){const k=J(),v=X(),{models:P,employees:z}=j(v),o=M,x=y(null),c=y(0),g=y([]),_=y([]),h=y([]),r=q({model_id:null,activity_role_id:Number(o.activity_role),employee_id:null,items:[],remark:""}),w=async(l="SEWING")=>{var t,s;try{const e=await Z.get("/api/activity-roles",{params:{group_menu:l}});_.value=e.data.data}catch(e){k.error(((s=(t=e.response)==null?void 0:t.data)==null?void 0:s.message)||"Gagal mengambil data tugas finishing")}};let N;const E=(l,t)=>{l.length&&(t(!0),clearTimeout(N),N=window.setTimeout(async()=>{await v.fetchModels({page:1,is_close:"N",search:l}),t(!1)},500))};H(async()=>{o.activity_role==="FINISHING"&&await w("FINISHING"),o.activity_role==="SEWING"&&await w("SEWING"),await v.fetchActivityEmployee(String(o.activity_role))}),W(x,async l=>{if(l)try{const s=(await v.fetchModelById(l)).data;r.model_id=s.id,g.value=s.sizes,r.items=s.sizes.map(e=>({size_id:String(e.size_id),size_name:e.size_name,qty:0,variant:e.variant}))}catch(t){console.error("Failed to fetch model sizes",t)}});const U=[{title:"Produksi",href:`/production/${o.activity_role}`}],A=ee(),B=async()=>{var l,t,s;try{let e=1;o.activity_role=="CUTTING"&&(e=1),(o.activity_role=="FINISHING"||o.activity_role=="SEWING")&&(e=h.value.map(d=>{var m;return(m=_.value.find(F=>F.id===d))==null?void 0:m.id}).filter(d=>d!==null)),o.activity_role=="LUBANG_KANCING"&&(e=4);const p=typeof c.value=="number"?c.value:((l=c.value)==null?void 0:l.id)??0;await A.createProduction({model_id:r.model_id,activity_role_id:e,activity_role:String(o.activity_role),employee_id:p,remark:r.remark||"",items:r.items.filter(d=>d.qty>0)}),k.success("Produksi berhasil dibuat"),C.visit(`/production/${o.activity_role}`)}catch(e){k.error(((s=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:s.message)??"Gagal membuat produksi")}};return(l,t)=>{const s=K("Input");return u(),n(S,null,[b(i(D),{title:"Production Management"}),b(O,{breadcrumbs:U},{default:L(()=>[a("div",te,[a("h1",ae,f(o.activity_role.toString().replace(/_/g," ")??"Buat Produksi"),1),a("div",null,[t[5]||(t[5]=a("label",{class:"mb-1 block font-medium"},"Pilih Desain Kerjaan",-1)),b(i(G),{id:"model.id",modelValue:x.value,"onUpdate:modelValue":t[0]||(t[0]=e=>x.value=e),reduce:e=>e.id,options:i(P),label:"description",filterable:!1,onSearch:E,placeholder:"Select Model",class:"w-full"},null,8,["modelValue","reduce","options"])]),a("div",null,[t[6]||(t[6]=a("label",{class:"mb-1 block font-medium"},"Karyawan",-1)),b(i(G),{id:"model.id",modelValue:c.value,"onUpdate:modelValue":t[1]||(t[1]=e=>c.value=e),options:i(z),label:"name",placeholder:"Select Employee",class:"w-full"},null,8,["modelValue","options"])]),o.activity_role==="QUALITY_CHECK"?(u(),n("div",oe,[t[7]||(t[7]=a("p",null,"Periksa kualitas produk dengan teliti sebelum melanjutkan ke proses selanjutnya. Pastikan tidak ada cacat atau kekurangan.",-1)),b(s,{type:"text",modelValue:i(r).remark,"onUpdate:modelValue":t[2]||(t[2]=e=>i(r).remark=e),placeholder:"Tambahkan catatan atau remark jika diperlukan",class:"mt-2 w-full rounded border p-2"},null,8,["modelValue"])])):I("",!0),_.value.length&&o.activity_role==="FINISHING"||o.activity_role==="SEWING"?(u(),n("div",le,[t[8]||(t[8]=a("p",{class:"font-semibold mb-2"},"Pilih pekerjaan yang dilakukan:",-1)),a("div",se,[(u(!0),n(S,null,V(_.value,e=>(u(),n("label",{key:e.id,class:"flex items-center gap-2"},[T(a("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=p=>h.value=p),value:e.id},null,8,ie),[[R,h.value]]),Q(" "+f(e.name),1)]))),128))])])):I("",!0),g.value.length>0?(u(),n("div",re,[t[10]||(t[10]=a("h2",{class:"mb-2 font-semibold"},"Model Ukuran",-1)),a("table",de,[t[9]||(t[9]=a("thead",null,[a("tr",{class:"bg-gray-100"},[a("th",{class:"border px-3 text-sm py-2 text-left"},"Size"),a("th",{class:"border px-3 text-sm py-2 text-left"},"Variant"),a("th",{class:"border px-3 text-sm py-2 text-left"},"Qty")])],-1)),a("tbody",null,[(u(!0),n(S,null,V(i(r).items,(e,p)=>{var d;return u(),n("tr",{key:`size-${p}-${e.size_id}`},[a("td",ne,f(((d=g.value.find(m=>m.size_id===e.size_id))==null?void 0:d.size_name)||e.size_id),1),a("td",ue,f(e.variant),1),a("td",me,[T(a("input",{type:"number",min:"0",class:"w-full rounded border px-2 py-1","onUpdate:modelValue":m=>e.qty=m},null,8,ce),[[Y,e.qty,void 0,{number:!0}]])])])}),128))])])])):I("",!0),a("div",pe,[a("button",{onClick:B,class:"rounded text-sm bg-blue-600 px-4 py-2 text-white hover:bg-blue-700",disabled:i(r).processing},"Simpan",8,ye),a("button",{onClick:t[4]||(t[4]=e=>i(C).visit(`/production/${o.activity_role}`)),type:"button",class:"rounded text-sm bg-gray-500 px-4 py-2 text-white hover:bg-gray-600"}," Cancel ")])])]),_:1})],64)}}});export{Ie as default};
