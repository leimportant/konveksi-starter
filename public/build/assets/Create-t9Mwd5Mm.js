import{d as N,q as h,r as G,Q as T,T as $,w as A,o as I,f as i,g as l,p as m,u as r,Z as Y,x as f,k as e,R as E,C as F,l as w,F as _,B as b,j as a,W as q,D as k,y as S}from"./app-DwD40pha.js";import{_ as O}from"./AppLayout.vue_vue_type_script_setup_true_lang-Dqw9mkBO.js";import{_ as v}from"./Input.vue_vue_type_script_setup_true_lang-BTbx_jFa.js";import{u as Q}from"./useToast-kXqWmEvq.js";import{u as j}from"./useGoodReceiveStore-BGT5JXaj.js";import{u as K}from"./useModelStore-CwFKjzSu.js";import{u as L}from"./useUomStore-eA2tNX3a.js";import{u as W}from"./useProductStore-i7hBYgUz.js";import"./index-CCvz1xt-.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-B0XSFyw3.js";const Z={class:"px-2 py-4 sm:px-4 sm:py-6"},z={class:"mx-auto"},H={class:"bg-white rounded-lg shadow p-4 sm:p-6"},J={class:"grid grid-cols-1 gap-4 sm:grid-cols-2 sm:gap-6"},X=["value"],ee={key:0,class:"mt-4 sm:mt-6"},te={class:"overflow-x-auto"},oe={class:"min-w-full inline-block align-middle"},se={class:"border rounded-lg overflow-hidden sm:border-0 sm:rounded-none"},de={class:"min-w-full divide-y divide-gray-200"},re={class:"bg-white divide-y divide-gray-200"},ae={class:"px-2 py-1 sm:px-3 sm:py-2 whitespace-nowrap block sm:table-cell"},ie={class:"sm:hidden"},le={class:"font-semibold"},ne={class:"text-sm mt-1"},me={class:"hidden sm:block"},ce={class:"px-3 py-2 whitespace-nowrap hidden sm:table-cell"},ue={class:"px-3 py-2 whitespace-nowrap hidden sm:table-cell"},pe={class:"px-3 py-2 whitespace-nowrap hidden sm:table-cell"},_e={class:"px-3 py-2 whitespace-nowrap sm:table-cell"},ye={class:"px-3 py-2 whitespace-nowrap sm:table-cell"},fe=["onUpdate:modelValue"],be=["value"],ve={class:"flex justify-end border-t pt-4 gap-2 text-sm"},Ce=N({__name:"Create",setup(ge){var x;const c=Q(),V=j(),y=K(),g=L(),M=W(),{models:R}=h(y),{items:U}=h(g),B=G([]),C=T().props.auth,d=$({date:new Date().toISOString().split("T")[0],model_id:0,description:"",recipent:((x=C.user)==null?void 0:x.name)||"",items:[]});A(()=>d.model_id,async n=>{var o;if(n)try{const p=((o=(await y.fetchModelById(n)).data)==null?void 0:o.model_material)||[];B.value=p,d.items=await Promise.all(p.map(async s=>{try{const u=await M.fetchProductById(s.product_id);return{model_material_id:s.product_id,model_material_desc:(u==null?void 0:u.name)||s.item.toString(),model_material_item:s.item,qty:s.qty,qty_convert:s.qty,uom_base:s.uom_id,uom_convert:"YARD"}}catch(u){return console.error("Error fetching product:",u),{model_material_id:s.product_id,model_material_desc:s.item.toString(),model_material_item:s.item,qty:s.qty,qty_convert:s.qty,uom_base:s.uom_id,uom_convert:"YARD"}}}))}catch(t){console.error("Error fetching model materials:",t)}});const D=[{title:"Good Receive",href:"/good-receive"},{title:"Create",href:"/good-receive/create"}];I(async()=>{await Promise.all([y.fetchModels(1,"N"),g.fetchUoms()])});const P=async()=>{var n,o;if(!d.model_id)return c.error("Model is required");if(!d.recipent)return c.error("Penerima is required");if(d.items.length===0)return c.error("Minimal 1 material item");try{await V.createGoodReceive({date:d.date,model_id:Number(d.model_id),description:d.description,recipent:d.recipent,items:d.items.map(t=>({model_material_id:t.model_material_id,model_material_desc:t.model_material_desc,model_material_item:t.model_material_item,qty:t.qty,qty_convert:t.qty_convert,qty_base:t.qty,uom_base:t.uom_base,uom_convert:t.uom_convert}))}),c.success("Good Receive created successfully"),window.location.href="/good-receive"}catch(t){c.error(((o=(n=t==null?void 0:t.response)==null?void 0:n.data)==null?void 0:o.message)??"Failed to create Good Receive")}};return(n,o)=>(l(),i(_,null,[m(r(Y),{title:"Buat Penerimaan Barang / Kain"}),m(O,{breadcrumbs:D},{default:f(()=>[e("div",Z,[e("div",z,[e("div",H,[o[13]||(o[13]=e("h2",{class:"sm:text-lg font-semibold mb-4 sm:mb-6"},"Penerimaan Kain",-1)),e("form",{onSubmit:E(P,["prevent"]),class:"space-y-4 sm:space-y-6"},[e("div",J,[e("div",null,[o[4]||(o[4]=e("label",{class:"block text-sm font-medium mb-1"},"Date",-1)),m(r(v),{type:"date",modelValue:r(d).date,"onUpdate:modelValue":o[0]||(o[0]=t=>r(d).date=t),required:""},null,8,["modelValue"])]),e("div",null,[o[6]||(o[6]=e("label",{class:"block text-sm font-medium mb-1"},"Model",-1)),w(e("select",{"onUpdate:modelValue":o[1]||(o[1]=t=>r(d).model_id=t),class:"w-full rounded-md border border-input px-3 py-2",required:""},[o[5]||(o[5]=e("option",{value:"0"},"Select Model",-1)),(l(!0),i(_,null,b(r(R),t=>(l(),i("option",{key:t.id,value:t.id},a(t.description),9,X))),128))],512),[[q,r(d).model_id]])])]),e("div",null,[o[7]||(o[7]=e("label",{class:"block text-sm font-medium mb-1"},"Penerima",-1)),m(r(v),{modelValue:r(d).recipent,"onUpdate:modelValue":o[2]||(o[2]=t=>r(d).recipent=t),required:""},null,8,["modelValue"])]),r(d).items.length>0?(l(),i("div",ee,[o[10]||(o[10]=e("h3",{class:"text-sm sm:text-md font-medium mb-2"},"Material Items",-1)),e("div",te,[e("div",oe,[e("div",se,[e("table",de,[o[9]||(o[9]=e("thead",{class:"bg-gray-50 hidden sm:table-header-group"},[e("tr",null,[e("th",{class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Material"),e("th",{class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Item"),e("th",{class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Qty"),e("th",{class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"UOM"),e("th",{class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Qty Conv"),e("th",{class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"UOM Conv")])],-1)),e("tbody",re,[(l(!0),i(_,null,b(r(d).items,(t,p)=>(l(),i("tr",{key:p,class:"block sm:table-row mb-2 sm:mb-0 border-b sm:border-b-0"},[e("td",ae,[e("div",ie,[e("div",le,a(t.model_material_id)+" - "+a(t.model_material_desc),1),e("div",ne,a(t.qty)+" "+a(t.uom_base),1)]),e("div",me,a(t.model_material_id)+" - "+a(t.model_material_desc),1)]),e("td",ce,a(t.model_material_item),1),e("td",ue,a(t.qty),1),e("td",pe,a(t.uom_base),1),e("td",_e,[m(r(v),{type:"number",modelValue:t.qty_convert,"onUpdate:modelValue":s=>t.qty_convert=s,step:"0.01",min:"0",class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),e("td",ye,[w(e("select",{"onUpdate:modelValue":s=>t.uom_convert=s,class:"w-full rounded-md border border-input px-2 py-1 text-sm"},[o[8]||(o[8]=e("option",{value:"YARD"},"YARD",-1)),(l(!0),i(_,null,b(r(U),s=>(l(),i("option",{key:s.id,value:s.name},a(s.name),9,be))),128))],8,fe),[[q,t.uom_convert]])])]))),128))])])])])])])):F("",!0),e("div",ve,[m(r(k),{type:"button",variant:"secondary",onClick:o[3]||(o[3]=t=>n.$inertia.visit("/good-receive"))},{default:f(()=>o[11]||(o[11]=[S(" Batal ")])),_:1,__:[11]}),m(r(k),{type:"submit",loading:r(d).processing,class:"bg-indigo-600 text-white hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:f(()=>o[12]||(o[12]=[S(" Simpan ")])),_:1,__:[12]},8,["loading"])])],32)])])])]),_:1})],64))}});export{Ce as default};
