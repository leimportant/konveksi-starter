import{d as E,q as Q,r as g,c as D,o as G,f as i,g as r,p as d,u as o,Z as U,x as _,k as e,D as m,y as Z,G as H,F as k,B as V,j as l,E as N,C as B,z as J}from"./app-DpWrON_T.js";import{_ as W}from"./Input.vue_vue_type_script_setup_true_lang-BUyj-wrB.js";import{u as X}from"./useToast-BmMZDI9v.js";import{_ as Y}from"./AppLayout.vue_vue_type_script_setup_true_lang-D7oWGhGO.js";import{u as tt}from"./useProductionStore-CbbwVF8_.js";import{P as et}from"./plus-B7dXvs2L.js";import{S as at}from"./square-pen-RTK_KiGE.js";import{T as st}from"./trash-2-sVY2ftDk.js";import{V as ot}from"./view--AaFQgho.js";import"./index-EOWVmPkW.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-ChaEM8tw.js";const rt={class:"px-3 py-4"},nt={class:"mb-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3"},lt={class:"flex flex-1 gap-2"},it={key:0,class:"py-4 text-center text-sm text-gray-500"},dt={key:1,class:"space-y-2"},ct={class:"overflow-x-auto rounded-md border border-gray-200 dark:border-gray-700"},ut={class:"min-w-full table-auto text-sm text-left text-gray-800 dark:text-gray-100"},pt={class:"px-3 py-2 whitespace-nowrap align-top"},yt={class:"px-3 py-2 whitespace-nowrap align-top"},gt={class:"px-3 py-2 max-w-[160px] whitespace-normal align-top"},_t={class:"px-3 py-2 truncate align-top"},vt={class:"px-3 py-2 whitespace-nowrap"},ht={key:0},xt={key:1},ft={class:"px-3 py-2 max-w-[160px] truncate align-top"},bt={class:"px-3 py-2 max-w-[160px] truncate align-top"},mt={class:"px-3 py-2 text-right align-top"},kt={class:"flex justify-end gap-1 sm:gap-2"},wt={class:"bg-gray-50 dark:bg-gray-800 font-semibold"},Pt={class:"px-3 py-2"},St={class:"flex justify-end mt-4 space-x-2"},$t=["disabled"],Ct=["onClick","disabled"],Tt=["disabled"],At=E({__name:"Index",props:{activity_role:{}},setup(O){const w=X(),v=tt(),{productions:P,currentPage:c,lastPage:j,loading:h}=Q(v),F=g(10),I=g("created_at"),z=g("desc"),x=O,R=[{title:"Production",href:`/production/${x.activity_role}`}],S=D(()=>j.value||1),$=async s=>{var a,t;s<1||s>S.value||(await v.fetchProductions({page:s,per_page:F.value,sort_field:I.value,sort_order:z.value,activity_role_id:x.activity_role,search:f.value,date_from:(a=b.value.from)==null?void 0:a.toISOString(),date_to:(t=b.value.to)==null?void 0:t.toISOString()}),c.value=s)},q=()=>$(c.value+1),A=()=>$(c.value-1),f=g(""),b=g({from:null,to:null});function C(s){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(s)}const T=async(s=1)=>{var a,t,n,y;try{await v.fetchProductions({page:s||c.value,per_page:F.value,sort_field:I.value,sort_order:z.value,activity_role_id:x.activity_role,search:f.value,date_from:(a=b.value.from)==null?void 0:a.toISOString(),date_to:(t=b.value.to)==null?void 0:t.toISOString()})}catch(p){w.error(((y=(n=p==null?void 0:p.response)==null?void 0:n.data)==null?void 0:y.message)??"Failed to fetch productions")}},K=D(()=>P.value.reduce((s,a)=>{const t=String(a.total_price).replace(/[^\d]/g,""),n=parseFloat(t)||0;return s+n},0)),L=D(()=>P.value.reduce((s,a)=>{const t=parseFloat(String(a.price_per_pcs).replace(/[^\d.-]/g,""))||0;return s+t},0));G(T);const M=async s=>{var a,t;if(confirm("Are you sure you want to delete this production?"))try{await v.deleteProduction(s),w.success("Production deleted successfully"),await T(1)}catch(n){w.error(((t=(a=n==null?void 0:n.response)==null?void 0:a.data)==null?void 0:t.message)??"Failed to delete production")}};return(s,a)=>(r(),i(k,null,[d(o(U),{title:"Production Management"}),d(Y,{breadcrumbs:R},{default:_(()=>[e("div",rt,[e("div",nt,[e("div",lt,[d(o(m),{onClick:a[0]||(a[0]=t=>s.$inertia.visit(`/production/${x.activity_role}/create`)),class:"flex-shrink-0 flex items-center gap-2 rounded-md bg-indigo-600 px-3 py-2 text-sm font-medium text-white hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:_(()=>[d(o(et),{class:"h-4 w-4"}),a[3]||(a[3]=Z(" Tambah Data "))]),_:1,__:[3]}),d(o(W),{modelValue:f.value,"onUpdate:modelValue":a[1]||(a[1]=t=>f.value=t),placeholder:"Search...",class:"flex-1 text-sm",onKeyup:a[2]||(a[2]=H(t=>T(1),["enter"]))},null,8,["modelValue"])])]),o(h)?(r(),i("div",it,"Loading...")):(r(),i("div",dt,[e("div",ct,[e("table",ut,[a[6]||(a[6]=e("thead",{class:"bg-gray-100 dark:bg-gray-800 text-xs font-semibold uppercase text-gray-600 dark:text-gray-300"},[e("tr",null,[e("th",{class:"px-3 py-2"},"Tanggal"),e("th",{class:"px-3 py-2"},"Karyawan"),e("th",{class:"px-3 py-2"},"Model"),e("th",{class:"px-3 py-2"},"Activity"),e("th",{class:"px-3 py-2"},"Size/Qty"),e("th",{class:"px-3 py-2"},"Price/PCS"),e("th",{class:"px-3 py-2"},"Total"),e("th",{class:"px-3 py-2 text-right"},"Actions")])],-1)),e("tbody",null,[(r(!0),i(k,null,V(o(P),t=>{var n,y,p;return r(),i("tr",{key:t.id,class:"border-b border-gray-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800"},[e("td",pt,l(t.created_at?new Date(t.created_at).toLocaleDateString():"-"),1),e("td",yt,l(t.employee_name||"-"),1),e("td",gt,l(((n=t.model)==null?void 0:n.description)||"-"),1),e("td",_t,l(((y=t.activity_role)==null?void 0:y.name)||"-"),1),e("td",vt,[(p=t.items)!=null&&p.length?(r(),i("div",ht,[(r(!0),i(k,null,V(t.items,u=>(r(),i("div",{key:u.id},l(u.size_id)+" - "+l(u.variant)+": "+l(u.qty),1))),128))])):(r(),i("div",xt,"-"))]),e("td",ft,l(C((t==null?void 0:t.price_per_pcs)||0)),1),e("td",bt,l((t==null?void 0:t.total_price)||0),1),e("td",mt,[e("div",kt,[t.status===1||t.status===3?(r(),N(o(m),{key:0,variant:"ghost",size:"icon",class:"hover:bg-gray-100 dark:hover:bg-gray-700",onClick:u=>s.$inertia.visit(`/production/${t.activity_role_id}/edit/${t.id}`)},{default:_(()=>[d(o(at),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):B("",!0),t.status===1||t.status===3?(r(),N(o(m),{key:1,variant:"ghost",size:"icon",class:"hover:bg-gray-100 dark:hover:bg-gray-700",onClick:u=>M(t.id)},{default:_(()=>[d(o(st),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):B("",!0),d(o(m),{variant:"ghost",size:"icon",class:"hover:bg-gray-100 dark:hover:bg-gray-700",onClick:u=>s.$inertia.visit(`/production/${t.activity_role_id}/view/${t.id}`)},{default:_(()=>[d(o(ot),{class:"h-4 w-4"})]),_:2},1032,["onClick"])])])])}),128))]),e("tfoot",null,[e("tr",wt,[a[4]||(a[4]=e("td",{colspan:"5",class:"px-3 py-2 text-right"},"Total:",-1)),e("td",Pt,l(C(L.value)),1),e("td",null,l(C(K.value)),1),a[5]||(a[5]=e("td",null,null,-1))])])])]),e("div",St,[e("button",{onClick:A,disabled:o(c)===1||o(h),class:"px-3 py-1 rounded border border-gray-300 text-gray-700 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed"}," Previous ",8,$t),(r(!0),i(k,null,V(S.value,t=>(r(),i("button",{key:t,onClick:n=>$(t),class:J(["px-3 py-1 rounded border text-sm",t===o(c)?"bg-blue-600 border-blue-600 text-white":"border-gray-300 text-gray-700 hover:bg-gray-100"]),disabled:o(h)},l(t),11,Ct))),128)),e("button",{onClick:q,disabled:o(c)===S.value||o(h),class:"px-3 py-1 rounded border border-gray-300 text-gray-700 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed"}," Next ",8,Tt)])]))])]),_:1})],64))}});export{At as default};
