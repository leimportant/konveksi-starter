import{d as B,q as F,r as _,T as U,w as A,o as I,f as c,g as u,p as S,u as p,Z as $,x as R,k as i,C as z,y as T,j as v,l as k,F as h,B as q,U as D,m as E,V as j}from"./app-Di3m0JM_.js";import{u as L}from"./useToast-BFDnfwVN.js";import{u as Q}from"./useProductionStore-DHEjgOe8.js";import{u as Z}from"./useModelStore-IY_ngc1b.js";import{u as G}from"./useMasterActivityRoleStore-BXGYutYs.js";import{_ as H}from"./AppLayout.vue_vue_type_script_setup_true_lang-CdnJxeNL.js";import"./index-ZAa7-5mu.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CARa6xu5.js";const J={class:"p-4 md:p-6 space-y-4 md:space-y-6"},K={class:"text-xl md:text-2xl font-bold"},O={key:0},W={class:"w-full"},X=["value"],Y={key:0,class:"overflow-x-auto"},tt={class:"w-full table-auto border text-sm md:"},et={class:"border px-2 md:px-3 py-1 md:py-2"},ot={class:"border px-2 md:px-3 py-1 md:py-2"},it={class:"border px-2 md:px-3 py-1 md:py-2"},st=["onUpdate:modelValue"],dt={class:"flex gap-2"},at=["disabled"],_t=B({__name:"Update",props:{id:{},activity_role:{}},setup(N){const f=L(),g=Q(),b=Z(),M=G(),{models:V}=F(b),m=N,y=_(null),a=_([]),x=_(null),s=U({id:null,model_id:null,activity_role_id:Number(m.activity_role),items:[]}),C=async()=>{try{const e=await g.fetchProductionsById(m.id);if(!e)throw new Error("No production data received");s.id=e.id,s.model_id=e.model_id,s.activity_role_id=e.activity_role_id,y.value=e.model_id,Array.isArray(e.items)?(a.value=e.items.map(t=>({size_id:String(t.size_id),size_name:t.size.name,qty:t.qty})),s.items=e.items.map(t=>({size_id:String(t.size_id),qty:t.qty||0,variant:t.variant||""}))):(a.value=[],s.items=[])}catch(e){console.error("Failed to fetch production data",e),f.error("Failed to fetch production data"),a.value=[],s.items=[]}},w=_(!0);A(y,async e=>{if(!(!e||w.value))try{const t=await b.fetchModelById(Number(e));if(!t)throw new Error("No model data received");s.model_id=t.id;const d=[...s.items];Array.isArray(t.sizes)?(a.value=t.sizes.map(o=>{var r;return{size_id:String(o.id),size_name:o.name,qty:((r=d.find(l=>l.size_id===String(o.id)))==null?void 0:r.qty)||0}}),s.items=t.sizes.map(o=>{var r,l;return{size_id:String(o.id),qty:((r=d.find(n=>n.size_id===String(o.id)))==null?void 0:r.qty)||0,variant:((l=d.find(n=>n.size_id===String(o.id)))==null?void 0:l.variant)||""}})):(a.value=[],s.items=[])}catch(t){console.error("Failed to fetch model sizes",t),a.value=[],s.items=[]}}),I(async()=>{await b.fetchModels({page:1,is_close:"N"});try{const e=await M.getActivityRoleById(Number(m.activity_role));x.value=e}catch(e){console.error("Failed to fetch activity role",e)}await C(),w.value=!1});const P=async()=>{var e,t;try{await g.updateProduction(String(s.id),{model_id:s.model_id,activity_role_id:s.activity_role_id,items:s.items.filter(d=>d.qty>0)}),f.success("Production updated successfully"),window.location.href="/konveksi"}catch(d){f.error(((t=(e=d==null?void 0:d.response)==null?void 0:e.data)==null?void 0:t.message)??"Failed to update production")}};return(e,t)=>(u(),c(h,null,[S(p($),{title:"Update Production"}),S(H,{breadcrumbs:[{title:"Production",href:`/production/${m.activity_role}`}]},{default:R(()=>{var d;return[i("div",J,[i("h1",K,[t[2]||(t[2]=T(" Update Production")),x.value?(u(),c("span",O," - "+v((d=x.value)==null?void 0:d.name),1)):z("",!0)]),i("div",W,[t[4]||(t[4]=i("label",{class:"block font-medium mb-1"},"Select Model",-1)),k(i("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>y.value=o),class:"border p-2 rounded w-full text-sm md:"},[t[3]||(t[3]=i("option",{disabled:"",value:""},"-- Choose a model --",-1)),(u(!0),c(h,null,q(p(V),o=>(u(),c("option",{key:o.id,value:o.id},v(o.description),9,X))),128))],512),[[D,y.value]])]),a.value.length>0?(u(),c("div",Y,[t[6]||(t[6]=i("h2",{class:"font-semibold mb-2"},"Model Sizes",-1)),i("table",tt,[t[5]||(t[5]=i("thead",null,[i("tr",{class:"bg-gray-100"},[i("th",{class:"border px-2 md:px-3 py-1 md:py-2 text-left"},"Size"),i("th",{class:"border px-2 md:px-3 py-1 md:py-2 text-left"},"Variant"),i("th",{class:"border px-2 md:px-3 py-1 md:py-2 text-left"},"Qty")])],-1)),i("tbody",null,[(u(!0),c(h,null,q(p(s).items,(o,r)=>{var l;return u(),c("tr",{key:`size-${r}-${o.size_id}`},[i("td",et,v(((l=a.value.find(n=>n.size_id===o.size_id))==null?void 0:l.size_name)||o.size_id),1),i("td",ot,v(o.variant),1),i("td",it,[k(i("input",{type:"number",min:"0",class:"border rounded px-2 py-1 w-full","onUpdate:modelValue":n=>o.qty=n},null,8,st),[[E,o.qty,void 0,{number:!0}]])])])}),128))])])])):z("",!0),i("div",dt,[i("button",{onClick:P,class:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",disabled:p(s).processing}," Save ",8,at),i("button",{onClick:t[1]||(t[1]=o=>p(j).visit(`/production/${m.activity_role}`)),type:"button",class:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600"}," Cancel ")])])]}),_:1},8,["breadcrumbs"])],64))}});export{_t as default};
