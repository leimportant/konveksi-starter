import{d as ve,r as m,c as A,o as be,a as xe,w as ye,b as q,e as _e,f as u,g as i,p as a,u as o,Z as ke,x as n,k as s,j as c,z as P,C as $,y as r,$ as we,F as D,B as F,E as R,a0 as he,a1 as I,a2 as Ce}from"./app-BDpa192z.js";import{_ as Pe,a as $e,b as U,c as _,d as De,e as x}from"./TableRow.vue_vue_type_script_setup_true_lang-C9Glwmer.js";import{_ as Te}from"./Textarea.vue_vue_type_script_setup_true_lang-DL_4DOFX.js";import{u as Se}from"./useToast-DHAakzS1.js";import{_ as Be}from"./AppLayout.vue_vue_type_script_setup_true_lang-u-XTIay_.js";import{u as E}from"./useOrderCustomer-BlSasXQn.js";import{u as Oe}from"./useBankAccountStore-Cp5HhLPl.js";import"./index-3JZXheUp.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-DfId8lQ4.js";const Ie={class:"absolute max-h-screen w-full bg-gray-50 p-4 md:p-2"},Ne={class:"mb-6 flex flex-wrap justify-between gap-2"},Me={class:"w-full flex-1 flex-col flex-wrap rounded-lg bg-indigo-100 p-4 text-center shadow sm:w-[32%] sm:w-[32.999%]"},je={class:"text-medium font-bold text-indigo-900"},Ae={class:"w-full flex-1 flex-col flex-wrap rounded-lg bg-green-100 p-4 text-center shadow sm:w-[32%] sm:w-[32.999%]"},Fe={class:"text-medium font-bold text-green-900"},Re={class:"w-full flex-1 flex-col flex-wrap rounded-lg bg-yellow-100 p-4 text-center shadow sm:w-[32%] sm:w-[32.999%]"},Ue={class:"text-small font-bold text-yellow-900"},Ee={class:"mb-4 flex flex-wrap gap-2 border-b"},Ke={key:0,class:"text-center text-gray-500"},Le={key:1,class:"text-center text-red-500"},Ve={key:2,class:"text-center text-gray-500"},Qe={key:3,class:"overflow-x-auto"},ze={key:0,class:"mb-4 flex items-center gap-3"},Ge={class:"flex items-center gap-2"},We=["checked"],He={class:"flex items-center justify-between gap-2"},Ye=["checked","onChange","disabled"],Ze={key:0,class:"relative inline-block border border-blue-200 text-gray-400 bg-blue-100 text-left"},qe=["onClick"],Je={key:0,class:"absolute z-10 mt-2 w-48 rounded-md bg-white text-gray-800 shadow-lg ring-1 ring-black ring-opacity-5"},Xe={class:"py-1 text-sm text-gray-700"},et={class:"text-gray-600 text-xs"},tt={class:"space-y-1"},st={class:"mt-1 text-right font-semibold"},lt={class:"space-y-4 p-4 sm:p-6"},at={class:"flex justify-end gap-2 pt-2"},nt={class:"flex justify-center p-4"},ot={class:"text-sm text-gray-700 space-y-1"},rt=["src"],it={key:1,class:"w-full h-full bg-gray-200 flex items-center justify-center text-xs text-gray-400 rounded-lg"},ut={class:"mt-4 text-right"},dt={key:0,class:"text-gray-500"},mt={key:1,class:"space-y-2 max-h-48 overflow-y-auto pr-2"},ct={class:"font-medium text-gray-700"},gt={class:"font-semibold"},ft={class:"font-mono"},pt={class:"mt-6"},$t=ve({__name:"OrderHistory",setup(vt){const N=m(!1),T=m(!1),k=m(!1),S=m(""),K=m(""),g=m([]),{orders:w,isLoading:L,error:V,pagination:Q,fetchOrders:h}=E(),f=m("pending"),{cancelOrder:J,checkShipping:X}=E(),M=Oe(),y=m(null),v=Se(),p=m(1),ee=A(()=>{var t,e;return Math.ceil((((t=Q.value)==null?void 0:t.total)||0)/(((e=Q.value)==null?void 0:e.per_page)||1))});be(()=>{w.value=[],p.value=1,h({status:f.value,page:p.value}),M.fetchBankAccount(),me(),window.addEventListener("scroll",z)}),xe(()=>{window.removeEventListener("scroll",z)}),ye(f,t=>{w.value=[],p.value=1,h({status:t,page:p.value})});const C=A(()=>w.value),z=()=>{document.documentElement.scrollTop+window.innerHeight>=document.documentElement.offsetHeight-100&&!L.value&&p.value<ee.value&&(p.value++,h({status:f.value,page:p.value,append:!0}))},te=t=>{K.value=t.join(","),N.value=!0},se=t=>{t.target.checked?g.value=C.value.filter(d=>d.payment_method==="cod_store").map(d=>d.id):g.value=[]},le=t=>{g.value=t,k.value=!0},ae=t=>{g.value.includes(t)?g.value=g.value.filter(e=>e!==t):g.value.push(t)},j=m();function ne(t){j.value=j.value===t?null:t}const oe=async t=>{try{const e=await X(t);T.value=!0,y.value=e.data}catch(e){console.log(e),alert("Gagal mengambil data pengiriman.")}},re=t=>t?t.startsWith("storage/")?"/"+t:t.startsWith("/storage/")?t:"/storage/"+t:"";async function ie(t){if(window.confirm("Apakah Anda yakin ingin membatalkan pesanan ini?"))try{await J(t),v.success("Pesanan berhasil dibatalkan."),setTimeout(()=>{w.value=[],p.value=1,h({status:f.value,page:p.value})},500)}catch(d){console.log(d),v.error("Gagal membatalkan pesanan.")}}const G=A(()=>g.value.filter(t=>{const e=w.value.find(d=>d.id===t);return e&&e.payment_method==="cod_store"})),ue=async()=>{try{const t={message:S.value,content_data:g.value.length>0?g.value:null,sender_type:"customer",order_id:g.value.length>0?g.value[0]:null};console.log("Sending message payload:",t),await q.post("/api/chat/send",t),k.value=!1,S.value="",v.success("Pesan berhasil dikirim")}catch(t){console.error("Failed to send message:",t),v.error("Gagal mengirim pesan")}},B=m(!1),O=m(null),de=t=>{const e=t.target;e.files&&e.files.length>0?O.value=e.files[0]:O.value=null},W=m(0),H=m(0),Y=m(0),me=async()=>{try{const t=await q.get("/api/dashboard/customer");W.value=t.data.totalProduk||0,H.value=t.data.totalOrder||0,Y.value=t.data.totalPembelian||0}catch(t){console.error("Failed to fetch dashboard data:",t)}},{uploadPaymentProof:ce}=E(),Z=m(null),ge=t=>{Z.value=t,B.value=!0},fe=t=>({1:"Pending",2:"Menunggu Pembayaran",3:"Menunggu Konfirmasi",4:"On Progress",5:"Sedang Dikemas",6:"Selesai",7:"Dibatalkan",8:"Konfirmasi Pembatalan",9:"Dikirim",10:"Disetujui",11:"Ditolak"})[t]||"-",pe=async()=>{if(!O.value){v.error("Silahkan pilih file bukti transfer terlebih dahulu.");return}const t=Z.value;if(!t){v.error("Tidak ada order yang dipilih untuk upload bukti transfer.");return}try{await ce(t,O.value),v.success("Bukti transfer berhasil diunggah!"),B.value=!1,h({status:f.value})}catch(e){console.error(e),v.error("Gagal mengunggah bukti transfer.")}};return(t,e)=>{const d=_e("Button");return i(),u(D,null,[a(o(ke),{title:"Riwayat Order"}),a(Be,null,{default:n(()=>[s("section",Ie,[s("div",Ne,[s("div",Me,[e[11]||(e[11]=s("p",{class:"text-xs font-medium text-indigo-800"},"Total Produk",-1)),s("p",je,c(W.value),1)]),s("div",Ae,[e[12]||(e[12]=s("p",{class:"text-xs font-medium text-green-800"},"Total Order",-1)),s("p",Fe,c(H.value),1)]),s("div",Re,[e[13]||(e[13]=s("p",{class:"text-xs font-medium text-yellow-800"},"Total Pembelian",-1)),s("p",Ue,c(Y.value),1)])]),s("div",Ee,[s("button",{onClick:e[0]||(e[0]=l=>f.value="pending"),class:P(["rounded-t px-4 py-2 text-sm md:",f.value==="pending"?"border-b-2 text-indigo-400 border-indigo-600 font-semibold":"text-gray-500"])}," Pesanan Saya ",2),s("button",{onClick:e[1]||(e[1]=l=>f.value="done"),class:P(["rounded-t px-4 py-2 text-sm md:",f.value==="done"?"border-b-2  text-indigo-400 border-indigo-600 font-semibold":"text-gray-500"])}," Selesai ",2),s("button",{onClick:e[2]||(e[2]=l=>f.value="cancel"),class:P(["rounded-t px-4 py-2 text-sm md:",f.value==="cancel"?"border-b-2  text-indigo-400 border-indigo-600 font-semibold":"text-gray-500"])}," Dibatalkan ",2)]),o(L)?(i(),u("div",Ke,"Memuat pesanan...")):o(V)?(i(),u("div",Le,c(o(V)),1)):C.value.length===0?(i(),u("div",Ve,"Tidak ada pesanan ditemukan. ")):(i(),u("div",Qe,[f.value==="pending"&&G.value.length>0?(i(),u("div",ze,[a(d,{onClick:e[3]||(e[3]=l=>te(G.value)),class:"flex items-center gap-1 rounded-md border border-indigo-600 px-3 py-1 text-indigo-600 hover:underline"},{default:n(()=>[a(o(we),{class:"h-4 w-4"}),e[14]||(e[14]=r(" Generate QR "))]),_:1,__:[14]})])):$("",!0),a(o(Pe),{class:"max-h-screen w-full"},{default:n(()=>[a(o($e),null,{default:n(()=>[a(o(U),{class:"bg-gray-100"},{default:n(()=>[a(o(_),{class:"w-[5%]"},{default:n(()=>[s("div",Ge,[s("input",{type:"checkbox",checked:g.value.length===C.value.length&&C.value.length>0,onChange:se},null,40,We)])]),_:1}),a(o(_),{class:"w-[10%]"},{default:n(()=>e[15]||(e[15]=[r("No. Order")])),_:1,__:[15]}),a(o(_),{class:"w-[10%]"},{default:n(()=>e[16]||(e[16]=[r("Tanggal")])),_:1,__:[16]}),a(o(_),{class:"w-[10%]"},{default:n(()=>e[17]||(e[17]=[r("Total")])),_:1,__:[17]}),a(o(_),{class:"w-[10%]"},{default:n(()=>e[18]||(e[18]=[r("Status")])),_:1,__:[18]}),a(o(_),{class:"w-[10%]"},{default:n(()=>e[19]||(e[19]=[r("Pembayaran")])),_:1,__:[19]})]),_:1})]),_:1}),a(o(De),null,{default:n(()=>[(i(!0),u(D,null,F(C.value,l=>(i(),u(D,{key:l.id},[a(o(U),null,{default:n(()=>[a(o(x),null,{default:n(()=>[s("div",He,[s("input",{type:"checkbox",checked:g.value.includes(l.id),onChange:b=>ae(l.id),disabled:l.payment_method!=="cod_store"},null,40,Ye),f.value=="pending"?(i(),u("div",Ze,[s("button",{onClick:b=>ne(l.id),class:"rounded bg-gray-100 px-2 py-1 text-sm hover:bg-gray-200"}," â‹® ",8,qe),j.value===l.id?(i(),u("div",Je,[s("div",Xe,[a(d,{onClick:b=>le([l.id]),class:"block w-full px-4 py-2 hover:bg-gray-100"},{default:n(()=>e[20]||(e[20]=[r(" Kirim Pesan ")])),_:2,__:[20]},1032,["onClick"]),a(d,{onClick:b=>ie(l.id),class:"block w-full px-4 py-2 text-red-500 hover:bg-gray-100"},{default:n(()=>e[21]||(e[21]=[r(" Ajukan Pembatalan ")])),_:2,__:[21]},1032,["onClick"]),l.is_paid=="Y"?(i(),R(d,{key:0,onClick:b=>oe(l.id),class:"block w-full px-4 py-2 hover:bg-gray-100"},{default:n(()=>e[22]||(e[22]=[r(" Status Pengiriman ")])),_:2,__:[22]},1032,["onClick"])):$("",!0),l.is_paid=="N"&&l.payment_method=="bank_transfer"?(i(),R(d,{key:1,onClick:b=>ge(l.id),class:"block w-full px-4 py-2 hover:bg-gray-100"},{default:n(()=>e[23]||(e[23]=[r(" Upload Bukti Transfer ")])),_:2,__:[23]},1032,["onClick"])):$("",!0)])])):$("",!0)])):$("",!0)])]),_:2},1024),a(o(x),{class:"text-gray-800 text-sm leading-snug space-y-0.5"},{default:n(()=>[r(c(l.id),1)]),_:2},1024),a(o(x),{class:"text-gray-800 text-sm leading-snug space-y-0.5"},{default:n(()=>[s("div",et,c(new Date(l.created_at).toLocaleDateString("id-ID")),1)]),_:2},1024),a(o(x),{class:"text-gray-800"},{default:n(()=>[r(c(new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(Number(l.total_amount))),1)]),_:2},1024),a(o(x),null,{default:n(()=>[s("span",{class:P({"text-yellow-600":l.status===1,"text-green-600":l.status===2,"text-red-600":l.status===3})},c(fe(l.status)),3)]),_:2},1024),a(o(x),{class:"text-gray-800 text-center text-xxs"},{default:n(()=>[s("span",{class:P(["text-xxs font-small inline-block rounded-full border px-1 py-1",l.payment_method==="bank_transfer"?"border-yellow-600 text-yellow-600":l.payment_method==="cod_store"?"border-green-600 text-green-600":"border-gray-300 text-gray-500"])},c(l.payment_method==="bank_transfer"?"Transfer":l.payment_method==="cod_store"?"Bayar Di Toko":"-"),3)]),_:2},1024)]),_:2},1024),a(o(U),null,{default:n(()=>[a(o(x),{colspan:"6",class:"rounded-md border border-blue-100 bg-blue-50 p-3"},{default:n(()=>[e[24]||(e[24]=s("h4",{class:"mb-1 text-sm font-semibold"},"Detail Pesanan:",-1)),s("div",tt,[(i(!0),u(D,null,F(l.order_items,b=>(i(),R(he,{key:b.id,item:b},null,8,["item"]))),128))]),s("div",st," Subtotal: "+c(new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(Number(l.total_amount))),1)]),_:2,__:[24]},1024)]),_:2},1024)],64))),128))]),_:1})]),_:1})]))]),a(I,{show:k.value,onClose:e[6]||(e[6]=l=>k.value=!1)},{default:n(()=>[s("div",lt,[e[27]||(e[27]=s("h2",{class:"text-center font-semibold text-gray-800 sm:text-lg"},"Kirim Pesan",-1)),a(o(Te),{modelValue:S.value,"onUpdate:modelValue":e[4]||(e[4]=l=>S.value=l),class:"h-32 w-full bg-white resize-none rounded-md border border-gray-300 p-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 sm:h-40",placeholder:"Tulis pesan..."},null,8,["modelValue"]),s("div",at,[a(d,{onClick:e[5]||(e[5]=l=>k.value=!1),variant:"outline",class:"px-4 py-2 text-sm"},{default:n(()=>e[25]||(e[25]=[r(" Batal ")])),_:1,__:[25]}),a(d,{onClick:ue,class:"bg-indigo-600 px-4 py-2 text-sm text-white hover:bg-indigo-700"},{default:n(()=>e[26]||(e[26]=[r(" Kirim ")])),_:1,__:[26]})])])]),_:1},8,["show"]),a(I,{show:N.value,onClose:e[7]||(e[7]=l=>N.value=!1)},{default:n(()=>[s("div",nt,[a(Ce,{value:K.value,size:256},null,8,["value"])])]),_:1},8,["show"]),a(I,{show:T.value,onClose:e[9]||(e[9]=l=>T.value=!1),class:"max-w-lg"},{default:n(()=>[e[32]||(e[32]=s("h2",{class:"text-lg font-semibold mb-2"},"Informasi Pengiriman",-1)),s("div",ot,[s("p",null,[e[28]||(e[28]=s("strong",null,"No. Resi:",-1)),r(" "+c(y.value.resi_number),1)]),s("p",null,[e[29]||(e[29]=s("strong",null,"Kurir:",-1)),r(" "+c(y.value.delivery_provider),1)]),s("p",null,[e[30]||(e[30]=s("strong",null,"Estimasi Tiba:",-1)),r(" "+c(new Date(y.value.estimation_date).toLocaleDateString("id-ID")),1)]),s("div",null,[e[31]||(e[31]=r("Bukti Pengiriman ")),y.value.delivery_proof?(i(),u("img",{key:0,src:re(y.value.delivery_proof),alt:"product",class:"w-full h-full object-cover rounded-lg cursor-pointer"},null,8,rt)):(i(),u("div",it,"No Image "))])]),s("div",ut,[s("button",{class:"px-4 py-2 bg-blue-600 text-white rounded",onClick:e[8]||(e[8]=l=>T.value=!1)},"Tutup")])]),_:1,__:[32]},8,["show"]),a(I,{show:B.value,onClose:e[10]||(e[10]=l=>B.value=!1),class:"max-w-lg"},{default:n(()=>[e[37]||(e[37]=s("div",{class:"mb-4 text-lg font-semibold"},"Informasi Rekening",-1)),o(M).loading?(i(),u("div",dt,"Memuat data rekening...")):(i(),u("ul",mt,[(i(!0),u(D,null,F(o(M).bankAccount,l=>(i(),u("li",{key:l.id,class:"p-3 border rounded-lg bg-gray-50 text-sm md:text-base"},[s("div",ct,"Bank ID: "+c(l.id),1),s("div",null,[e[33]||(e[33]=r("Atas Nama: ")),s("span",gt,c(l.name),1)]),s("div",null,[e[34]||(e[34]=r("No Rekening: ")),s("span",ft,c(l.account_number),1)])]))),128))])),s("div",pt,[e[35]||(e[35]=s("label",{class:"block mb-1 font-medium"},"Upload Bukti Transfer",-1)),s("input",{type:"file",onChange:de,class:"block w-full text-sm text-gray-700 file:mr-4 file:py-1 file:px-3 file:rounded-md file:border-0 file:bg-blue-600 file:text-white hover:file:bg-blue-700"},null,32)]),a(d,{class:"mt-4 bg-blue-600 hover:bg-blue-700 px-4 py-2 text-white rounded-md w-full",onClick:pe},{default:n(()=>e[36]||(e[36]=[r(" Kirim Bukti Transfer ")])),_:1,__:[36]})]),_:1,__:[37]},8,["show"])]),_:1})],64)}}});export{$t as default};
