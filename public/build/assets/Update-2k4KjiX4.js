import{d as J,T as K,aQ as x,r as W,o as X,b as S,w as Y,f as r,g as n,p as d,u as s,Z as tt,x as l,k as o,C as D,l as h,y as u,F as m,B as v,j as _,O as T,D as w,E as et,m as st,P as M}from"./app-CJqfVmpi.js";import{_ as ot}from"./AppLayout.vue_vue_type_script_setup_true_lang-DY0hRfUP.js";import{_ as P}from"./Input.vue_vue_type_script_setup_true_lang-C7z7rBdL.js";import{_ as U}from"./Label.vue_vue_type_script_setup_true_lang-fxltGLey.js";import{_ as at,a as it,b as O,c as g,d as dt,e as b}from"./TableRow.vue_vue_type_script_setup_true_lang-C54C7mXv.js";import{u as lt}from"./useToast-zrFUjB3s.js";import{u as nt}from"./useTransferStockStore-DmJ3yeWF.js";import{u as rt}from"./useInventoryStore-DywWDEou.js";import{d as ut}from"./debounce-BcZQbp_F.js";import{T as _t}from"./trash-CUcsmn_8.js";import"./index-BX9Ggp7C.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-Bjho6l_o.js";const ct={class:"p-6 space-y-6"},pt={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ft=["value"],mt=["value"],yt=["value"],xt={class:"border rounded-lg p-4 shadow-sm bg-white"},vt={class:"flex justify-between items-center mb-4 flex-wrap gap-2"},gt={class:"overflow-x-auto"},bt=["value"],kt={class:"flex justify-end gap-2"},ht={key:0,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"},wt={class:"bg-white rounded-lg shadow-lg w-11/12 max-w-4xl p-6"},zt={class:"flex justify-between items-center mb-4"},Vt={key:0,class:"text-center py-10"},$t={key:1,class:"space-y-4"},Ct={class:"flex flex-col sm:flex-row items-start sm:items-center gap-2"},St=["disabled"],Tt={class:"overflow-x-auto rounded-md border border-gray-200 shadow-sm"},Pt={class:"min-w-full text-sm text-left whitespace-nowrap"},Ut={class:"px-3 py-2 font-medium text-gray-800"},Nt={class:"px-3 py-2"},qt={class:"px-3 py-2"},Bt={class:"px-3 py-2 text-right"},jt={class:"px-3 py-2 text-center"},It=["onClick"],Dt={key:0},Kt=J({__name:"Update",props:{id:{}},setup(F){const L=[{title:"Transfer Stock",href:"/transfer-stock"}],c=lt(),z=nt(),p=rt(),i=K({location_id:void 0,location_destination_id:void 0,sloc_id:void 0,transfer_detail:[]}),N=x({}),V=x([]),q=x([]),B=x([]),k=W(!1),$=x({productName:""}),C=F;X(async()=>{try{await z.fetchTransferByID(C.id),H();const[a,t,e]=await Promise.all([S.get("/api/locations"),S.get("/api/slocs"),S.get("/api/products")]);V.push(...a.data.data),q.push(...t.data.data),B.push(...e.data.data)}catch(a){console.error(a),c.error("Gagal memuat data")}}),Y(()=>$.productName,ut(a=>{p.setFilter("productName",a),p.fetchInventory()},500));const R=async()=>{if(!i.location_id||!i.sloc_id){c.error("Pilih lokasi dan sloc terlebih dahulu");return}try{await p.fetchInventory(),k.value=!0}catch(a){console.error(a),c.error("Gagal memuat inventory")}},A=a=>{if(i.transfer_detail.find(e=>e.product_id===a.product_id&&e.size_id===a.size_id&&e.uom_id===a.uom_id)){c.error("Produk ini sudah ada di daftar detail");return}i.transfer_detail.push({product_id:a.product_id,product_name:a.product_name,size_id:a.size_id,size_name:a.size_id,uom_id:a.uom_id,uom_name:a.uom_id,qty:a.qty_available??1}),k.value=!1},E=(a,t)=>{const e=B.find(y=>y.id===a);return e?e.name:t},j=a=>{delete N[a]},G=()=>{M.visit("/transfer-stock")},Q=a=>{i.transfer_detail.splice(a,1)},Z=async()=>{var a;try{if(!i.location_id||!i.location_destination_id||!i.sloc_id){c.error("Semua lokasi dan sloc wajib diisi");return}await z.updateTransfer(String(C.id),{id:C.id,location_id:i.location_id,location_destination_id:i.location_destination_id,sloc_id:i.sloc_id,transfer_detail:i.transfer_detail.map(t=>({product_id:t.product_id,size_id:t.size_id,uom_id:t.uom_id,qty:t.qty}))}),c.success("Transfer berhasil disimpan"),M.visit("/transfer-stock")}catch(t){((a=t.response)==null?void 0:a.status)===422?Object.assign(N,t.response.data.errors):c.error("Gagal menyimpan transfer")}},H=()=>{const a=z.transfer;if(a){i.location_id=a.location_id??void 0,i.location_destination_id=a.location_destination_id??void 0,i.sloc_id=a.sloc_id??void 0;const t=a.transfer_detail?a.transfer_detail.map(e=>({product_id:e.product_id??0,product_name:e.product_name??"",size_id:e.size_id??"",size_name:e.size_id??"",uom_id:e.uom_id??"",uom_name:e.uom_id??"",qty:e.qty})):[];i.transfer_detail.splice(0,i.transfer_detail.length,...t)}},I=()=>{j("location_id"),j("sloc_id"),i.transfer_detail.splice(0,i.transfer_detail.length)};return(a,t)=>(n(),r(m,null,[d(s(tt),{title:"Transfer Stock Management"}),d(ot,{breadcrumbs:L},{default:l(()=>[o("div",ct,[o("div",pt,[o("div",null,[d(s(U),{for:"location_id"},{default:l(()=>t[5]||(t[5]=[u("Lokasi Asal")])),_:1,__:[5]}),h(o("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>s(i).location_id=e),id:"location_id",class:"w-full border rounded p-2",onChange:I},[t[6]||(t[6]=o("option",{disabled:"",value:""},"Pilih lokasi",-1)),(n(!0),r(m,null,v(V,e=>(n(),r("option",{key:e.id,value:e.id},_(e.name),9,ft))),128))],544),[[T,s(i).location_id]])]),o("div",null,[d(s(U),{for:"location_destination_id"},{default:l(()=>t[7]||(t[7]=[u("Lokasi Tujuan")])),_:1,__:[7]}),h(o("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>s(i).location_destination_id=e),id:"location_destination_id",class:"w-full border rounded p-2"},[t[8]||(t[8]=o("option",{disabled:"",value:""},"Pilih lokasi",-1)),(n(!0),r(m,null,v(V,e=>(n(),r("option",{key:e.id,value:e.id},_(e.name),9,mt))),128))],512),[[T,s(i).location_destination_id]])]),o("div",null,[d(s(U),{for:"sloc_id"},{default:l(()=>t[9]||(t[9]=[u("Sloc")])),_:1,__:[9]}),h(o("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>s(i).sloc_id=e),id:"sloc_id",class:"w-full border rounded p-2",onChange:I},[t[10]||(t[10]=o("option",{disabled:"",value:""},"Pilih sloc",-1)),(n(!0),r(m,null,v(q,e=>(n(),r("option",{key:e.id,value:e.id},_(e.name),9,yt))),128))],544),[[T,s(i).sloc_id]])])]),o("div",xt,[o("div",vt,[t[12]||(t[12]=o("h2",{class:"text-lg font-semibold text-gray-800"},"Detail Barang",-1)),d(s(w),{variant:"outline",onClick:R,disabled:!s(i).location_id||!s(i).sloc_id,class:"text-sm"},{default:l(()=>t[11]||(t[11]=[u(" Tambah Baris ")])),_:1,__:[11]},8,["disabled"])]),o("div",gt,[d(s(at),{class:"min-w-full text-sm"},{default:l(()=>[d(s(it),null,{default:l(()=>[d(s(O),{class:"bg-gray-100"},{default:l(()=>[d(s(g),{class:"px-3 py-2"},{default:l(()=>t[13]||(t[13]=[u("Produk")])),_:1,__:[13]}),d(s(g),{class:"px-3 py-2"},{default:l(()=>t[14]||(t[14]=[u("Size")])),_:1,__:[14]}),d(s(g),{class:"px-3 py-2"},{default:l(()=>t[15]||(t[15]=[u("UOM")])),_:1,__:[15]}),d(s(g),{class:"px-3 py-2"},{default:l(()=>t[16]||(t[16]=[u("Qty")])),_:1,__:[16]}),d(s(g),{class:"px-3 py-2 text-center"},{default:l(()=>t[17]||(t[17]=[u("Action")])),_:1,__:[17]})]),_:1})]),_:1}),d(s(dt),null,{default:l(()=>[(n(!0),r(m,null,v(s(i).transfer_detail,(e,y)=>(n(),et(s(O),{key:y,class:"hover:bg-gray-50"},{default:l(()=>[d(s(b),{class:"px-3 py-2"},{default:l(()=>[o("input",{type:"text",value:E(e.product_id,e.product_name),readonly:"",class:"w-full bg-gray-100 text-sm border rounded px-2 py-1"},null,8,bt)]),_:2},1024),d(s(b),{class:"px-3 py-2"},{default:l(()=>[d(s(P),{type:"text",modelValue:e.size_id,"onUpdate:modelValue":f=>e.size_id=f,readonly:"",class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),d(s(b),{class:"px-3 py-2"},{default:l(()=>[d(s(P),{type:"text",modelValue:e.uom_id,"onUpdate:modelValue":f=>e.uom_id=f,readonly:"",class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),d(s(b),{class:"px-3 py-2"},{default:l(()=>[d(s(P),{type:"number",min:"1",modelValue:e.qty,"onUpdate:modelValue":f=>e.qty=f,class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),d(s(b),{class:"px-3 py-2 text-center"},{default:l(()=>[d(s(w),{variant:"destructive",size:"sm",onClick:f=>Q(y)},{default:l(()=>[d(s(_t),{class:"h-4 w-4"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])]),o("div",kt,[d(s(w),{onClick:Z,class:"bg-indigo-600 text-white py-2 h-10 rounded-md hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:l(()=>t[18]||(t[18]=[u("Simpan")])),_:1,__:[18]}),d(s(w),{variant:"outline",onClick:G},{default:l(()=>t[19]||(t[19]=[u("Batal")])),_:1,__:[19]})])]),k.value?(n(),r("div",ht,[o("div",wt,[o("div",zt,[t[20]||(t[20]=o("h3",{class:"text-lg font-semibold"},"Pilih Produk dari Inventory",-1)),o("button",{onClick:t[3]||(t[3]=e=>k.value=!1),class:"text-2xl font-bold text-gray-600 hover:text-gray-900"},"Ã—")]),s(p).loading?(n(),r("div",Vt,"Loading inventory...")):(n(),r("div",$t,[o("div",Ct,[h(o("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>$.productName=e),placeholder:"Cari Produk",disabled:s(p).loading,class:"w-full sm:w-64 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 text-sm","aria-label":"Search"},null,8,St),[[st,$.productName]])]),o("div",Tt,[o("table",Pt,[t[22]||(t[22]=o("thead",{class:"bg-gray-100 text-gray-700 uppercase text-xs"},[o("tr",null,[o("th",{class:"px-3 py-2"},"Produk"),o("th",{class:"px-3 py-2"},"Size"),o("th",{class:"px-3 py-2"},"UOM"),o("th",{class:"px-3 py-2 text-right"},"Qty"),o("th",{class:"px-3 py-2 text-center"},"Aksi")])],-1)),o("tbody",null,[(n(!0),r(m,null,v(s(p).inventoryRpt,e=>(n(),r("tr",{key:`${e.product_id}-${e.location_id}-${e.sloc_id}-${e.size_id}`,class:"hover:bg-gray-50 border-t"},[o("td",Ut,_(e.product_id)+" - "+_(e.product_name),1),o("td",Nt,_(e.size_id),1),o("td",qt,_(e.uom_id),1),o("td",Bt,_(e.qty),1),o("td",jt,[o("button",{onClick:y=>A(e),class:"text-blue-600 hover:text-blue-800 hover:underline transition"}," Pilih ",8,It)])]))),128)),s(p).inventoryRpt.length===0?(n(),r("tr",Dt,t[21]||(t[21]=[o("td",{colspan:"5",class:"px-3 py-4 text-center text-gray-500"},"Tidak ada inventory ditemukan.",-1)]))):D("",!0)])])])]))])])):D("",!0)]),_:1})],64))}});export{Kt as default};
