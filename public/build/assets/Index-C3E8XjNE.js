import{d as Z,q as H,r as _,c as k,o as J,f as i,g as l,p as c,u as n,Z as W,x as v,k as e,D as w,y as V,G as X,F as g,B as P,j as d,E as B,C as O,z as Y}from"./app-C0haUAd3.js";import{_ as tt}from"./Input.vue_vue_type_script_setup_true_lang-DYd3c6mh.js";import{u as et}from"./useToast-CqJn-E_m.js";import{_ as ot}from"./AppLayout.vue_vue_type_script_setup_true_lang-BV7Kz6jH.js";import{u as st}from"./useProductionStore-a0Kxoa6g.js";import{P as at}from"./plus-C1nhQA6u.js";import{S as rt}from"./square-pen-BncbPSOn.js";import{T as nt}from"./trash-2-BVBBKuCn.js";import{V as lt}from"./view-C8CqznhH.js";import"./index-Dq1WJwb7.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-DHmxgee6.js";const it={class:"px-3 py-4"},dt={class:"mb-4 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},ct={class:"flex flex-1 gap-2"},ut={key:0,class:"py-4 text-center text-sm text-gray-500"},pt={key:1,class:"space-y-2"},yt={class:"overflow-x-auto rounded-md border border-gray-200 dark:border-gray-700"},gt={class:"min-w-full table-auto text-left text-sm text-gray-800 dark:text-gray-100"},_t={class:"bg-gray-200 dark:bg-gray-700 font-semibold"},vt={colspan:"8",class:"px-3 py-2"},mt={class:"whitespace-nowrap px-3 py-2 align-top"},ft={class:"whitespace-nowrap px-3 py-2 align-top"},xt={key:0,class:"flex flex-col gap-1 rounded-lg border border-gray-200 bg-gray-50 p-1 text-[11px] text-gray-700"},bt={class:"font-semibold"},ht={key:1,class:"text-xs italic text-gray-400"},kt={class:"truncate px-3 py-2 align-top"},wt={class:"max-w-[80px] truncate px-3 py-2 align-top"},Pt={class:"px-3 py-2 align-top"},St={class:"flex justify-end gap-1 sm:gap-2"},$t={class:"bg-gray-50 font-semibold dark:bg-gray-800"},Ct={class:"px-3 py-2 text-right"},Tt={class:"px-3 py-2"},Dt={class:"mt-4 flex justify-end space-x-2"},Vt=["disabled"],Ft=["onClick","disabled"],It=["disabled"],At=Z({__name:"Index",props:{activity_role:{}},setup(q){const S=et(),m=st(),{productions:$,currentPage:p,lastPage:R,loading:f}=H(m),F=_(50),I=_("created_at"),N=_("desc"),x=q,E=[{title:"Production",href:`/production/${x.activity_role}`}],C=k(()=>R.value||1),T=async a=>{var t,o;a<1||a>C.value||(await m.fetchProductions({page:a,per_page:F.value,sort_field:I.value,sort_order:N.value,activity_role_id:x.activity_role,search:b.value,date_from:(t=h.value.from)==null?void 0:t.toISOString(),date_to:(o=h.value.to)==null?void 0:o.toISOString()}),p.value=a)},L=()=>T(p.value+1),M=()=>T(p.value-1),b=_(""),h=_({from:null,to:null});function j(a){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(a)}const D=async(a=1)=>{var t,o,r,s;try{await m.fetchProductions({page:a||p.value,per_page:F.value,sort_field:I.value,sort_order:N.value,activity_role_id:x.activity_role,search:b.value,date_from:(t=h.value.from)==null?void 0:t.toISOString(),date_to:(o=h.value.to)==null?void 0:o.toISOString()})}catch(u){S.error(((s=(r=u==null?void 0:u.response)==null?void 0:r.data)==null?void 0:s.message)??"Failed to fetch productions")}},Q=k(()=>{const a={};return $.value.forEach(t=>{var r,s;const o=`${t.employee_name||"Unknown"} - ${((r=t.model)==null?void 0:r.description)||"No Model"}`;a[o]||(a[o]={employee_name:t.employee_name,model_description:(s=t.model)==null?void 0:s.description,items:[]}),a[o].items.push(t)}),a}),A=k(()=>$.value.reduce((a,t)=>{var r;const o=((r=t.items)==null?void 0:r.reduce((s,u)=>s+(parseFloat(String(u.qty))||0),0))||0;return a+o},0)),K=k(()=>$.value.reduce((a,t)=>{const o=String(t.total_price).replace(/[^\d]/g,""),r=parseFloat(o)||0;return a+r},0));J(D);const U=async a=>{var t,o;if(confirm("Are you sure you want to delete this production?"))try{await m.deleteProduction(a),S.success("Production deleted successfully"),await D(1)}catch(r){S.error(((o=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:o.message)??"Failed to delete production")}};return(a,t)=>(l(),i(g,null,[c(n(W),{title:"Production Management"}),c(ot,{breadcrumbs:E},{default:v(()=>[e("div",it,[e("div",dt,[e("div",ct,[c(n(w),{onClick:t[0]||(t[0]=o=>a.$inertia.visit(`/production/${x.activity_role}/create`)),class:"flex flex-shrink-0 items-center gap-2 rounded-md bg-indigo-600 px-3 py-2 text-sm font-medium text-white hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:v(()=>[c(n(at),{class:"h-4 w-4"}),t[3]||(t[3]=V(" Tambah Data "))]),_:1,__:[3]}),c(n(tt),{modelValue:b.value,"onUpdate:modelValue":t[1]||(t[1]=o=>b.value=o),placeholder:"Search...",class:"flex-1 text-sm",onKeyup:t[2]||(t[2]=X(o=>D(1),["enter"]))},null,8,["modelValue"])])]),n(f)?(l(),i("div",ut,"Loading...")):(l(),i("div",pt,[e("div",yt,[e("table",gt,[t[8]||(t[8]=e("thead",{class:"bg-gray-100 text-xs font-semibold uppercase text-gray-600 dark:bg-gray-800 dark:text-gray-300"},[e("tr",null,[e("th",{class:"px-3 py-2"},"Tanggal"),e("th",{class:"px-3 py-2"},"Size/Qty"),e("th",{class:"px-3 py-2"},"Price/PCS"),e("th",{class:"px-3 py-2"},"Total"),e("th",{class:"px-3 py-2 text-right"},"Actions")])],-1)),e("tbody",null,[(l(!0),i(g,null,P(Q.value,(o,r)=>(l(),i(g,{key:r},[e("tr",_t,[e("td",vt," ðŸ‘¤ "+d(o.employee_name||"-")+" â€” ðŸ§µ "+d(o.model_description||"-"),1)]),(l(!0),i(g,null,P(o.items,s=>{var u,z;return l(),i("tr",{key:s.id,class:"border-b border-gray-100 hover:bg-gray-50 dark:border-gray-700 dark:hover:bg-gray-800"},[e("td",mt,[V(d(s.created_at?new Date(s.created_at).toLocaleDateString():"-")+" ",1),t[4]||(t[4]=e("br",null,null,-1)),V(" "+d(((u=s.activity_role)==null?void 0:u.name)||"-"),1)]),e("td",ft,[(z=s.items)!=null&&z.length?(l(),i("div",xt,[(l(!0),i(g,null,P(s.items,(y,G)=>(l(),i("div",{key:G,class:"flex items-center justify-between rounded-md bg-white px-1.5 py-0.5 shadow-sm"},[e("span",null,d(y.size_id)+" - "+d(y.variant),1),e("span",bt,d(y.qty),1)]))),128))])):(l(),i("span",ht,"-"))]),e("td",kt,d(j((s==null?void 0:s.price_per_pcs)||0)),1),e("td",wt,d((s==null?void 0:s.total_price)||0),1),e("td",Pt,[e("div",St,[s.status===1||s.status===3?(l(),B(n(w),{key:0,variant:"ghost",size:"icon",class:"hover:bg-gray-100 dark:hover:bg-gray-700",onClick:y=>a.$inertia.visit(`/production/${s.activity_role_id}/edit/${s.id}`)},{default:v(()=>[c(n(rt),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):O("",!0),s.status===1||s.status===3?(l(),B(n(w),{key:1,variant:"ghost",size:"icon",class:"hover:bg-gray-100 dark:hover:bg-gray-700",onClick:y=>U(s.id)},{default:v(()=>[c(n(nt),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):O("",!0),c(n(w),{variant:"ghost",size:"icon",class:"hover:bg-gray-100 dark:hover:bg-gray-700",onClick:y=>a.$inertia.visit(`/production/${s.activity_role_id}/view/${s.id}`)},{default:v(()=>[c(n(lt),{class:"h-4 w-4"})]),_:2},1032,["onClick"])])])])}),128))],64))),128))]),e("tfoot",null,[e("tr",$t,[t[5]||(t[5]=e("td",{class:"px-3 py-2 text-right"},null,-1)),e("td",Ct,"Total Â :Â  "+d(A.value),1),t[6]||(t[6]=e("td",{class:"px-3 py-2"},null,-1)),e("td",Tt,d(j(K.value)),1),t[7]||(t[7]=e("td",null,null,-1))])])])]),e("div",Dt,[e("button",{onClick:M,disabled:n(p)===1||n(f),class:"rounded border border-gray-300 px-3 py-1 text-gray-700 hover:bg-gray-100 disabled:cursor-not-allowed disabled:opacity-50"}," Previous ",8,Vt),(l(!0),i(g,null,P(C.value,o=>(l(),i("button",{key:o,onClick:r=>T(o),class:Y(["rounded border px-3 py-1 text-sm",o===n(p)?"border-blue-600 bg-blue-600 text-white":"border-gray-300 text-gray-700 hover:bg-gray-100"]),disabled:n(f)},d(o),11,Ft))),128)),e("button",{onClick:L,disabled:n(p)===C.value||n(f),class:"rounded border border-gray-300 px-3 py-1 text-gray-700 hover:bg-gray-100 disabled:cursor-not-allowed disabled:opacity-50"}," Next ",8,It)])]))])]),_:1})],64))}});export{At as default};
