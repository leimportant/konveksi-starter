import{d as Y,r as c,q as Z,T as G,o as J,f as r,g as i,p as l,u as a,Z as O,x as M,k as s,F as h,B as z,z as k,j as p,N as R,C as m,l as W,U as X,D,V as N,y as T}from"./app-efsuWaun.js";import{_ as ee}from"./AppLayout.vue_vue_type_script_setup_true_lang-BYTOM3Vg.js";import{_ as S}from"./Input.vue_vue_type_script_setup_true_lang-Dyk-Rhdx.js";import{_ as B}from"./DateInput.vue_vue_type_script_setup_true_lang-CDhRXcpK.js";import{_ as te}from"./DocumentList.vue_vue_type_script_setup_true_lang-BVO_LMSa.js";import{d as ae,_ as se,a as oe,b as de,c as re}from"./index-04s-RgFU.js";import{u as ie}from"./useModelStore-b1-9oNTH.js";import{u as le}from"./useCategoryStore-7nLxIJap.js";import{u as ne}from"./useToast-NHW6HhW0.js";import"./index-Dn7aIggF.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BrAe7Yrn.js";import"./trash-D_OKupfJ.js";import"./useSizeStore-Dgp30EEm.js";import"./useProductStore-5YWP7bhy.js";import"./useMasterActivityRoleStore-aS09DDTX.js";import"./useUomStore-Dd258WqO.js";import"./vue3-select-CT0opolc.js";const me={class:"rounded-xl bg-white p-6 shadow-sm dark:bg-gray-800"},ue={class:"my-6 flex space-x-4 border-b dark:border-gray-700"},ce=["onClick"],pe={key:0,class:"space-y-6"},ve={key:0,class:"text-destructive"},_e=["value"],fe={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ye={key:0,class:"text-destructive"},ge={class:"hidden"},be={key:0,class:"text-destructive"},ke={class:"hidden"},xe={key:0,class:"text-destructive"},Ve={class:"hidden"},Me={key:0,class:"text-destructive"},he={key:1},Se={key:2},we={key:3,class:"space-y-6"},$e={key:4},Ue={key:5},Ce={class:"flex justify-end gap-2"},Ie="Model",Je=Y({__name:"UpdateModel",props:{modelId:{}},setup(j){const x=j,q=c(Number(x.modelId)).value??"",w=["model","size","activity","gambar","bahan dan biaya","hpp"],u=c(w[0]),d=c({}),$=le(),{items:F}=Z($),P=[{title:"Konveksi",href:"/konveksi"},{title:"Edit Model",href:`/konveksi/model/${x.modelId}/edit`}],U=ie(),v=ne(),A=n=>n.map(t=>({...t,product_id:typeof t.product_id=="object"?t.product_id.id:t.product_id})),o=G({description:"",category_id:null,remark:"",start_date:null,end_date:null,estimation_price_pcs:0,estimation_qty:1}),C=c([]),f=c([]),I=c(0),_=c([]),y=c([]),L=async()=>{var n,t,e,g,V;try{await U.updateModel(x.modelId,{...o,sizes:f.value,activity:_.value,documents:C.value,modelMaterials:A(y.value)}),v.success("Model berhasil diperbarui"),N.visit("/konveksi/model/list")}catch(b){if(((n=b.response)==null?void 0:n.status)===422&&((e=(t=b.response)==null?void 0:t.data)!=null&&e.errors)){d.value=b.response.data.errors;for(const H in d.value)d.value[H].forEach(Q=>{v.error(Q)})}else(V=(g=b.response)==null?void 0:g.data)!=null&&V.message?v.error(b.response.data.message):v.error("Terjadi kesalahan saat menyimpan model")}};J(async()=>{var n,t;try{Promise.all([$.fetchCategories()]);const e=await U.fetchModelById(x.modelId);console.log("Model Data:",e),e&&(o.description=e.data.description,o.remark=e.data.remark,o.start_date=e.data.start_date?E(e.data.start_date):"",o.end_date=e.data.end_date?E(e.data.end_date):"",o.estimation_price_pcs=e.data.estimation_price_pcs,o.estimation_qty=e.data.estimation_qty,o.category_id=e.data.category_id,f.value=e.data.sizes||[],_.value=e.data.activities||[],C.value=e.data.documents||[],y.value=e.data.model_material||[])}catch(e){(t=(n=e.response)==null?void 0:n.data)!=null&&t.errors?(d.value=e.response.data.errors,v.error("Validasi gagal, silakan periksa form")):v.error("Terjadi kesalahan saat membuat model")}window.addEventListener("popstate",()=>{ae.Inertia.visit(window.location.href,{preserveState:!0})})});const K=n=>{const t=_.value.find(e=>e.activity_role_id===n);return(t==null?void 0:t.activity_name)||`Activity ${n}`};function E(n){const t=new Date(n),e=t.getFullYear(),g=String(t.getMonth()+1).padStart(2,"0"),V=String(t.getDate()).padStart(2,"0");return`${e}-${g}-${V}`}return(n,t)=>(i(),r(h,null,[l(a(O),{title:"Edit Model"}),l(ee,{breadcrumbs:P},{default:M(()=>[s("div",me,[t[20]||(t[20]=s("div",{class:"border-b pb-4"},[s("h1",{class:"text-2xl font-semibold text-gray-900 dark:text-white"},"Edit Model"),s("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Edit data model, ukuran, dan aktivitas")],-1)),s("div",ue,[(i(),r(h,null,z(w,e=>s("button",{key:e,class:k(["pb-2 text-sm font-medium",{"border-b-2 border-primary text-primary":u.value===e,"text-gray-500 hover:text-gray-700":u.value!==e}]),onClick:g=>u.value=e},p(e.charAt(0).toUpperCase()+e.slice(1)),11,ce)),64))]),s("form",{onSubmit:R(L,["prevent"]),class:"space-y-6"},[u.value==="model"?(i(),r("div",pe,[s("div",null,[t[11]||(t[11]=s("label",{for:"description",class:"text-sm font-medium"},"Nama Model",-1)),l(a(S),{id:"description",modelValue:a(o).description,"onUpdate:modelValue":t[0]||(t[0]=e=>a(o).description=e),placeholder:""},null,8,["modelValue"]),d.value.description?(i(),r("small",ve,p(d.value.description[0]),1)):m("",!0)]),s("div",null,[t[13]||(t[13]=s("label",{for:"category_id",class:"block mb-1 font-medium"},"Kategori",-1)),W(s("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>a(o).category_id=e),class:"w-full text-xs rounded-md border border-input px-3 py-2",required:""},[t[12]||(t[12]=s("option",{value:"0"},"Select Category",-1)),(i(!0),r(h,null,z(a(F),e=>(i(),r("option",{key:e.id,value:e.id},p(e.name),9,_e))),128))],512),[[X,a(o).category_id]])]),s("div",fe,[s("div",null,[t[14]||(t[14]=s("label",{for:"start_date",class:"text-sm font-medium"},"Tanggal Mulai",-1)),l(a(B),{modelValue:a(o).start_date,"onUpdate:modelValue":t[2]||(t[2]=e=>a(o).start_date=e),id:"start_date",class:k({"border-destructive":d.value.start_date})},null,8,["modelValue","class"]),d.value.start_date?(i(),r("small",ye,p(d.value.start_date[0]),1)):m("",!0)]),s("div",ge,[t[15]||(t[15]=s("label",{for:"end_date",class:"text-sm font-medium"},"Estimasi Selesai",-1)),l(a(B),{modelValue:a(o).end_date,"onUpdate:modelValue":t[3]||(t[3]=e=>a(o).end_date=e),id:"end_date",class:k({"border-destructive":d.value.end_date})},null,8,["modelValue","class"]),d.value.end_date?(i(),r("small",be,p(d.value.end_date[0]),1)):m("",!0)]),s("div",ke,[t[16]||(t[16]=s("label",{for:"estimation_price_pcs",class:"text-sm font-medium"},"Estimasi Harga",-1)),l(a(S),{type:"number",modelValue:a(o).estimation_price_pcs,"onUpdate:modelValue":t[4]||(t[4]=e=>a(o).estimation_price_pcs=e),id:"estimation_price_pcs",class:k({"border-destructive":d.value.estimation_price_pcs})},null,8,["modelValue","class"]),d.value.estimation_price_pcs?(i(),r("small",xe,p(d.value.estimation_price_pcs[0]),1)):m("",!0)])]),s("div",Ve,[t[17]||(t[17]=s("label",{for:"remark",class:"text-sm font-medium"},"Catatan",-1)),l(a(S),{modelValue:a(o).remark,"onUpdate:modelValue":t[5]||(t[5]=e=>a(o).remark=e),id:"remark",placeholder:"",class:k({"border-destructive":d.value.remark})},null,8,["modelValue","class"]),d.value.remark?(i(),r("small",Me,p(d.value.remark[0]),1)):m("",!0)])])):m("",!0),u.value==="size"?(i(),r("div",he,[l(se,{modelValue:f.value,"onUpdate:modelValue":t[6]||(t[6]=e=>f.value=e),"onUpdate:totalQuantity":t[7]||(t[7]=e=>I.value=e)},null,8,["modelValue"])])):m("",!0),u.value==="activity"?(i(),r("div",Se,[l(oe,{modelValue:_.value,"onUpdate:modelValue":t[8]||(t[8]=e=>_.value=e)},null,8,["modelValue"])])):m("",!0),u.value==="gambar"?(i(),r("div",we,[l(te,{"reference-id":a(q),"reference-type":Ie},null,8,["reference-id"])])):m("",!0),u.value==="bahan dan biaya"?(i(),r("div",$e,[l(de,{modelValue:y.value,"onUpdate:modelValue":t[9]||(t[9]=e=>y.value=e)},null,8,["modelValue"])])):m("",!0),u.value==="hpp"?(i(),r("div",Ue,[l(re,{"model-materials":y.value,"activity-items":_.value.map(e=>({...e,activity_name:K(e.activity_role_id)})),"start-date":a(o).start_date,"end-date":a(o).end_date,"total-production":I.value,"size-items":f.value.map(e=>({...e}))},null,8,["model-materials","activity-items","start-date","end-date","total-production","size-items"])])):m("",!0),s("div",Ce,[l(a(D),{type:"button",class:"bg-amber-600 text-white h-10 rounded-md hover:bg-amber-700",variant:"outline",onClick:t[10]||(t[10]=e=>a(N).visit("/konveksi/model/list"))},{default:M(()=>t[18]||(t[18]=[T(" Batal ")])),_:1,__:[18]}),l(a(D),{type:"submit",class:"bg-indigo-600 text-white py-2 h-10 rounded-md hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:M(()=>t[19]||(t[19]=[T("Simpan Perubahan")])),_:1,__:[19]})])],32)])]),_:1})],64))}});export{Je as default};
