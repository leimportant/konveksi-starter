import{d as J,aR as L,r as w,T as W,w as Z,o as q,b as h,f as p,g as c,p as o,u as t,Z as K,x as a,k as n,y as _,C as g,j as m,F as P,B as U,E as Q,l as z,O as T,D as S,P as B}from"./app-OChygklg.js";import{_ as X}from"./AppLayout.vue_vue_type_script_setup_true_lang-BfK2xR03.js";import{_ as $}from"./Input.vue_vue_type_script_setup_true_lang-CJBXtHtF.js";import{_ as C}from"./Label.vue_vue_type_script_setup_true_lang-RJl65WDX.js";import{_ as Y,a as ee,b as E,c as y,d as te,e as b}from"./TableRow.vue_vue_type_script_setup_true_lang-DKI-NP62.js";import{u as re}from"./useToast-BxESZ6ul.js";import{A as oe}from"./vue3-select-DXZ1nXCV.js";import{u as se}from"./useProductPriceStore-BobLGHN2.js";import{T as ie}from"./trash-2-CmXolHew.js";import"./index-BXtxs2U3.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CIb7ob0q.js";const de={class:"p-6 space-y-6"},ae={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},le={key:0,class:"text-red-600 text-sm mt-1"},ue={key:0,class:"text-red-600 text-sm mt-1"},ce={class:"border rounded p-4"},pe=["onUpdate:modelValue","id","onChange"],ne=["value"],_e={key:0,class:"text-red-600 text-xs mt-1"},fe=["onUpdate:modelValue","id","onChange"],me=["value"],ve={key:0,class:"text-red-600 text-xs mt-1"},ge={key:0,class:"text-red-600 text-xs mt-1"},ye={key:0,class:"text-red-600 text-xs mt-1"},be={key:0,class:"text-red-600 text-xs mt-1"},$e={class:"flex justify-end gap-2 mt-4"},ze=J({__name:"Update",props:{id:{}},setup(R){const f=re(),k=R,j=[{title:"Edit Product Prices",href:`/product-prices/${k.id}/edit`}],u=L({}),V=w([]),D=w([]),M=w([]),I=w([]),i=W({product_id:void 0,effective_date:new Date().toISOString().split("T")[0],cost_price:0,product_price:[]}),x=se();Z(()=>i.product_price,s=>{s.forEach(e=>{e.price_sell=e.price-e.discount})},{deep:!0,immediate:!0}),q(async()=>{await O(),await H()});const O=async()=>{try{const[s,e,l]=await Promise.all([h.get("/api/price-types"),h.get("/api/uoms"),h.get("/api/sizes")]);D.value=s.data.data,M.value=e.data.data,I.value=l.data.data}catch(s){f.error("Gagal mengambil data dropdown"),console.error(s)}},H=async()=>{try{const s=await x.fetchProductPriceById(k.id);if(console.log("Fetched data:",s),!s){f.error("Data produk tidak ditemukan");return}i.product_id=s.product??null,i.effective_date=s.effective_date?new Date(s.effective_date).toISOString().slice(0,10):"",i.effective_date||(i.effective_date=new Date().toISOString().slice(0,10)),i.cost_price=s.cost_price??0,i.product_price=s.price_types??[],V.value=s.product?[s.product]:[]}catch(s){f.error("Gagal memuat data"),console.error(s)}},N=async s=>{if(s.length<2){V.value=[];return}try{const e=await h.get("/api/products",{params:{search:s}});V.value=e.data.data}catch(e){console.error("Search error:",e),f.error("Failed to search products")}},A=s=>{i.product_price.length>1?i.product_price.splice(s,1):f.error("Setidaknya harus ada satu baris harga")},F=()=>{i.product_price.push({price_type_id:void 0,size_id:"",price:0,discount:0,price_sell:0})},v=s=>{Object.keys(u).forEach(e=>{(e===s||e.startsWith(s+"."))&&delete u[e]})},G=async()=>{var l;if(!i.product_id){f.error("Product must be selected");return}for(const[r,d]of i.product_price.entries())if(!d.price_type_id||!d.size_id){f.error(`Lengkapi semua field pada baris harga ke-${r+1}`);return}const s=typeof i.product_id=="object"?i.product_id.id:i.product_id,e=i.product_price.map(r=>({price_id:k.id,product_id:s,price_type_id:r.price_type_id,size_id:r.size_id,price:r.price,discount:r.discount,price_sell:(r.price??0)-(r.discount??0)}));console.log("Submitting data:",{product_id:s,effective_date:i.effective_date,cost_price:i.cost_price,price_types:e});try{await x.updateProductPrice(k.id,{product_id:s,effective_date:i.effective_date,cost_price:i.cost_price,price_types:e}),f.success("Data updated successfully"),B.visit("/product-prices")}catch(r){((l=r.response)==null?void 0:l.status)===422?(Object.assign(u,r.response.data.errors),f.error("Periksa kesalahan input dan coba lagi")):(console.error("Submit error:",r),f.error("Gagal memperbarui data"))}};return(s,e)=>(c(),p(P,null,[o(t(K),{title:"Edit Product Prices"}),o(X,{breadcrumbs:j},{default:a(()=>[n("div",de,[n("div",ae,[n("div",null,[o(t(C),{for:"product_id"},{default:a(()=>e[6]||(e[6]=[_("Produk")])),_:1,__:[6]}),o(t(oe),{modelValue:t(i).product_id,"onUpdate:modelValue":e[0]||(e[0]=l=>t(i).product_id=l),options:V.value,label:"name",value:"id",onSearch:N,placeholder:"Search a product",disabled:!0},null,8,["modelValue","options"])]),n("div",null,[o(t(C),{for:"effective_date"},{default:a(()=>e[7]||(e[7]=[_("Tanggal Berlaku")])),_:1,__:[7]}),o(t($),{type:"date",modelValue:t(i).effective_date,"onUpdate:modelValue":e[1]||(e[1]=l=>t(i).effective_date=l),id:"effective_date",onInput:e[2]||(e[2]=l=>v("effective_date"))},null,8,["modelValue"]),u.effective_date?(c(),p("p",le,m(u.effective_date),1)):g("",!0)]),n("div",null,[o(t(C),{for:"cost_price"},{default:a(()=>e[8]||(e[8]=[_("Harga Pokok")])),_:1,__:[8]}),o(t($),{type:"number",modelValue:t(i).cost_price,"onUpdate:modelValue":e[3]||(e[3]=l=>t(i).cost_price=l),modelModifiers:{number:!0},id:"cost_price",onInput:e[4]||(e[4]=l=>v("cost_price"))},null,8,["modelValue"]),u.cost_price?(c(),p("p",ue,m(u.cost_price),1)):g("",!0)])]),n("div",ce,[e[18]||(e[18]=n("div",{class:"font-semibold text-lg mb-4"},"Detail Harga",-1)),o(t(Y),null,{default:a(()=>[o(t(ee),null,{default:a(()=>[o(t(E),null,{default:a(()=>[o(t(y),null,{default:a(()=>e[9]||(e[9]=[_("Jenis Harga")])),_:1,__:[9]}),o(t(y),null,{default:a(()=>e[10]||(e[10]=[_("Ukuran")])),_:1,__:[10]}),o(t(y),null,{default:a(()=>e[11]||(e[11]=[_("Harga")])),_:1,__:[11]}),o(t(y),null,{default:a(()=>e[12]||(e[12]=[_("Discount")])),_:1,__:[12]}),o(t(y),null,{default:a(()=>e[13]||(e[13]=[_("Harga Jual")])),_:1,__:[13]}),o(t(y),null,{default:a(()=>e[14]||(e[14]=[_("Actions")])),_:1,__:[14]})]),_:1})]),_:1}),o(t(te),null,{default:a(()=>[(c(!0),p(P,null,U(t(i).product_price,(l,r)=>(c(),Q(t(E),{key:r,class:"hover:bg-gray-50"},{default:a(()=>[o(t(b),null,{default:a(()=>[z(n("select",{"onUpdate:modelValue":d=>l.price_type_id=d,id:`price_type_id_${r}`,class:"w-full border rounded p-1",onChange:d=>v(`product_price.${r}.price_type_id`)},[e[15]||(e[15]=n("option",{value:"",disabled:""},"Pilih jenis harga",-1)),(c(!0),p(P,null,U(D.value,d=>(c(),p("option",{key:d.id,value:d.id},m(d.name),9,ne))),128))],40,pe),[[T,l.price_type_id,void 0,{number:!0}]]),u[`product_price.${r}.price_type_id`]?(c(),p("p",_e,m(u[`product_price.${r}.price_type_id`]),1)):g("",!0)]),_:2},1024),o(t(b),null,{default:a(()=>[z(n("select",{"onUpdate:modelValue":d=>l.size_id=d,id:`size_id_${r}`,class:"w-full border rounded p-1",onChange:d=>v(`product_price.${r}.size_id`)},[e[16]||(e[16]=n("option",{value:"",disabled:""},"Pilih ukuran",-1)),(c(!0),p(P,null,U(I.value,d=>(c(),p("option",{key:d.id,value:d.id},m(d.name),9,me))),128))],40,fe),[[T,l.size_id,void 0,{number:!0}]]),u[`product_price.${r}.size_id`]?(c(),p("p",ve,m(u[`product_price.${r}.size_id`]),1)):g("",!0)]),_:2},1024),o(t(b),null,{default:a(()=>[o(t($),{type:"number",modelValue:l.price,"onUpdate:modelValue":d=>l.price=d,modelModifiers:{number:!0},id:`price_${r}`,onInput:d=>v(`product_price.${r}.price`),class:"w-full"},null,8,["modelValue","onUpdate:modelValue","id","onInput"]),u[`product_price.${r}.price`]?(c(),p("p",ge,m(u[`product_price.${r}.price`]),1)):g("",!0)]),_:2},1024),o(t(b),null,{default:a(()=>[o(t($),{type:"number",modelValue:l.discount,"onUpdate:modelValue":d=>l.discount=d,modelModifiers:{number:!0},id:`discount_${r}`,onInput:d=>v(`product_price.${r}.discount`),class:"w-full"},null,8,["modelValue","onUpdate:modelValue","id","onInput"]),u[`product_price.${r}.discount`]?(c(),p("p",ye,m(u[`product_price.${r}.discount`]),1)):g("",!0)]),_:2},1024),o(t(b),null,{default:a(()=>[o(t($),{type:"number",readonly:"",modelValue:l.price_sell,"onUpdate:modelValue":d=>l.price_sell=d,modelModifiers:{number:!0},id:`price_sell_${r}`,onInput:d=>v(`product_price.${r}.price_sell`),class:"w-full"},null,8,["modelValue","onUpdate:modelValue","id","onInput"]),u[`product_price.${r}.price_sell`]?(c(),p("p",be,m(u[`product_price.${r}.price_sell`]),1)):g("",!0)]),_:2},1024),o(t(b),{class:"text-center"},{default:a(()=>[o(t(S),{variant:"ghost",size:"icon",onClick:d=>A(r)},{default:a(()=>[o(t(ie),{class:"h-4 w-4"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),o(t(S),{onClick:F,variant:"outline",class:"bg-indigo-600 text-white py-2 h-10 rounded-md hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:a(()=>e[17]||(e[17]=[_("Add")])),_:1,__:[17]})]),n("div",$e,[o(t(S),{onClick:G,class:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600",disabled:t(i).processing},{default:a(()=>e[19]||(e[19]=[_("Update")])),_:1,__:[19]},8,["disabled"]),o(t(S),{onClick:e[5]||(e[5]=l=>t(B).visit("/product-prices")),type:"button",class:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600"},{default:a(()=>e[20]||(e[20]=[_(" Cancel ")])),_:1,__:[20]})])])]),_:1})],64))}});export{ze as default};
