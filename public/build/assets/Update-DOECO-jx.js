import{d as B,q as F,r as _,T as $,w as A,o as I,f as c,g as u,p as z,u as p,Z as R,x as T,k as o,C as q,y as D,j as x,l as h,F as g,B as N,W as E,m as k,N as j}from"./app-ES40TwV8.js";import{u as L}from"./useToast-3q3NZr1O.js";import{u as Q}from"./useProductionStore-dJz42lLg.js";import{u as W}from"./useModelStore-CjHVpO0o.js";import{u as Z}from"./useMasterActivityRoleStore-rJUYw2i9.js";import{_ as G}from"./AppLayout.vue_vue_type_script_setup_true_lang-CRvYir_q.js";import"./index-P5wiNW0v.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CjluVPN9.js";const H={class:"p-4 md:p-6 space-y-4 md:space-y-6"},J={class:"text-xl md:text-2xl font-bold"},K={key:0},O={class:"w-full"},X=["value"],Y={key:0,class:"overflow-x-auto"},tt={class:"w-full table-auto border text-sm md:"},et={class:"border px-2 md:px-3 py-1 md:py-2"},ot={class:"border px-2 md:px-3 py-1 md:py-2"},it=["onUpdate:modelValue"],st={class:"border px-2 md:px-3 py-1 md:py-2"},dt=["onUpdate:modelValue"],at={class:"flex gap-2"},rt=["disabled"],vt=B({__name:"Update",props:{id:{},activity_role:{}},setup(M){const v=L(),w=Q(),f=W(),V=Z(),{models:C}=F(f),m=M,y=_(null),r=_([]),b=_(null),s=$({id:null,model_id:null,activity_role_id:Number(m.activity_role),items:[]}),P=async()=>{try{const i=await w.fetchProductionsById(m.id);if(!i)throw new Error("No production data received");s.id=i.id,s.model_id=i.model_id,s.activity_role_id=i.activity_role_id,y.value=i.model_id,Array.isArray(i.items)?(r.value=i.items.map(t=>({size_id:String(t.size_id),size_name:t.size.name,qty:t.qty})),s.items=i.items.map(t=>({size_id:String(t.size_id),qty:t.qty||0,variant:t.variant||""}))):(r.value=[],s.items=[])}catch(i){console.error("Failed to fetch production data",i),v.error("Failed to fetch production data"),r.value=[],s.items=[]}},S=_(!0);A(y,async i=>{if(!(!i||S.value))try{const t=await f.fetchModelById(Number(i));if(!t)throw new Error("No model data received");s.model_id=t.id;const d=[...s.items];Array.isArray(t.sizes)?(r.value=t.sizes.map(e=>{var l;return{size_id:String(e.id),size_name:e.name,qty:((l=d.find(n=>n.size_id===String(e.id)))==null?void 0:l.qty)||0}}),s.items=t.sizes.map(e=>{var l,n;return{size_id:String(e.id),qty:((l=d.find(a=>a.size_id===String(e.id)))==null?void 0:l.qty)||0,variant:((n=d.find(a=>a.size_id===String(e.id)))==null?void 0:n.variant)||""}})):(r.value=[],s.items=[])}catch(t){console.error("Failed to fetch model sizes",t),r.value=[],s.items=[]}}),I(async()=>{await f.fetchModels(1,"N");try{const i=await V.getActivityRoleById(Number(m.activity_role));b.value=i}catch(i){console.error("Failed to fetch activity role",i)}await P(),S.value=!1});const U=async()=>{var i,t;try{await w.updateProduction(String(s.id),{model_id:s.model_id,activity_role_id:s.activity_role_id,items:s.items.filter(d=>d.qty>0)}),v.success("Production updated successfully"),window.location.href=`/production/${s.activity_role_id}`}catch(d){v.error(((t=(i=d==null?void 0:d.response)==null?void 0:i.data)==null?void 0:t.message)??"Failed to update production")}};return(i,t)=>(u(),c(g,null,[z(p(R),{title:"Update Production"}),z(G,{breadcrumbs:[{title:"Production",href:`/production/${m.activity_role}`}]},{default:T(()=>{var d;return[o("div",H,[o("h1",J,[t[2]||(t[2]=D(" Update Production")),b.value?(u(),c("span",K," - "+x((d=b.value)==null?void 0:d.name),1)):q("",!0)]),o("div",O,[t[4]||(t[4]=o("label",{class:"block font-medium mb-1"},"Select Model",-1)),h(o("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>y.value=e),class:"border p-2 rounded w-full text-sm md:"},[t[3]||(t[3]=o("option",{disabled:"",value:""},"-- Choose a model --",-1)),(u(!0),c(g,null,N(p(C),e=>(u(),c("option",{key:e.id,value:e.id},x(e.description),9,X))),128))],512),[[E,y.value]])]),r.value.length>0?(u(),c("div",Y,[t[6]||(t[6]=o("h2",{class:"font-semibold mb-2"},"Model Sizes",-1)),o("table",tt,[t[5]||(t[5]=o("thead",null,[o("tr",{class:"bg-gray-100"},[o("th",{class:"border px-2 md:px-3 py-1 md:py-2 text-left"},"Size"),o("th",{class:"border px-2 md:px-3 py-1 md:py-2 text-left"},"Variant"),o("th",{class:"border px-2 md:px-3 py-1 md:py-2 text-left"},"Qty")])],-1)),o("tbody",null,[(u(!0),c(g,null,N(p(s).items,(e,l)=>{var n;return u(),c("tr",{key:`size-${l}-${e.size_id}`},[o("td",et,x(((n=r.value.find(a=>a.size_id===e.size_id))==null?void 0:n.size_name)||e.size_id),1),o("td",ot,[h(o("input",{type:"text",class:"border rounded px-2 py-1 w-full","onUpdate:modelValue":a=>e.variant=a},null,8,it),[[k,e.variant]])]),o("td",st,[h(o("input",{type:"number",min:"0",class:"border rounded px-2 py-1 w-full","onUpdate:modelValue":a=>e.qty=a},null,8,dt),[[k,e.qty,void 0,{number:!0}]])])])}),128))])])])):q("",!0),o("div",at,[o("button",{onClick:U,class:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",disabled:p(s).processing}," Save ",8,rt),o("button",{onClick:t[1]||(t[1]=e=>p(j).visit(`/production/${m.activity_role}`)),type:"button",class:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600"}," Cancel ")])])]}),_:1},8,["breadcrumbs"])],64))}});export{vt as default};
