import{U as ne,b as B,d as re,r as x,T as ie,q as O,c as de,o as ue,f as b,g as f,p as o,u as a,Z as me,x as r,k as s,C as q,D as h,y as m,V as ce,F as C,B as S,E as fe,j as _,z as be,R as D,l as A,W as R}from"./app-CXQrq815.js";import{_ as ve}from"./AppLayout.vue_vue_type_script_setup_true_lang-BPL71yRy.js";import{_ as T}from"./Input.vue_vue_type_script_setup_true_lang-DGd_ITcx.js";import{_ as pe,a as he,b as G,c as N,d as ge,e as V}from"./TableRow.vue_vue_type_script_setup_true_lang-CB8vXp8j.js";import{u as ye}from"./useToast-CYwMU27Y.js";import{u as xe}from"./useCategoryStore-DY1dopyh.js";import{u as _e}from"./useUomStore-BBeJr9Zp.js";import{d as we}from"./debounce-BcZQbp_F.js";import{P as ke}from"./plus-BBD62aOn.js";import{S as Be}from"./square-pen-F_m6MUIh.js";import{T as Ce}from"./trash-2-Dw-na9R7.js";import"./index-CIvoTlmE.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-DaAYrWdr.js";const Pe=ne("bahan",{state:()=>({items:[],total:0,loaded:!1,loading:!1,currentPage:1,filterName:""}),actions:{async fetchBahans(d=1,l=10){const v={page:d,perPage:l,search:this.filterName};this.loaded=!1,this.currentPage=d;try{const p=await B.get("/api/bahan",{params:v});this.items=p.data.data,this.total=p.data.total,this.currentPage=d,this.loaded=!0}catch(p){throw console.error("Failed to fetch products:",p),p}},setFilter(d,l){(d==="search"||d==="name")&&(this.filterName=l,this.currentPage=1,this.loaded=!1,this.fetchBahans(1))},async fetchBahanById(d){try{return(await B.get(`/api/bahan/${d}`)).data}catch(l){throw console.error("Failed to fetch product by ID:",l),l}},async createBahan(d){try{await B.post("/api/bahan",{name:d.name,category_id:0,uom_id:d.uom_id}),this.loaded=!1,await this.fetchBahans()}catch(l){throw console.error("Failed to create product:",l),l}},async updateBahan(d,l){try{await B.put(`/api/bahan/${d}`,l),this.loaded=!1,await this.fetchBahans(this.currentPage)}catch(v){throw console.error("Failed to update product:",v),v}},async deleteProduct(d){try{await B.delete(`/api/bahan/${d}`),this.loaded=!1,await this.fetchBahans(this.currentPage)}catch(l){throw console.error("Failed to delete product:",l),l}}}}),Ue={class:"px-4 py-4"},$e={class:"flex justify-between items-center gap-2 mb-2"},Me={class:"rounded-md border"},Se={class:"flex justify-end mt-4 space-x-2"},Ne=["disabled"],Ve=["onClick"],je=["disabled"],Fe={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},qe={class:"relative bg-white p-6 rounded-lg shadow-xl w-full max-w-sm md:max-w-md lg:max-w-lg xl:max-w-4xl max-h-[90vh] overflow-y-auto"},Te={class:"flex justify-between items-center mb-4"},ze={class:"mt-4 flex justify-end"},Ee={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Ie={class:"bg-white p-6 rounded-lg w-[1000px]"},Oe={class:"space-y-4"},De=["value"],Ae={class:"flex justify-end gap-2 mt-4"},Re={key:2,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Ge={class:"bg-white p-6 rounded-lg w-[1000px]"},Le={class:"space-y-4"},We=["value"],Ye={class:"flex justify-end gap-2 mt-4"},L=10,rt=re({__name:"Index",setup(d){const l=ye(),v=x(!1),p=x(!1),P=x(!1),U=x(null),i=ie({name:"",uom_id:""}),W=[{title:"Bahan",href:"/bahans"}],g=Pe(),Y=xe(),z=_e(),{items:E,total:Z,loading:H,filterName:j}=O(g),{items:F}=O(z),u=x(1),I=x(0),$=de(()=>Math.ceil(I.value/L)),w=async n=>{await g.fetchBahans(n,L),I.value=Z.value||0,u.value=n};ue(async()=>{await Promise.all([Y.fetchCategories(),z.fetchUoms()]),await w(u.value)});const M=async n=>{n<1||n>$.value||await w(n)},J=async()=>{u.value<$.value&&await M(u.value+1)},K=async()=>{u.value>1&&await M(u.value-1)},Q=we((n,e)=>{g.setFilter(n,e)},400),X=n=>{const e=n.target;Q("name",e.value)},ee=async()=>{var n,e,t,c;if(!i.name)return l.error("Name is required");if(!i.uom_id)return l.error("UOM is required");try{await g.createBahan({name:i.name,uom_id:i.uom_id}),l.success("Bahan berhasil di buat"),i.reset(),v.value=!1,await w(u.value)}catch(y){const k=(c=(t=(e=(n=y==null?void 0:y.response)==null?void 0:n.data)==null?void 0:e.errors)==null?void 0:t.name)==null?void 0:c[0];l.error(k||"Gagal buat data")}},te=n=>{U.value=n,i.name=n.name,i.uom_id=n.uom_id,P.value=!0},ae=async()=>{var e,t,c,y;if(!U.value||!i.name)return l.error("Name is required");if(!i.uom_id)return l.error("UOM is required");const n=U.value.id;try{await g.updateBahan(n,{name:i.name,uom_id:i.uom_id}),l.success("Bahan berhasil di update"),i.reset(),P.value=!1,U.value=null,await w(u.value)}catch(k){const le=(y=(c=(t=(e=k==null?void 0:k.response)==null?void 0:e.data)==null?void 0:t.errors)==null?void 0:c.name)==null?void 0:y[0];l.error(le||"Gagal buat data")}},se=async n=>{var e,t;if(confirm("Yakin mau delete data Bahan?"))try{await g.deleteProduct(n),l.success("Bahan deleted successfully"),E.value.length===1&&u.value>1?await M(u.value-1):await w(u.value)}catch(c){l.error(((t=(e=c==null?void 0:c.response)==null?void 0:e.data)==null?void 0:t.message)??"Failed to delete Bahan")}},oe=n=>{const e=F.value.find(t=>t.id===n);return(e==null?void 0:e.name)||"N/A"};return(n,e)=>(f(),b(C,null,[o(a(me),{title:"Bahan Management"}),o(ve,{breadcrumbs:W},{default:r(()=>[s("div",Ue,[s("div",$e,[o(a(h),{onClick:e[0]||(e[0]=t=>v.value=!0),class:"bg-indigo-600 text-white py-2 h-10 rounded-md hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:r(()=>[o(a(ke),{class:"h-4 w-4"}),e[10]||(e[10]=m(" Add "))]),_:1,__:[10]}),o(a(T),{modelValue:a(j),"onUpdate:modelValue":e[1]||(e[1]=t=>ce(j)?j.value=t:null),placeholder:"Search",onInput:X,class:"w-64","aria-label":"Search",disabled:a(H)},null,8,["modelValue","disabled"])]),s("div",Me,[o(a(pe),null,{default:r(()=>[o(a(he),null,{default:r(()=>[o(a(G),{class:"bg-gray-100"},{default:r(()=>[o(a(N),null,{default:r(()=>e[11]||(e[11]=[m("ID")])),_:1,__:[11]}),o(a(N),null,{default:r(()=>e[12]||(e[12]=[m("Name")])),_:1,__:[12]}),o(a(N),null,{default:r(()=>e[13]||(e[13]=[m("UOM")])),_:1,__:[13]}),o(a(N),{class:"w-24"},{default:r(()=>e[14]||(e[14]=[m("Actions")])),_:1,__:[14]})]),_:1})]),_:1}),o(a(ge),null,{default:r(()=>[(f(!0),b(C,null,S(a(E),t=>(f(),fe(a(G),{key:t.id},{default:r(()=>[o(a(V),null,{default:r(()=>[m(_(t.id),1)]),_:2},1024),o(a(V),null,{default:r(()=>[m(_(t.name),1)]),_:2},1024),o(a(V),null,{default:r(()=>[m(_(oe(t.uom_id)),1)]),_:2},1024),o(a(V),{class:"flex gap-2"},{default:r(()=>[o(a(h),{variant:"ghost",size:"icon",onClick:c=>te(t)},{default:r(()=>[o(a(Be),{class:"h-4 w-4"})]),_:2},1032,["onClick"]),o(a(h),{variant:"ghost",size:"icon",onClick:c=>se(t.id)},{default:r(()=>[o(a(Ce),{class:"h-4 w-4"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),s("div",Se,[s("button",{onClick:K,disabled:u.value===1,class:"px-3 py-1 rounded border border-gray-300 text-gray-700 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed"}," Previous ",8,Ne),(f(!0),b(C,null,S($.value,t=>(f(),b("button",{key:t,onClick:c=>M(t),class:be(["px-3 py-1 rounded border text-xs",t===u.value?"bg-blue-600 border-blue-600 text-white":"border-gray-300 text-gray-700 hover:bg-gray-100"])},_(t),11,Ve))),128)),s("button",{onClick:J,disabled:u.value===$.value,class:"px-3 py-1 rounded border border-gray-300 text-gray-700 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed"}," Next ",8,je)]),p.value?(f(),b("div",Fe,[s("div",qe,[s("div",Te,[e[16]||(e[16]=s("h2",{class:"text-lg font-semibold"},"Upload Media",-1)),s("button",{onClick:e[2]||(e[2]=t=>p.value=!1),class:"text-gray-500 hover:text-gray-800 transition p-1 rounded-full hover:bg-gray-100","aria-label":"Tutup modal"},e[15]||(e[15]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),s("div",ze,[o(a(h),{onClick:e[3]||(e[3]=t=>p.value=!1),variant:"outline"},{default:r(()=>e[17]||(e[17]=[m("Tutup")])),_:1,__:[17]})])])])):q("",!0),v.value?(f(),b("div",Ee,[s("div",Ie,[e[23]||(e[23]=s("h2",{class:"text-lg font-semibold mb-4"},"Buat Bahan Baru",-1)),s("form",{onSubmit:D(ee,["prevent"])},[s("div",Oe,[s("div",null,[e[18]||(e[18]=s("label",{class:"block text-xs font-medium mb-1"},"Name",-1)),o(a(T),{modelValue:a(i).name,"onUpdate:modelValue":e[4]||(e[4]=t=>a(i).name=t),placeholder:"Bahan",class:"text-xs",required:""},null,8,["modelValue"])]),s("div",null,[e[20]||(e[20]=s("label",{class:"block text-xs font-medium mb-1"},"UOM",-1)),A(s("select",{"onUpdate:modelValue":e[5]||(e[5]=t=>a(i).uom_id=t),class:"w-full rounded-md border text-xs border-input px-3 py-2",required:""},[e[19]||(e[19]=s("option",{value:""},"Select UOM",-1)),(f(!0),b(C,null,S(a(F),t=>(f(),b("option",{key:t.id,value:t.id},_(t.name),9,De))),128))],512),[[R,a(i).uom_id]])])]),s("div",Ae,[o(a(h),{type:"button",variant:"outline",onClick:e[6]||(e[6]=t=>v.value=!1),class:"h-10"},{default:r(()=>e[21]||(e[21]=[m("Cancel")])),_:1,__:[21]}),o(a(h),{type:"submit",class:"bg-indigo-600 text-white py-2 h-10 rounded-md hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:r(()=>e[22]||(e[22]=[m("Create")])),_:1,__:[22]})])],32)])])):q("",!0),P.value?(f(),b("div",Re,[s("div",Ge,[e[29]||(e[29]=s("h2",{class:"text-lg font-semibold mb-4"},"Edit Product",-1)),s("form",{onSubmit:D(ae,["prevent"])},[s("div",Le,[s("div",null,[e[24]||(e[24]=s("label",{class:"block text-xs font-medium mb-1"},"Name",-1)),o(a(T),{modelValue:a(i).name,"onUpdate:modelValue":e[7]||(e[7]=t=>a(i).name=t),placeholder:"Bahan",class:"text-xs",required:""},null,8,["modelValue"])]),s("div",null,[e[26]||(e[26]=s("label",{class:"block text-xs font-medium mb-1"},"UOM",-1)),A(s("select",{"onUpdate:modelValue":e[8]||(e[8]=t=>a(i).uom_id=t),class:"w-full text-xs rounded-md border border-input px-3 py-2",required:""},[e[25]||(e[25]=s("option",{value:""},"Select UOM",-1)),(f(!0),b(C,null,S(a(F),t=>(f(),b("option",{key:t.id,value:t.id},_(t.name),9,We))),128))],512),[[R,a(i).uom_id]])])]),s("div",Ye,[o(a(h),{type:"button",variant:"outline",onClick:e[9]||(e[9]=t=>P.value=!1),class:"h-10"},{default:r(()=>e[27]||(e[27]=[m("Cancel")])),_:1,__:[27]}),o(a(h),{type:"submit",class:"bg-indigo-600 text-white py-2 h-10 rounded-md hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:r(()=>e[28]||(e[28]=[m("Update")])),_:1,__:[28]})])],32)])])):q("",!0)])]),_:1})],64))}});export{rt as default};
