import{d as K,q as G,r as V,c as Z,o as H,f as u,g as r,p as c,u as l,Z as J,x as d,k as t,l as h,S as z,m as D,D as S,y,j as n,O as W,E as v,C as $,F as f,B as T,z as B}from"./app-Cxp-5L4P.js";import{_ as X,a as Y,b as L,c as M,d as ee,e as E}from"./TableRow.vue_vue_type_script_setup_true_lang-BXYBSToZ.js";import{_ as te}from"./AppLayout.vue_vue_type_script_setup_true_lang-BOKY9Jlb.js";import{u as se}from"./usePayrollStore-IAAZ71CY.js";import{C as I}from"./circle-check-big-Cu61lwuy.js";import{D as le}from"./dollar-sign-CNoGRBfl.js";import"./index-DEKMW6Xb.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-8RwTf7Nl.js";const oe={class:"space-y-4 p-6"},ae={class:"grid grid-cols-2 gap-3 sm:grid-cols-2"},ne={class:"flex flex-col"},re={class:"flex flex-col"},ie={class:"flex items-center gap-2"},de={class:"flex items-center gap-2"},ce={class:"ml-4 flex items-center"},ue={class:"relative inline-flex cursor-pointer items-center"},ge={class:"overflow-hidden rounded-md border"},pe={class:"rounded-lg border bg-white p-2 shadow-sm transition hover:shadow-md"},fe={class:"mb-2 flex items-center justify-between"},me={class:"flex items-center gap-2"},be=["checked","onChange"],ye={class:"text-sm font-semibold text-gray-900"},_e={class:"flex items-center justify-between"},xe={class:"font-semibold text-gray-900"},he={class:"flex items-center justify-between"},ve={class:"font-semibold text-gray-900"},we={class:"flex items-center justify-between"},ke={class:"font-semibold text-gray-900"},Ce={class:"flex items-center justify-between"},De=["onUpdate:modelValue","onInput"],Se={key:1,class:"font-semibold text-gray-900"},Te={class:"col-span-full flex items-center justify-between rounded-md bg-green-50 p-1 font-bold"},je={class:"col-span-full flex items-center justify-between rounded-md bg-red-50 p-1 font-bold"},Ne={class:"mt-2 flex gap-2"},$e={class:"pr-4"},Pe={class:"w-full text-xs"},Ve={class:"bg-gray-200 font-bold dark:bg-gray-700"},ze={colspan:"4",class:"px-3 py-2"},Be={class:"bg-blue-50 font-semibold px-3 mp-2"},Le={colspan:"5",class:"px-3 py-2"},Me={class:"p-2"},Ee={class:"p-2 text-right"},Ie={class:"p-2 text-right"},Ue={class:"p-2 text-right font-semibold"},qe={class:"bg-blue-100 font-bold"},Fe={class:"p-2 text-right"},Oe={class:"p-2 text-right"},Ae={key:0},Qe={class:"flex justify-end"},et=K({__name:"CLosing",setup(Re){const g=se(),{employees:j,startDate:w,endDate:k,selectedEmployees:_}=G(g),C=V(""),U=Z(()=>C.value?j.value.filter(a=>{var e;return(e=a.employee_name)==null?void 0:e.toLowerCase().includes(C.value.toLowerCase())}):j.value),x=V(!0),q=a=>{const e=a.target;g.selectedEmployees=e.checked?j.value.map(s=>s.employee_id):[]},F=[{title:"Payroll Closing Management",href:"/payroll/closing"}];H(()=>{const a=new Date,e=new Date;e.setDate(a.getDate()-6),w.value=e.toISOString().split("T")[0],k.value=a.toISOString().split("T")[0],g.loadPayrollData()});const O=a=>a.reduce((e,s)=>e+Number(s.qty),0),A=a=>a.reduce((e,s)=>{const o=s.price_per_unit||s.price||0;return e+s.qty*o},0),Q=a=>{if(!a)return"-";const e=a.split("T")[0],[s,o,i]=e.split("-");return`${i}/${o}/${s}`},R=a=>{if(!a.details)return{};const e={};a.details.forEach(o=>{var b;const i=((b=o.created_at)==null?void 0:b.split("T")[0])||"-",m=o.model_desc||"-";e[i]||(e[i]={}),e[i][m]||(e[i][m]=[]),e[i][m].push(o)});const s={};return Object.keys(e).sort((o,i)=>i.localeCompare(o)).forEach(o=>{s[o]={},Object.keys(e[o]).sort().forEach(i=>{s[o][i]=e[o][i]})}),s},N=(a,e=!1)=>{if(a==null||a==="")return"";const s=typeof a=="string"?parseFloat(a.replace(/[^\d,-]/g,"").replace(/,/g,".")):a;if(isNaN(s))return"";const o={minimumFractionDigits:0,maximumFractionDigits:0};return e&&(o.style="currency",o.currency="IDR"),new Intl.NumberFormat("id-ID",o).format(s)};return(a,e)=>(r(),u(f,null,[c(l(J),{title:"Payroll Management"}),c(te,{breadcrumbs:F},{default:d(()=>[t("div",oe,[t("div",ae,[t("div",ne,[e[4]||(e[4]=t("label",{class:"mb-1 text-xs font-medium"},"Tanggal Mulai",-1)),h(t("input",{type:"date","onUpdate:modelValue":e[0]||(e[0]=s=>z(w)?w.value=s:null),class:"rounded-md border px-3 py-1.5 text-sm shadow-sm focus:border-indigo-500 focus:ring"},null,512),[[D,l(w),void 0,{lazy:!0}]])]),t("div",re,[e[5]||(e[5]=t("label",{class:"mb-1 text-xs font-medium"},"Tanggal Akhir",-1)),h(t("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=s=>z(k)?k.value=s:null),class:"rounded-md border px-3 py-1.5 text-sm shadow-sm focus:border-indigo-500 focus:ring"},null,512),[[D,l(k),void 0,{lazy:!0}]])])]),t("div",ie,[c(l(S),{onClick:l(g).loadPayrollData,size:"sm",class:"rounded bg-blue-600 px-4 py-2 text-sm text-white hover:bg-blue-700"},{default:d(()=>e[6]||(e[6]=[y(" Tampilkan ")])),_:1,__:[6]},8,["onClick"]),h(t("input",{type:"text",placeholder:"Cari Karyawan","onUpdate:modelValue":e[2]||(e[2]=s=>C.value=s),class:"rounded-md border px-3 py-1.5 text-sm shadow-sm focus:border-indigo-500 focus:ring"},null,512),[[D,C.value,void 0,{lazy:!0}]])]),t("div",de,[c(l(S),{onClick:l(g).closePayroll,disabled:l(_).length===0,class:"bg-green-600 text-white hover:bg-green-700 disabled:cursor-not-allowed disabled:opacity-50"},{default:d(()=>[c(l(I),{class:"h-4 w-4"}),y(" Bayar ("+n(l(_).length)+") ",1)]),_:1},8,["onClick","disabled"]),t("div",ce,[t("label",ue,[h(t("input",{id:"detailToggle",type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=s=>x.value=s),class:"peer sr-only"},null,512),[[W,x.value]]),e[7]||(e[7]=t("div",{class:"peer h-6 w-11 rounded-full bg-gray-200 after:absolute after:left-[2px] after:top-[2px] after:h-5 after:w-5 after:rounded-full after:border after:border-gray-300 after:bg-white after:transition-all after:content-[''] peer-checked:bg-blue-600 peer-checked:after:translate-x-full peer-checked:after:border-white"},null,-1)),e[8]||(e[8]=t("span",{class:"ml-3 text-sm"},"Detail",-1))])])]),t("div",ge,[c(l(X),null,{default:d(()=>[c(l(Y),null,{default:d(()=>[c(l(L),{class:"bg-gray-50"},{default:d(()=>[c(l(M),null,{default:d(()=>[t("input",{type:"checkbox",onChange:q},null,32),e[9]||(e[9]=y(" Karyawan"))]),_:1,__:[9]}),x.value?(r(),v(l(M),{key:0},{default:d(()=>e[10]||(e[10]=[y("Detail")])),_:1,__:[10]})):$("",!0)]),_:1})]),_:1}),c(l(ee),null,{default:d(()=>[(r(!0),u(f,null,T(U.value,s=>(r(),v(l(L),{key:s.employee_id,class:"bg-white align-top hover:bg-gray-50"},{default:d(()=>[c(l(E),{class:"align-top sm:p-2"},{default:d(()=>[t("div",pe,[t("div",fe,[t("div",me,[t("input",{type:"checkbox",checked:l(_).includes(s.employee_id),onChange:()=>l(g).toggleSelect(s.employee_id),class:"h-4 w-4 accent-green-500"},null,40,be),t("span",ye,n(s.employee_name),1)]),t("span",{class:B(["rounded-full px-2 py-0.5 text-xs font-semibold capitalize",s.status==="closed"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"])},n(s.status),3)]),t("div",{class:B(["grid gap-1 text-sm text-gray-700",x.value?"grid-cols-1":"sm:grid-cols-2 md:grid-cols-3"])},[t("div",_e,[e[11]||(e[11]=t("span",null,"Qty",-1)),t("span",xe,n(s.total_qty),1)]),t("div",he,[e[12]||(e[12]=t("span",null,"Upah",-1)),t("span",ve,n(Number(s.total_upah).toLocaleString()),1)]),t("div",we,[e[13]||(e[13]=t("span",null,"Makan",-1)),t("span",ke,n(Number(s.uang_makan).toLocaleString()),1)]),t("div",Ce,[e[14]||(e[14]=t("span",null,"Potongan",-1)),s.saldo_kasbon>0?h((r(),u("input",{key:0,type:"number","onUpdate:modelValue":o=>s.potongan=o,onInput:o=>l(g).updatePotongan(s.employee_id,s.potongan),class:"w-20 border-b border-gray-300 text-right text-sm focus:border-green-500 focus:outline-none"},null,40,De)),[[D,s.potongan,void 0,{number:!0}]]):(r(),u("span",Se,"0"))]),t("div",Te,[e[15]||(e[15]=t("span",null,"Total Gaji",-1)),t("span",null,n(Number(s.total_gaji).toLocaleString()),1)]),t("div",je,[e[16]||(e[16]=t("span",null,"Sisa Kasbon",-1)),t("span",null,n(Number(s.saldo_kasbon).toLocaleString()),1)])],2),t("div",Ne,[c(l(S),{variant:"outline",onClick:o=>l(g).closeSingle(s),disabled:s.status==="closed",class:"flex flex-1 items-center justify-center gap-2 rounded-md bg-green-600 text-sm font-semibold text-white transition hover:bg-green-700 disabled:cursor-not-allowed disabled:opacity-50"},{default:d(()=>[s.status!=="closed"?(r(),v(l(le),{key:0,class:"h-4 w-4"})):(r(),v(l(I),{key:1,class:"h-4 w-4"})),e[17]||(e[17]=y(" Bayar "))]),_:2,__:[17]},1032,["onClick","disabled"])])])]),_:2},1024),x.value?(r(),v(l(E),{key:0,class:"p-0 align-top sm:p-2"},{default:d(()=>{var o;return[t("div",$e,[t("table",Pe,[(r(!0),u(f,null,T(R(s),(i,m)=>(r(),u(f,{key:m},[t("tr",Ve,[t("td",ze,"ðŸ“… "+n(Q(m)),1)]),(r(!0),u(f,null,T(i,(b,P)=>(r(),u(f,{key:P},[t("tr",Be,[t("td",Le,"ðŸ§µ Model: "+n(P),1)]),e[20]||(e[20]=t("tr",{class:"bg-gray-100 font-semibold text-gray-600 dark:bg-gray-700"},[t("td",{class:"w-1/3 p-2 text-left"},"Size - Variant"),t("td",{class:"w-1/6 p-2 text-right"},"Qty"),t("td",{class:"w-1/6 p-2 text-right"},"Price"),t("td",{class:"w-1/3 p-2 text-right"},"Total Price")],-1)),(r(!0),u(f,null,T(b,p=>(r(),u("tr",{key:p.id,class:"border-b bg-white"},[t("td",Me,n(p.size_id)+" - "+n(p.variant),1),t("td",Ee,n(Number(p.qty).toLocaleString()),1),t("td",Ie,n(N(p.price||0)),1),t("td",Ue,n(N(p.qty*(p.price||0))),1)]))),128)),t("tr",qe,[e[18]||(e[18]=t("td",{class:"p-2 text-right"},"Total :",-1)),t("td",Fe,n(O(b)),1),e[19]||(e[19]=t("td",null,null,-1)),t("td",Oe,n(N(A(b))),1)])],64))),128))],64))),128)),(o=s.details)!=null&&o.length?$("",!0):(r(),u("tr",Ae,e[21]||(e[21]=[t("td",{colspan:"4",class:"p-2 text-center text-gray-500"},"Tidak ada data rincian aktivitas.",-1)])))])])]}),_:2},1024)):$("",!0)]),_:2},1024))),128))]),_:1})]),_:1})]),t("div",Qe,[c(l(S),{onClick:l(g).closePayroll,disabled:l(_).length===0,class:"bg-green-600 text-white"},{default:d(()=>[y(" Close Selected ("+n(l(_).length)+") ",1)]),_:1},8,["onClick","disabled"])])])]),_:1})],64))}});export{et as default};
