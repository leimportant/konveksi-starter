import{d as G,aQ as f,w as B,T as Q,r as H,o as J,b as S,E as q,g as n,x as l,k as s,f as r,C as x,p as d,l as w,u as o,y as u,F as y,B as v,j as _,O as V,D as C,m as K,P as I}from"./app-Bj_kpMHq.js";import{_ as W}from"./AppLayout.vue_vue_type_script_setup_true_lang-C-B5aa47.js";import{_ as X}from"./Input.vue_vue_type_script_setup_true_lang-DJN7_ygH.js";import{_ as N}from"./Label.vue_vue_type_script_setup_true_lang-DMgLNupf.js";import{_ as Y,a as Z,b as O,c as b,d as tt,e as g}from"./TableRow.vue_vue_type_script_setup_true_lang-2xZ4sEoC.js";import{u as et}from"./useToast-BKXtDSru.js";import{u as st}from"./useTransferStockStore-kFaf5IXX.js";import{u as ot}from"./useInventoryStore-COrTFn35.js";import{d as at}from"./debounce-BcZQbp_F.js";import{T as it}from"./trash-f1KsgeP8.js";import"./index-DYrEdJEX.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CFabbRMa.js";const lt={class:"p-4 space-y-4 text-sm"},dt={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3"},nt=["value"],rt={key:0,class:"text-red-600 text-xs mt-1"},ut=["value"],_t={key:0,class:"text-red-600 text-xs mt-1"},ct=["value"],pt={key:0,class:"text-red-600 text-xs mt-1"},mt={class:"border rounded-lg p-4 bg-white shadow-sm"},ft={class:"flex justify-between items-center mb-4"},xt=["value"],yt=["value"],vt=["value"],bt={class:"flex justify-end gap-2"},gt={key:0,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"},kt={class:"bg-white rounded-lg shadow-lg w-11/12 max-w-4xl p-4 space-y-4 text-sm"},ht={class:"flex justify-between items-center"},wt={key:0,class:"text-center py-6"},Ct={key:1,class:"space-y-4"},$t={class:"flex flex-col sm:flex-row items-start sm:items-center gap-2"},zt=["disabled"],Tt={class:"overflow-x-auto rounded-md border border-gray-200 shadow-sm"},Pt={class:"min-w-full text-sm text-left whitespace-nowrap"},St={class:"px-3 py-2 font-medium text-gray-800"},Vt={class:"px-3 py-2"},Nt={class:"px-3 py-2"},Ut={class:"px-3 py-2 text-right"},jt={class:"px-3 py-2 text-center"},Bt=["onClick"],qt={key:0},Kt=G({__name:"Create",setup(It){const $=f({productName:""});B(()=>$.productName,at(a=>{c.setFilter("productName",a),c.fetchInventory()},500));const m=et(),c=ot(),D=st(),i=Q({location_id:void 0,location_destination_id:void 0,sloc_id:void 0,transfer_detail:[]}),p=f({}),z=f([]),U=f([]),L=f([]),k=H(!1);J(async()=>{try{const[a,t,e]=await Promise.all([S.get("/api/locations"),S.get("/api/slocs"),S.get("/api/products")]);z.push(...a.data.data),U.push(...t.data.data),L.push(...e.data.data)}catch(a){console.error(a),m.error("Gagal memuat data")}}),B(()=>i.location_id,()=>{h("location_id"),T()});const M=async()=>{if(!i.location_id||!i.sloc_id){m.error("Pilih lokasi dan sloc terlebih dahulu");return}c.filters.productName="";try{await c.fetchInventory(),k.value=!0}catch(a){console.error(a),m.error("Gagal memuat inventory")}},R=a=>{if(i.transfer_detail.find(e=>e.product_id===a.product_id&&e.size_id===a.size_id&&e.uom_id===a.uom.id)){m.error("Produk ini sudah ada di daftar detail");return}i.transfer_detail.push({product_id:a.product_id,product_name:a.product_name,size_id:a.size_id,size_name:a.size_id,uom_id:a.uom_id,uom_name:a.uom_id,qty:a.qty_available??1}),k.value=!1},h=a=>{delete p[a]},F=()=>{I.visit("/transfer-stock")},A=async()=>{var a;try{if(!i.location_id||!i.location_destination_id||!i.sloc_id){m.error("Semua lokasi dan sloc wajib diisi");return}await D.createTransfer({location_id:i.location_id,location_destination_id:i.location_destination_id,sloc_id:i.sloc_id,transfer_detail:i.transfer_detail.map(t=>({product_id:t.product_id,size_id:t.size_id,uom_id:t.uom_id,qty:t.qty}))}),m.success("Transfer berhasil disimpan"),I.visit("/transfer-stock")}catch(t){((a=t.response)==null?void 0:a.status)===422?Object.assign(p,t.response.data.errors):m.error("Gagal menyimpan transfer")}};function E(a){i.transfer_detail.splice(a,1)}const T=()=>{h("location_id"),h("sloc_id"),i.transfer_detail.splice(0,i.transfer_detail.length)};return(a,t)=>(n(),q(W,{title:"Tambah Transfer Stock"},{default:l(()=>[s("div",lt,[s("div",dt,[s("div",null,[d(o(N),{for:"location_id"},{default:l(()=>t[6]||(t[6]=[u("Lokasi Asal")])),_:1,__:[6]}),w(s("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>o(i).location_id=e),id:"location_id",class:"w-full border rounded p-1",onChange:T},[t[7]||(t[7]=s("option",{disabled:"",value:""},"Pilih lokasi",-1)),(n(!0),r(y,null,v(z,e=>(n(),r("option",{key:e.id,value:e.id},_(e.name),9,nt))),128))],544),[[V,o(i).location_id]]),p.location_id?(n(),r("p",rt,_(p.location_id),1)):x("",!0)]),s("div",null,[d(o(N),{for:"location_destination_id"},{default:l(()=>t[8]||(t[8]=[u("Lokasi Tujuan")])),_:1,__:[8]}),w(s("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>o(i).location_destination_id=e),id:"location_destination_id",class:"w-full border rounded p-1",onChange:t[2]||(t[2]=e=>h("location_destination_id"))},[t[9]||(t[9]=s("option",{disabled:"",value:""},"Pilih lokasi",-1)),(n(!0),r(y,null,v(z,e=>(n(),r("option",{key:e.id,value:e.id},_(e.name),9,ut))),128))],544),[[V,o(i).location_destination_id]]),p.location_destination_id?(n(),r("p",_t,_(p.location_destination_id),1)):x("",!0)]),s("div",null,[d(o(N),{for:"sloc_id"},{default:l(()=>t[10]||(t[10]=[u("Sloc")])),_:1,__:[10]}),w(s("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>o(i).sloc_id=e),id:"sloc_id",class:"w-full border rounded p-1",onChange:T},[t[11]||(t[11]=s("option",{disabled:"",value:""},"Pilih sloc",-1)),(n(!0),r(y,null,v(U,e=>(n(),r("option",{key:e.id,value:e.id},_(e.name),9,ct))),128))],544),[[V,o(i).sloc_id]]),p.sloc_id?(n(),r("p",pt,_(p.sloc_id),1)):x("",!0)])]),s("div",mt,[s("div",ft,[t[13]||(t[13]=s("h2",{class:"font-semibold text-gray-800 text-base"},"Detail Barang",-1)),d(o(C),{variant:"outline",size:"sm",class:"text-xs",onClick:M,disabled:!o(i).location_id||!o(i).sloc_id},{default:l(()=>t[12]||(t[12]=[u(" Tambah Baris ")])),_:1,__:[12]},8,["disabled"])]),d(o(Y),null,{default:l(()=>[d(o(Z),null,{default:l(()=>[d(o(O),null,{default:l(()=>[d(o(b),{class:"text-xs"},{default:l(()=>t[14]||(t[14]=[u("Produk")])),_:1,__:[14]}),d(o(b),{class:"text-xs"},{default:l(()=>t[15]||(t[15]=[u("Ukuran")])),_:1,__:[15]}),d(o(b),{class:"text-xs"},{default:l(()=>t[16]||(t[16]=[u("UOM")])),_:1,__:[16]}),d(o(b),{class:"text-xs text-center"},{default:l(()=>t[17]||(t[17]=[u("Qty")])),_:1,__:[17]}),d(o(b),{class:"text-xs text-center"},{default:l(()=>t[18]||(t[18]=[u("Aksi")])),_:1,__:[18]})]),_:1})]),_:1}),d(o(tt),null,{default:l(()=>[(n(!0),r(y,null,v(o(i).transfer_detail,(e,P)=>(n(),q(o(O),{key:P},{default:l(()=>[d(o(g),null,{default:l(()=>[s("input",{type:"text",value:e.product_name,readonly:"",class:"w-full bg-gray-100 text-sm border rounded px-2 py-1"},null,8,xt)]),_:2},1024),d(o(g),null,{default:l(()=>[s("input",{type:"text",value:e.size_id,readonly:"",class:"w-full bg-gray-100 text-sm border rounded px-2 py-1"},null,8,yt)]),_:2},1024),d(o(g),null,{default:l(()=>[s("input",{type:"text",value:e.uom_id,readonly:"",class:"w-full bg-gray-100 text-sm border rounded px-2 py-1"},null,8,vt)]),_:2},1024),d(o(g),{class:"text-center"},{default:l(()=>[d(o(X),{type:"number",min:"1",step:"1",modelValue:e.qty,"onUpdate:modelValue":j=>e.qty=j,class:"w-full text-sm px-2 py-1 border rounded"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),d(o(g),{class:"text-center"},{default:l(()=>[d(o(C),{variant:"destructive",size:"sm",class:"text-xs",onClick:j=>E(P)},{default:l(()=>[d(o(it),{class:"h-4 w-4"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),s("div",bt,[d(o(C),{onClick:A,disabled:o(i).processing,class:"bg-indigo-600 text-white text-sm px-4 py-2 rounded hover:bg-indigo-700"},{default:l(()=>t[19]||(t[19]=[u("Simpan")])),_:1,__:[19]},8,["disabled"]),d(o(C),{onClick:F,variant:"outline",class:"text-sm px-4 py-2"},{default:l(()=>t[20]||(t[20]=[u("Batal")])),_:1,__:[20]})])]),k.value?(n(),r("div",gt,[s("div",kt,[s("div",ht,[t[21]||(t[21]=s("h3",{class:"text-base font-semibold"},"Pilih Produk dari Inventory",-1)),s("button",{onClick:t[4]||(t[4]=e=>k.value=!1),class:"text-gray-600 hover:text-gray-900 text-lg"},"Ã—")]),o(c).loading?(n(),r("div",wt,"Loading inventory...")):(n(),r("div",Ct,[s("div",$t,[w(s("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>$.productName=e),placeholder:"Cari Produk",disabled:o(c).loading,class:"w-full sm:w-64 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 text-sm","aria-label":"Search"},null,8,zt),[[K,$.productName]])]),s("div",Tt,[s("table",Pt,[t[23]||(t[23]=s("thead",{class:"bg-gray-100 text-gray-700 uppercase text-xs"},[s("tr",null,[s("th",{class:"px-3 py-2"},"Produk"),s("th",{class:"px-3 py-2"},"Size"),s("th",{class:"px-3 py-2"},"UOM"),s("th",{class:"px-3 py-2 text-right"},"Qty"),s("th",{class:"px-3 py-2 text-center"},"Aksi")])],-1)),s("tbody",null,[(n(!0),r(y,null,v(o(c).inventoryRpt,e=>(n(),r("tr",{key:`${e.product_id}-${e.location_id}-${e.sloc_id}-${e.size_id}`,class:"hover:bg-gray-50 border-t"},[s("td",St,_(e.product_name),1),s("td",Vt,_(e.size_id),1),s("td",Nt,_(e.uom_id),1),s("td",Ut,_(e.qty),1),s("td",jt,[s("button",{onClick:P=>R(e),class:"text-blue-600 hover:text-blue-800 hover:underline transition"}," Pilih ",8,Bt)])]))),128)),o(c).inventoryRpt.length===0?(n(),r("tr",qt,t[22]||(t[22]=[s("td",{colspan:"5",class:"px-3 py-4 text-center text-gray-500"},"Tidak ada inventory ditemukan.",-1)]))):x("",!0)])])])]))])])):x("",!0)]),_:1}))}});export{Kt as default};
