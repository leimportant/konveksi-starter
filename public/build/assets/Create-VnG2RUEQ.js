import{d as L,r as i,o as U,w as j,f as b,g,p as s,u as d,Z as N,x,k as l,R as D,C as F,j as R,D as M,y as $,F as A,b as r,N as B}from"./app-Cy47uJEn.js";import{_ as O}from"./AppLayout.vue_vue_type_script_setup_true_lang-DoiPhHME.js";import{_ as V}from"./Input.vue_vue_type_script_setup_true_lang-CqeMOCnl.js";import{u as T}from"./useToast-BNLVGT5a.js";import{A as p}from"./vue3-select-BbduWhwE.js";import"./index-BtH-0mLd.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CSqrrGaT.js";const E={class:"p-6"},G={class:"full-w mx-auto"},P={key:0,class:"bg-red-50 text-red-700 border border-red-300 p-4 rounded-md shadow-sm"},I={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Q={class:"flex justify-end"},oe=L({__name:"Create",setup(Z){const v=i(!1),u=i(""),S=T(),o=i({product_id:0,location_id:{id:1,name:"Loading Location..."},sloc_id:"GS00",uom_id:"PCS",size_id:"",qty:0}),w=i([]),m=i([]),c=i([]),y=i([]),f=i([]),z=[{title:"Add Inventory Stock",href:"/inventory/create"}],k=async t=>{if(t.length<2){m.value=[];return}try{const e=await r.get("/api/products",{params:{search:t}});m.value=e.data.data}catch(e){console.error("Search error:",e),S.error("Failed to search products")}},h=async()=>{var t,e;try{const[a,_,C]=await Promise.all([r.get("/api/products"),r.get("/api/locations"),r.get("/api/slocs")]);w.value=a.data.data,c.value=_.data.data.map(n=>({id:n.id,name:(n==null?void 0:n.name)||`Location ${n.id}`})),y.value=C.data.data}catch(a){u.value=((e=(t=a.response)==null?void 0:t.data)==null?void 0:e.message)||"Failed to fetch data"}},q=async()=>{var t,e;v.value=!0,u.value="";try{const a={product_id:typeof o.value.product_id=="object"?o.value.product_id.id:o.value.product_id,location_id:typeof o.value.location_id=="object"?o.value.location_id.id:o.value.location_id,sloc_id:typeof o.value.sloc_id=="object"?o.value.sloc_id.id:o.value.sloc_id,size_id:o.value.size_id?typeof o.value.size_id=="object"?o.value.size_id.id:o.value.size_id:"",qty:o.value.qty,uom_id:o.value.uom_id};console.log("Submitting cleaned payload:",a),await r.post("/api/inventories",a),B.visit("/inventory")}catch(a){u.value=((e=(t=a.response)==null?void 0:t.data)==null?void 0:e.message)||"Failed to create inventory"}finally{v.value=!1}};return U(async()=>{if(await h(),c.value.length>0){const t=c.value.find(e=>e.id===1);t&&(o.value.location_id=t)}}),j(()=>o.value.product_id,t=>{const e=typeof t=="object"?t.id:t,a=m.value.find(_=>_.id===e);o.value.size_id="",f.value=[],a&&a.uom_id?(o.value.uom_id=a.uom_id,f.value=a.sizes):o.value.uom_id=""},{deep:!0}),(t,e)=>(g(),b(A,null,[s(d(N),{title:"Tambah Stock Gudang"}),s(O,{breadcrumbs:z},{default:x(()=>[l("div",E,[l("div",G,[l("form",{onSubmit:D(q,["prevent"]),class:"space-y-6"},[u.value?(g(),b("div",P,R(u.value),1)):F("",!0),l("div",I,[l("div",null,[e[6]||(e[6]=l("label",{for:"location",class:"block text-sm font-medium text-gray-700 mb-2"},"Location",-1)),s(d(p),{id:"location",modelValue:o.value.location_id,"onUpdate:modelValue":e[0]||(e[0]=a=>o.value.location_id=a),options:c.value,label:"name",placeholder:"Select Location",class:"w-full"},null,8,["modelValue","options"])]),l("div",null,[e[7]||(e[7]=l("label",{for:"product",class:"block text-sm font-medium text-gray-700 mb-2"},"Product",-1)),s(d(p),{modelValue:o.value.product_id,"onUpdate:modelValue":e[1]||(e[1]=a=>o.value.product_id=a),options:m.value,label:"name",value:"id",onSearch:k,placeholder:"Search a product"},null,8,["modelValue","options"])]),l("div",null,[e[8]||(e[8]=l("label",{for:"sloc",class:"block text-sm font-medium text-gray-700 mb-2"},"SLOC",-1)),s(d(p),{id:"sloc",modelValue:o.value.sloc_id,"onUpdate:modelValue":e[2]||(e[2]=a=>o.value.sloc_id=a),options:y.value,label:"name",value:"id",placeholder:"Select SLOC",class:"w-full"},null,8,["modelValue","options"])]),l("div",null,[e[9]||(e[9]=l("label",{for:"qty",class:"block text-sm font-medium text-gray-700 mb-2"},"Quantity",-1)),s(d(V),{id:"qty",modelValue:o.value.qty,"onUpdate:modelValue":e[3]||(e[3]=a=>o.value.qty=a),type:"number",placeholder:"Enter quantity",class:"w-full"},null,8,["modelValue"])]),l("div",null,[e[10]||(e[10]=l("label",{for:"size",class:"block text-sm font-medium text-gray-700 mb-2"},"Size",-1)),s(d(p),{id:"size",modelValue:o.value.size_id,"onUpdate:modelValue":e[4]||(e[4]=a=>o.value.size_id=a),options:f.value,label:"name",value:"id",placeholder:"Select Size",class:"w-full"},null,8,["modelValue","options"])]),l("div",null,[e[11]||(e[11]=l("label",{for:"uom",class:"block text-sm font-medium text-gray-700 mb-2"},"UOM",-1)),s(d(V),{id:"uom",modelValue:o.value.uom_id,"onUpdate:modelValue":e[5]||(e[5]=a=>o.value.uom_id=a),type:"text",placeholder:"Unit of Measure",class:"w-full",readonly:""},null,8,["modelValue"])])]),l("div",Q,[s(d(M),{type:"submit",loading:v.value,class:"px-6 py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-md shadow-md transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"},{default:x(()=>e[12]||(e[12]=[$(" Simpan ")])),_:1,__:[12]},8,["loading"])])],32)])])]),_:1})],64))}});export{oe as default};
