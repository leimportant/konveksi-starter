import{d as E,q as G,r as g,c as k,o as U,f as i,g as n,p as d,u as o,Z,x as _,k as e,D as w,y as H,G as J,F as P,B as F,j as l,E as N,C as B,z as W}from"./app-BHNKcnPG.js";import{_ as X}from"./Input.vue_vue_type_script_setup_true_lang-DvsyUhMc.js";import{u as Y}from"./useToast-CJ7HFMdh.js";import{_ as tt}from"./AppLayout.vue_vue_type_script_setup_true_lang-D7gq86-p.js";import{u as et}from"./useProductionStore-G-f7Bxli.js";import{P as st}from"./plus-A43wHS5H.js";import{S as at}from"./square-pen-DRTH05--.js";import{T as ot}from"./trash-2-ZlgBBDH6.js";import{V as rt}from"./view-A9u7uYdy.js";import"./index-ynyRUIXa.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-Jb1XFH3Z.js";const nt={class:"px-3 py-4"},lt={class:"mb-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3"},it={class:"flex flex-1 gap-2"},dt={key:0,class:"py-4 text-center text-sm text-gray-500"},ct={key:1,class:"space-y-2"},ut={class:"overflow-x-auto rounded-md border border-gray-200 dark:border-gray-700"},pt={class:"min-w-full table-auto text-sm text-left text-gray-800 dark:text-gray-100"},yt={class:"px-3 py-2 whitespace-nowrap align-top"},gt={class:"px-3 py-2 whitespace-nowrap align-top"},_t={class:"px-3 py-2 max-w-[160px] whitespace-normal align-top"},vt={class:"px-3 py-2 truncate align-top"},ht={class:"px-3 py-2 whitespace-nowrap"},xt={key:0},ft={key:1},mt={class:"px-3 py-2 max-w-[160px] truncate align-top"},bt={class:"px-3 py-2 max-w-[160px] truncate align-top"},kt={class:"px-3 py-2 text-right align-top"},wt={class:"flex justify-end gap-1 sm:gap-2"},Pt={class:"bg-gray-50 dark:bg-gray-800 font-semibold"},St={class:"px-3 py-2 text-right"},$t={class:"px-3 py-2"},Ct={class:"hidden"},Tt={class:"px-3 py-2 text-right"},Dt={class:"flex justify-end mt-4 space-x-2"},Ft=["disabled"],Vt=["onClick","disabled"],It=["disabled"],Qt=E({__name:"Index",props:{activity_role:{}},setup(O){const S=Y(),v=et(),{productions:h,currentPage:u,lastPage:j,loading:x}=G(v),V=g(50),I=g("created_at"),z=g("desc"),f=O,q=[{title:"Production",href:`/production/${f.activity_role}`}],$=k(()=>j.value||1),C=async a=>{var s,t;a<1||a>$.value||(await v.fetchProductions({page:a,per_page:V.value,sort_field:I.value,sort_order:z.value,activity_role_id:f.activity_role,search:m.value,date_from:(s=b.value.from)==null?void 0:s.toISOString(),date_to:(t=b.value.to)==null?void 0:t.toISOString()}),u.value=a)},R=()=>C(u.value+1),A=()=>C(u.value-1),m=g(""),b=g({from:null,to:null});function T(a){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(a)}const D=async(a=1)=>{var s,t,r,p;try{await v.fetchProductions({page:a||u.value,per_page:V.value,sort_field:I.value,sort_order:z.value,activity_role_id:f.activity_role,search:m.value,date_from:(s=b.value.from)==null?void 0:s.toISOString(),date_to:(t=b.value.to)==null?void 0:t.toISOString()})}catch(c){S.error(((p=(r=c==null?void 0:c.response)==null?void 0:r.data)==null?void 0:p.message)??"Failed to fetch productions")}},K=k(()=>h.value.reduce((a,s)=>{const t=String(s.total_price).replace(/[^\d]/g,""),r=parseFloat(t)||0;return a+r},0)),L=k(()=>h.value.reduce((a,s)=>{const t=parseFloat(String(s.price_per_pcs).replace(/[^\d.-]/g,""))||0;return a+t},0)),M=k(()=>h.value.reduce((a,s)=>{var r;const t=((r=s.items)==null?void 0:r.reduce((p,c)=>p+(parseFloat(String(c.qty))||0),0))||0;return a+t},0));U(D);const Q=async a=>{var s,t;if(confirm("Are you sure you want to delete this production?"))try{await v.deleteProduction(a),S.success("Production deleted successfully"),await D(1)}catch(r){S.error(((t=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:t.message)??"Failed to delete production")}};return(a,s)=>(n(),i(P,null,[d(o(Z),{title:"Production Management"}),d(tt,{breadcrumbs:q},{default:_(()=>[e("div",nt,[e("div",lt,[e("div",it,[d(o(w),{onClick:s[0]||(s[0]=t=>a.$inertia.visit(`/production/${f.activity_role}/create`)),class:"flex-shrink-0 flex items-center gap-2 rounded-md bg-indigo-600 px-3 py-2 text-sm font-medium text-white hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500"},{default:_(()=>[d(o(st),{class:"h-4 w-4"}),s[3]||(s[3]=H(" Tambah Data "))]),_:1,__:[3]}),d(o(X),{modelValue:m.value,"onUpdate:modelValue":s[1]||(s[1]=t=>m.value=t),placeholder:"Search...",class:"flex-1 text-sm",onKeyup:s[2]||(s[2]=J(t=>D(1),["enter"]))},null,8,["modelValue"])])]),o(x)?(n(),i("div",dt,"Loading...")):(n(),i("div",ct,[e("div",ut,[e("table",pt,[s[6]||(s[6]=e("thead",{class:"bg-gray-100 dark:bg-gray-800 text-xs font-semibold uppercase text-gray-600 dark:text-gray-300"},[e("tr",null,[e("th",{class:"px-3 py-2"},"Tanggal"),e("th",{class:"px-3 py-2"},"Karyawan"),e("th",{class:"px-3 py-2"},"Model"),e("th",{class:"px-3 py-2"},"Activity"),e("th",{class:"px-3 py-2"},"Size/Qty"),e("th",{class:"px-3 py-2"},"Price/PCS"),e("th",{class:"px-3 py-2"},"Total"),e("th",{class:"px-3 py-2 text-right"},"Actions")])],-1)),e("tbody",null,[(n(!0),i(P,null,F(o(h),t=>{var r,p,c;return n(),i("tr",{key:t.id,class:"border-b border-gray-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800"},[e("td",yt,l(t.created_at?new Date(t.created_at).toLocaleDateString():"-"),1),e("td",gt,l(t.employee_name||"-"),1),e("td",_t,l(((r=t.model)==null?void 0:r.description)||"-"),1),e("td",vt,l(((p=t.activity_role)==null?void 0:p.name)||"-"),1),e("td",ht,[(c=t.items)!=null&&c.length?(n(),i("div",xt,[(n(!0),i(P,null,F(t.items,y=>(n(),i("div",{key:y.id},l(y.size_id)+" - "+l(y.variant)+": "+l(y.qty),1))),128))])):(n(),i("div",ft,"-"))]),e("td",mt,l(T((t==null?void 0:t.price_per_pcs)||0)),1),e("td",bt,l((t==null?void 0:t.total_price)||0),1),e("td",kt,[e("div",wt,[t.status===1||t.status===3?(n(),N(o(w),{key:0,variant:"ghost",size:"icon",class:"hover:bg-gray-100 dark:hover:bg-gray-700",onClick:y=>a.$inertia.visit(`/production/${t.activity_role_id}/edit/${t.id}`)},{default:_(()=>[d(o(at),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):B("",!0),t.status===1||t.status===3?(n(),N(o(w),{key:1,variant:"ghost",size:"icon",class:"hover:bg-gray-100 dark:hover:bg-gray-700",onClick:y=>Q(t.id)},{default:_(()=>[d(o(ot),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):B("",!0),d(o(w),{variant:"ghost",size:"icon",class:"hover:bg-gray-100 dark:hover:bg-gray-700",onClick:y=>a.$inertia.visit(`/production/${t.activity_role_id}/view/${t.id}`)},{default:_(()=>[d(o(rt),{class:"h-4 w-4"})]),_:2},1032,["onClick"])])])])}),128))]),e("tfoot",null,[e("tr",Pt,[s[4]||(s[4]=e("td",{colspan:"4",class:"px-3 py-2 text-right"},"Total:",-1)),e("td",St,l(M.value),1),e("td",$t,[e("div",Ct,l(T(L.value)),1)]),e("td",Tt,l(T(K.value)),1),s[5]||(s[5]=e("td",null,null,-1))])])])]),e("div",Dt,[e("button",{onClick:A,disabled:o(u)===1||o(x),class:"px-3 py-1 rounded border border-gray-300 text-gray-700 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed"}," Previous ",8,Ft),(n(!0),i(P,null,F($.value,t=>(n(),i("button",{key:t,onClick:r=>C(t),class:W(["px-3 py-1 rounded border text-sm",t===o(u)?"bg-blue-600 border-blue-600 text-white":"border-gray-300 text-gray-700 hover:bg-gray-100"]),disabled:o(x)},l(t),11,Vt))),128)),e("button",{onClick:R,disabled:o(u)===$.value||o(x),class:"px-3 py-1 rounded border border-gray-300 text-gray-700 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed"}," Next ",8,It)])]))])]),_:1})],64))}});export{Qt as default};
